"use strict";(()=>{var Qh=Object.defineProperty;var td=(n,t,e)=>t in n?Qh(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var _=(n,t,e)=>td(n,typeof t!="symbol"?t+"":t,e);function $(n){var t=n.width,e=n.height;if(t<0)throw new Error("Negative width is not allowed for Size");if(e<0)throw new Error("Negative height is not allowed for Size");return{width:t,height:e}}function kt(n,t){return n.width===t.width&&n.height===t.height}var ed=(function(){function n(t){var e=this;this._resolutionListener=function(){return e._onResolutionChanged()},this._resolutionMediaQueryList=null,this._observers=[],this._window=t,this._installResolutionListener()}return n.prototype.dispose=function(){this._uninstallResolutionListener(),this._window=null},Object.defineProperty(n.prototype,"value",{get:function(){return this._window.devicePixelRatio},enumerable:!1,configurable:!0}),n.prototype.subscribe=function(t){var e=this,i={next:t};return this._observers.push(i),{unsubscribe:function(){e._observers=e._observers.filter(function(s){return s!==i})}}},n.prototype._installResolutionListener=function(){if(this._resolutionMediaQueryList!==null)throw new Error("Resolution listener is already installed");var t=this._window.devicePixelRatio;this._resolutionMediaQueryList=this._window.matchMedia("all and (resolution: ".concat(t,"dppx)")),this._resolutionMediaQueryList.addListener(this._resolutionListener)},n.prototype._uninstallResolutionListener=function(){this._resolutionMediaQueryList!==null&&(this._resolutionMediaQueryList.removeListener(this._resolutionListener),this._resolutionMediaQueryList=null)},n.prototype._reinstallResolutionListener=function(){this._uninstallResolutionListener(),this._installResolutionListener()},n.prototype._onResolutionChanged=function(){var t=this;this._observers.forEach(function(e){return e.next(t._window.devicePixelRatio)}),this._reinstallResolutionListener()},n})();function la(n){return new ed(n)}var id=(function(){function n(t,e,i){var s;this._canvasElement=null,this._bitmapSizeChangedListeners=[],this._suggestedBitmapSize=null,this._suggestedBitmapSizeChangedListeners=[],this._devicePixelRatioObservable=null,this._canvasElementResizeObserver=null,this._canvasElement=t,this._canvasElementClientSize=$({width:this._canvasElement.clientWidth,height:this._canvasElement.clientHeight}),this._transformBitmapSize=e??(function(r){return r}),this._allowResizeObserver=(s=i?.allowResizeObserver)!==null&&s!==void 0?s:!0,this._chooseAndInitObserver()}return n.prototype.dispose=function(){var t,e;if(this._canvasElement===null)throw new Error("Object is disposed");(t=this._canvasElementResizeObserver)===null||t===void 0||t.disconnect(),this._canvasElementResizeObserver=null,(e=this._devicePixelRatioObservable)===null||e===void 0||e.dispose(),this._devicePixelRatioObservable=null,this._suggestedBitmapSizeChangedListeners.length=0,this._bitmapSizeChangedListeners.length=0,this._canvasElement=null},Object.defineProperty(n.prototype,"canvasElement",{get:function(){if(this._canvasElement===null)throw new Error("Object is disposed");return this._canvasElement},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"canvasElementClientSize",{get:function(){return this._canvasElementClientSize},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"bitmapSize",{get:function(){return $({width:this.canvasElement.width,height:this.canvasElement.height})},enumerable:!1,configurable:!0}),n.prototype.resizeCanvasElement=function(t){this._canvasElementClientSize=$(t),this.canvasElement.style.width="".concat(this._canvasElementClientSize.width,"px"),this.canvasElement.style.height="".concat(this._canvasElementClientSize.height,"px"),this._invalidateBitmapSize()},n.prototype.subscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners.push(t)},n.prototype.unsubscribeBitmapSizeChanged=function(t){this._bitmapSizeChangedListeners=this._bitmapSizeChangedListeners.filter(function(e){return e!==t})},Object.defineProperty(n.prototype,"suggestedBitmapSize",{get:function(){return this._suggestedBitmapSize},enumerable:!1,configurable:!0}),n.prototype.subscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners.push(t)},n.prototype.unsubscribeSuggestedBitmapSizeChanged=function(t){this._suggestedBitmapSizeChangedListeners=this._suggestedBitmapSizeChangedListeners.filter(function(e){return e!==t})},n.prototype.applySuggestedBitmapSize=function(){if(this._suggestedBitmapSize!==null){var t=this._suggestedBitmapSize;this._suggestedBitmapSize=null,this._resizeBitmap(t),this._emitSuggestedBitmapSizeChanged(t,this._suggestedBitmapSize)}},n.prototype._resizeBitmap=function(t){var e=this.bitmapSize;kt(e,t)||(this.canvasElement.width=t.width,this.canvasElement.height=t.height,this._emitBitmapSizeChanged(e,t))},n.prototype._emitBitmapSizeChanged=function(t,e){var i=this;this._bitmapSizeChangedListeners.forEach(function(s){return s.call(i,t,e)})},n.prototype._suggestNewBitmapSize=function(t){var e=this._suggestedBitmapSize,i=$(this._transformBitmapSize(t,this._canvasElementClientSize)),s=kt(this.bitmapSize,i)?null:i;e===null&&s===null||e!==null&&s!==null&&kt(e,s)||(this._suggestedBitmapSize=s,this._emitSuggestedBitmapSizeChanged(e,s))},n.prototype._emitSuggestedBitmapSizeChanged=function(t,e){var i=this;this._suggestedBitmapSizeChangedListeners.forEach(function(s){return s.call(i,t,e)})},n.prototype._chooseAndInitObserver=function(){var t=this;if(!this._allowResizeObserver){this._initDevicePixelRatioObservable();return}nd().then(function(e){return e?t._initResizeObserver():t._initDevicePixelRatioObservable()})},n.prototype._initDevicePixelRatioObservable=function(){var t=this;if(this._canvasElement!==null){var e=aa(this._canvasElement);if(e===null)throw new Error("No window is associated with the canvas");this._devicePixelRatioObservable=la(e),this._devicePixelRatioObservable.subscribe(function(){return t._invalidateBitmapSize()}),this._invalidateBitmapSize()}},n.prototype._invalidateBitmapSize=function(){var t,e;if(this._canvasElement!==null){var i=aa(this._canvasElement);if(i!==null){var s=(e=(t=this._devicePixelRatioObservable)===null||t===void 0?void 0:t.value)!==null&&e!==void 0?e:i.devicePixelRatio,r=this._canvasElement.getClientRects(),o=r[0]!==void 0?sd(r[0],s):$({width:this._canvasElementClientSize.width*s,height:this._canvasElementClientSize.height*s});this._suggestNewBitmapSize(o)}}},n.prototype._initResizeObserver=function(){var t=this;this._canvasElement!==null&&(this._canvasElementResizeObserver=new ResizeObserver(function(e){var i=e.find(function(o){return o.target===t._canvasElement});if(!(!i||!i.devicePixelContentBoxSize||!i.devicePixelContentBoxSize[0])){var s=i.devicePixelContentBoxSize[0],r=$({width:s.inlineSize,height:s.blockSize});t._suggestNewBitmapSize(r)}}),this._canvasElementResizeObserver.observe(this._canvasElement,{box:"device-pixel-content-box"}))},n})();function yr(n,t){if(t.type==="device-pixel-content-box")return new id(n,t.transform,t.options);throw new Error("Unsupported binding target")}function aa(n){return n.ownerDocument.defaultView}function nd(){return new Promise(function(n){var t=new ResizeObserver(function(e){n(e.every(function(i){return"devicePixelContentBoxSize"in i})),t.disconnect()});t.observe(document.body,{box:"device-pixel-content-box"})}).catch(function(){return!1})}function sd(n,t){return $({width:Math.round(n.left*t+n.width*t)-Math.round(n.left*t),height:Math.round(n.top*t+n.height*t)-Math.round(n.top*t)})}var ca=(function(){function n(t,e,i){if(e.width===0||e.height===0)throw new TypeError("Rendering target could only be created on a media with positive width and height");if(this._mediaSize=e,i.width===0||i.height===0)throw new TypeError("Rendering target could only be created using a bitmap with positive integer width and height");this._bitmapSize=i,this._context=t}return n.prototype.useMediaCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),this._context.scale(this._horizontalPixelRatio,this._verticalPixelRatio),t({context:this._context,mediaSize:this._mediaSize})}finally{this._context.restore()}},n.prototype.useBitmapCoordinateSpace=function(t){try{return this._context.save(),this._context.setTransform(1,0,0,1,0,0),t({context:this._context,mediaSize:this._mediaSize,bitmapSize:this._bitmapSize,horizontalPixelRatio:this._horizontalPixelRatio,verticalPixelRatio:this._verticalPixelRatio})}finally{this._context.restore()}},Object.defineProperty(n.prototype,"_horizontalPixelRatio",{get:function(){return this._bitmapSize.width/this._mediaSize.width},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"_verticalPixelRatio",{get:function(){return this._bitmapSize.height/this._mediaSize.height},enumerable:!1,configurable:!0}),n})();function Vt(n,t){var e=n.canvasElementClientSize;if(e.width===0||e.height===0)return null;var i=n.bitmapSize;if(i.width===0||i.height===0)return null;var s=n.canvasElement.getContext("2d",t);return s===null?null:new ca(s,e,i)}var rd={upColor:"#26a69a",downColor:"#ef5350",wickVisible:!0,borderVisible:!0,borderColor:"#378658",borderUpColor:"#26a69a",borderDownColor:"#ef5350",wickColor:"#737375",wickUpColor:"#26a69a",wickDownColor:"#ef5350"},od={upColor:"#26a69a",downColor:"#ef5350",openVisible:!0,thinBars:!0},ld={color:"#2196f3",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},ad={topColor:"rgba( 46, 220, 135, 0.4)",bottomColor:"rgba( 40, 221, 100, 0)",invertFilledArea:!1,lineColor:"#33D778",lineStyle:0,lineWidth:3,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},cd={baseValue:{type:"price",price:0},topFillColor1:"rgba(38, 166, 154, 0.28)",topFillColor2:"rgba(38, 166, 154, 0.05)",topLineColor:"rgba(38, 166, 154, 1)",bottomFillColor1:"rgba(239, 83, 80, 0.05)",bottomFillColor2:"rgba(239, 83, 80, 0.28)",bottomLineColor:"rgba(239, 83, 80, 1)",lineWidth:3,lineStyle:0,lineType:0,lineVisible:!0,crosshairMarkerVisible:!0,crosshairMarkerRadius:4,crosshairMarkerBorderColor:"",crosshairMarkerBorderWidth:2,crosshairMarkerBackgroundColor:"",lastPriceAnimation:0,pointMarkersVisible:!1},ud={color:"#26a69a",base:0},Ya={color:"#2196f3"},Qa={title:"",visible:!0,lastValueVisible:!0,priceLineVisible:!0,priceLineSource:0,priceLineWidth:1,priceLineColor:"",priceLineStyle:2,baseLineVisible:!0,baseLineWidth:1,baseLineColor:"#B2B5BE",baseLineStyle:0,priceFormat:{type:"price",precision:2,minMove:.01}},ua,ha;function ve(n,t){let e={0:[],1:[n.lineWidth,n.lineWidth],2:[2*n.lineWidth,2*n.lineWidth],3:[6*n.lineWidth,6*n.lineWidth],4:[n.lineWidth,4*n.lineWidth]}[t];n.setLineDash(e)}function tc(n,t,e,i){n.beginPath();let s=n.lineWidth%2?.5:0;n.moveTo(e,t+s),n.lineTo(i,t+s),n.stroke()}function te(n,t){if(!n)throw new Error("Assertion failed"+(t?": "+t:""))}function it(n){if(n===void 0)throw new Error("Value is undefined");return n}function y(n){if(n===null)throw new Error("Value is null");return n}function ze(n){return y(it(n))}(function(n){n[n.Simple=0]="Simple",n[n.WithSteps=1]="WithSteps",n[n.Curved=2]="Curved"})(ua||(ua={})),(function(n){n[n.Solid=0]="Solid",n[n.Dotted=1]="Dotted",n[n.Dashed=2]="Dashed",n[n.LargeDashed=3]="LargeDashed",n[n.SparseDotted=4]="SparseDotted"})(ha||(ha={}));var da={khaki:"#f0e68c",azure:"#f0ffff",aliceblue:"#f0f8ff",ghostwhite:"#f8f8ff",gold:"#ffd700",goldenrod:"#daa520",gainsboro:"#dcdcdc",gray:"#808080",green:"#008000",honeydew:"#f0fff0",floralwhite:"#fffaf0",lightblue:"#add8e6",lightcoral:"#f08080",lemonchiffon:"#fffacd",hotpink:"#ff69b4",lightyellow:"#ffffe0",greenyellow:"#adff2f",lightgoldenrodyellow:"#fafad2",limegreen:"#32cd32",linen:"#faf0e6",lightcyan:"#e0ffff",magenta:"#f0f",maroon:"#800000",olive:"#808000",orange:"#ffa500",oldlace:"#fdf5e6",mediumblue:"#0000cd",transparent:"#0000",lime:"#0f0",lightpink:"#ffb6c1",mistyrose:"#ffe4e1",moccasin:"#ffe4b5",midnightblue:"#191970",orchid:"#da70d6",mediumorchid:"#ba55d3",mediumturquoise:"#48d1cc",orangered:"#ff4500",royalblue:"#4169e1",powderblue:"#b0e0e6",red:"#f00",coral:"#ff7f50",turquoise:"#40e0d0",white:"#fff",whitesmoke:"#f5f5f5",wheat:"#f5deb3",teal:"#008080",steelblue:"#4682b4",bisque:"#ffe4c4",aquamarine:"#7fffd4",aqua:"#0ff",sienna:"#a0522d",silver:"#c0c0c0",springgreen:"#00ff7f",antiquewhite:"#faebd7",burlywood:"#deb887",brown:"#a52a2a",beige:"#f5f5dc",chocolate:"#d2691e",chartreuse:"#7fff00",cornflowerblue:"#6495ed",cornsilk:"#fff8dc",crimson:"#dc143c",cadetblue:"#5f9ea0",tomato:"#ff6347",fuchsia:"#f0f",blue:"#00f",salmon:"#fa8072",blanchedalmond:"#ffebcd",slateblue:"#6a5acd",slategray:"#708090",thistle:"#d8bfd8",tan:"#d2b48c",cyan:"#0ff",darkblue:"#00008b",darkcyan:"#008b8b",darkgoldenrod:"#b8860b",darkgray:"#a9a9a9",blueviolet:"#8a2be2",black:"#000",darkmagenta:"#8b008b",darkslateblue:"#483d8b",darkkhaki:"#bdb76b",darkorchid:"#9932cc",darkorange:"#ff8c00",darkgreen:"#006400",darkred:"#8b0000",dodgerblue:"#1e90ff",darkslategray:"#2f4f4f",dimgray:"#696969",deepskyblue:"#00bfff",firebrick:"#b22222",forestgreen:"#228b22",indigo:"#4b0082",ivory:"#fffff0",lavenderblush:"#fff0f5",feldspar:"#d19275",indianred:"#cd5c5c",lightgreen:"#90ee90",lightgrey:"#d3d3d3",lightskyblue:"#87cefa",lightslategray:"#789",lightslateblue:"#8470ff",snow:"#fffafa",lightseagreen:"#20b2aa",lightsalmon:"#ffa07a",darksalmon:"#e9967a",darkviolet:"#9400d3",mediumpurple:"#9370d8",mediumaquamarine:"#66cdaa",skyblue:"#87ceeb",lavender:"#e6e6fa",lightsteelblue:"#b0c4de",mediumvioletred:"#c71585",mintcream:"#f5fffa",navajowhite:"#ffdead",navy:"#000080",olivedrab:"#6b8e23",palevioletred:"#d87093",violetred:"#d02090",yellow:"#ff0",yellowgreen:"#9acd32",lawngreen:"#7cfc00",pink:"#ffc0cb",paleturquoise:"#afeeee",palegoldenrod:"#eee8aa",darkolivegreen:"#556b2f",darkseagreen:"#8fbc8f",darkturquoise:"#00ced1",peachpuff:"#ffdab9",deeppink:"#ff1493",violet:"#ee82ee",palegreen:"#98fb98",mediumseagreen:"#3cb371",peru:"#cd853f",saddlebrown:"#8b4513",sandybrown:"#f4a460",rosybrown:"#bc8f8f",purple:"#800080",seagreen:"#2e8b57",seashell:"#fff5ee",papayawhip:"#ffefd5",mediumslateblue:"#7b68ee",plum:"#dda0dd",mediumspringgreen:"#00fa9a"};function yt(n){return n<0?0:n>255?255:Math.round(n)||0}function ec(n){return n<=0||n>1?Math.min(Math.max(n,0),1):Math.round(1e4*n)/1e4}var hd=/^#([0-9a-f])([0-9a-f])([0-9a-f])([0-9a-f])?$/i,dd=/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})?$/i,fd=/^rgb\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*\)$/,md=/^rgba\(\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d{1,10})\s*,\s*(-?\d*\.?\d+)\s*\)$/;function $i(n){(n=n.toLowerCase())in da&&(n=da[n]);{let t=md.exec(n)||fd.exec(n);if(t)return[yt(parseInt(t[1],10)),yt(parseInt(t[2],10)),yt(parseInt(t[3],10)),ec(t.length<5?1:parseFloat(t[4]))]}{let t=dd.exec(n);if(t)return[yt(parseInt(t[1],16)),yt(parseInt(t[2],16)),yt(parseInt(t[3],16)),1]}{let t=hd.exec(n);if(t)return[yt(17*parseInt(t[1],16)),yt(17*parseInt(t[2],16)),yt(17*parseInt(t[3],16)),1]}throw new Error(`Cannot parse color: ${n}`)}function ic(n){return .199*n[0]+.687*n[1]+.114*n[2]}function is(n){let t=$i(n);return{t:`rgb(${t[0]}, ${t[1]}, ${t[2]})`,i:ic(t)>160?"black":"white"}}var O=class{constructor(){this.h=[]}l(t,e,i){let s={o:t,_:e,u:i===!0};this.h.push(s)}v(t){let e=this.h.findIndex((i=>t===i.o));e>-1&&this.h.splice(e,1)}p(t){this.h=this.h.filter((e=>e._!==t))}m(t,e,i){let s=[...this.h];this.h=this.h.filter((r=>!r.u)),s.forEach((r=>r.o(t,e,i)))}M(){return this.h.length>0}S(){this.h=[]}};function Ct(n,...t){for(let e of t)for(let i in e)e[i]!==void 0&&(typeof e[i]!="object"||n[i]===void 0||Array.isArray(e[i])?n[i]=e[i]:Ct(n[i],e[i]));return n}function Rt(n){return typeof n=="number"&&isFinite(n)}function Vi(n){return typeof n=="number"&&n%1==0}function qi(n){return typeof n=="string"}function _n(n){return typeof n=="boolean"}function Ft(n){let t=n;if(!t||typeof t!="object")return t;let e,i,s;for(i in e=Array.isArray(t)?[]:{},t)t.hasOwnProperty(i)&&(s=t[i],e[i]=s&&typeof s=="object"?Ft(s):s);return e}function pd(n){return n!==null}function Fi(n){return n===null?void 0:n}var nl="-apple-system, BlinkMacSystemFont, 'Trebuchet MS', Roboto, Ubuntu, sans-serif";function We(n,t,e){return t===void 0&&(t=nl),`${e=e!==void 0?`${e} `:""}${n}px ${t}`}var $r=class{constructor(t){this.k={C:1,T:5,P:NaN,R:"",D:"",V:"",O:"",B:0,A:0,I:0,L:0,N:0},this.F=t}W(){let t=this.k,e=this.j(),i=this.H();return t.P===e&&t.D===i||(t.P=e,t.D=i,t.R=We(e,i),t.L=2.5/12*e,t.B=t.L,t.A=e/12*t.T,t.I=e/12*t.T,t.N=0),t.V=this.$(),t.O=this.U(),this.k}$(){return this.F.W().layout.textColor}U(){return this.F.q()}j(){return this.F.W().layout.fontSize}H(){return this.F.W().layout.fontFamily}},Bi=class{constructor(){this.Y=[]}Z(t){this.Y=t}X(t,e,i){this.Y.forEach((s=>{s.X(t,e,i)}))}},mt=class{X(t,e,i){t.useBitmapCoordinateSpace((s=>this.K(s,e,i)))}},Vr=class extends mt{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:i}){if(this.G===null||this.G.tt===null)return;let s=this.G.tt,r=this.G,o=Math.max(1,Math.floor(e))%2/2,l=a=>{t.beginPath();for(let c=s.to-1;c>=s.from;--c){let u=r.it[c],h=Math.round(u.nt*e)+o,d=u.st*i,f=a*i+o;t.moveTo(h,d),t.arc(h,d,f,0,2*Math.PI)}t.fill()};r.et>0&&(t.fillStyle=r.rt,l(r.ht+r.et)),t.fillStyle=r.lt,l(r.ht)}};function gd(){return{it:[{nt:0,st:0,ot:0,_t:0}],lt:"",rt:"",ht:0,et:0,tt:null}}var vd={from:0,to:1},Fr=class{constructor(t,e){this.ut=new Bi,this.ct=[],this.dt=[],this.ft=!0,this.F=t,this.vt=e,this.ut.Z(this.ct)}bt(t){let e=this.F.wt();e.length!==this.ct.length&&(this.dt=e.map(gd),this.ct=this.dt.map((i=>{let s=new Vr;return s.J(i),s})),this.ut.Z(this.ct)),this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.ut}Mt(){let t=this.vt.W().mode===2,e=this.F.wt(),i=this.vt.xt(),s=this.F.St();e.forEach(((r,o)=>{var l;let a=this.dt[o],c=r.kt(i);if(t||c===null||!r.yt())return void(a.tt=null);let u=y(r.Ct());a.lt=c.Tt,a.ht=c.ht,a.et=c.Pt,a.it[0]._t=c._t,a.it[0].st=r.Dt().Rt(c._t,u.Vt),a.rt=(l=c.Ot)!==null&&l!==void 0?l:this.F.Bt(a.it[0].st/r.Dt().At()),a.it[0].ot=i,a.it[0].nt=s.It(i),a.tt=vd}))}},Br=class extends mt{constructor(t){super(),this.zt=t}K({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:s}){if(this.zt===null)return;let r=this.zt.Lt.yt,o=this.zt.Et.yt;if(!r&&!o)return;let l=Math.round(this.zt.nt*i),a=Math.round(this.zt.st*s);t.lineCap="butt",r&&l>=0&&(t.lineWidth=Math.floor(this.zt.Lt.et*i),t.strokeStyle=this.zt.Lt.V,t.fillStyle=this.zt.Lt.V,ve(t,this.zt.Lt.Nt),(function(c,u,h,d){c.beginPath();let f=c.lineWidth%2?.5:0;c.moveTo(u+f,h),c.lineTo(u+f,d),c.stroke()})(t,l,0,e.height)),o&&a>=0&&(t.lineWidth=Math.floor(this.zt.Et.et*s),t.strokeStyle=this.zt.Et.V,t.fillStyle=this.zt.Et.V,ve(t,this.zt.Et.Nt),tc(t,a,0,e.width))}},zr=class{constructor(t){this.ft=!0,this.Ft={Lt:{et:1,Nt:0,V:"",yt:!1},Et:{et:1,Nt:0,V:"",yt:!1},nt:0,st:0},this.Wt=new Br(this.Ft),this.jt=t}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt}Mt(){let t=this.jt.yt(),e=y(this.jt.Ht()),i=e.$t().W().crosshair,s=this.Ft;if(i.mode===2)return s.Et.yt=!1,void(s.Lt.yt=!1);s.Et.yt=t&&this.jt.Ut(e),s.Lt.yt=t&&this.jt.qt(),s.Et.et=i.horzLine.width,s.Et.Nt=i.horzLine.style,s.Et.V=i.horzLine.color,s.Lt.et=i.vertLine.width,s.Lt.Nt=i.vertLine.style,s.Lt.V=i.vertLine.color,s.nt=this.jt.Yt(),s.st=this.jt.Zt()}};function bd(n,t,e,i,s,r){n.fillRect(t+r,e,i-2*r,r),n.fillRect(t+r,e+s-r,i-2*r,r),n.fillRect(t,e,r,s),n.fillRect(t+i-r,e,r,s)}function ns(n,t,e,i,s,r){n.save(),n.globalCompositeOperation="copy",n.fillStyle=r,n.fillRect(t,e,i,s),n.restore()}function fa(n,t,e,i,s,r){n.beginPath(),n.roundRect?n.roundRect(t,e,i,s,r):(n.lineTo(t+i-r[1],e),r[1]!==0&&n.arcTo(t+i,e,t+i,e+r[1],r[1]),n.lineTo(t+i,e+s-r[2]),r[2]!==0&&n.arcTo(t+i,e+s,t+i-r[2],e+s,r[2]),n.lineTo(t+r[3],e+s),r[3]!==0&&n.arcTo(t,e+s,t,e+s-r[3],r[3]),n.lineTo(t,e+r[0]),r[0]!==0&&n.arcTo(t,e,t+r[0],e,r[0]))}function ma(n,t,e,i,s,r,o=0,l=[0,0,0,0],a=""){if(n.save(),!o||!a||a===r)return fa(n,t,e,i,s,l),n.fillStyle=r,n.fill(),void n.restore();let c=o/2;var u;fa(n,t+c,e+c,i-o,s-o,(u=-c,l.map((h=>h===0?h:h+u)))),r!=="transparent"&&(n.fillStyle=r,n.fill()),a!=="transparent"&&(n.lineWidth=o,n.strokeStyle=a,n.closePath(),n.stroke()),n.restore()}function nc(n,t,e,i,s,r,o){n.save(),n.globalCompositeOperation="copy";let l=n.createLinearGradient(0,0,0,s);l.addColorStop(0,r),l.addColorStop(1,o),n.fillStyle=l,n.fillRect(t,e,i,s),n.restore()}var Hn=class{constructor(t,e){this.J(t,e)}J(t,e){this.zt=t,this.Xt=e}At(t,e){return this.zt.yt?t.P+t.L+t.B:0}X(t,e,i,s){if(!this.zt.yt||this.zt.Kt.length===0)return;let r=this.zt.V,o=this.Xt.t,l=t.useBitmapCoordinateSpace((a=>{let c=a.context;c.font=e.R;let u=this.Gt(a,e,i,s),h=u.Jt;return u.Qt?ma(c,h.ti,h.ii,h.ni,h.si,o,h.ei,[h.ht,0,0,h.ht],o):ma(c,h.ri,h.ii,h.ni,h.si,o,h.ei,[0,h.ht,h.ht,0],o),this.zt.hi&&(c.fillStyle=r,c.fillRect(h.ri,h.li,h.ai-h.ri,h.oi)),this.zt._i&&(c.fillStyle=e.O,c.fillRect(u.Qt?h.ui-h.ei:0,h.ii,h.ei,h.ci-h.ii)),u}));t.useMediaCoordinateSpace((({context:a})=>{let c=l.di;a.font=e.R,a.textAlign=l.Qt?"right":"left",a.textBaseline="middle",a.fillStyle=r,a.fillText(this.zt.Kt,c.fi,(c.ii+c.ci)/2+c.pi)}))}Gt(t,e,i,s){var r;let{context:o,bitmapSize:l,mediaSize:a,horizontalPixelRatio:c,verticalPixelRatio:u}=t,h=this.zt.hi||!this.zt.mi?e.T:0,d=this.zt.bi?e.C:0,f=e.L+this.Xt.wi,p=e.B+this.Xt.gi,m=e.A,g=e.I,v=this.zt.Kt,b=e.P,w=i.Mi(o,v),S=Math.ceil(i.xi(o,v)),x=b+f+p,A=e.C+m+g+S+h,N=Math.max(1,Math.floor(u)),B=Math.round(x*u);B%2!=N%2&&(B+=1);let bt=d>0?Math.max(1,Math.floor(d*c)):0,et=Math.round(A*c),vr=Math.round(h*c),$e=(r=this.Xt.Si)!==null&&r!==void 0?r:this.Xt.ki,kn=Math.round($e*u)-Math.floor(.5*u),me=Math.floor(kn+N/2-B/2),Ve=me+B,Jt=s==="right",Fe=Jt?a.width-d:d,ft=Jt?l.width-bt:bt,ot,Yt,br;return Jt?(ot=ft-et,Yt=ft-vr,br=Fe-h-m-d):(ot=ft+et,Yt=ft+vr,br=Fe+h+m),{Qt:Jt,Jt:{ii:me,li:kn,ci:Ve,ni:et,si:B,ht:2*c,ei:bt,ti:ot,ri:ft,ai:Yt,oi:N,ui:l.width},di:{ii:me/u,ci:Ve/u,fi:br,pi:w}}}},Ue=class{constructor(t){this.yi={ki:0,t:"#000",gi:0,wi:0},this.Ci={Kt:"",yt:!1,hi:!0,mi:!1,Ot:"",V:"#FFF",_i:!1,bi:!1},this.Ti={Kt:"",yt:!1,hi:!1,mi:!0,Ot:"",V:"#FFF",_i:!0,bi:!0},this.ft=!0,this.Pi=new(t||Hn)(this.Ci,this.yi),this.Ri=new(t||Hn)(this.Ti,this.yi)}Kt(){return this.Di(),this.Ci.Kt}ki(){return this.Di(),this.yi.ki}bt(){this.ft=!0}At(t,e=!1){return Math.max(this.Pi.At(t,e),this.Ri.At(t,e))}Vi(){return this.yi.Si||0}Oi(t){this.yi.Si=t}Bi(){return this.Di(),this.Ci.yt||this.Ti.yt}Ai(){return this.Di(),this.Ci.yt}gt(t){return this.Di(),this.Ci.hi=this.Ci.hi&&t.W().ticksVisible,this.Ti.hi=this.Ti.hi&&t.W().ticksVisible,this.Pi.J(this.Ci,this.yi),this.Ri.J(this.Ti,this.yi),this.Pi}Ii(){return this.Di(),this.Pi.J(this.Ci,this.yi),this.Ri.J(this.Ti,this.yi),this.Ri}Di(){this.ft&&(this.Ci.hi=!0,this.Ti.hi=!1,this.zi(this.Ci,this.Ti,this.yi))}},Hr=class extends Ue{constructor(t,e,i){super(),this.jt=t,this.Li=e,this.Ei=i}zi(t,e,i){if(t.yt=!1,this.jt.W().mode===2)return;let s=this.jt.W().horzLine;if(!s.labelVisible)return;let r=this.Li.Ct();if(!this.jt.yt()||this.Li.Ni()||r===null)return;let o=is(s.labelBackgroundColor);i.t=o.t,t.V=o.i;let l=2/12*this.Li.P();i.wi=l,i.gi=l;let a=this.Ei(this.Li);i.ki=a.ki,t.Kt=this.Li.Fi(a._t,r),t.yt=!0}},yd=/[1-9]/g,On=class{constructor(){this.zt=null}J(t){this.zt=t}X(t,e){if(this.zt===null||this.zt.yt===!1||this.zt.Kt.length===0)return;let i=t.useMediaCoordinateSpace((({context:d})=>(d.font=e.R,Math.round(e.Wi.xi(d,y(this.zt).Kt,yd)))));if(i<=0)return;let s=e.ji,r=i+2*s,o=r/2,l=this.zt.Hi,a=this.zt.ki,c=Math.floor(a-o)+.5;c<0?(a+=Math.abs(0-c),c=Math.floor(a-o)+.5):c+r>l&&(a-=Math.abs(l-(c+r)),c=Math.floor(a-o)+.5);let u=c+r,h=Math.ceil(0+e.C+e.T+e.L+e.P+e.B);t.useBitmapCoordinateSpace((({context:d,horizontalPixelRatio:f,verticalPixelRatio:p})=>{let m=y(this.zt);d.fillStyle=m.t;let g=Math.round(c*f),v=Math.round(0*p),b=Math.round(u*f),w=Math.round(h*p),S=Math.round(2*f);if(d.beginPath(),d.moveTo(g,v),d.lineTo(g,w-S),d.arcTo(g,w,g+S,w,S),d.lineTo(b-S,w),d.arcTo(b,w,b,w-S,S),d.lineTo(b,v),d.fill(),m.hi){let x=Math.round(m.ki*f),A=v,N=Math.round((A+e.T)*p);d.fillStyle=m.V;let B=Math.max(1,Math.floor(f)),bt=Math.floor(.5*f);d.fillRect(x-bt,A,B,N-A)}})),t.useMediaCoordinateSpace((({context:d})=>{let f=y(this.zt),p=0+e.C+e.T+e.L+e.P/2;d.font=e.R,d.textAlign="left",d.textBaseline="middle",d.fillStyle=f.V;let m=e.Wi.Mi(d,"Apr0");d.translate(c+s,p+m),d.fillText(f.Kt,0,0)}))}},Or=class{constructor(t,e,i){this.ft=!0,this.Wt=new On,this.Ft={yt:!1,t:"#4c525e",V:"white",Kt:"",Hi:0,ki:NaN,hi:!0},this.vt=t,this.$i=e,this.Ei=i}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt.J(this.Ft),this.Wt}Mt(){let t=this.Ft;if(t.yt=!1,this.vt.W().mode===2)return;let e=this.vt.W().vertLine;if(!e.labelVisible)return;let i=this.$i.St();if(i.Ni())return;t.Hi=i.Hi();let s=this.Ei();if(s===null)return;t.ki=s.ki;let r=i.Ui(this.vt.xt());t.Kt=i.qi(y(r)),t.yt=!0;let o=is(e.labelBackgroundColor);t.t=o.t,t.V=o.i,t.hi=i.W().ticksVisible}},zi=class{constructor(){this.Yi=null,this.Zi=0}Xi(){return this.Zi}Ki(t){this.Zi=t}Dt(){return this.Yi}Gi(t){this.Yi=t}Ji(t){return[]}Qi(){return[]}yt(){return!0}},zt;(function(n){n[n.Normal=0]="Normal",n[n.Magnet=1]="Magnet",n[n.Hidden=2]="Hidden"})(zt||(zt={}));var Wr=class extends zi{constructor(t,e){super(),this.tn=null,this.nn=NaN,this.sn=0,this.en=!0,this.rn=new Map,this.hn=!1,this.ln=NaN,this.an=NaN,this._n=NaN,this.un=NaN,this.$i=t,this.cn=e,this.dn=new Fr(t,this),this.fn=((s,r)=>o=>{let l=r(),a=s();if(o===y(this.tn).vn())return{_t:a,ki:l};{let c=y(o.Ct());return{_t:o.pn(l,c),ki:l}}})((()=>this.nn),(()=>this.an));let i=((s,r)=>()=>{let o=this.$i.St().mn(s()),l=r();return o&&Number.isFinite(l)?{ot:o,ki:l}:null})((()=>this.sn),(()=>this.Yt()));this.bn=new Or(this,t,i),this.wn=new zr(this)}W(){return this.cn}gn(t,e){this._n=t,this.un=e}Mn(){this._n=NaN,this.un=NaN}xn(){return this._n}Sn(){return this.un}kn(t,e,i){this.hn||(this.hn=!0),this.en=!0,this.yn(t,e,i)}xt(){return this.sn}Yt(){return this.ln}Zt(){return this.an}yt(){return this.en}Cn(){this.en=!1,this.Tn(),this.nn=NaN,this.ln=NaN,this.an=NaN,this.tn=null,this.Mn()}Pn(t){return this.tn!==null?[this.wn,this.dn]:[]}Ut(t){return t===this.tn&&this.cn.horzLine.visible}qt(){return this.cn.vertLine.visible}Rn(t,e){this.en&&this.tn===t||this.rn.clear();let i=[];return this.tn===t&&i.push(this.Dn(this.rn,e,this.fn)),i}Qi(){return this.en?[this.bn]:[]}Ht(){return this.tn}Vn(){this.wn.bt(),this.rn.forEach((t=>t.bt())),this.bn.bt(),this.dn.bt()}On(t){return t&&!t.vn().Ni()?t.vn():null}yn(t,e,i){this.Bn(t,e,i)&&this.Vn()}Bn(t,e,i){let s=this.ln,r=this.an,o=this.nn,l=this.sn,a=this.tn,c=this.On(i);this.sn=t,this.ln=isNaN(t)?NaN:this.$i.St().It(t),this.tn=i;let u=c!==null?c.Ct():null;return c!==null&&u!==null?(this.nn=e,this.an=c.Rt(e,u)):(this.nn=NaN,this.an=NaN),s!==this.ln||r!==this.an||l!==this.sn||o!==this.nn||a!==this.tn}Tn(){let t=this.$i.wt().map((i=>i.In().An())).filter(pd),e=t.length===0?null:Math.max(...t);this.sn=e!==null?e:NaN}Dn(t,e,i){let s=t.get(e);return s===void 0&&(s=new Hr(this,e,i),t.set(e,s)),s}};function ss(n){return n==="left"||n==="right"}var J=class n{constructor(t){this.zn=new Map,this.Ln=[],this.En=t}Nn(t,e){let i=(function(s,r){return s===void 0?r:{Fn:Math.max(s.Fn,r.Fn),Wn:s.Wn||r.Wn}})(this.zn.get(t),e);this.zn.set(t,i)}jn(){return this.En}Hn(t){let e=this.zn.get(t);return e===void 0?{Fn:this.En}:{Fn:Math.max(this.En,e.Fn),Wn:e.Wn}}$n(){this.Un(),this.Ln=[{qn:0}]}Yn(t){this.Un(),this.Ln=[{qn:1,Vt:t}]}Zn(t){this.Xn(),this.Ln.push({qn:5,Vt:t})}Un(){this.Xn(),this.Ln.push({qn:6})}Kn(){this.Un(),this.Ln=[{qn:4}]}Gn(t){this.Un(),this.Ln.push({qn:2,Vt:t})}Jn(t){this.Un(),this.Ln.push({qn:3,Vt:t})}Qn(){return this.Ln}ts(t){for(let e of t.Ln)this.ns(e);this.En=Math.max(this.En,t.En),t.zn.forEach(((e,i)=>{this.Nn(i,e)}))}static ss(){return new n(2)}static es(){return new n(3)}ns(t){switch(t.qn){case 0:this.$n();break;case 1:this.Yn(t.Vt);break;case 2:this.Gn(t.Vt);break;case 3:this.Jn(t.Vt);break;case 4:this.Kn();break;case 5:this.Zn(t.Vt);break;case 6:this.Xn()}}Xn(){let t=this.Ln.findIndex((e=>e.qn===5));t!==-1&&this.Ln.splice(t,1)}},pa=".";function Bt(n,t){if(!Rt(n))return"n/a";if(!Vi(t))throw new TypeError("invalid length");if(t<0||t>16)throw new TypeError("invalid length");return t===0?n.toString():("0000000000000000"+n.toString()).slice(-t)}var je=class{constructor(t,e){if(e||(e=1),Rt(t)&&Vi(t)||(t=100),t<0)throw new TypeError("invalid base");this.Li=t,this.rs=e,this.hs()}format(t){let e=t<0?"\u2212":"";return t=Math.abs(t),e+this.ls(t)}hs(){if(this.os=0,this.Li>0&&this.rs>0){let t=this.Li;for(;t>1;)t/=10,this.os++}}ls(t){let e=this.Li/this.rs,i=Math.floor(t),s="",r=this.os!==void 0?this.os:NaN;if(e>1){let o=+(Math.round(t*e)-i*e).toFixed(this.os);o>=e&&(o-=e,i+=1),s=pa+Bt(+o.toFixed(this.os)*this.rs,r)}else i=Math.round(i*e)/e,r>0&&(s=pa+Bt(0,r));return i.toFixed(0)+s}},Wn=class extends je{constructor(t=100){super(t)}format(t){return`${super.format(t)}%`}},Ur=class{constructor(t){this._s=t}format(t){let e="";return t<0&&(e="-",t=-t),t<995?e+this.us(t):t<999995?e+this.us(t/1e3)+"K":t<999999995?(t=1e3*Math.round(t/1e3),e+this.us(t/1e6)+"M"):(t=1e6*Math.round(t/1e6),e+this.us(t/1e9)+"B")}us(t){let e,i=Math.pow(10,this._s);return e=(t=Math.round(t*i)/i)>=1e-15&&t<1?t.toFixed(this._s).replace(/\.?0+$/,""):String(t),e.replace(/(\.[1-9]*)0+$/,((s,r)=>r))}};function sc(n,t,e,i,s,r,o){if(t.length===0||i.from>=t.length||i.to<=0)return;let{context:l,horizontalPixelRatio:a,verticalPixelRatio:c}=n,u=t[i.from],h=r(n,u),d=u;if(i.to-i.from<2){let f=s/2;l.beginPath();let p={nt:u.nt-f,st:u.st},m={nt:u.nt+f,st:u.st};l.moveTo(p.nt*a,p.st*c),l.lineTo(m.nt*a,m.st*c),o(n,h,p,m)}else{let f=(m,g)=>{o(n,h,d,g),l.beginPath(),h=m,d=g},p=d;l.beginPath(),l.moveTo(u.nt*a,u.st*c);for(let m=i.from+1;m<i.to;++m){p=t[m];let g=r(n,p);switch(e){case 0:l.lineTo(p.nt*a,p.st*c);break;case 1:l.lineTo(p.nt*a,t[m-1].st*c),g!==h&&(f(g,p),l.lineTo(p.nt*a,t[m-1].st*c)),l.lineTo(p.nt*a,p.st*c);break;case 2:{let[v,b]=Sd(t,m-1,m);l.bezierCurveTo(v.nt*a,v.st*c,b.nt*a,b.st*c,p.nt*a,p.st*c);break}}e!==1&&g!==h&&(f(g,p),l.moveTo(p.nt*a,p.st*c))}(d!==p||d===p&&e===1)&&o(n,h,d,p)}}var ga=6;function Sr(n,t){return{nt:n.nt-t.nt,st:n.st-t.st}}function va(n,t){return{nt:n.nt/t,st:n.st/t}}function Sd(n,t,e){let i=Math.max(0,t-1),s=Math.min(n.length-1,e+1);var r,o;return[(r=n[t],o=va(Sr(n[e],n[i]),ga),{nt:r.nt+o.nt,st:r.st+o.st}),Sr(n[e],va(Sr(n[s],n[t]),ga))]}function wd(n,t,e,i,s){let{context:r,horizontalPixelRatio:o,verticalPixelRatio:l}=t;r.lineTo(s.nt*o,n*l),r.lineTo(i.nt*o,n*l),r.closePath(),r.fillStyle=e,r.fill()}var Un=class extends mt{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K(t){var e;if(this.G===null)return;let{it:i,tt:s,cs:r,et:o,Nt:l,ds:a}=this.G,c=(e=this.G.fs)!==null&&e!==void 0?e:this.G.vs?0:t.mediaSize.height;if(s===null)return;let u=t.context;u.lineCap="butt",u.lineJoin="round",u.lineWidth=o,ve(u,l),u.lineWidth=1,sc(t,i,a,s,r,this.ps.bind(this),wd.bind(null,c))}};function jr(n,t,e){return Math.min(Math.max(n,t),e)}function Rn(n,t,e){return t-n<=e}function rc(n){let t=Math.ceil(n);return t%2==0?t-1:t}var Hi=class{bs(t,e){let i=this.ws,{gs:s,Ms:r,xs:o,Ss:l,ks:a,fs:c}=e;if(this.ys===void 0||i===void 0||i.gs!==s||i.Ms!==r||i.xs!==o||i.Ss!==l||i.fs!==c||i.ks!==a){let u=t.context.createLinearGradient(0,0,0,a);if(u.addColorStop(0,s),c!=null){let h=jr(c*t.verticalPixelRatio/a,0,1);u.addColorStop(h,r),u.addColorStop(h,o)}u.addColorStop(1,l),this.ys=u,this.ws=e}return this.ys}},Kr=class extends Un{constructor(){super(...arguments),this.Cs=new Hi}ps(t,e){return this.Cs.bs(t,{gs:e.Ts,Ms:"",xs:"",Ss:e.Ps,ks:t.bitmapSize.height})}};function Md(n,t){let e=n.context;e.strokeStyle=t,e.stroke()}var jn=class extends mt{constructor(){super(...arguments),this.G=null}J(t){this.G=t}K(t){if(this.G===null)return;let{it:e,tt:i,cs:s,ds:r,et:o,Nt:l,Rs:a}=this.G;if(i===null)return;let c=t.context;c.lineCap="butt",c.lineWidth=o*t.verticalPixelRatio,ve(c,l),c.lineJoin="round";let u=this.Ds.bind(this);r!==void 0&&sc(t,e,r,i,s,u,Md),a&&(function(h,d,f,p,m){let{horizontalPixelRatio:g,verticalPixelRatio:v,context:b}=h,w=null,S=Math.max(1,Math.floor(g))%2/2,x=f*v+S;for(let A=p.to-1;A>=p.from;--A){let N=d[A];if(N){let B=m(h,N);B!==w&&(b.beginPath(),w!==null&&b.fill(),b.fillStyle=B,w=B);let bt=Math.round(N.nt*g)+S,et=N.st*v;b.moveTo(bt,et),b.arc(bt,et,x,0,2*Math.PI)}}b.fill()})(t,e,a,i,u)}},Kn=class extends jn{Ds(t,e){return e.lt}};function oc(n,t,e,i,s=0,r=t.length){let o=r-s;for(;0<o;){let l=o>>1,a=s+l;i(t[a],e)===n?(s=a+1,o-=l+1):o=l}return s}var Gi=oc.bind(null,!0),lc=oc.bind(null,!1);function xd(n,t){return n.ot<t}function Cd(n,t){return t<n.ot}function ac(n,t,e){let i=t.Vs(),s=t.ui(),r=Gi(n,i,xd),o=lc(n,s,Cd);if(!e)return{from:r,to:o};let l=r,a=o;return r>0&&r<n.length&&n[r].ot>=i&&(l=r-1),o>0&&o<n.length&&n[o-1].ot<=s&&(a=o+1),{from:l,to:a}}var Oi=class{constructor(t,e,i){this.Os=!0,this.Bs=!0,this.As=!0,this.Is=[],this.zs=null,this.Ls=t,this.Es=e,this.Ns=i}bt(t){this.Os=!0,t==="data"&&(this.Bs=!0),t==="options"&&(this.As=!0)}gt(){return this.Ls.yt()?(this.Fs(),this.zs===null?null:this.Ws):null}js(){this.Is=this.Is.map((t=>Object.assign(Object.assign({},t),this.Ls.$s().Hs(t.ot))))}Us(){this.zs=null}Fs(){this.Bs&&(this.qs(),this.Bs=!1),this.As&&(this.js(),this.As=!1),this.Os&&(this.Ys(),this.Os=!1)}Ys(){let t=this.Ls.Dt(),e=this.Es.St();if(this.Us(),e.Ni()||t.Ni())return;let i=e.Zs();if(i===null||this.Ls.In().Xs()===0)return;let s=this.Ls.Ct();s!==null&&(this.zs=ac(this.Is,i,this.Ns),this.Ks(t,e,s.Vt),this.Gs())}},Ke=class extends Oi{constructor(t,e){super(t,e,!0)}Ks(t,e,i){e.Js(this.Is,Fi(this.zs)),t.Qs(this.Is,i,Fi(this.zs))}te(t,e){return{ot:t,_t:e,nt:NaN,st:NaN}}qs(){let t=this.Ls.$s();this.Is=this.Ls.In().ie().map((e=>{let i=e.Vt[3];return this.ne(e.se,i,t)}))}},qr=class extends Ke{constructor(t,e){super(t,e),this.Ws=new Bi,this.ee=new Kr,this.re=new Kn,this.Ws.Z([this.ee,this.re])}ne(t,e,i){return Object.assign(Object.assign({},this.te(t,e)),i.Hs(t))}Gs(){let t=this.Ls.W();this.ee.J({ds:t.lineType,it:this.Is,Nt:t.lineStyle,et:t.lineWidth,fs:null,vs:t.invertFilledArea,tt:this.zs,cs:this.Es.St().he()}),this.re.J({ds:t.lineVisible?t.lineType:void 0,it:this.Is,Nt:t.lineStyle,et:t.lineWidth,tt:this.zs,cs:this.Es.St().he(),Rs:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0})}},Gr=class extends mt{constructor(){super(...arguments),this.zt=null,this.le=0,this.ae=0}J(t){this.zt=t}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:i}){if(this.zt===null||this.zt.In.length===0||this.zt.tt===null)return;this.le=this.oe(e),this.le>=2&&Math.max(1,Math.floor(e))%2!=this.le%2&&this.le--,this.ae=this.zt._e?Math.min(this.le,Math.floor(e)):this.le;let s=null,r=this.ae<=this.le&&this.zt.he>=Math.floor(1.5*e);for(let o=this.zt.tt.from;o<this.zt.tt.to;++o){let l=this.zt.In[o];s!==l.ue&&(t.fillStyle=l.ue,s=l.ue);let a=Math.floor(.5*this.ae),c=Math.round(l.nt*e),u=c-a,h=this.ae,d=u+h-1,f=Math.min(l.ce,l.de),p=Math.max(l.ce,l.de),m=Math.round(f*i)-a,g=Math.round(p*i)+a,v=Math.max(g-m,this.ae);t.fillRect(u,m,h,v);let b=Math.ceil(1.5*this.le);if(r){if(this.zt.fe){let A=c-b,N=Math.max(m,Math.round(l.ve*i)-a),B=N+h-1;B>m+v-1&&(B=m+v-1,N=B-h+1),t.fillRect(A,N,u-A,B-N+1)}let w=c+b,S=Math.max(m,Math.round(l.pe*i)-a),x=S+h-1;x>m+v-1&&(x=m+v-1,S=x-h+1),t.fillRect(d+1,S,w-d,x-S+1)}}}oe(t){let e=Math.floor(t);return Math.max(e,Math.floor((function(i,s){return Math.floor(.3*i*s)})(y(this.zt).he,t)))}},qn=class extends Oi{constructor(t,e){super(t,e,!1)}Ks(t,e,i){e.Js(this.Is,Fi(this.zs)),t.me(this.Is,i,Fi(this.zs))}be(t,e,i){return{ot:t,we:e.Vt[0],ge:e.Vt[1],Me:e.Vt[2],xe:e.Vt[3],nt:NaN,ve:NaN,ce:NaN,de:NaN,pe:NaN}}qs(){let t=this.Ls.$s();this.Is=this.Ls.In().ie().map((e=>this.ne(e.se,e,t)))}},Zr=class extends qn{constructor(){super(...arguments),this.Ws=new Gr}ne(t,e,i){return Object.assign(Object.assign({},this.be(t,e,i)),i.Hs(t))}Gs(){let t=this.Ls.W();this.Ws.J({In:this.Is,he:this.Es.St().he(),fe:t.openVisible,_e:t.thinBars,tt:this.zs})}},Xr=class extends Un{constructor(){super(...arguments),this.Cs=new Hi}ps(t,e){let i=this.G;return this.Cs.bs(t,{gs:e.Se,Ms:e.ke,xs:e.ye,Ss:e.Ce,ks:t.bitmapSize.height,fs:i.fs})}},Jr=class extends jn{constructor(){super(...arguments),this.Te=new Hi}Ds(t,e){let i=this.G;return this.Te.bs(t,{gs:e.Pe,Ms:e.Pe,xs:e.Re,Ss:e.Re,ks:t.bitmapSize.height,fs:i.fs})}},Yr=class extends Ke{constructor(t,e){super(t,e),this.Ws=new Bi,this.De=new Xr,this.Ve=new Jr,this.Ws.Z([this.De,this.Ve])}ne(t,e,i){return Object.assign(Object.assign({},this.te(t,e)),i.Hs(t))}Gs(){let t=this.Ls.Ct();if(t===null)return;let e=this.Ls.W(),i=this.Ls.Dt().Rt(e.baseValue.price,t.Vt),s=this.Es.St().he();this.De.J({it:this.Is,et:e.lineWidth,Nt:e.lineStyle,ds:e.lineType,fs:i,vs:!1,tt:this.zs,cs:s}),this.Ve.J({it:this.Is,et:e.lineWidth,Nt:e.lineStyle,ds:e.lineVisible?e.lineType:void 0,Rs:e.pointMarkersVisible?e.pointMarkersRadius||e.lineWidth/2+2:void 0,fs:i,tt:this.zs,cs:s})}},Qr=class extends mt{constructor(){super(...arguments),this.zt=null,this.le=0}J(t){this.zt=t}K(t){if(this.zt===null||this.zt.In.length===0||this.zt.tt===null)return;let{horizontalPixelRatio:e}=t;this.le=(function(r,o){if(r>=2.5&&r<=4)return Math.floor(3*o);let l=1-.2*Math.atan(Math.max(4,r)-4)/(.5*Math.PI),a=Math.floor(r*l*o),c=Math.floor(r*o),u=Math.min(a,c);return Math.max(Math.floor(o),u)})(this.zt.he,e),this.le>=2&&Math.floor(e)%2!=this.le%2&&this.le--;let i=this.zt.In;this.zt.Oe&&this.Be(t,i,this.zt.tt),this.zt._i&&this.Ae(t,i,this.zt.tt);let s=this.Ie(e);(!this.zt._i||this.le>2*s)&&this.ze(t,i,this.zt.tt)}Be(t,e,i){if(this.zt===null)return;let{context:s,horizontalPixelRatio:r,verticalPixelRatio:o}=t,l="",a=Math.min(Math.floor(r),Math.floor(this.zt.he*r));a=Math.max(Math.floor(r),Math.min(a,this.le));let c=Math.floor(.5*a),u=null;for(let h=i.from;h<i.to;h++){let d=e[h];d.Le!==l&&(s.fillStyle=d.Le,l=d.Le);let f=Math.round(Math.min(d.ve,d.pe)*o),p=Math.round(Math.max(d.ve,d.pe)*o),m=Math.round(d.ce*o),g=Math.round(d.de*o),v=Math.round(r*d.nt)-c,b=v+a-1;u!==null&&(v=Math.max(u+1,v),v=Math.min(v,b));let w=b-v+1;s.fillRect(v,m,w,f-m),s.fillRect(v,p+1,w,g-p),u=b}}Ie(t){let e=Math.floor(1*t);this.le<=2*e&&(e=Math.floor(.5*(this.le-1)));let i=Math.max(Math.floor(t),e);return this.le<=2*i?Math.max(Math.floor(t),Math.floor(1*t)):i}Ae(t,e,i){if(this.zt===null)return;let{context:s,horizontalPixelRatio:r,verticalPixelRatio:o}=t,l="",a=this.Ie(r),c=null;for(let u=i.from;u<i.to;u++){let h=e[u];h.Ee!==l&&(s.fillStyle=h.Ee,l=h.Ee);let d=Math.round(h.nt*r)-Math.floor(.5*this.le),f=d+this.le-1,p=Math.round(Math.min(h.ve,h.pe)*o),m=Math.round(Math.max(h.ve,h.pe)*o);if(c!==null&&(d=Math.max(c+1,d),d=Math.min(d,f)),this.zt.he*r>2*a)bd(s,d,p,f-d+1,m-p+1,a);else{let g=f-d+1;s.fillRect(d,p,g,m-p+1)}c=f}}ze(t,e,i){if(this.zt===null)return;let{context:s,horizontalPixelRatio:r,verticalPixelRatio:o}=t,l="",a=this.Ie(r);for(let c=i.from;c<i.to;c++){let u=e[c],h=Math.round(Math.min(u.ve,u.pe)*o),d=Math.round(Math.max(u.ve,u.pe)*o),f=Math.round(u.nt*r)-Math.floor(.5*this.le),p=f+this.le-1;if(u.ue!==l){let m=u.ue;s.fillStyle=m,l=m}this.zt._i&&(f+=a,h+=a,p-=a,d-=a),h>d||s.fillRect(f,h,p-f+1,d-h+1)}}},to=class extends qn{constructor(){super(...arguments),this.Ws=new Qr}ne(t,e,i){return Object.assign(Object.assign({},this.be(t,e,i)),i.Hs(t))}Gs(){let t=this.Ls.W();this.Ws.J({In:this.Is,he:this.Es.St().he(),Oe:t.wickVisible,_i:t.borderVisible,tt:this.zs})}},eo=class{constructor(t,e){this.Ne=t,this.Li=e}X(t,e,i){this.Ne.draw(t,this.Li,e,i)}},_i=class extends Oi{constructor(t,e,i){super(t,e,!1),this.wn=i,this.Ws=new eo(this.wn.renderer(),(s=>{let r=t.Ct();return r===null?null:t.Dt().Rt(s,r.Vt)}))}Fe(t){return this.wn.priceValueBuilder(t)}We(t){return this.wn.isWhitespace(t)}qs(){let t=this.Ls.$s();this.Is=this.Ls.In().ie().map((e=>Object.assign(Object.assign({ot:e.se,nt:NaN},t.Hs(e.se)),{je:e.He})))}Ks(t,e){e.Js(this.Is,Fi(this.zs))}Gs(){this.wn.update({bars:this.Is.map(Dd),barSpacing:this.Es.St().he(),visibleRange:this.zs},this.Ls.W())}};function Dd(n){return{x:n.nt,time:n.ot,originalData:n.je,barColor:n.ue}}var io=class extends mt{constructor(){super(...arguments),this.zt=null,this.$e=[]}J(t){this.zt=t,this.$e=[]}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:i}){if(this.zt===null||this.zt.it.length===0||this.zt.tt===null)return;this.$e.length||this.Ue(e);let s=Math.max(1,Math.floor(i)),r=Math.round(this.zt.qe*i)-Math.floor(s/2),o=r+s;for(let l=this.zt.tt.from;l<this.zt.tt.to;l++){let a=this.zt.it[l],c=this.$e[l-this.zt.tt.from],u=Math.round(a.st*i),h,d;t.fillStyle=a.ue,u<=r?(h=u,d=o):(h=r,d=u-Math.floor(s/2)+s),t.fillRect(c.Vs,h,c.ui-c.Vs+1,d-h)}}Ue(t){if(this.zt===null||this.zt.it.length===0||this.zt.tt===null)return void(this.$e=[]);let e=Math.ceil(this.zt.he*t)<=1?0:Math.max(1,Math.floor(t)),i=Math.round(this.zt.he*t)-e;this.$e=new Array(this.zt.tt.to-this.zt.tt.from);for(let r=this.zt.tt.from;r<this.zt.tt.to;r++){let o=this.zt.it[r],l=Math.round(o.nt*t),a,c;if(i%2){let u=(i-1)/2;a=l-u,c=l+u}else{let u=i/2;a=l-u,c=l+u-1}this.$e[r-this.zt.tt.from]={Vs:a,ui:c,Ye:l,Ze:o.nt*t,ot:o.ot}}for(let r=this.zt.tt.from+1;r<this.zt.tt.to;r++){let o=this.$e[r-this.zt.tt.from],l=this.$e[r-this.zt.tt.from-1];o.ot===l.ot+1&&o.Vs-l.ui!==e+1&&(l.Ye>l.Ze?l.ui=o.Vs-e-1:o.Vs=l.ui+e+1)}let s=Math.ceil(this.zt.he*t);for(let r=this.zt.tt.from;r<this.zt.tt.to;r++){let o=this.$e[r-this.zt.tt.from];o.ui<o.Vs&&(o.ui=o.Vs);let l=o.ui-o.Vs+1;s=Math.min(l,s)}if(e>0&&s<4)for(let r=this.zt.tt.from;r<this.zt.tt.to;r++){let o=this.$e[r-this.zt.tt.from];o.ui-o.Vs+1>s&&(o.Ye>o.Ze?o.ui-=1:o.Vs+=1)}}},no=class extends Ke{constructor(){super(...arguments),this.Ws=new io}ne(t,e,i){return Object.assign(Object.assign({},this.te(t,e)),i.Hs(t))}Gs(){let t={it:this.Is,he:this.Es.St().he(),tt:this.zs,qe:this.Ls.Dt().Rt(this.Ls.W().base,y(this.Ls.Ct()).Vt)};this.Ws.J(t)}},so=class extends Ke{constructor(){super(...arguments),this.Ws=new Kn}ne(t,e,i){return Object.assign(Object.assign({},this.te(t,e)),i.Hs(t))}Gs(){let t=this.Ls.W(),e={it:this.Is,Nt:t.lineStyle,ds:t.lineVisible?t.lineType:void 0,et:t.lineWidth,Rs:t.pointMarkersVisible?t.pointMarkersRadius||t.lineWidth/2+2:void 0,tt:this.zs,cs:this.Es.St().he()};this.Ws.J(e)}},Td=/[2-9]/g,be=class{constructor(t=50){this.Xe=0,this.Ke=1,this.Ge=1,this.Je={},this.Qe=new Map,this.tr=t}ir(){this.Xe=0,this.Qe.clear(),this.Ke=1,this.Ge=1,this.Je={}}xi(t,e,i){return this.nr(t,e,i).width}Mi(t,e,i){let s=this.nr(t,e,i);return((s.actualBoundingBoxAscent||0)-(s.actualBoundingBoxDescent||0))/2}nr(t,e,i){let s=i||Td,r=String(e).replace(s,"0");if(this.Qe.has(r))return it(this.Qe.get(r)).sr;if(this.Xe===this.tr){let l=this.Je[this.Ge];delete this.Je[this.Ge],this.Qe.delete(l),this.Ge++,this.Xe--}t.save(),t.textBaseline="middle";let o=t.measureText(r);return t.restore(),o.width===0&&e.length||(this.Qe.set(r,{sr:o,er:this.Ke}),this.Je[this.Ke]=r,this.Xe++,this.Ke++),o}},ro=class{constructor(t){this.rr=null,this.k=null,this.hr="right",this.lr=t}ar(t,e,i){this.rr=t,this.k=e,this.hr=i}X(t){this.k!==null&&this.rr!==null&&this.rr.X(t,this.k,this.lr,this.hr)}},Gn=class{constructor(t,e,i){this._r=t,this.lr=new be(50),this.ur=e,this.F=i,this.j=-1,this.Wt=new ro(this.lr)}gt(){let t=this.F.cr(this.ur);if(t===null)return null;let e=t.dr(this.ur)?t.vr():this.ur.Dt();if(e===null)return null;let i=t.pr(e);if(i==="overlay")return null;let s=this.F.mr();return s.P!==this.j&&(this.j=s.P,this.lr.ir()),this.Wt.ar(this._r.Ii(),s,i),this.Wt}},oo=class extends mt{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}br(t,e){var i;if(!(!((i=this.zt)===null||i===void 0)&&i.yt))return null;let{st:s,et:r,wr:o}=this.zt;return e>=s-r-7&&e<=s+r+7?{gr:this.zt,wr:o}:null}K({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:s}){if(this.zt===null||this.zt.yt===!1)return;let r=Math.round(this.zt.st*s);r<0||r>e.height||(t.lineCap="butt",t.strokeStyle=this.zt.V,t.lineWidth=Math.floor(this.zt.et*i),ve(t,this.zt.Nt),tc(t,r,0,e.width))}},Wi=class{constructor(t){this.Mr={st:0,V:"rgba(0, 0, 0, 0)",et:1,Nt:0,yt:!1},this.Sr=new oo,this.ft=!0,this.Ls=t,this.Es=t.$t(),this.Sr.J(this.Mr)}bt(){this.ft=!0}gt(){return this.Ls.yt()?(this.ft&&(this.kr(),this.ft=!1),this.Sr):null}},lo=class extends Wi{constructor(t){super(t)}kr(){this.Mr.yt=!1;let t=this.Ls.Dt(),e=t.yr().yr;if(e!==2&&e!==3)return;let i=this.Ls.W();if(!i.baseLineVisible||!this.Ls.yt())return;let s=this.Ls.Ct();s!==null&&(this.Mr.yt=!0,this.Mr.st=t.Rt(s.Vt,s.Vt),this.Mr.V=i.baseLineColor,this.Mr.et=i.baseLineWidth,this.Mr.Nt=i.baseLineStyle)}},ao=class extends mt{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}He(){return this.zt}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:i}){let s=this.zt;if(s===null)return;let r=Math.max(1,Math.floor(e)),o=r%2/2,l=Math.round(s.Ze.x*e)+o,a=s.Ze.y*i;t.fillStyle=s.Cr,t.beginPath();let c=Math.max(2,1.5*s.Tr)*e;t.arc(l,a,c,0,2*Math.PI,!1),t.fill(),t.fillStyle=s.Pr,t.beginPath(),t.arc(l,a,s.ht*e,0,2*Math.PI,!1),t.fill(),t.lineWidth=r,t.strokeStyle=s.Rr,t.beginPath(),t.arc(l,a,s.ht*e+r/2,0,2*Math.PI,!1),t.stroke()}},Ld=[{Dr:0,Vr:.25,Or:4,Br:10,Ar:.25,Ir:0,zr:.4,Lr:.8},{Dr:.25,Vr:.525,Or:10,Br:14,Ar:0,Ir:0,zr:.8,Lr:0},{Dr:.525,Vr:1,Or:14,Br:14,Ar:0,Ir:0,zr:0,Lr:0}];function ba(n,t,e,i){return(function(s,r){if(s==="transparent")return s;let o=$i(s),l=o[3];return`rgba(${o[0]}, ${o[1]}, ${o[2]}, ${r*l})`})(n,e+(i-e)*t)}function ya(n,t){let e=n%2600/2600,i;for(let a of Ld)if(e>=a.Dr&&e<=a.Vr){i=a;break}te(i!==void 0,"Last price animation internal logic error");let s=(e-i.Dr)/(i.Vr-i.Dr);return{Pr:ba(t,s,i.Ar,i.Ir),Rr:ba(t,s,i.zr,i.Lr),ht:(r=s,o=i.Or,l=i.Br,o+(l-o)*r)};var r,o,l}var co=class{constructor(t){this.Wt=new ao,this.ft=!0,this.Er=!0,this.Nr=performance.now(),this.Fr=this.Nr-1,this.Wr=t}jr(){this.Fr=this.Nr-1,this.bt()}Hr(){if(this.bt(),this.Wr.W().lastPriceAnimation===2){let t=performance.now(),e=this.Fr-t;if(e>0)return void(e<650&&(this.Fr+=2600));this.Nr=t,this.Fr=t+2600}}bt(){this.ft=!0}$r(){this.Er=!0}yt(){return this.Wr.W().lastPriceAnimation!==0}Ur(){switch(this.Wr.W().lastPriceAnimation){case 0:return!1;case 1:return!0;case 2:return performance.now()<=this.Fr}}gt(){return this.ft?(this.Mt(),this.ft=!1,this.Er=!1):this.Er&&(this.qr(),this.Er=!1),this.Wt}Mt(){this.Wt.J(null);let t=this.Wr.$t().St(),e=t.Zs(),i=this.Wr.Ct();if(e===null||i===null)return;let s=this.Wr.Yr(!0);if(s.Zr||!e.Xr(s.se))return;let r={x:t.It(s.se),y:this.Wr.Dt().Rt(s._t,i.Vt)},o=s.V,l=this.Wr.W().lineWidth,a=ya(this.Kr(),o);this.Wt.J({Cr:o,Tr:l,Pr:a.Pr,Rr:a.Rr,ht:a.ht,Ze:r})}qr(){let t=this.Wt.He();if(t!==null){let e=ya(this.Kr(),t.Cr);t.Pr=e.Pr,t.Rr=e.Rr,t.ht=e.ht}}Kr(){return this.Ur()?performance.now()-this.Nr:2599}};function Ri(n,t){return rc(Math.min(Math.max(n,12),30)*t)}function Ui(n,t){switch(n){case"arrowDown":case"arrowUp":return Ri(t,1);case"circle":return Ri(t,.8);case"square":return Ri(t,.7)}}function cc(n){return(function(t){let e=Math.ceil(t);return e%2!=0?e-1:e})(Ri(n,1))}function Sa(n){return Math.max(Ri(n,.1),3)}function wa(n,t,e){return t?n:e?Math.ceil(n/2):0}function uc(n,t,e,i,s){let r=Ui("square",e),o=(r-1)/2,l=n-o,a=t-o;return i>=l&&i<=l+r&&s>=a&&s<=a+r}function Ma(n,t,e,i){let s=(Ui("arrowUp",i)-1)/2*e.Gr,r=(rc(i/2)-1)/2*e.Gr;t.beginPath(),n?(t.moveTo(e.nt-s,e.st),t.lineTo(e.nt,e.st-s),t.lineTo(e.nt+s,e.st),t.lineTo(e.nt+r,e.st),t.lineTo(e.nt+r,e.st+s),t.lineTo(e.nt-r,e.st+s),t.lineTo(e.nt-r,e.st)):(t.moveTo(e.nt-s,e.st),t.lineTo(e.nt,e.st+s),t.lineTo(e.nt+s,e.st),t.lineTo(e.nt+r,e.st),t.lineTo(e.nt+r,e.st-s),t.lineTo(e.nt-r,e.st-s),t.lineTo(e.nt-r,e.st)),t.fill()}function Ed(n,t,e,i,s,r){return uc(t,e,i,s,r)}var uo=class extends mt{constructor(){super(...arguments),this.zt=null,this.lr=new be,this.j=-1,this.H="",this.Jr=""}J(t){this.zt=t}ar(t,e){this.j===t&&this.H===e||(this.j=t,this.H=e,this.Jr=We(t,e),this.lr.ir())}br(t,e){if(this.zt===null||this.zt.tt===null)return null;for(let i=this.zt.tt.from;i<this.zt.tt.to;i++){let s=this.zt.it[i];if(_d(s,t,e))return{gr:s.Qr,wr:s.wr}}return null}K({context:t,horizontalPixelRatio:e,verticalPixelRatio:i},s,r){if(this.zt!==null&&this.zt.tt!==null){t.textBaseline="middle",t.font=this.Jr;for(let o=this.zt.tt.from;o<this.zt.tt.to;o++){let l=this.zt.it[o];l.Kt!==void 0&&(l.Kt.Hi=this.lr.xi(t,l.Kt.th),l.Kt.At=this.j,l.Kt.nt=l.nt-l.Kt.Hi/2),kd(l,t,e,i)}}}};function kd(n,t,e,i){t.fillStyle=n.V,n.Kt!==void 0&&(function(s,r,o,l,a,c){s.save(),s.scale(a,c),s.fillText(r,o,l),s.restore()})(t,n.Kt.th,n.Kt.nt,n.Kt.st,e,i),(function(s,r,o){if(s.Xs!==0){switch(s.ih){case"arrowDown":return void Ma(!1,r,o,s.Xs);case"arrowUp":return void Ma(!0,r,o,s.Xs);case"circle":return void(function(l,a,c){let u=(Ui("circle",c)-1)/2;l.beginPath(),l.arc(a.nt,a.st,u*a.Gr,0,2*Math.PI,!1),l.fill()})(r,o,s.Xs);case"square":return void(function(l,a,c){let u=Ui("square",c),h=(u-1)*a.Gr/2,d=a.nt-h,f=a.st-h;l.fillRect(d,f,u*a.Gr,u*a.Gr)})(r,o,s.Xs)}s.ih}})(n,t,(function(s,r,o){let l=Math.max(1,Math.floor(r))%2/2;return{nt:Math.round(s.nt*r)+l,st:s.st*o,Gr:r}})(n,e,i))}function _d(n,t,e){return!(n.Kt===void 0||!(function(i,s,r,o,l,a){let c=o/2;return l>=i&&l<=i+r&&a>=s-c&&a<=s+c})(n.Kt.nt,n.Kt.st,n.Kt.Hi,n.Kt.At,t,e))||(function(i,s,r){if(i.Xs===0)return!1;switch(i.ih){case"arrowDown":case"arrowUp":return Ed(0,i.nt,i.st,i.Xs,s,r);case"circle":return(function(o,l,a,c,u){let h=2+Ui("circle",a)/2,d=o-c,f=l-u;return Math.sqrt(d*d+f*f)<=h})(i.nt,i.st,i.Xs,s,r);case"square":return uc(i.nt,i.st,i.Xs,s,r)}})(n,t,e)}function Rd(n,t,e,i,s,r,o,l,a){let c=Rt(e)?e:e.xe,u=Rt(e)?e:e.ge,h=Rt(e)?e:e.Me,d=Rt(t.size)?Math.max(t.size,0):1,f=cc(l.he())*d,p=f/2;switch(n.Xs=f,t.position){case"inBar":return n.st=o.Rt(c,a),void(n.Kt!==void 0&&(n.Kt.st=n.st+p+r+.6*s));case"aboveBar":return n.st=o.Rt(u,a)-p-i.nh,n.Kt!==void 0&&(n.Kt.st=n.st-p-.6*s,i.nh+=1.2*s),void(i.nh+=f+r);case"belowBar":return n.st=o.Rt(h,a)+p+i.sh,n.Kt!==void 0&&(n.Kt.st=n.st+p+r+.6*s,i.sh+=1.2*s),void(i.sh+=f+r)}t.position}var ho=class{constructor(t,e){this.ft=!0,this.eh=!0,this.rh=!0,this.hh=null,this.ah=null,this.Wt=new uo,this.Wr=t,this.$i=e,this.zt={it:[],tt:null}}bt(t){this.ft=!0,this.rh=!0,t==="data"&&(this.eh=!0,this.ah=null)}gt(t){if(!this.Wr.yt())return null;this.ft&&this.oh();let e=this.$i.W().layout;return this.Wt.ar(e.fontSize,e.fontFamily),this.Wt.J(this.zt),this.Wt}_h(){if(this.rh){if(this.Wr.uh().length>0){let t=this.$i.St().he(),e=Sa(t),i=1.5*cc(t)+2*e,s=this.dh();this.hh={above:wa(i,s.aboveBar,s.inBar),below:wa(i,s.belowBar,s.inBar)}}else this.hh=null;this.rh=!1}return this.hh}dh(){return this.ah===null&&(this.ah=this.Wr.uh().reduce(((t,e)=>(t[e.position]||(t[e.position]=!0),t)),{inBar:!1,aboveBar:!1,belowBar:!1})),this.ah}oh(){let t=this.Wr.Dt(),e=this.$i.St(),i=this.Wr.uh();this.eh&&(this.zt.it=i.map((u=>({ot:u.time,nt:0,st:0,Xs:0,ih:u.shape,V:u.color,Qr:u.Qr,wr:u.id,Kt:void 0}))),this.eh=!1);let s=this.$i.W().layout;this.zt.tt=null;let r=e.Zs();if(r===null)return;let o=this.Wr.Ct();if(o===null||this.zt.it.length===0)return;let l=NaN,a=Sa(e.he()),c={nh:a,sh:a};this.zt.tt=ac(this.zt.it,r,!0);for(let u=this.zt.tt.from;u<this.zt.tt.to;u++){let h=i[u];h.time!==l&&(c.nh=a,c.sh=a,l=h.time);let d=this.zt.it[u];d.nt=e.It(h.time),h.text!==void 0&&h.text.length>0&&(d.Kt={th:h.text,nt:0,st:0,Hi:0,At:0});let f=this.Wr.fh(h.time);f!==null&&Rd(d,h,f,c,s.fontSize,a,t,e,o.Vt)}this.ft=!1}},fo=class extends Wi{constructor(t){super(t)}kr(){let t=this.Mr;t.yt=!1;let e=this.Ls.W();if(!e.priceLineVisible||!this.Ls.yt())return;let i=this.Ls.Yr(e.priceLineSource===0);i.Zr||(t.yt=!0,t.st=i.ki,t.V=this.Ls.ph(i.V),t.et=e.priceLineWidth,t.Nt=e.priceLineStyle)}},mo=class extends Ue{constructor(t){super(),this.jt=t}zi(t,e,i){t.yt=!1,e.yt=!1;let s=this.jt;if(!s.yt())return;let r=s.W(),o=r.lastValueVisible,l=s.mh()!=="",a=r.seriesLastValueMode===0,c=s.Yr(!1);if(c.Zr)return;o&&(t.Kt=this.bh(c,o,a),t.yt=t.Kt.length!==0),(l||a)&&(e.Kt=this.wh(c,o,l,a),e.yt=e.Kt.length>0);let u=s.ph(c.V),h=is(u);i.t=h.t,i.ki=c.ki,e.Ot=s.$t().Bt(c.ki/s.Dt().At()),t.Ot=u,t.V=h.i,e.V=h.i}wh(t,e,i,s){let r="",o=this.jt.mh();return i&&o.length!==0&&(r+=`${o} `),e&&s&&(r+=this.jt.Dt().gh()?t.Mh:t.xh),r.trim()}bh(t,e,i){return e?i?this.jt.Dt().gh()?t.xh:t.Mh:t.Kt:""}};function xa(n,t,e,i){let s=Number.isFinite(t),r=Number.isFinite(e);return s&&r?n(t,e):s||r?s?t:e:i}var St=class n{constructor(t,e){this.Sh=t,this.kh=e}yh(t){return t!==null&&this.Sh===t.Sh&&this.kh===t.kh}Ch(){return new n(this.Sh,this.kh)}Th(){return this.Sh}Ph(){return this.kh}Rh(){return this.kh-this.Sh}Ni(){return this.kh===this.Sh||Number.isNaN(this.kh)||Number.isNaN(this.Sh)}ts(t){return t===null?this:new n(xa(Math.min,this.Th(),t.Th(),-1/0),xa(Math.max,this.Ph(),t.Ph(),1/0))}Dh(t){if(!Rt(t)||this.kh-this.Sh===0)return;let e=.5*(this.kh+this.Sh),i=this.kh-e,s=this.Sh-e;i*=t,s*=t,this.kh=e+i,this.Sh=e+s}Vh(t){Rt(t)&&(this.kh+=t,this.Sh+=t)}Oh(){return{minValue:this.Sh,maxValue:this.kh}}static Bh(t){return t===null?null:new n(t.minValue,t.maxValue)}},Zn=class n{constructor(t,e){this.Ah=t,this.Ih=e||null}zh(){return this.Ah}Lh(){return this.Ih}Oh(){return this.Ah===null?null:{priceRange:this.Ah.Oh(),margins:this.Ih||void 0}}static Bh(t){return t===null?null:new n(St.Bh(t.priceRange),t.margins)}},po=class extends Wi{constructor(t,e){super(t),this.Eh=e}kr(){let t=this.Mr;t.yt=!1;let e=this.Eh.W();if(!this.Ls.yt()||!e.lineVisible)return;let i=this.Eh.Nh();i!==null&&(t.yt=!0,t.st=i,t.V=e.color,t.et=e.lineWidth,t.Nt=e.lineStyle,t.wr=this.Eh.W().id)}},go=class extends Ue{constructor(t,e){super(),this.Wr=t,this.Eh=e}zi(t,e,i){t.yt=!1,e.yt=!1;let s=this.Eh.W(),r=s.axisLabelVisible,o=s.title!=="",l=this.Wr;if(!r||!l.yt())return;let a=this.Eh.Nh();if(a===null)return;o&&(e.Kt=s.title,e.yt=!0),e.Ot=l.$t().Bt(a/l.Dt().At()),t.Kt=this.Fh(s.price),t.yt=!0;let c=is(s.axisLabelColor||s.color);i.t=c.t;let u=s.axisLabelTextColor||c.i;t.V=u,e.V=u,i.ki=a}Fh(t){let e=this.Wr.Ct();return e===null?"":this.Wr.Dt().Fi(t,e.Vt)}},vo=class{constructor(t,e){this.Wr=t,this.cn=e,this.Wh=new po(t,this),this._r=new go(t,this),this.jh=new Gn(this._r,t,t.$t())}Hh(t){Ct(this.cn,t),this.bt(),this.Wr.$t().$h()}W(){return this.cn}Uh(){return this.Wh}qh(){return this.jh}Yh(){return this._r}bt(){this.Wh.bt(),this._r.bt()}Nh(){let t=this.Wr,e=t.Dt();if(t.$t().St().Ni()||e.Ni())return null;let i=t.Ct();return i===null?null:e.Rt(this.cn.price,i.Vt)}},bo=class extends zi{constructor(t){super(),this.$i=t}$t(){return this.$i}},Pd={Bar:(n,t,e,i)=>{var s;let r=t.upColor,o=t.downColor,l=y(n(e,i)),a=ze(l.Vt[0])<=ze(l.Vt[3]);return{ue:(s=l.V)!==null&&s!==void 0?s:a?r:o}},Candlestick:(n,t,e,i)=>{var s,r,o;let l=t.upColor,a=t.downColor,c=t.borderUpColor,u=t.borderDownColor,h=t.wickUpColor,d=t.wickDownColor,f=y(n(e,i)),p=ze(f.Vt[0])<=ze(f.Vt[3]);return{ue:(s=f.V)!==null&&s!==void 0?s:p?l:a,Ee:(r=f.Ot)!==null&&r!==void 0?r:p?c:u,Le:(o=f.Zh)!==null&&o!==void 0?o:p?h:d}},Custom:(n,t,e,i)=>{var s;return{ue:(s=y(n(e,i)).V)!==null&&s!==void 0?s:t.color}},Area:(n,t,e,i)=>{var s,r,o,l;let a=y(n(e,i));return{ue:(s=a.lt)!==null&&s!==void 0?s:t.lineColor,lt:(r=a.lt)!==null&&r!==void 0?r:t.lineColor,Ts:(o=a.Ts)!==null&&o!==void 0?o:t.topColor,Ps:(l=a.Ps)!==null&&l!==void 0?l:t.bottomColor}},Baseline:(n,t,e,i)=>{var s,r,o,l,a,c;let u=y(n(e,i));return{ue:u.Vt[3]>=t.baseValue.price?t.topLineColor:t.bottomLineColor,Pe:(s=u.Pe)!==null&&s!==void 0?s:t.topLineColor,Re:(r=u.Re)!==null&&r!==void 0?r:t.bottomLineColor,Se:(o=u.Se)!==null&&o!==void 0?o:t.topFillColor1,ke:(l=u.ke)!==null&&l!==void 0?l:t.topFillColor2,ye:(a=u.ye)!==null&&a!==void 0?a:t.bottomFillColor1,Ce:(c=u.Ce)!==null&&c!==void 0?c:t.bottomFillColor2}},Line:(n,t,e,i)=>{var s,r;let o=y(n(e,i));return{ue:(s=o.V)!==null&&s!==void 0?s:t.color,lt:(r=o.V)!==null&&r!==void 0?r:t.color}},Histogram:(n,t,e,i)=>{var s;return{ue:(s=y(n(e,i)).V)!==null&&s!==void 0?s:t.color}}},yo=class{constructor(t){this.Xh=(e,i)=>i!==void 0?i.Vt:this.Wr.In().Kh(e),this.Wr=t,this.Gh=Pd[t.Jh()]}Hs(t,e){return this.Gh(this.Xh,this.Wr.W(),t,e)}},Ca;(function(n){n[n.NearestLeft=-1]="NearestLeft",n[n.None=0]="None",n[n.NearestRight=1]="NearestRight"})(Ca||(Ca={}));var Qt=30,So=class{constructor(){this.Qh=[],this.tl=new Map,this.il=new Map}nl(){return this.Xs()>0?this.Qh[this.Qh.length-1]:null}sl(){return this.Xs()>0?this.el(0):null}An(){return this.Xs()>0?this.el(this.Qh.length-1):null}Xs(){return this.Qh.length}Ni(){return this.Xs()===0}Xr(t){return this.rl(t,0)!==null}Kh(t){return this.hl(t)}hl(t,e=0){let i=this.rl(t,e);return i===null?null:Object.assign(Object.assign({},this.ll(i)),{se:this.el(i)})}ie(){return this.Qh}al(t,e,i){if(this.Ni())return null;let s=null;for(let r of i)s=Pn(s,this.ol(t,e,r));return s}J(t){this.il.clear(),this.tl.clear(),this.Qh=t}el(t){return this.Qh[t].se}ll(t){return this.Qh[t]}rl(t,e){let i=this._l(t);if(i===null&&e!==0)switch(e){case-1:return this.ul(t);case 1:return this.cl(t);default:throw new TypeError("Unknown search mode")}return i}ul(t){let e=this.dl(t);return e>0&&(e-=1),e!==this.Qh.length&&this.el(e)<t?e:null}cl(t){let e=this.fl(t);return e!==this.Qh.length&&t<this.el(e)?e:null}_l(t){let e=this.dl(t);return e===this.Qh.length||t<this.Qh[e].se?null:e}dl(t){return Gi(this.Qh,t,((e,i)=>e.se<i))}fl(t){return lc(this.Qh,t,((e,i)=>e.se>i))}vl(t,e,i){let s=null;for(let r=t;r<e;r++){let o=this.Qh[r].Vt[i];Number.isNaN(o)||(s===null?s={pl:o,ml:o}:(o<s.pl&&(s.pl=o),o>s.ml&&(s.ml=o)))}return s}ol(t,e,i){if(this.Ni())return null;let s=null,r=y(this.sl()),o=y(this.An()),l=Math.max(t,r),a=Math.min(e,o),c=Math.ceil(l/Qt)*Qt,u=Math.max(c,Math.floor(a/Qt)*Qt);{let d=this.dl(l),f=this.fl(Math.min(a,c,e));s=Pn(s,this.vl(d,f,i))}let h=this.tl.get(i);h===void 0&&(h=new Map,this.tl.set(i,h));for(let d=Math.max(c+1,l);d<u;d+=Qt){let f=Math.floor(d/Qt),p=h.get(f);if(p===void 0){let m=this.dl(f*Qt),g=this.fl((f+1)*Qt-1);p=this.vl(m,g,i),h.set(f,p)}s=Pn(s,p)}{let d=this.dl(u),f=this.fl(a);s=Pn(s,this.vl(d,f,i))}return s}};function Pn(n,t){return n===null?t:t===null?n:{pl:Math.min(n.pl,t.pl),ml:Math.max(n.ml,t.ml)}}var wo=class{constructor(t){this.bl=t}X(t,e,i){this.bl.draw(t)}wl(t,e,i){var s,r;(r=(s=this.bl).drawBackground)===null||r===void 0||r.call(s,t)}},Pi=class{constructor(t){this.Qe=null,this.wn=t}gt(){var t;let e=this.wn.renderer();if(e===null)return null;if(((t=this.Qe)===null||t===void 0?void 0:t.gl)===e)return this.Qe.Ml;let i=new wo(e);return this.Qe={gl:e,Ml:i},i}xl(){var t,e,i;return(i=(e=(t=this.wn).zOrder)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:"normal"}};function hc(n){var t,e,i,s,r;return{Kt:n.text(),ki:n.coordinate(),Si:(t=n.fixedCoordinate)===null||t===void 0?void 0:t.call(n),V:n.textColor(),t:n.backColor(),yt:(i=(e=n.visible)===null||e===void 0?void 0:e.call(n))===null||i===void 0||i,hi:(r=(s=n.tickVisible)===null||s===void 0?void 0:s.call(n))===null||r===void 0||r}}var Mo=class{constructor(t,e){this.Wt=new On,this.Sl=t,this.kl=e}gt(){return this.Wt.J(Object.assign({Hi:this.kl.Hi()},hc(this.Sl))),this.Wt}},xo=class extends Ue{constructor(t,e){super(),this.Sl=t,this.Li=e}zi(t,e,i){let s=hc(this.Sl);i.t=s.t,t.V=s.V;let r=2/12*this.Li.P();i.wi=r,i.gi=r,i.ki=s.ki,i.Si=s.Si,t.Kt=s.Kt,t.yt=s.yt,t.hi=s.hi}},Co=class{constructor(t,e){this.yl=null,this.Cl=null,this.Tl=null,this.Pl=null,this.Rl=null,this.Dl=t,this.Wr=e}Vl(){return this.Dl}Vn(){var t,e;(e=(t=this.Dl).updateAllViews)===null||e===void 0||e.call(t)}Pn(){var t,e,i,s;let r=(i=(e=(t=this.Dl).paneViews)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:[];if(((s=this.yl)===null||s===void 0?void 0:s.gl)===r)return this.yl.Ml;let o=r.map((l=>new Pi(l)));return this.yl={gl:r,Ml:o},o}Qi(){var t,e,i,s;let r=(i=(e=(t=this.Dl).timeAxisViews)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:[];if(((s=this.Cl)===null||s===void 0?void 0:s.gl)===r)return this.Cl.Ml;let o=this.Wr.$t().St(),l=r.map((a=>new Mo(a,o)));return this.Cl={gl:r,Ml:l},l}Rn(){var t,e,i,s;let r=(i=(e=(t=this.Dl).priceAxisViews)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:[];if(((s=this.Tl)===null||s===void 0?void 0:s.gl)===r)return this.Tl.Ml;let o=this.Wr.Dt(),l=r.map((a=>new xo(a,o)));return this.Tl={gl:r,Ml:l},l}Ol(){var t,e,i,s;let r=(i=(e=(t=this.Dl).priceAxisPaneViews)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:[];if(((s=this.Pl)===null||s===void 0?void 0:s.gl)===r)return this.Pl.Ml;let o=r.map((l=>new Pi(l)));return this.Pl={gl:r,Ml:o},o}Bl(){var t,e,i,s;let r=(i=(e=(t=this.Dl).timeAxisPaneViews)===null||e===void 0?void 0:e.call(t))!==null&&i!==void 0?i:[];if(((s=this.Rl)===null||s===void 0?void 0:s.gl)===r)return this.Rl.Ml;let o=r.map((l=>new Pi(l)));return this.Rl={gl:r,Ml:o},o}Al(t,e){var i,s,r;return(r=(s=(i=this.Dl).autoscaleInfo)===null||s===void 0?void 0:s.call(i,t,e))!==null&&r!==void 0?r:null}br(t,e){var i,s,r;return(r=(s=(i=this.Dl).hitTest)===null||s===void 0?void 0:s.call(i,t,e))!==null&&r!==void 0?r:null}};function wr(n,t,e,i){n.forEach((s=>{t(s).forEach((r=>{r.xl()===e&&i.push(r)}))}))}function Mr(n){return n.Pn()}function Id(n){return n.Ol()}function Ad(n){return n.Bl()}var ji=class extends bo{constructor(t,e,i,s,r){super(t),this.zt=new So,this.Wh=new fo(this),this.Il=[],this.zl=new lo(this),this.Ll=null,this.El=null,this.Nl=[],this.Fl=[],this.Wl=null,this.jl=[],this.cn=e,this.Hl=i;let o=new mo(this);this.rn=[o],this.jh=new Gn(o,this,t),i!=="Area"&&i!=="Line"&&i!=="Baseline"||(this.Ll=new co(this)),this.$l(),this.Ul(r)}S(){this.Wl!==null&&clearTimeout(this.Wl)}ph(t){return this.cn.priceLineColor||t}Yr(t){let e={Zr:!0},i=this.Dt();if(this.$t().St().Ni()||i.Ni()||this.zt.Ni())return e;let s=this.$t().St().Zs(),r=this.Ct();if(s===null||r===null)return e;let o,l;if(t){let h=this.zt.nl();if(h===null)return e;o=h,l=h.se}else{let h=this.zt.hl(s.ui(),-1);if(h===null||(o=this.zt.Kh(h.se),o===null))return e;l=h.se}let a=o.Vt[3],c=this.$s().Hs(l,{Vt:o}),u=i.Rt(a,r.Vt);return{Zr:!1,_t:a,Kt:i.Fi(a,r.Vt),Mh:i.ql(a),xh:i.Yl(a,r.Vt),V:c.ue,ki:u,se:l}}$s(){return this.El!==null||(this.El=new yo(this)),this.El}W(){return this.cn}Hh(t){let e=t.priceScaleId;e!==void 0&&e!==this.cn.priceScaleId&&this.$t().Zl(this,e),Ct(this.cn,t),t.priceFormat!==void 0&&(this.$l(),this.$t().Xl()),this.$t().Kl(this),this.$t().Gl(),this.wn.bt("options")}J(t,e){this.zt.J(t),this.Jl(),this.wn.bt("data"),this.dn.bt("data"),this.Ll!==null&&(e&&e.Ql?this.Ll.Hr():t.length===0&&this.Ll.jr());let i=this.$t().cr(this);this.$t().ta(i),this.$t().Kl(this),this.$t().Gl(),this.$t().$h()}ia(t){this.Nl=t,this.Jl();let e=this.$t().cr(this);this.dn.bt("data"),this.$t().ta(e),this.$t().Kl(this),this.$t().Gl(),this.$t().$h()}na(){return this.Nl}uh(){return this.Fl}sa(t){let e=new vo(this,t);return this.Il.push(e),this.$t().Kl(this),e}ea(t){let e=this.Il.indexOf(t);e!==-1&&this.Il.splice(e,1),this.$t().Kl(this)}Jh(){return this.Hl}Ct(){let t=this.ra();return t===null?null:{Vt:t.Vt[3],ha:t.ot}}ra(){let t=this.$t().St().Zs();if(t===null)return null;let e=t.Vs();return this.zt.hl(e,1)}In(){return this.zt}fh(t){let e=this.zt.Kh(t);return e===null?null:this.Hl==="Bar"||this.Hl==="Candlestick"||this.Hl==="Custom"?{we:e.Vt[0],ge:e.Vt[1],Me:e.Vt[2],xe:e.Vt[3]}:e.Vt[3]}la(t){let e=[];wr(this.jl,Mr,"top",e);let i=this.Ll;return i!==null&&i.yt()&&(this.Wl===null&&i.Ur()&&(this.Wl=setTimeout((()=>{this.Wl=null,this.$t().aa()}),0)),i.$r(),e.unshift(i)),e}Pn(){let t=[];this.oa()||t.push(this.zl),t.push(this.wn,this.Wh,this.dn);let e=this.Il.map((i=>i.Uh()));return t.push(...e),wr(this.jl,Mr,"normal",t),t}_a(){return this.ua(Mr,"bottom")}ca(t){return this.ua(Id,t)}da(t){return this.ua(Ad,t)}fa(t,e){return this.jl.map((i=>i.br(t,e))).filter((i=>i!==null))}Ji(t){return[this.jh,...this.Il.map((e=>e.qh()))]}Rn(t,e){if(e!==this.Yi&&!this.oa())return[];let i=[...this.rn];for(let s of this.Il)i.push(s.Yh());return this.jl.forEach((s=>{i.push(...s.Rn())})),i}Qi(){let t=[];return this.jl.forEach((e=>{t.push(...e.Qi())})),t}Al(t,e){if(this.cn.autoscaleInfoProvider!==void 0){let i=this.cn.autoscaleInfoProvider((()=>{let s=this.va(t,e);return s===null?null:s.Oh()}));return Zn.Bh(i)}return this.va(t,e)}pa(){return this.cn.priceFormat.minMove}ma(){return this.ba}Vn(){var t;this.wn.bt(),this.dn.bt();for(let e of this.rn)e.bt();for(let e of this.Il)e.bt();this.Wh.bt(),this.zl.bt(),(t=this.Ll)===null||t===void 0||t.bt(),this.jl.forEach((e=>e.Vn()))}Dt(){return y(super.Dt())}kt(t){if(!((this.Hl==="Line"||this.Hl==="Area"||this.Hl==="Baseline")&&this.cn.crosshairMarkerVisible))return null;let e=this.zt.Kh(t);return e===null?null:{_t:e.Vt[3],ht:this.wa(),Ot:this.ga(),Pt:this.Ma(),Tt:this.xa(t)}}mh(){return this.cn.title}yt(){return this.cn.visible}Sa(t){this.jl.push(new Co(t,this))}ka(t){this.jl=this.jl.filter((e=>e.Vl()!==t))}ya(){if(this.wn instanceof _i)return t=>this.wn.Fe(t)}Ca(){if(this.wn instanceof _i)return t=>this.wn.We(t)}oa(){return!ss(this.Dt().Ta())}va(t,e){if(!Vi(t)||!Vi(e)||this.zt.Ni())return null;let i=this.Hl==="Line"||this.Hl==="Area"||this.Hl==="Baseline"||this.Hl==="Histogram"?[3]:[2,1],s=this.zt.al(t,e,i),r=s!==null?new St(s.pl,s.ml):null;if(this.Jh()==="Histogram"){let l=this.cn.base,a=new St(l,l);r=r!==null?r.ts(a):a}let o=this.dn._h();return this.jl.forEach((l=>{let a=l.Al(t,e);if(a?.priceRange){let f=new St(a.priceRange.minValue,a.priceRange.maxValue);r=r!==null?r.ts(f):f}var c,u,h,d;a?.margins&&(c=o,u=a.margins,o={above:Math.max((h=c?.above)!==null&&h!==void 0?h:0,u.above),below:Math.max((d=c?.below)!==null&&d!==void 0?d:0,u.below)})})),new Zn(r,o)}wa(){switch(this.Hl){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerRadius}return 0}ga(){switch(this.Hl){case"Line":case"Area":case"Baseline":{let t=this.cn.crosshairMarkerBorderColor;if(t.length!==0)return t}}return null}Ma(){switch(this.Hl){case"Line":case"Area":case"Baseline":return this.cn.crosshairMarkerBorderWidth}return 0}xa(t){switch(this.Hl){case"Line":case"Area":case"Baseline":{let e=this.cn.crosshairMarkerBackgroundColor;if(e.length!==0)return e}}return this.$s().Hs(t).ue}$l(){switch(this.cn.priceFormat.type){case"custom":this.ba={format:this.cn.priceFormat.formatter};break;case"volume":this.ba=new Ur(this.cn.priceFormat.precision);break;case"percent":this.ba=new Wn(this.cn.priceFormat.precision);break;default:{let t=Math.pow(10,this.cn.priceFormat.precision);this.ba=new je(t,this.cn.priceFormat.minMove*t)}}this.Yi!==null&&this.Yi.Pa()}Jl(){let t=this.$t().St();if(!t.Ra()||this.zt.Ni())return void(this.Fl=[]);let e=y(this.zt.sl());this.Fl=this.Nl.map(((i,s)=>{let r=y(t.Da(i.time,!0)),o=r<e?1:-1;return{time:y(this.zt.hl(r,o)).se,position:i.position,shape:i.shape,color:i.color,id:i.id,Qr:s,text:i.text,size:i.size,originalTime:i.originalTime}}))}Ul(t){switch(this.dn=new ho(this,this.$t()),this.Hl){case"Bar":this.wn=new Zr(this,this.$t());break;case"Candlestick":this.wn=new to(this,this.$t());break;case"Line":this.wn=new so(this,this.$t());break;case"Custom":this.wn=new _i(this,this.$t(),it(t));break;case"Area":this.wn=new qr(this,this.$t());break;case"Baseline":this.wn=new Yr(this,this.$t());break;case"Histogram":this.wn=new no(this,this.$t());break;default:throw Error("Unknown chart style assigned: "+this.Hl)}}ua(t,e){let i=[];return wr(this.jl,t,e,i),i}},Do=class{constructor(t){this.cn=t}Va(t,e,i){let s=t;if(this.cn.mode===0)return s;let r=i.vn(),o=r.Ct();if(o===null)return s;let l=r.Rt(t,o),a=i.Oa().filter((u=>u instanceof ji)).reduce(((u,h)=>{if(i.dr(h)||!h.yt())return u;let d=h.Dt(),f=h.In();if(d.Ni()||!f.Xr(e))return u;let p=f.Kh(e);if(p===null)return u;let m=ze(h.Ct());return u.concat([d.Rt(p.Vt[3],m.Vt)])}),[]);if(a.length===0)return s;a.sort(((u,h)=>Math.abs(u-l)-Math.abs(h-l)));let c=a[0];return s=r.pn(c,o),s}},To=class extends mt{constructor(){super(...arguments),this.zt=null}J(t){this.zt=t}K({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:s}){if(this.zt===null)return;let r=Math.max(1,Math.floor(i));t.lineWidth=r,(function(o,l){o.save(),o.lineWidth%2&&o.translate(.5,.5),l(),o.restore()})(t,(()=>{let o=y(this.zt);if(o.Ba){t.strokeStyle=o.Aa,ve(t,o.Ia),t.beginPath();for(let l of o.za){let a=Math.round(l.La*i);t.moveTo(a,-r),t.lineTo(a,e.height+r)}t.stroke()}if(o.Ea){t.strokeStyle=o.Na,ve(t,o.Fa),t.beginPath();for(let l of o.Wa){let a=Math.round(l.La*s);t.moveTo(-r,a),t.lineTo(e.width+r,a)}t.stroke()}}))}},Lo=class{constructor(t){this.Wt=new To,this.ft=!0,this.tn=t}bt(){this.ft=!0}gt(){if(this.ft){let t=this.tn.$t().W().grid,e={Ea:t.horzLines.visible,Ba:t.vertLines.visible,Na:t.horzLines.color,Aa:t.vertLines.color,Fa:t.horzLines.style,Ia:t.vertLines.style,Wa:this.tn.vn().ja(),za:(this.tn.$t().St().ja()||[]).map((i=>({La:i.coord})))};this.Wt.J(e),this.ft=!1}return this.Wt}},Eo=class{constructor(t){this.wn=new Lo(t)}Uh(){return this.wn}},xr={Ha:4,$a:1e-4};function He(n,t){let e=100*(n-t)/t;return t<0?-e:e}function Nd(n,t){let e=He(n.Th(),t),i=He(n.Ph(),t);return new St(e,i)}function Ii(n,t){let e=100*(n-t)/t+100;return t<0?-e:e}function $d(n,t){let e=Ii(n.Th(),t),i=Ii(n.Ph(),t);return new St(e,i)}function Xn(n,t){let e=Math.abs(n);if(e<1e-15)return 0;let i=Math.log10(e+t.$a)+t.Ha;return n<0?-i:i}function Ai(n,t){let e=Math.abs(n);if(e<1e-15)return 0;let i=Math.pow(10,e-t.Ha)-t.$a;return n<0?-i:i}function ki(n,t){if(n===null)return null;let e=Xn(n.Th(),t),i=Xn(n.Ph(),t);return new St(e,i)}function In(n,t){if(n===null)return null;let e=Ai(n.Th(),t),i=Ai(n.Ph(),t);return new St(e,i)}function Cr(n){if(n===null)return xr;let t=Math.abs(n.Ph()-n.Th());if(t>=1||t<1e-15)return xr;let e=Math.ceil(Math.abs(Math.log10(t))),i=xr.Ha+e;return{Ha:i,$a:1/Math.pow(10,i)}}var Ni=class{constructor(t,e){if(this.Ua=t,this.qa=e,(function(i){if(i<0)return!1;for(let s=i;s>1;s/=10)if(s%10!=0)return!1;return!0})(this.Ua))this.Ya=[2,2.5,2];else{this.Ya=[];for(let i=this.Ua;i!==1;){if(i%2==0)this.Ya.push(2),i/=2;else{if(i%5!=0)throw new Error("unexpected base");this.Ya.push(2,2.5),i/=5}if(this.Ya.length>100)throw new Error("something wrong with base")}}}Za(t,e,i){let s=this.Ua===0?0:1/this.Ua,r=Math.pow(10,Math.max(0,Math.ceil(Math.log10(t-e)))),o=0,l=this.qa[0];for(;;){let h=Rn(r,s,1e-14)&&r>s+1e-14,d=Rn(r,i*l,1e-14),f=Rn(r,1,1e-14);if(!(h&&d&&f))break;r/=l,l=this.qa[++o%this.qa.length]}if(r<=s+1e-14&&(r=s),r=Math.max(1,r),this.Ya.length>0&&(a=r,c=1,u=1e-14,Math.abs(a-c)<u))for(o=0,l=this.Ya[0];Rn(r,i*l,1e-14)&&r>s+1e-14;)r/=l,l=this.Ya[++o%this.Ya.length];var a,c,u;return r}},Jn=class{constructor(t,e,i,s){this.Xa=[],this.Li=t,this.Ua=e,this.Ka=i,this.Ga=s}Za(t,e){if(t<e)throw new Error("high < low");let i=this.Li.At(),s=(t-e)*this.Ja()/i,r=new Ni(this.Ua,[2,2.5,2]),o=new Ni(this.Ua,[2,2,2.5]),l=new Ni(this.Ua,[2.5,2,2]),a=[];return a.push(r.Za(t,e,s),o.Za(t,e,s),l.Za(t,e,s)),(function(c){if(c.length<1)throw Error("array is empty");let u=c[0];for(let h=1;h<c.length;++h)c[h]<u&&(u=c[h]);return u})(a)}Qa(){let t=this.Li,e=t.Ct();if(e===null)return void(this.Xa=[]);let i=t.At(),s=this.Ka(i-1,e),r=this.Ka(0,e),o=this.Li.W().entireTextOnly?this.io()/2:0,l=o,a=i-1-o,c=Math.max(s,r),u=Math.min(s,r);if(c===u)return void(this.Xa=[]);let h=this.Za(c,u),d=c%h;d+=d<0?h:0;let f=c>=u?1:-1,p=null,m=0;for(let g=c-d;g>u;g-=h){let v=this.Ga(g,e,!0);p!==null&&Math.abs(v-p)<this.Ja()||v<l||v>a||(m<this.Xa.length?(this.Xa[m].La=v,this.Xa[m].no=t.so(g)):this.Xa.push({La:v,no:t.so(g)}),m++,p=v,t.eo()&&(h=this.Za(g*f,u)))}this.Xa.length=m}ja(){return this.Xa}io(){return this.Li.P()}Ja(){return Math.ceil(2.5*this.io())}};function dc(n){return n.slice().sort(((t,e)=>y(t.Xi())-y(e.Xi())))}var Da;(function(n){n[n.Normal=0]="Normal",n[n.Logarithmic=1]="Logarithmic",n[n.Percentage=2]="Percentage",n[n.IndexedTo100=3]="IndexedTo100"})(Da||(Da={}));var Ta=new Wn,La=new je(100,1),ko=class{constructor(t,e,i,s){this.ro=0,this.ho=null,this.Ah=null,this.lo=null,this.ao={oo:!1,_o:null},this.uo=0,this.co=0,this.do=new O,this.fo=new O,this.vo=[],this.po=null,this.mo=null,this.bo=null,this.wo=null,this.ba=La,this.Mo=Cr(null),this.xo=t,this.cn=e,this.So=i,this.ko=s,this.yo=new Jn(this,100,this.Co.bind(this),this.To.bind(this))}Ta(){return this.xo}W(){return this.cn}Hh(t){if(Ct(this.cn,t),this.Pa(),t.mode!==void 0&&this.Po({yr:t.mode}),t.scaleMargins!==void 0){let e=it(t.scaleMargins.top),i=it(t.scaleMargins.bottom);if(e<0||e>1)throw new Error(`Invalid top margin - expect value between 0 and 1, given=${e}`);if(i<0||i>1)throw new Error(`Invalid bottom margin - expect value between 0 and 1, given=${i}`);if(e+i>1)throw new Error(`Invalid margins - sum of margins must be less than 1, given=${e+i}`);this.Ro(),this.mo=null}}Do(){return this.cn.autoScale}eo(){return this.cn.mode===1}gh(){return this.cn.mode===2}Vo(){return this.cn.mode===3}yr(){return{Wn:this.cn.autoScale,Oo:this.cn.invertScale,yr:this.cn.mode}}Po(t){let e=this.yr(),i=null;t.Wn!==void 0&&(this.cn.autoScale=t.Wn),t.yr!==void 0&&(this.cn.mode=t.yr,t.yr!==2&&t.yr!==3||(this.cn.autoScale=!0),this.ao.oo=!1),e.yr===1&&t.yr!==e.yr&&((function(r,o){if(r===null)return!1;let l=Ai(r.Th(),o),a=Ai(r.Ph(),o);return isFinite(l)&&isFinite(a)})(this.Ah,this.Mo)?(i=In(this.Ah,this.Mo),i!==null&&this.Bo(i)):this.cn.autoScale=!0),t.yr===1&&t.yr!==e.yr&&(i=ki(this.Ah,this.Mo),i!==null&&this.Bo(i));let s=e.yr!==this.cn.mode;s&&(e.yr===2||this.gh())&&this.Pa(),s&&(e.yr===3||this.Vo())&&this.Pa(),t.Oo!==void 0&&e.Oo!==t.Oo&&(this.cn.invertScale=t.Oo,this.Ao()),this.fo.m(e,this.yr())}Io(){return this.fo}P(){return this.So.fontSize}At(){return this.ro}zo(t){this.ro!==t&&(this.ro=t,this.Ro(),this.mo=null)}Lo(){if(this.ho)return this.ho;let t=this.At()-this.Eo()-this.No();return this.ho=t,t}zh(){return this.Fo(),this.Ah}Bo(t,e){let i=this.Ah;(e||i===null&&t!==null||i!==null&&!i.yh(t))&&(this.mo=null,this.Ah=t)}Ni(){return this.Fo(),this.ro===0||!this.Ah||this.Ah.Ni()}Wo(t){return this.Oo()?t:this.At()-1-t}Rt(t,e){return this.gh()?t=He(t,e):this.Vo()&&(t=Ii(t,e)),this.To(t,e)}Qs(t,e,i){this.Fo();let s=this.No(),r=y(this.zh()),o=r.Th(),l=r.Ph(),a=this.Lo()-1,c=this.Oo(),u=a/(l-o),h=i===void 0?0:i.from,d=i===void 0?t.length:i.to,f=this.jo();for(let p=h;p<d;p++){let m=t[p],g=m._t;if(isNaN(g))continue;let v=g;f!==null&&(v=f(m._t,e));let b=s+u*(v-o),w=c?b:this.ro-1-b;m.st=w}}me(t,e,i){this.Fo();let s=this.No(),r=y(this.zh()),o=r.Th(),l=r.Ph(),a=this.Lo()-1,c=this.Oo(),u=a/(l-o),h=i===void 0?0:i.from,d=i===void 0?t.length:i.to,f=this.jo();for(let p=h;p<d;p++){let m=t[p],g=m.we,v=m.ge,b=m.Me,w=m.xe;f!==null&&(g=f(m.we,e),v=f(m.ge,e),b=f(m.Me,e),w=f(m.xe,e));let S=s+u*(g-o),x=c?S:this.ro-1-S;m.ve=x,S=s+u*(v-o),x=c?S:this.ro-1-S,m.ce=x,S=s+u*(b-o),x=c?S:this.ro-1-S,m.de=x,S=s+u*(w-o),x=c?S:this.ro-1-S,m.pe=x}}pn(t,e){let i=this.Co(t,e);return this.Ho(i,e)}Ho(t,e){let i=t;return this.gh()?i=(function(s,r){return r<0&&(s=-s),s/100*r+r})(i,e):this.Vo()&&(i=(function(s,r){return s-=100,r<0&&(s=-s),s/100*r+r})(i,e)),i}Oa(){return this.vo}$o(){if(this.po)return this.po;let t=[];for(let e=0;e<this.vo.length;e++){let i=this.vo[e];i.Xi()===null&&i.Ki(e+1),t.push(i)}return t=dc(t),this.po=t,this.po}Uo(t){this.vo.indexOf(t)===-1&&(this.vo.push(t),this.Pa(),this.qo())}Yo(t){let e=this.vo.indexOf(t);if(e===-1)throw new Error("source is not attached to scale");this.vo.splice(e,1),this.vo.length===0&&(this.Po({Wn:!0}),this.Bo(null)),this.Pa(),this.qo()}Ct(){let t=null;for(let e of this.vo){let i=e.Ct();i!==null&&(t===null||i.ha<t.ha)&&(t=i)}return t===null?null:t.Vt}Oo(){return this.cn.invertScale}ja(){let t=this.Ct()===null;if(this.mo!==null&&(t||this.mo.Zo===t))return this.mo.ja;this.yo.Qa();let e=this.yo.ja();return this.mo={ja:e,Zo:t},this.do.m(),e}Xo(){return this.do}Ko(t){this.gh()||this.Vo()||this.bo===null&&this.lo===null&&(this.Ni()||(this.bo=this.ro-t,this.lo=y(this.zh()).Ch()))}Go(t){if(this.gh()||this.Vo()||this.bo===null)return;this.Po({Wn:!1}),(t=this.ro-t)<0&&(t=0);let e=(this.bo+.2*(this.ro-1))/(t+.2*(this.ro-1)),i=y(this.lo).Ch();e=Math.max(e,.1),i.Dh(e),this.Bo(i)}Jo(){this.gh()||this.Vo()||(this.bo=null,this.lo=null)}Qo(t){this.Do()||this.wo===null&&this.lo===null&&(this.Ni()||(this.wo=t,this.lo=y(this.zh()).Ch()))}t_(t){if(this.Do()||this.wo===null)return;let e=y(this.zh()).Rh()/(this.Lo()-1),i=t-this.wo;this.Oo()&&(i*=-1);let s=i*e,r=y(this.lo).Ch();r.Vh(s),this.Bo(r,!0),this.mo=null}i_(){this.Do()||this.wo!==null&&(this.wo=null,this.lo=null)}ma(){return this.ba||this.Pa(),this.ba}Fi(t,e){switch(this.cn.mode){case 2:return this.n_(He(t,e));case 3:return this.ma().format(Ii(t,e));default:return this.Fh(t)}}so(t){switch(this.cn.mode){case 2:return this.n_(t);case 3:return this.ma().format(t);default:return this.Fh(t)}}ql(t){return this.Fh(t,y(this.s_()).ma())}Yl(t,e){return t=He(t,e),this.n_(t,Ta)}e_(){return this.vo}r_(t){this.ao={_o:t,oo:!1}}Vn(){this.vo.forEach((t=>t.Vn()))}Pa(){this.mo=null;let t=this.s_(),e=100;t!==null&&(e=Math.round(1/t.pa())),this.ba=La,this.gh()?(this.ba=Ta,e=100):this.Vo()?(this.ba=new je(100,1),e=100):t!==null&&(this.ba=t.ma()),this.yo=new Jn(this,e,this.Co.bind(this),this.To.bind(this)),this.yo.Qa()}qo(){this.po=null}s_(){return this.vo[0]||null}Eo(){return this.Oo()?this.cn.scaleMargins.bottom*this.At()+this.co:this.cn.scaleMargins.top*this.At()+this.uo}No(){return this.Oo()?this.cn.scaleMargins.top*this.At()+this.uo:this.cn.scaleMargins.bottom*this.At()+this.co}Fo(){this.ao.oo||(this.ao.oo=!0,this.h_())}Ro(){this.ho=null}To(t,e){if(this.Fo(),this.Ni())return 0;t=this.eo()&&t?Xn(t,this.Mo):t;let i=y(this.zh()),s=this.No()+(this.Lo()-1)*(t-i.Th())/i.Rh();return this.Wo(s)}Co(t,e){if(this.Fo(),this.Ni())return 0;let i=this.Wo(t),s=y(this.zh()),r=s.Th()+s.Rh()*((i-this.No())/(this.Lo()-1));return this.eo()?Ai(r,this.Mo):r}Ao(){this.mo=null,this.yo.Qa()}h_(){let t=this.ao._o;if(t===null)return;let e=null,i=this.e_(),s=0,r=0;for(let a of i){if(!a.yt())continue;let c=a.Ct();if(c===null)continue;let u=a.Al(t.Vs(),t.ui()),h=u&&u.zh();if(h!==null){switch(this.cn.mode){case 1:h=ki(h,this.Mo);break;case 2:h=Nd(h,c.Vt);break;case 3:h=$d(h,c.Vt)}if(e=e===null?h:e.ts(y(h)),u!==null){let d=u.Lh();d!==null&&(s=Math.max(s,d.above),r=Math.max(r,d.below))}}}if(s===this.uo&&r===this.co||(this.uo=s,this.co=r,this.mo=null,this.Ro()),e!==null){if(e.Th()===e.Ph()){let a=this.s_(),c=5*(a===null||this.gh()||this.Vo()?1:a.pa());this.eo()&&(e=In(e,this.Mo)),e=new St(e.Th()-c,e.Ph()+c),this.eo()&&(e=ki(e,this.Mo))}if(this.eo()){let a=In(e,this.Mo),c=Cr(a);if(o=c,l=this.Mo,o.Ha!==l.Ha||o.$a!==l.$a){let u=this.lo!==null?In(this.lo,this.Mo):null;this.Mo=c,e=ki(a,c),u!==null&&(this.lo=ki(u,c))}}this.Bo(e)}else this.Ah===null&&(this.Bo(new St(-.5,.5)),this.Mo=Cr(null));var o,l;this.ao.oo=!0}jo(){return this.gh()?He:this.Vo()?Ii:this.eo()?t=>Xn(t,this.Mo):null}l_(t,e,i){return e===void 0?(i===void 0&&(i=this.ma()),i.format(t)):e(t)}Fh(t,e){return this.l_(t,this.ko.priceFormatter,e)}n_(t,e){return this.l_(t,this.ko.percentageFormatter,e)}},_o=class{constructor(t,e){this.vo=[],this.a_=new Map,this.ro=0,this.o_=0,this.__=1e3,this.po=null,this.u_=new O,this.kl=t,this.$i=e,this.c_=new Eo(this);let i=e.W();this.d_=this.f_("left",i.leftPriceScale),this.v_=this.f_("right",i.rightPriceScale),this.d_.Io().l(this.p_.bind(this,this.d_),this),this.v_.Io().l(this.p_.bind(this,this.v_),this),this.m_(i)}m_(t){if(t.leftPriceScale&&this.d_.Hh(t.leftPriceScale),t.rightPriceScale&&this.v_.Hh(t.rightPriceScale),t.localization&&(this.d_.Pa(),this.v_.Pa()),t.overlayPriceScales){let e=Array.from(this.a_.values());for(let i of e){let s=y(i[0].Dt());s.Hh(t.overlayPriceScales),t.localization&&s.Pa()}}}b_(t){switch(t){case"left":return this.d_;case"right":return this.v_}return this.a_.has(t)?it(this.a_.get(t))[0].Dt():null}S(){this.$t().w_().p(this),this.d_.Io().p(this),this.v_.Io().p(this),this.vo.forEach((t=>{t.S&&t.S()})),this.u_.m()}g_(){return this.__}M_(t){this.__=t}$t(){return this.$i}Hi(){return this.o_}At(){return this.ro}x_(t){this.o_=t,this.S_()}zo(t){this.ro=t,this.d_.zo(t),this.v_.zo(t),this.vo.forEach((e=>{if(this.dr(e)){let i=e.Dt();i!==null&&i.zo(t)}})),this.S_()}Oa(){return this.vo}dr(t){let e=t.Dt();return e===null||this.d_!==e&&this.v_!==e}Uo(t,e,i){let s=i!==void 0?i:this.y_().k_+1;this.C_(t,e,s)}Yo(t){let e=this.vo.indexOf(t);te(e!==-1,"removeDataSource: invalid data source"),this.vo.splice(e,1);let i=y(t.Dt()).Ta();if(this.a_.has(i)){let r=it(this.a_.get(i)),o=r.indexOf(t);o!==-1&&(r.splice(o,1),r.length===0&&this.a_.delete(i))}let s=t.Dt();s&&s.Oa().indexOf(t)>=0&&s.Yo(t),s!==null&&(s.qo(),this.T_(s)),this.po=null}pr(t){return t===this.d_?"left":t===this.v_?"right":"overlay"}P_(){return this.d_}R_(){return this.v_}D_(t,e){t.Ko(e)}V_(t,e){t.Go(e),this.S_()}O_(t){t.Jo()}B_(t,e){t.Qo(e)}A_(t,e){t.t_(e),this.S_()}I_(t){t.i_()}S_(){this.vo.forEach((t=>{t.Vn()}))}vn(){let t=null;return this.$i.W().rightPriceScale.visible&&this.v_.Oa().length!==0?t=this.v_:this.$i.W().leftPriceScale.visible&&this.d_.Oa().length!==0?t=this.d_:this.vo.length!==0&&(t=this.vo[0].Dt()),t===null&&(t=this.v_),t}vr(){let t=null;return this.$i.W().rightPriceScale.visible?t=this.v_:this.$i.W().leftPriceScale.visible&&(t=this.d_),t}T_(t){t!==null&&t.Do()&&this.z_(t)}L_(t){let e=this.kl.Zs();t.Po({Wn:!0}),e!==null&&t.r_(e),this.S_()}E_(){this.z_(this.d_),this.z_(this.v_)}N_(){this.T_(this.d_),this.T_(this.v_),this.vo.forEach((t=>{this.dr(t)&&this.T_(t.Dt())})),this.S_(),this.$i.$h()}$o(){return this.po===null&&(this.po=dc(this.vo)),this.po}F_(){return this.u_}W_(){return this.c_}z_(t){let e=t.e_();if(e&&e.length>0&&!this.kl.Ni()){let i=this.kl.Zs();i!==null&&t.r_(i)}t.Vn()}y_(){let t=this.$o();if(t.length===0)return{j_:0,k_:0};let e=0,i=0;for(let s=0;s<t.length;s++){let r=t[s].Xi();r!==null&&(r<e&&(e=r),r>i&&(i=r))}return{j_:e,k_:i}}C_(t,e,i){let s=this.b_(e);if(s===null&&(s=this.f_(e,this.$i.W().overlayPriceScales)),this.vo.push(t),!ss(e)){let r=this.a_.get(e)||[];r.push(t),this.a_.set(e,r)}s.Uo(t),t.Gi(s),t.Ki(i),this.T_(s),this.po=null}p_(t,e,i){e.yr!==i.yr&&this.z_(t)}f_(t,e){let i=Object.assign({visible:!0,autoScale:!0},Ft(e)),s=new ko(t,i,this.$i.W().layout,this.$i.W().localization);return s.zo(this.At()),s}},Ro=class{constructor(t,e,i=50){this.Xe=0,this.Ke=1,this.Ge=1,this.Qe=new Map,this.Je=new Map,this.H_=t,this.U_=e,this.tr=i}q_(t){let e=t.time,i=this.U_.cacheKey(e),s=this.Qe.get(i);if(s!==void 0)return s.Y_;if(this.Xe===this.tr){let o=this.Je.get(this.Ge);this.Je.delete(this.Ge),this.Qe.delete(it(o)),this.Ge++,this.Xe--}let r=this.H_(t);return this.Qe.set(i,{Y_:r,er:this.Ke}),this.Je.set(this.Ke,i),this.Xe++,this.Ke++,r}},ge=class{constructor(t,e){te(t<=e,"right should be >= left"),this.Z_=t,this.X_=e}Vs(){return this.Z_}ui(){return this.X_}K_(){return this.X_-this.Z_+1}Xr(t){return this.Z_<=t&&t<=this.X_}yh(t){return this.Z_===t.Vs()&&this.X_===t.ui()}};function Ea(n,t){return n===null||t===null?n===t:n.yh(t)}var Po=class{constructor(){this.G_=new Map,this.Qe=null,this.J_=!1}Q_(t){this.J_=t,this.Qe=null}tu(t,e){this.iu(e),this.Qe=null;for(let i=e;i<t.length;++i){let s=t[i],r=this.G_.get(s.timeWeight);r===void 0&&(r=[],this.G_.set(s.timeWeight,r)),r.push({index:i,time:s.time,weight:s.timeWeight,originalTime:s.originalTime})}}nu(t,e){let i=Math.ceil(e/t);return this.Qe!==null&&this.Qe.su===i||(this.Qe={ja:this.eu(i),su:i}),this.Qe.ja}iu(t){if(t===0)return void this.G_.clear();let e=[];this.G_.forEach(((i,s)=>{t<=i[0].index?e.push(s):i.splice(Gi(i,t,(r=>r.index<t)),1/0)}));for(let i of e)this.G_.delete(i)}eu(t){let e=[];for(let i of Array.from(this.G_.keys()).sort(((s,r)=>r-s))){if(!this.G_.get(i))continue;let s=e;e=[];let r=s.length,o=0,l=it(this.G_.get(i)),a=l.length,c=1/0,u=-1/0;for(let h=0;h<a;h++){let d=l[h],f=d.index;for(;o<r;){let p=s[o],m=p.index;if(!(m<f)){c=m;break}o++,e.push(p),u=m,c=1/0}if(c-f>=t&&f-u>=t)e.push(d),u=f;else if(this.J_)return s}for(;o<r;o++)e.push(s[o])}return e}},Oe=class n{constructor(t){this.ru=t}hu(){return this.ru===null?null:new ge(Math.floor(this.ru.Vs()),Math.ceil(this.ru.ui()))}lu(){return this.ru}static au(){return new n(null)}};function Vd(n,t){return n.weight>t.weight?n:t}var Io=class{constructor(t,e,i,s){this.o_=0,this.ou=null,this._u=[],this.wo=null,this.bo=null,this.uu=new Po,this.cu=new Map,this.du=Oe.au(),this.fu=!0,this.vu=new O,this.pu=new O,this.mu=new O,this.bu=null,this.wu=null,this.gu=[],this.cn=e,this.ko=i,this.Mu=e.rightOffset,this.xu=e.barSpacing,this.$i=t,this.U_=s,this.Su(),this.uu.Q_(e.uniformDistribution)}W(){return this.cn}ku(t){Ct(this.ko,t),this.yu(),this.Su()}Hh(t,e){var i;Ct(this.cn,t),this.cn.fixLeftEdge&&this.Cu(),this.cn.fixRightEdge&&this.Tu(),t.barSpacing!==void 0&&this.$i.Gn(t.barSpacing),t.rightOffset!==void 0&&this.$i.Jn(t.rightOffset),t.minBarSpacing!==void 0&&this.$i.Gn((i=t.barSpacing)!==null&&i!==void 0?i:this.xu),this.yu(),this.Su(),this.mu.m()}mn(t){var e,i;return(i=(e=this._u[t])===null||e===void 0?void 0:e.time)!==null&&i!==void 0?i:null}Ui(t){var e;return(e=this._u[t])!==null&&e!==void 0?e:null}Da(t,e){if(this._u.length<1)return null;if(this.U_.key(t)>this.U_.key(this._u[this._u.length-1].time))return e?this._u.length-1:null;let i=Gi(this._u,this.U_.key(t),((s,r)=>this.U_.key(s.time)<r));return this.U_.key(t)<this.U_.key(this._u[i].time)?e?i:null:i}Ni(){return this.o_===0||this._u.length===0||this.ou===null}Ra(){return this._u.length>0}Zs(){return this.Pu(),this.du.hu()}Ru(){return this.Pu(),this.du.lu()}Du(){let t=this.Zs();if(t===null)return null;let e={from:t.Vs(),to:t.ui()};return this.Vu(e)}Vu(t){let e=Math.round(t.from),i=Math.round(t.to),s=y(this.Ou()),r=y(this.Bu());return{from:y(this.Ui(Math.max(s,e))),to:y(this.Ui(Math.min(r,i)))}}Au(t){return{from:y(this.Da(t.from,!0)),to:y(this.Da(t.to,!0))}}Hi(){return this.o_}x_(t){if(!isFinite(t)||t<=0||this.o_===t)return;let e=this.Ru(),i=this.o_;if(this.o_=t,this.fu=!0,this.cn.lockVisibleTimeRangeOnResize&&i!==0){let s=this.xu*t/i;this.xu=s}if(this.cn.fixLeftEdge&&e!==null&&e.Vs()<=0){let s=i-t;this.Mu-=Math.round(s/this.xu)+1,this.fu=!0}this.Iu(),this.zu()}It(t){if(this.Ni()||!Vi(t))return 0;let e=this.Lu()+this.Mu-t;return this.o_-(e+.5)*this.xu-1}Js(t,e){let i=this.Lu(),s=e===void 0?0:e.from,r=e===void 0?t.length:e.to;for(let o=s;o<r;o++){let l=t[o].ot,a=i+this.Mu-l,c=this.o_-(a+.5)*this.xu-1;t[o].nt=c}}Eu(t){return Math.ceil(this.Nu(t))}Jn(t){this.fu=!0,this.Mu=t,this.zu(),this.$i.Fu(),this.$i.$h()}he(){return this.xu}Gn(t){this.Wu(t),this.zu(),this.$i.Fu(),this.$i.$h()}ju(){return this.Mu}ja(){if(this.Ni())return null;if(this.wu!==null)return this.wu;let t=this.xu,e=5*(this.$i.W().layout.fontSize+4)/8*(this.cn.tickMarkMaxCharacterLength||8),i=Math.round(e/t),s=y(this.Zs()),r=Math.max(s.Vs(),s.Vs()-i),o=Math.max(s.ui(),s.ui()-i),l=this.uu.nu(t,e),a=this.Ou()+i,c=this.Bu()-i,u=this.Hu(),h=this.cn.fixLeftEdge||u,d=this.cn.fixRightEdge||u,f=0;for(let p of l){if(!(r<=p.index&&p.index<=o))continue;let m;f<this.gu.length?(m=this.gu[f],m.coord=this.It(p.index),m.label=this.$u(p),m.weight=p.weight):(m={needAlignCoordinate:!1,coord:this.It(p.index),label:this.$u(p),weight:p.weight},this.gu.push(m)),this.xu>e/2&&!u?m.needAlignCoordinate=!1:m.needAlignCoordinate=h&&p.index<=a||d&&p.index>=c,f++}return this.gu.length=f,this.wu=this.gu,this.gu}Uu(){this.fu=!0,this.Gn(this.cn.barSpacing),this.Jn(this.cn.rightOffset)}qu(t){this.fu=!0,this.ou=t,this.zu(),this.Cu()}Yu(t,e){let i=this.Nu(t),s=this.he(),r=s+e*(s/10);this.Gn(r),this.cn.rightBarStaysOnScroll||this.Jn(this.ju()+(i-this.Nu(t)))}Ko(t){this.wo&&this.i_(),this.bo===null&&this.bu===null&&(this.Ni()||(this.bo=t,this.Zu()))}Go(t){if(this.bu===null)return;let e=jr(this.o_-t,0,this.o_),i=jr(this.o_-y(this.bo),0,this.o_);e!==0&&i!==0&&this.Gn(this.bu.he*e/i)}Jo(){this.bo!==null&&(this.bo=null,this.Xu())}Qo(t){this.wo===null&&this.bu===null&&(this.Ni()||(this.wo=t,this.Zu()))}t_(t){if(this.wo===null)return;let e=(this.wo-t)/this.he();this.Mu=y(this.bu).ju+e,this.fu=!0,this.zu()}i_(){this.wo!==null&&(this.wo=null,this.Xu())}Ku(){this.Gu(this.cn.rightOffset)}Gu(t,e=400){if(!isFinite(t))throw new RangeError("offset is required and must be finite number");if(!isFinite(e)||e<=0)throw new RangeError("animationDuration (optional) must be finite positive number");let i=this.Mu,s=performance.now();this.$i.Zn({Ju:r=>(r-s)/e>=1,Qu:r=>{let o=(r-s)/e;return o>=1?t:i+(t-i)*o}})}bt(t,e){this.fu=!0,this._u=t,this.uu.tu(t,e),this.zu()}tc(){return this.vu}nc(){return this.pu}sc(){return this.mu}Lu(){return this.ou||0}ec(t){let e=t.K_();this.Wu(this.o_/e),this.Mu=t.ui()-this.Lu(),this.zu(),this.fu=!0,this.$i.Fu(),this.$i.$h()}rc(){let t=this.Ou(),e=this.Bu();t!==null&&e!==null&&this.ec(new ge(t,e+this.cn.rightOffset))}hc(t){let e=new ge(t.from,t.to);this.ec(e)}qi(t){return this.ko.timeFormatter!==void 0?this.ko.timeFormatter(t.originalTime):this.U_.formatHorzItem(t.time)}Hu(){let{handleScroll:t,handleScale:e}=this.$i.W();return!(t.horzTouchDrag||t.mouseWheel||t.pressedMouseMove||t.vertTouchDrag||e.axisDoubleClickReset.time||e.axisPressedMouseMove.time||e.mouseWheel||e.pinch)}Ou(){return this._u.length===0?null:0}Bu(){return this._u.length===0?null:this._u.length-1}lc(t){return(this.o_-1-t)/this.xu}Nu(t){let e=this.lc(t),i=this.Lu()+this.Mu-e;return Math.round(1e6*i)/1e6}Wu(t){let e=this.xu;this.xu=t,this.Iu(),e!==this.xu&&(this.fu=!0,this.ac())}Pu(){if(!this.fu)return;if(this.fu=!1,this.Ni())return void this.oc(Oe.au());let t=this.Lu(),e=this.o_/this.xu,i=this.Mu+t,s=new ge(i-e+1,i);this.oc(new Oe(s))}Iu(){let t=this._c();if(this.xu<t&&(this.xu=t,this.fu=!0),this.o_!==0){let e=.5*this.o_;this.xu>e&&(this.xu=e,this.fu=!0)}}_c(){return this.cn.fixLeftEdge&&this.cn.fixRightEdge&&this._u.length!==0?this.o_/this._u.length:this.cn.minBarSpacing}zu(){let t=this.uc();this.Mu>t&&(this.Mu=t,this.fu=!0);let e=this.cc();e!==null&&this.Mu<e&&(this.Mu=e,this.fu=!0)}cc(){let t=this.Ou(),e=this.ou;return t===null||e===null?null:t-e-1+(this.cn.fixLeftEdge?this.o_/this.xu:Math.min(2,this._u.length))}uc(){return this.cn.fixRightEdge?0:this.o_/this.xu-Math.min(2,this._u.length)}Zu(){this.bu={he:this.he(),ju:this.ju()}}Xu(){this.bu=null}$u(t){let e=this.cu.get(t.weight);return e===void 0&&(e=new Ro((i=>this.dc(i)),this.U_),this.cu.set(t.weight,e)),e.q_(t)}dc(t){return this.U_.formatTickmark(t,this.ko)}oc(t){let e=this.du;this.du=t,Ea(e.hu(),this.du.hu())||this.vu.m(),Ea(e.lu(),this.du.lu())||this.pu.m(),this.ac()}ac(){this.wu=null}yu(){this.ac(),this.cu.clear()}Su(){this.U_.updateFormatter(this.ko)}Cu(){if(!this.cn.fixLeftEdge)return;let t=this.Ou();if(t===null)return;let e=this.Zs();if(e===null)return;let i=e.Vs()-t;if(i<0){let s=this.Mu-i-1;this.Jn(s)}this.Iu()}Tu(){this.zu(),this.Iu()}},Ao=class{X(t,e,i){t.useMediaCoordinateSpace((s=>this.K(s,e,i)))}wl(t,e,i){t.useMediaCoordinateSpace((s=>this.fc(s,e,i)))}fc(t,e,i){}},No=class extends Ao{constructor(t){super(),this.vc=new Map,this.zt=t}K(t){}fc(t){if(!this.zt.yt)return;let{context:e,mediaSize:i}=t,s=0;for(let o of this.zt.mc){if(o.Kt.length===0)continue;e.font=o.R;let l=this.bc(e,o.Kt);l>i.width?o.Yu=i.width/l:o.Yu=1,s+=o.wc*o.Yu}let r=0;switch(this.zt.gc){case"top":r=0;break;case"center":r=Math.max((i.height-s)/2,0);break;case"bottom":r=Math.max(i.height-s,0)}e.fillStyle=this.zt.V;for(let o of this.zt.mc){e.save();let l=0;switch(this.zt.Mc){case"left":e.textAlign="left",l=o.wc/2;break;case"center":e.textAlign="center",l=i.width/2;break;case"right":e.textAlign="right",l=i.width-1-o.wc/2}e.translate(l,r),e.textBaseline="top",e.font=o.R,e.scale(o.Yu,o.Yu),e.fillText(o.Kt,0,o.xc),e.restore(),r+=o.wc*o.Yu}}bc(t,e){let i=this.Sc(t.font),s=i.get(e);return s===void 0&&(s=t.measureText(e).width,i.set(e,s)),s}Sc(t){let e=this.vc.get(t);return e===void 0&&(e=new Map,this.vc.set(t,e)),e}},$o=class{constructor(t){this.ft=!0,this.Ft={yt:!1,V:"",mc:[],gc:"center",Mc:"center"},this.Wt=new No(this.Ft),this.jt=t}bt(){this.ft=!0}gt(){return this.ft&&(this.Mt(),this.ft=!1),this.Wt}Mt(){let t=this.jt.W(),e=this.Ft;e.yt=t.visible,e.yt&&(e.V=t.color,e.Mc=t.horzAlign,e.gc=t.vertAlign,e.mc=[{Kt:t.text,R:We(t.fontSize,t.fontFamily,t.fontStyle),wc:1.2*t.fontSize,xc:0,Yu:0}])}},Vo=class extends zi{constructor(t,e){super(),this.cn=e,this.wn=new $o(this)}Rn(){return[]}Pn(){return[this.wn]}W(){return this.cn}Vn(){this.wn.bt()}},ka,_a,Ra,Pa,Ia;(function(n){n[n.OnTouchEnd=0]="OnTouchEnd",n[n.OnNextTap=1]="OnNextTap"})(ka||(ka={}));var Fo=class{constructor(t,e,i){this.kc=[],this.yc=[],this.o_=0,this.Cc=null,this.Tc=new O,this.Pc=new O,this.Rc=null,this.Dc=t,this.cn=e,this.U_=i,this.Vc=new $r(this),this.kl=new Io(this,e.timeScale,this.cn.localization,i),this.vt=new Wr(this,e.crosshair),this.Oc=new Do(e.crosshair),this.Bc=new Vo(this,e.watermark),this.Ac(),this.kc[0].M_(2e3),this.Ic=this.zc(0),this.Lc=this.zc(1)}Xl(){this.Ec(J.es())}$h(){this.Ec(J.ss())}aa(){this.Ec(new J(1))}Kl(t){let e=this.Nc(t);this.Ec(e)}Fc(){return this.Cc}Wc(t){let e=this.Cc;this.Cc=t,e!==null&&this.Kl(e.jc),t!==null&&this.Kl(t.jc)}W(){return this.cn}Hh(t){Ct(this.cn,t),this.kc.forEach((e=>e.m_(t))),t.timeScale!==void 0&&this.kl.Hh(t.timeScale),t.localization!==void 0&&this.kl.ku(t.localization),(t.leftPriceScale||t.rightPriceScale)&&this.Tc.m(),this.Ic=this.zc(0),this.Lc=this.zc(1),this.Xl()}Hc(t,e){if(t==="left")return void this.Hh({leftPriceScale:e});if(t==="right")return void this.Hh({rightPriceScale:e});let i=this.$c(t);i!==null&&(i.Dt.Hh(e),this.Tc.m())}$c(t){for(let e of this.kc){let i=e.b_(t);if(i!==null)return{Ht:e,Dt:i}}return null}St(){return this.kl}Uc(){return this.kc}qc(){return this.Bc}Yc(){return this.vt}Zc(){return this.Pc}Xc(t,e){t.zo(e),this.Fu()}x_(t){this.o_=t,this.kl.x_(this.o_),this.kc.forEach((e=>e.x_(t))),this.Fu()}Ac(t){let e=new _o(this.kl,this);t!==void 0?this.kc.splice(t,0,e):this.kc.push(e);let i=t===void 0?this.kc.length-1:t,s=J.es();return s.Nn(i,{Fn:0,Wn:!0}),this.Ec(s),e}D_(t,e,i){t.D_(e,i)}V_(t,e,i){t.V_(e,i),this.Gl(),this.Ec(this.Kc(t,2))}O_(t,e){t.O_(e),this.Ec(this.Kc(t,2))}B_(t,e,i){e.Do()||t.B_(e,i)}A_(t,e,i){e.Do()||(t.A_(e,i),this.Gl(),this.Ec(this.Kc(t,2)))}I_(t,e){e.Do()||(t.I_(e),this.Ec(this.Kc(t,2)))}L_(t,e){t.L_(e),this.Ec(this.Kc(t,2))}Gc(t){this.kl.Ko(t)}Jc(t,e){let i=this.St();if(i.Ni()||e===0)return;let s=i.Hi();t=Math.max(1,Math.min(t,s)),i.Yu(t,e),this.Fu()}Qc(t){this.td(0),this.nd(t),this.sd()}ed(t){this.kl.Go(t),this.Fu()}rd(){this.kl.Jo(),this.$h()}td(t){this.kl.Qo(t)}nd(t){this.kl.t_(t),this.Fu()}sd(){this.kl.i_(),this.$h()}wt(){return this.yc}hd(t,e,i,s,r){this.vt.gn(t,e);let o=NaN,l=this.kl.Eu(t),a=this.kl.Zs();a!==null&&(l=Math.min(Math.max(a.Vs(),l),a.ui()));let c=s.vn(),u=c.Ct();u!==null&&(o=c.pn(e,u)),o=this.Oc.Va(o,l,s),this.vt.kn(l,o,s),this.aa(),r||this.Pc.m(this.vt.xt(),{x:t,y:e},i)}ld(t,e,i){let s=i.vn(),r=s.Ct(),o=s.Rt(t,y(r)),l=this.kl.Da(e,!0),a=this.kl.It(y(l));this.hd(a,o,null,i,!0)}ad(t){this.Yc().Cn(),this.aa(),t||this.Pc.m(null,null,null)}Gl(){let t=this.vt.Ht();if(t!==null){let e=this.vt.xn(),i=this.vt.Sn();this.hd(e,i,null,t)}this.vt.Vn()}od(t,e,i){let s=this.kl.mn(0);e!==void 0&&i!==void 0&&this.kl.bt(e,i);let r=this.kl.mn(0),o=this.kl.Lu(),l=this.kl.Zs();if(l!==null&&s!==null&&r!==null){let a=l.Xr(o),c=this.U_.key(s)>this.U_.key(r),u=t!==null&&t>o&&!c,h=this.kl.W().allowShiftVisibleRangeOnWhitespaceReplacement,d=a&&(i!==void 0||h)&&this.kl.W().shiftVisibleRangeOnNewBar;if(u&&!d){let f=t-o;this.kl.Jn(this.kl.ju()-f)}}this.kl.qu(t)}ta(t){t!==null&&t.N_()}cr(t){let e=this.kc.find((i=>i.$o().includes(t)));return e===void 0?null:e}Fu(){this.Bc.Vn(),this.kc.forEach((t=>t.N_())),this.Gl()}S(){this.kc.forEach((t=>t.S())),this.kc.length=0,this.cn.localization.priceFormatter=void 0,this.cn.localization.percentageFormatter=void 0,this.cn.localization.timeFormatter=void 0}_d(){return this.Vc}mr(){return this.Vc.W()}w_(){return this.Tc}ud(t,e,i){let s=this.kc[0],r=this.dd(e,t,s,i);return this.yc.push(r),this.yc.length===1?this.Xl():this.$h(),r}fd(t){let e=this.cr(t),i=this.yc.indexOf(t);te(i!==-1,"Series not found"),this.yc.splice(i,1),y(e).Yo(t),t.S&&t.S()}Zl(t,e){let i=y(this.cr(t));i.Yo(t);let s=this.$c(e);if(s===null){let r=t.Xi();i.Uo(t,e,r)}else{let r=s.Ht===i?t.Xi():void 0;s.Ht.Uo(t,e,r)}}rc(){let t=J.ss();t.$n(),this.Ec(t)}vd(t){let e=J.ss();e.Yn(t),this.Ec(e)}Kn(){let t=J.ss();t.Kn(),this.Ec(t)}Gn(t){let e=J.ss();e.Gn(t),this.Ec(e)}Jn(t){let e=J.ss();e.Jn(t),this.Ec(e)}Zn(t){let e=J.ss();e.Zn(t),this.Ec(e)}Un(){let t=J.ss();t.Un(),this.Ec(t)}pd(){return this.cn.rightPriceScale.visible?"right":"left"}md(){return this.Lc}q(){return this.Ic}Bt(t){let e=this.Lc,i=this.Ic;if(e===i)return e;if(t=Math.max(0,Math.min(100,Math.round(100*t))),this.Rc===null||this.Rc.Ts!==i||this.Rc.Ps!==e)this.Rc={Ts:i,Ps:e,bd:new Map};else{let r=this.Rc.bd.get(t);if(r!==void 0)return r}let s=(function(r,o,l){let[a,c,u,h]=$i(r),[d,f,p,m]=$i(o),g=[yt(a+l*(d-a)),yt(c+l*(f-c)),yt(u+l*(p-u)),ec(h+l*(m-h))];return`rgba(${g[0]}, ${g[1]}, ${g[2]}, ${g[3]})`})(i,e,t/100);return this.Rc.bd.set(t,s),s}Kc(t,e){let i=new J(e);if(t!==null){let s=this.kc.indexOf(t);i.Nn(s,{Fn:e})}return i}Nc(t,e){return e===void 0&&(e=2),this.Kc(this.cr(t),e)}Ec(t){this.Dc&&this.Dc(t),this.kc.forEach((e=>e.W_().Uh().bt()))}dd(t,e,i,s){let r=new ji(this,t,e,i,s),o=t.priceScaleId!==void 0?t.priceScaleId:this.pd();return i.Uo(r,o),ss(o)||r.Hh(t),r}zc(t){let e=this.cn.layout;return e.background.type==="gradient"?t===0?e.background.topColor:e.background.bottomColor:e.background.color}};function Bo(n){return!Rt(n)&&!qi(n)}function fc(n){return Rt(n)}(function(n){n[n.Disabled=0]="Disabled",n[n.Continuous=1]="Continuous",n[n.OnDataUpdate=2]="OnDataUpdate"})(_a||(_a={})),(function(n){n[n.LastBar=0]="LastBar",n[n.LastVisible=1]="LastVisible"})(Ra||(Ra={})),(function(n){n.Solid="solid",n.VerticalGradient="gradient"})(Pa||(Pa={})),(function(n){n[n.Year=0]="Year",n[n.Month=1]="Month",n[n.DayOfMonth=2]="DayOfMonth",n[n.Time=3]="Time",n[n.TimeWithSeconds=4]="TimeWithSeconds"})(Ia||(Ia={}));var Aa=n=>n.getUTCFullYear();function Fd(n,t,e){return t.replace(/yyyy/g,(i=>Bt(Aa(i),4))(n)).replace(/yy/g,(i=>Bt(Aa(i)%100,2))(n)).replace(/MMMM/g,((i,s)=>new Date(i.getUTCFullYear(),i.getUTCMonth(),1).toLocaleString(s,{month:"long"}))(n,e)).replace(/MMM/g,((i,s)=>new Date(i.getUTCFullYear(),i.getUTCMonth(),1).toLocaleString(s,{month:"short"}))(n,e)).replace(/MM/g,(i=>Bt((s=>s.getUTCMonth()+1)(i),2))(n)).replace(/dd/g,(i=>Bt((s=>s.getUTCDate())(i),2))(n))}var Yn=class{constructor(t="yyyy-MM-dd",e="default"){this.wd=t,this.gd=e}q_(t){return Fd(t,this.wd,this.gd)}},zo=class{constructor(t){this.Md=t||"%h:%m:%s"}q_(t){return this.Md.replace("%h",Bt(t.getUTCHours(),2)).replace("%m",Bt(t.getUTCMinutes(),2)).replace("%s",Bt(t.getUTCSeconds(),2))}},Bd={xd:"yyyy-MM-dd",Sd:"%h:%m:%s",kd:" ",yd:"default"},Ho=class{constructor(t={}){let e=Object.assign(Object.assign({},Bd),t);this.Cd=new Yn(e.xd,e.yd),this.Td=new zo(e.Sd),this.Pd=e.kd}q_(t){return`${this.Cd.q_(t)}${this.Pd}${this.Td.q_(t)}`}};function An(n){return 60*n*60*1e3}function Dr(n){return 60*n*1e3}var Nn=[{Rd:(Na=1,1e3*Na),Dd:10},{Rd:Dr(1),Dd:20},{Rd:Dr(5),Dd:21},{Rd:Dr(30),Dd:22},{Rd:An(1),Dd:30},{Rd:An(3),Dd:31},{Rd:An(6),Dd:32},{Rd:An(12),Dd:33}],Na;function $a(n,t){if(n.getUTCFullYear()!==t.getUTCFullYear())return 70;if(n.getUTCMonth()!==t.getUTCMonth())return 60;if(n.getUTCDate()!==t.getUTCDate())return 50;for(let e=Nn.length-1;e>=0;--e)if(Math.floor(t.getTime()/Nn[e].Rd)!==Math.floor(n.getTime()/Nn[e].Rd))return Nn[e].Dd;return 0}function Tr(n){let t=n;if(qi(n)&&(t=sl(n)),!Bo(t))throw new Error("time must be of type BusinessDay");let e=new Date(Date.UTC(t.year,t.month-1,t.day,0,0,0,0));return{Vd:Math.round(e.getTime()/1e3),Od:t}}function Va(n){if(!fc(n))throw new Error("time must be of type isUTCTimestamp");return{Vd:n}}function sl(n){let t=new Date(n);if(isNaN(t.getTime()))throw new Error(`Invalid date string=${n}, expected format=yyyy-mm-dd`);return{day:t.getUTCDate(),month:t.getUTCMonth()+1,year:t.getUTCFullYear()}}function Fa(n){qi(n.time)&&(n.time=sl(n.time))}var Qn=class{options(){return this.cn}setOptions(t){this.cn=t,this.updateFormatter(t.localization)}preprocessData(t){Array.isArray(t)?(function(e){e.forEach(Fa)})(t):Fa(t)}createConverterToInternalObj(t){return y((function(e){return e.length===0?null:Bo(e[0].time)||qi(e[0].time)?Tr:Va})(t))}key(t){return typeof t=="object"&&"Vd"in t?t.Vd:this.key(this.convertHorzItemToInternal(t))}cacheKey(t){let e=t;return e.Od===void 0?new Date(1e3*e.Vd).getTime():new Date(Date.UTC(e.Od.year,e.Od.month-1,e.Od.day)).getTime()}convertHorzItemToInternal(t){return fc(e=t)?Va(e):Bo(e)?Tr(e):Tr(sl(e));var e}updateFormatter(t){if(!this.cn)return;let e=t.dateFormat;this.cn.timeScale.timeVisible?this.Bd=new Ho({xd:e,Sd:this.cn.timeScale.secondsVisible?"%h:%m:%s":"%h:%m",kd:"   ",yd:t.locale}):this.Bd=new Yn(e,t.locale)}formatHorzItem(t){let e=t;return this.Bd.q_(new Date(1e3*e.Vd))}formatTickmark(t,e){let i=(function(r,o,l){switch(r){case 0:case 10:return o?l?4:3:2;case 20:case 21:case 22:case 30:case 31:case 32:case 33:return o?3:2;case 50:return 2;case 60:return 1;case 70:return 0}})(t.weight,this.cn.timeScale.timeVisible,this.cn.timeScale.secondsVisible),s=this.cn.timeScale;if(s.tickMarkFormatter!==void 0){let r=s.tickMarkFormatter(t.originalTime,i,e.locale);if(r!==null)return r}return(function(r,o,l){let a={};switch(o){case 0:a.year="numeric";break;case 1:a.month="short";break;case 2:a.day="numeric";break;case 3:a.hour12=!1,a.hour="2-digit",a.minute="2-digit";break;case 4:a.hour12=!1,a.hour="2-digit",a.minute="2-digit",a.second="2-digit"}let c=r.Od===void 0?new Date(1e3*r.Vd):new Date(Date.UTC(r.Od.year,r.Od.month-1,r.Od.day));return new Date(c.getUTCFullYear(),c.getUTCMonth(),c.getUTCDate(),c.getUTCHours(),c.getUTCMinutes(),c.getUTCSeconds(),c.getUTCMilliseconds()).toLocaleString(l,a)})(t.time,i,e.locale)}maxTickMarkWeight(t){let e=t.reduce(Vd,t[0]).weight;return e>30&&e<50&&(e=30),e}fillWeightsForPoints(t,e){(function(i,s=0){if(i.length===0)return;let r=s===0?null:i[s-1].time.Vd,o=r!==null?new Date(1e3*r):null,l=0;for(let a=s;a<i.length;++a){let c=i[a],u=new Date(1e3*c.time.Vd);o!==null&&(c.timeWeight=$a(u,o)),l+=c.time.Vd-(r||c.time.Vd),r=c.time.Vd,o=u}if(s===0&&i.length>1){let a=Math.ceil(l/(i.length-1)),c=new Date(1e3*(i[0].time.Vd-a));i[0].timeWeight=$a(new Date(1e3*i[0].time.Vd),c)}})(t,e)}static Ad(t){return Ct({localization:{dateFormat:"dd MMM 'yy"}},t??{})}},qe=typeof window<"u";function Ba(){return!!qe&&window.navigator.userAgent.toLowerCase().indexOf("firefox")>-1}function Lr(){return!!qe&&/iPhone|iPad|iPod/.test(window.navigator.platform)}function Oo(n){return n+n%2}function Er(n,t){return n.Id-t.Id}function kr(n,t,e){let i=(n.Id-t.Id)/(n.ot-t.ot);return Math.sign(i)*Math.min(Math.abs(i),e)}var Wo=class{constructor(t,e,i,s){this.zd=null,this.Ld=null,this.Ed=null,this.Nd=null,this.Fd=null,this.Wd=0,this.jd=0,this.Hd=t,this.$d=e,this.Ud=i,this.rs=s}qd(t,e){if(this.zd!==null){if(this.zd.ot===e)return void(this.zd.Id=t);if(Math.abs(this.zd.Id-t)<this.rs)return}this.Nd=this.Ed,this.Ed=this.Ld,this.Ld=this.zd,this.zd={ot:e,Id:t}}Dr(t,e){if(this.zd===null||this.Ld===null||e-this.zd.ot>50)return;let i=0,s=kr(this.zd,this.Ld,this.$d),r=Er(this.zd,this.Ld),o=[s],l=[r];if(i+=r,this.Ed!==null){let c=kr(this.Ld,this.Ed,this.$d);if(Math.sign(c)===Math.sign(s)){let u=Er(this.Ld,this.Ed);if(o.push(c),l.push(u),i+=u,this.Nd!==null){let h=kr(this.Ed,this.Nd,this.$d);if(Math.sign(h)===Math.sign(s)){let d=Er(this.Ed,this.Nd);o.push(h),l.push(d),i+=d}}}}let a=0;for(let c=0;c<o.length;++c)a+=l[c]/i*o[c];Math.abs(a)<this.Hd||(this.Fd={Id:t,ot:e},this.jd=a,this.Wd=(function(c,u){let h=Math.log(u);return Math.log(1*h/-c)/h})(Math.abs(a),this.Ud))}Qu(t){let e=y(this.Fd),i=t-e.ot;return e.Id+this.jd*(Math.pow(this.Ud,i)-1)/Math.log(this.Ud)}Ju(t){return this.Fd===null||this.Yd(t)===this.Wd}Yd(t){let e=t-y(this.Fd).ot;return Math.min(e,this.Wd)}},Uo=class{constructor(t,e){this.Zd=void 0,this.Xd=void 0,this.Kd=void 0,this.en=!1,this.Gd=t,this.Jd=e,this.Qd()}bt(){this.Qd()}tf(){this.Zd&&this.Gd.removeChild(this.Zd),this.Xd&&this.Gd.removeChild(this.Xd),this.Zd=void 0,this.Xd=void 0}if(){return this.en!==this.nf()||this.Kd!==this.sf()}sf(){return ic($i(this.Jd.W().layout.textColor))>160?"dark":"light"}nf(){return this.Jd.W().layout.attributionLogo}ef(){let t=new URL(location.href);return t.hostname?"&utm_source="+t.hostname+t.pathname:""}Qd(){this.if()&&(this.tf(),this.en=this.nf(),this.en&&(this.Kd=this.sf(),this.Xd=document.createElement("style"),this.Xd.innerText="a#tv-attr-logo{--fill:#131722;--stroke:#fff;position:absolute;left:10px;bottom:10px;height:19px;width:35px;margin:0;padding:0;border:0;z-index:3;}a#tv-attr-logo[data-dark]{--fill:#D1D4DC;--stroke:#131722;}",this.Zd=document.createElement("a"),this.Zd.href=`https://www.tradingview.com/?utm_medium=lwc-link&utm_campaign=lwc-chart${this.ef()}`,this.Zd.title="Charting by TradingView",this.Zd.id="tv-attr-logo",this.Zd.target="_blank",this.Zd.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 35 19" width="35" height="19" fill="none"><g fill-rule="evenodd" clip-path="url(#a)" clip-rule="evenodd"><path fill="var(--stroke)" d="M2 0H0v10h6v9h21.4l.5-1.3 6-15 1-2.7H23.7l-.5 1.3-.2.6a5 5 0 0 0-7-.9V0H2Zm20 17h4l5.2-13 .8-2h-7l-1 2.5-.2.5-1.5 3.8-.3.7V17Zm-.8-10a3 3 0 0 0 .7-2.7A3 3 0 1 0 16.8 7h4.4ZM14 7V2H2v6h6v9h4V7h2Z"/><path fill="var(--fill)" d="M14 2H2v6h6v9h6V2Zm12 15h-7l6-15h7l-6 15Zm-7-9a3 3 0 1 0 0-6 3 3 0 0 0 0 6Z"/></g><defs><clipPath id="a"><path fill="var(--stroke)" d="M0 0h35v19H0z"/></clipPath></defs></svg>',this.Zd.toggleAttribute("data-dark",this.Kd==="dark"),this.Gd.appendChild(this.Xd),this.Gd.appendChild(this.Zd)))}};function ye(n,t){let e=y(n.ownerDocument).createElement("canvas");n.appendChild(e);let i=yr(e,{type:"device-pixel-content-box",options:{allowResizeObserver:!1},transform:(s,r)=>({width:Math.max(s.width,r.width),height:Math.max(s.height,r.height)})});return i.resizeCanvasElement(t),i}function Se(n){var t;n.width=1,n.height=1,(t=n.getContext("2d"))===null||t===void 0||t.clearRect(0,0,1,1)}function jo(n,t,e,i){n.wl&&n.wl(t,e,i)}function zn(n,t,e,i){n.X(t,e,i)}function Ko(n,t,e,i){let s=n(e,i);for(let r of s){let o=r.gt();o!==null&&t(o)}}function zd(n){qe&&window.chrome!==void 0&&n.addEventListener("mousedown",(t=>{if(t.button===1)return t.preventDefault(),!1}))}var Ki=class{constructor(t,e,i){this.rf=0,this.hf=null,this.lf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.af=0,this._f=null,this.uf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY},this.cf=null,this.df=!1,this.ff=null,this.vf=null,this.pf=!1,this.mf=!1,this.bf=!1,this.wf=null,this.gf=null,this.Mf=null,this.xf=null,this.Sf=null,this.kf=null,this.yf=null,this.Cf=0,this.Tf=!1,this.Pf=!1,this.Rf=!1,this.Df=0,this.Vf=null,this.Of=!Lr(),this.Bf=s=>{this.Af(s)},this.If=s=>{if(this.zf(s)){let r=this.Lf(s);if(++this.af,this._f&&this.af>1){let{Ef:o}=this.Nf(_t(s),this.uf);o<30&&!this.bf&&this.Ff(r,this.jf.Wf),this.Hf()}}else{let r=this.Lf(s);if(++this.rf,this.hf&&this.rf>1){let{Ef:o}=this.Nf(_t(s),this.lf);o<5&&!this.mf&&this.$f(r,this.jf.Uf),this.qf()}}},this.Yf=t,this.jf=e,this.cn=i,this.Zf()}S(){this.wf!==null&&(this.wf(),this.wf=null),this.gf!==null&&(this.gf(),this.gf=null),this.xf!==null&&(this.xf(),this.xf=null),this.Sf!==null&&(this.Sf(),this.Sf=null),this.kf!==null&&(this.kf(),this.kf=null),this.Mf!==null&&(this.Mf(),this.Mf=null),this.Xf(),this.qf()}Kf(t){this.xf&&this.xf();let e=this.Gf.bind(this);if(this.xf=()=>{this.Yf.removeEventListener("mousemove",e)},this.Yf.addEventListener("mousemove",e),this.zf(t))return;let i=this.Lf(t);this.$f(i,this.jf.Jf),this.Of=!0}qf(){this.hf!==null&&clearTimeout(this.hf),this.rf=0,this.hf=null,this.lf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}Hf(){this._f!==null&&clearTimeout(this._f),this.af=0,this._f=null,this.uf={nt:Number.NEGATIVE_INFINITY,st:Number.POSITIVE_INFINITY}}Gf(t){if(this.Rf||this.vf!==null||this.zf(t))return;let e=this.Lf(t);this.$f(e,this.jf.Qf),this.Of=!0}tv(t){let e=_r(t.changedTouches,y(this.Vf));if(e===null||(this.Df=$n(t),this.yf!==null)||this.Pf)return;this.Tf=!0;let i=this.Nf(_t(e),y(this.vf)),{iv:s,nv:r,Ef:o}=i;if(this.pf||!(o<5)){if(!this.pf){let l=.5*s,a=r>=l&&!this.cn.sv(),c=l>r&&!this.cn.ev();a||c||(this.Pf=!0),this.pf=!0,this.bf=!0,this.Xf(),this.Hf()}if(!this.Pf){let l=this.Lf(t,e);this.Ff(l,this.jf.rv),Be(t)}}}hv(t){if(t.button!==0)return;let e=this.Nf(_t(t),y(this.ff)),{Ef:i}=e;if(i>=5&&(this.mf=!0,this.qf()),this.mf){let s=this.Lf(t);this.$f(s,this.jf.lv)}}Nf(t,e){let i=Math.abs(e.nt-t.nt),s=Math.abs(e.st-t.st);return{iv:i,nv:s,Ef:i+s}}av(t){let e=_r(t.changedTouches,y(this.Vf));if(e===null&&t.touches.length===0&&(e=t.changedTouches[0]),e===null)return;this.Vf=null,this.Df=$n(t),this.Xf(),this.vf=null,this.kf&&(this.kf(),this.kf=null);let i=this.Lf(t,e);if(this.Ff(i,this.jf.ov),++this.af,this._f&&this.af>1){let{Ef:s}=this.Nf(_t(e),this.uf);s<30&&!this.bf&&this.Ff(i,this.jf.Wf),this.Hf()}else this.bf||(this.Ff(i,this.jf._v),this.jf._v&&Be(t));this.af===0&&Be(t),t.touches.length===0&&this.df&&(this.df=!1,Be(t))}Af(t){if(t.button!==0)return;let e=this.Lf(t);if(this.ff=null,this.Rf=!1,this.Sf&&(this.Sf(),this.Sf=null),Ba()&&this.Yf.ownerDocument.documentElement.removeEventListener("mouseleave",this.Bf),!this.zf(t))if(this.$f(e,this.jf.uv),++this.rf,this.hf&&this.rf>1){let{Ef:i}=this.Nf(_t(t),this.lf);i<5&&!this.mf&&this.$f(e,this.jf.Uf),this.qf()}else this.mf||this.$f(e,this.jf.cv)}Xf(){this.cf!==null&&(clearTimeout(this.cf),this.cf=null)}dv(t){if(this.Vf!==null)return;let e=t.changedTouches[0];this.Vf=e.identifier,this.Df=$n(t);let i=this.Yf.ownerDocument.documentElement;this.bf=!1,this.pf=!1,this.Pf=!1,this.vf=_t(e),this.kf&&(this.kf(),this.kf=null);{let r=this.tv.bind(this),o=this.av.bind(this);this.kf=()=>{i.removeEventListener("touchmove",r),i.removeEventListener("touchend",o)},i.addEventListener("touchmove",r,{passive:!1}),i.addEventListener("touchend",o,{passive:!1}),this.Xf(),this.cf=setTimeout(this.fv.bind(this,t),240)}let s=this.Lf(t,e);this.Ff(s,this.jf.vv),this._f||(this.af=0,this._f=setTimeout(this.Hf.bind(this),500),this.uf=_t(e))}pv(t){if(t.button!==0)return;let e=this.Yf.ownerDocument.documentElement;Ba()&&e.addEventListener("mouseleave",this.Bf),this.mf=!1,this.ff=_t(t),this.Sf&&(this.Sf(),this.Sf=null);{let s=this.hv.bind(this),r=this.Af.bind(this);this.Sf=()=>{e.removeEventListener("mousemove",s),e.removeEventListener("mouseup",r)},e.addEventListener("mousemove",s),e.addEventListener("mouseup",r)}if(this.Rf=!0,this.zf(t))return;let i=this.Lf(t);this.$f(i,this.jf.mv),this.hf||(this.rf=0,this.hf=setTimeout(this.qf.bind(this),500),this.lf=_t(t))}Zf(){this.Yf.addEventListener("mouseenter",this.Kf.bind(this)),this.Yf.addEventListener("touchcancel",this.Xf.bind(this));{let t=this.Yf.ownerDocument,e=i=>{this.jf.bv&&(i.composed&&this.Yf.contains(i.composedPath()[0])||i.target&&this.Yf.contains(i.target)||this.jf.bv())};this.gf=()=>{t.removeEventListener("touchstart",e)},this.wf=()=>{t.removeEventListener("mousedown",e)},t.addEventListener("mousedown",e),t.addEventListener("touchstart",e,{passive:!0})}Lr()&&(this.Mf=()=>{this.Yf.removeEventListener("dblclick",this.If)},this.Yf.addEventListener("dblclick",this.If)),this.Yf.addEventListener("mouseleave",this.wv.bind(this)),this.Yf.addEventListener("touchstart",this.dv.bind(this),{passive:!0}),zd(this.Yf),this.Yf.addEventListener("mousedown",this.pv.bind(this)),this.gv(),this.Yf.addEventListener("touchmove",(()=>{}),{passive:!1})}gv(){this.jf.Mv===void 0&&this.jf.xv===void 0&&this.jf.Sv===void 0||(this.Yf.addEventListener("touchstart",(t=>this.kv(t.touches)),{passive:!0}),this.Yf.addEventListener("touchmove",(t=>{if(t.touches.length===2&&this.yf!==null&&this.jf.xv!==void 0){let e=za(t.touches[0],t.touches[1])/this.Cf;this.jf.xv(this.yf,e),Be(t)}}),{passive:!1}),this.Yf.addEventListener("touchend",(t=>{this.kv(t.touches)})))}kv(t){t.length===1&&(this.Tf=!1),t.length!==2||this.Tf||this.df?this.yv():this.Cv(t)}Cv(t){let e=this.Yf.getBoundingClientRect()||{left:0,top:0};this.yf={nt:(t[0].clientX-e.left+(t[1].clientX-e.left))/2,st:(t[0].clientY-e.top+(t[1].clientY-e.top))/2},this.Cf=za(t[0],t[1]),this.jf.Mv!==void 0&&this.jf.Mv(),this.Xf()}yv(){this.yf!==null&&(this.yf=null,this.jf.Sv!==void 0&&this.jf.Sv())}wv(t){if(this.xf&&this.xf(),this.zf(t)||!this.Of)return;let e=this.Lf(t);this.$f(e,this.jf.Tv),this.Of=!Lr()}fv(t){let e=_r(t.touches,y(this.Vf));if(e===null)return;let i=this.Lf(t,e);this.Ff(i,this.jf.Pv),this.bf=!0,this.df=!0}zf(t){return t.sourceCapabilities&&t.sourceCapabilities.firesTouchEvents!==void 0?t.sourceCapabilities.firesTouchEvents:$n(t)<this.Df+500}Ff(t,e){e&&e.call(this.jf,t)}$f(t,e){e&&e.call(this.jf,t)}Lf(t,e){let i=e||t,s=this.Yf.getBoundingClientRect()||{left:0,top:0};return{clientX:i.clientX,clientY:i.clientY,pageX:i.pageX,pageY:i.pageY,screenX:i.screenX,screenY:i.screenY,localX:i.clientX-s.left,localY:i.clientY-s.top,ctrlKey:t.ctrlKey,altKey:t.altKey,shiftKey:t.shiftKey,metaKey:t.metaKey,Rv:!t.type.startsWith("mouse")&&t.type!=="contextmenu"&&t.type!=="click",Dv:t.type,Vv:i.target,Ov:t.view,Bv:()=>{t.type!=="touchstart"&&Be(t)}}}};function za(n,t){let e=n.clientX-t.clientX,i=n.clientY-t.clientY;return Math.sqrt(e*e+i*i)}function Be(n){n.cancelable&&n.preventDefault()}function _t(n){return{nt:n.pageX,st:n.pageY}}function $n(n){return n.timeStamp||performance.now()}function _r(n,t){for(let e=0;e<n.length;++e)if(n[e].identifier===t)return n[e];return null}function Vn(n){return{jc:n.jc,Av:{wr:n.Iv.externalId},zv:n.Iv.cursorStyle}}function Hd(n,t,e){for(let i of n){let s=i.gt();if(s!==null&&s.br){let r=s.br(t,e);if(r!==null)return{Ov:i,Av:r}}}return null}function Rr(n,t){return e=>{var i,s,r,o;return((s=(i=e.Dt())===null||i===void 0?void 0:i.Ta())!==null&&s!==void 0?s:"")!==t?[]:(o=(r=e.ca)===null||r===void 0?void 0:r.call(e,n))!==null&&o!==void 0?o:[]}}function Ha(n,t,e,i){if(!n.length)return;let s=0,r=e/2,o=n[0].At(i,!0),l=t===1?r-(n[0].Vi()-o/2):n[0].Vi()-o/2-r;l=Math.max(0,l);for(let a=1;a<n.length;a++){let c=n[a],u=n[a-1],h=u.At(i,!1),d=c.Vi(),f=u.Vi();if(t===1?d>f-h:d<f+h){let p=f-h*t;c.Oi(p);let m=p-t*h/2;if((t===1?m<0:m>e)&&l>0){let g=t===1?-1-m:m-e,v=Math.min(g,l);for(let b=s;b<n.length;b++)n[b].Oi(n[b].Vi()+t*v);l-=v}}else s=a,l=t===1?f-h-d:d-(f+h)}}var ts=class{constructor(t,e,i,s){this.Li=null,this.Lv=null,this.Ev=!1,this.Nv=new be(200),this.Jr=null,this.Fv=0,this.Wv=!1,this.jv=()=>{this.Wv||this.tn.Hv().$t().$h()},this.$v=()=>{this.Wv||this.tn.Hv().$t().$h()},this.tn=t,this.cn=e,this.So=e.layout,this.Vc=i,this.Uv=s==="left",this.qv=Rr("normal",s),this.Yv=Rr("top",s),this.Zv=Rr("bottom",s),this.Xv=document.createElement("div"),this.Xv.style.height="100%",this.Xv.style.overflow="hidden",this.Xv.style.width="25px",this.Xv.style.left="0",this.Xv.style.position="relative",this.Kv=ye(this.Xv,$({width:16,height:16})),this.Kv.subscribeSuggestedBitmapSizeChanged(this.jv);let r=this.Kv.canvasElement;r.style.position="absolute",r.style.zIndex="1",r.style.left="0",r.style.top="0",this.Gv=ye(this.Xv,$({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.$v);let o=this.Gv.canvasElement;o.style.position="absolute",o.style.zIndex="2",o.style.left="0",o.style.top="0";let l={mv:this.Jv.bind(this),vv:this.Jv.bind(this),lv:this.Qv.bind(this),rv:this.Qv.bind(this),bv:this.tp.bind(this),uv:this.ip.bind(this),ov:this.ip.bind(this),Uf:this.np.bind(this),Wf:this.np.bind(this),Jf:this.sp.bind(this),Tv:this.ep.bind(this)};this.rp=new Ki(this.Gv.canvasElement,l,{sv:()=>!this.cn.handleScroll.vertTouchDrag,ev:()=>!0})}S(){this.rp.S(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.$v),Se(this.Gv.canvasElement),this.Gv.dispose(),this.Kv.unsubscribeSuggestedBitmapSizeChanged(this.jv),Se(this.Kv.canvasElement),this.Kv.dispose(),this.Li!==null&&this.Li.Xo().p(this),this.Li=null}hp(){return this.Xv}P(){return this.So.fontSize}lp(){let t=this.Vc.W();return this.Jr!==t.R&&(this.Nv.ir(),this.Jr=t.R),t}ap(){if(this.Li===null)return 0;let t=0,e=this.lp(),i=y(this.Kv.canvasElement.getContext("2d"));i.save();let s=this.Li.ja();i.font=this.op(),s.length>0&&(t=Math.max(this.Nv.xi(i,s[0].no),this.Nv.xi(i,s[s.length-1].no)));let r=this._p();for(let a=r.length;a--;){let c=this.Nv.xi(i,r[a].Kt());c>t&&(t=c)}let o=this.Li.Ct();if(o!==null&&this.Lv!==null){let a=this.Li.pn(1,o),c=this.Li.pn(this.Lv.height-2,o);t=Math.max(t,this.Nv.xi(i,this.Li.Fi(Math.floor(Math.min(a,c))+.11111111111111,o)),this.Nv.xi(i,this.Li.Fi(Math.ceil(Math.max(a,c))-.11111111111111,o)))}i.restore();let l=t||34;return Oo(Math.ceil(e.C+e.T+e.A+e.I+5+l))}up(t){this.Lv!==null&&kt(this.Lv,t)||(this.Lv=t,this.Wv=!0,this.Kv.resizeCanvasElement(t),this.Gv.resizeCanvasElement(t),this.Wv=!1,this.Xv.style.width=`${t.width}px`,this.Xv.style.height=`${t.height}px`)}cp(){return y(this.Lv).width}Gi(t){this.Li!==t&&(this.Li!==null&&this.Li.Xo().p(this),this.Li=t,t.Xo().l(this.do.bind(this),this))}Dt(){return this.Li}ir(){let t=this.tn.dp();this.tn.Hv().$t().L_(t,y(this.Dt()))}fp(t){if(this.Lv===null)return;if(t!==1){this.vp(),this.Kv.applySuggestedBitmapSize();let i=Vt(this.Kv);i!==null&&(i.useBitmapCoordinateSpace((s=>{this.pp(s),this.Ae(s)})),this.tn.mp(i,this.Zv),this.bp(i),this.tn.mp(i,this.qv),this.wp(i))}this.Gv.applySuggestedBitmapSize();let e=Vt(this.Gv);e!==null&&(e.useBitmapCoordinateSpace((({context:i,bitmapSize:s})=>{i.clearRect(0,0,s.width,s.height)})),this.gp(e),this.tn.mp(e,this.Yv))}Mp(){return this.Kv.bitmapSize}xp(t,e,i){let s=this.Mp();s.width>0&&s.height>0&&t.drawImage(this.Kv.canvasElement,e,i)}bt(){var t;(t=this.Li)===null||t===void 0||t.ja()}Jv(t){if(this.Li===null||this.Li.Ni()||!this.cn.handleScale.axisPressedMouseMove.price)return;let e=this.tn.Hv().$t(),i=this.tn.dp();this.Ev=!0,e.D_(i,this.Li,t.localY)}Qv(t){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;let e=this.tn.Hv().$t(),i=this.tn.dp(),s=this.Li;e.V_(i,s,t.localY)}tp(){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;let t=this.tn.Hv().$t(),e=this.tn.dp(),i=this.Li;this.Ev&&(this.Ev=!1,t.O_(e,i))}ip(t){if(this.Li===null||!this.cn.handleScale.axisPressedMouseMove.price)return;let e=this.tn.Hv().$t(),i=this.tn.dp();this.Ev=!1,e.O_(i,this.Li)}np(t){this.cn.handleScale.axisDoubleClickReset.price&&this.ir()}sp(t){this.Li!==null&&(!this.tn.Hv().$t().W().handleScale.axisPressedMouseMove.price||this.Li.gh()||this.Li.Vo()||this.Sp(1))}ep(t){this.Sp(0)}_p(){let t=[],e=this.Li===null?void 0:this.Li;return(i=>{for(let s=0;s<i.length;++s){let r=i[s].Rn(this.tn.dp(),e);for(let o=0;o<r.length;o++)t.push(r[o])}})(this.tn.dp().$o()),t}pp({context:t,bitmapSize:e}){let{width:i,height:s}=e,r=this.tn.dp().$t(),o=r.q(),l=r.md();o===l?ns(t,0,0,i,s,o):nc(t,0,0,i,s,o,l)}Ae({context:t,bitmapSize:e,horizontalPixelRatio:i}){if(this.Lv===null||this.Li===null||!this.Li.W().borderVisible)return;t.fillStyle=this.Li.W().borderColor;let s=Math.max(1,Math.floor(this.lp().C*i)),r;r=this.Uv?e.width-s:0,t.fillRect(r,0,s,e.height)}bp(t){if(this.Lv===null||this.Li===null)return;let e=this.Li.ja(),i=this.Li.W(),s=this.lp(),r=this.Uv?this.Lv.width-s.T:0;i.borderVisible&&i.ticksVisible&&t.useBitmapCoordinateSpace((({context:o,horizontalPixelRatio:l,verticalPixelRatio:a})=>{o.fillStyle=i.borderColor;let c=Math.max(1,Math.floor(a)),u=Math.floor(.5*a),h=Math.round(s.T*l);o.beginPath();for(let d of e)o.rect(Math.floor(r*l),Math.round(d.La*a)-u,h,c);o.fill()})),t.useMediaCoordinateSpace((({context:o})=>{var l;o.font=this.op(),o.fillStyle=(l=i.textColor)!==null&&l!==void 0?l:this.So.textColor,o.textAlign=this.Uv?"right":"left",o.textBaseline="middle";let a=this.Uv?Math.round(r-s.A):Math.round(r+s.T+s.A),c=e.map((u=>this.Nv.Mi(o,u.no)));for(let u=e.length;u--;){let h=e[u];o.fillText(h.no,a,h.La+c[u])}}))}vp(){if(this.Lv===null||this.Li===null)return;let t=[],e=this.Li.$o().slice(),i=this.tn.dp(),s=this.lp();this.Li===i.vr()&&this.tn.dp().$o().forEach((o=>{i.dr(o)&&e.push(o)}));let r=this.Li;e.forEach((o=>{o.Rn(i,r).forEach((l=>{l.Oi(null),l.Bi()&&t.push(l)}))})),t.forEach((o=>o.Oi(o.ki()))),this.Li.W().alignLabels&&this.kp(t,s)}kp(t,e){if(this.Lv===null)return;let i=this.Lv.height/2,s=t.filter((o=>o.ki()<=i)),r=t.filter((o=>o.ki()>i));s.sort(((o,l)=>l.ki()-o.ki())),r.sort(((o,l)=>o.ki()-l.ki()));for(let o of t){let l=Math.floor(o.At(e)/2),a=o.ki();a>-l&&a<l&&o.Oi(l),a>this.Lv.height-l&&a<this.Lv.height+l&&o.Oi(this.Lv.height-l)}Ha(s,1,this.Lv.height,e),Ha(r,-1,this.Lv.height,e)}wp(t){if(this.Lv===null)return;let e=this._p(),i=this.lp(),s=this.Uv?"right":"left";e.forEach((r=>{r.Ai()&&r.gt(y(this.Li)).X(t,i,this.Nv,s)}))}gp(t){if(this.Lv===null||this.Li===null)return;let e=this.tn.Hv().$t(),i=[],s=this.tn.dp(),r=e.Yc().Rn(s,this.Li);r.length&&i.push(r);let o=this.lp(),l=this.Uv?"right":"left";i.forEach((a=>{a.forEach((c=>{c.gt(y(this.Li)).X(t,o,this.Nv,l)}))}))}Sp(t){this.Xv.style.cursor=t===1?"ns-resize":"default"}do(){let t=this.ap();this.Fv<t&&this.tn.Hv().$t().Xl(),this.Fv=t}op(){return We(this.So.fontSize,this.So.fontFamily)}};function Od(n,t){var e,i;return(i=(e=n._a)===null||e===void 0?void 0:e.call(n,t))!==null&&i!==void 0?i:[]}function Fn(n,t){var e,i;return(i=(e=n.Pn)===null||e===void 0?void 0:e.call(n,t))!==null&&i!==void 0?i:[]}function Wd(n,t){var e,i;return(i=(e=n.Ji)===null||e===void 0?void 0:e.call(n,t))!==null&&i!==void 0?i:[]}function Ud(n,t){var e,i;return(i=(e=n.la)===null||e===void 0?void 0:e.call(n,t))!==null&&i!==void 0?i:[]}var qo=class n{constructor(t,e){this.Lv=$({width:0,height:0}),this.yp=null,this.Cp=null,this.Tp=null,this.Pp=null,this.Rp=!1,this.Dp=new O,this.Vp=new O,this.Op=0,this.Bp=!1,this.Ap=null,this.Ip=!1,this.zp=null,this.Lp=null,this.Wv=!1,this.jv=()=>{this.Wv||this.Ep===null||this.$i().$h()},this.$v=()=>{this.Wv||this.Ep===null||this.$i().$h()},this.Jd=t,this.Ep=e,this.Ep.F_().l(this.Np.bind(this),this,!0),this.Fp=document.createElement("td"),this.Fp.style.padding="0",this.Fp.style.position="relative";let i=document.createElement("div");i.style.width="100%",i.style.height="100%",i.style.position="relative",i.style.overflow="hidden",this.Wp=document.createElement("td"),this.Wp.style.padding="0",this.jp=document.createElement("td"),this.jp.style.padding="0",this.Fp.appendChild(i),this.Kv=ye(i,$({width:16,height:16})),this.Kv.subscribeSuggestedBitmapSizeChanged(this.jv);let s=this.Kv.canvasElement;s.style.position="absolute",s.style.zIndex="1",s.style.left="0",s.style.top="0",this.Gv=ye(i,$({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.$v);let r=this.Gv.canvasElement;r.style.position="absolute",r.style.zIndex="2",r.style.left="0",r.style.top="0",this.Hp=document.createElement("tr"),this.Hp.appendChild(this.Wp),this.Hp.appendChild(this.Fp),this.Hp.appendChild(this.jp),this.$p(),this.rp=new Ki(this.Gv.canvasElement,this,{sv:()=>this.Ap===null&&!this.Jd.W().handleScroll.vertTouchDrag,ev:()=>this.Ap===null&&!this.Jd.W().handleScroll.horzTouchDrag})}S(){this.yp!==null&&this.yp.S(),this.Cp!==null&&this.Cp.S(),this.Tp=null,this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.$v),Se(this.Gv.canvasElement),this.Gv.dispose(),this.Kv.unsubscribeSuggestedBitmapSizeChanged(this.jv),Se(this.Kv.canvasElement),this.Kv.dispose(),this.Ep!==null&&this.Ep.F_().p(this),this.rp.S()}dp(){return y(this.Ep)}Up(t){var e,i;this.Ep!==null&&this.Ep.F_().p(this),this.Ep=t,this.Ep!==null&&this.Ep.F_().l(n.prototype.Np.bind(this),this,!0),this.$p(),this.Jd.qp().indexOf(this)===this.Jd.qp().length-1?(this.Tp=(e=this.Tp)!==null&&e!==void 0?e:new Uo(this.Fp,this.Jd),this.Tp.bt()):((i=this.Tp)===null||i===void 0||i.tf(),this.Tp=null)}Hv(){return this.Jd}hp(){return this.Hp}$p(){if(this.Ep!==null&&(this.Yp(),this.$i().wt().length!==0)){if(this.yp!==null){let t=this.Ep.P_();this.yp.Gi(y(t))}if(this.Cp!==null){let t=this.Ep.R_();this.Cp.Gi(y(t))}}}Zp(){this.yp!==null&&this.yp.bt(),this.Cp!==null&&this.Cp.bt()}g_(){return this.Ep!==null?this.Ep.g_():0}M_(t){this.Ep&&this.Ep.M_(t)}Jf(t){if(!this.Ep)return;this.Xp();let e=t.localX,i=t.localY;this.Kp(e,i,t)}mv(t){this.Xp(),this.Gp(),this.Kp(t.localX,t.localY,t)}Qf(t){var e;if(!this.Ep)return;this.Xp();let i=t.localX,s=t.localY;this.Kp(i,s,t);let r=this.br(i,s);this.Jd.Jp((e=r?.zv)!==null&&e!==void 0?e:null),this.$i().Wc(r&&{jc:r.jc,Av:r.Av})}cv(t){this.Ep!==null&&(this.Xp(),this.Qp(t))}Uf(t){this.Ep!==null&&this.tm(this.Vp,t)}Wf(t){this.Uf(t)}lv(t){this.Xp(),this.im(t),this.Kp(t.localX,t.localY,t)}uv(t){this.Ep!==null&&(this.Xp(),this.Bp=!1,this.nm(t))}_v(t){this.Ep!==null&&this.Qp(t)}Pv(t){if(this.Bp=!0,this.Ap===null){let e={x:t.localX,y:t.localY};this.sm(e,e,t)}}Tv(t){this.Ep!==null&&(this.Xp(),this.Ep.$t().Wc(null),this.rm())}hm(){return this.Dp}lm(){return this.Vp}Mv(){this.Op=1,this.$i().Un()}xv(t,e){if(!this.Jd.W().handleScale.pinch)return;let i=5*(e-this.Op);this.Op=e,this.$i().Jc(t.nt,i)}vv(t){this.Bp=!1,this.Ip=this.Ap!==null,this.Gp();let e=this.$i().Yc();this.Ap!==null&&e.yt()&&(this.zp={x:e.Yt(),y:e.Zt()},this.Ap={x:t.localX,y:t.localY})}rv(t){if(this.Ep===null)return;let e=t.localX,i=t.localY;if(this.Ap===null)this.im(t);else{this.Ip=!1;let s=y(this.zp),r=s.x+(e-this.Ap.x),o=s.y+(i-this.Ap.y);this.Kp(r,o,t)}}ov(t){this.Hv().W().trackingMode.exitMode===0&&(this.Ip=!0),this.am(),this.nm(t)}br(t,e){let i=this.Ep;return i===null?null:(function(s,r,o){let l=s.$o(),a=(function(c,u,h){var d,f;let p,m;for(let b of c){let w=(f=(d=b.fa)===null||d===void 0?void 0:d.call(b,u,h))!==null&&f!==void 0?f:[];for(let S of w)g=S.zOrder,(!(v=p?.zOrder)||g==="top"&&v!=="top"||g==="normal"&&v==="bottom")&&(p=S,m=b)}var g,v;return p&&m?{Iv:p,jc:m}:null})(l,r,o);if(a?.Iv.zOrder==="top")return Vn(a);for(let c of l){if(a&&a.jc===c&&a.Iv.zOrder!=="bottom"&&!a.Iv.isBackground)return Vn(a);let u=Hd(c.Pn(s),r,o);if(u!==null)return{jc:c,Ov:u.Ov,Av:u.Av};if(a&&a.jc===c&&a.Iv.zOrder!=="bottom"&&a.Iv.isBackground)return Vn(a)}return a?.Iv?Vn(a):null})(i,t,e)}om(t,e){y(e==="left"?this.yp:this.Cp).up($({width:t,height:this.Lv.height}))}_m(){return this.Lv}up(t){kt(this.Lv,t)||(this.Lv=t,this.Wv=!0,this.Kv.resizeCanvasElement(t),this.Gv.resizeCanvasElement(t),this.Wv=!1,this.Fp.style.width=t.width+"px",this.Fp.style.height=t.height+"px")}um(){let t=y(this.Ep);t.T_(t.P_()),t.T_(t.R_());for(let e of t.Oa())if(t.dr(e)){let i=e.Dt();i!==null&&t.T_(i),e.Vn()}}Mp(){return this.Kv.bitmapSize}xp(t,e,i){let s=this.Mp();s.width>0&&s.height>0&&t.drawImage(this.Kv.canvasElement,e,i)}fp(t){if(t===0||this.Ep===null)return;if(t>1&&this.um(),this.yp!==null&&this.yp.fp(t),this.Cp!==null&&this.Cp.fp(t),t!==1){this.Kv.applySuggestedBitmapSize();let i=Vt(this.Kv);i!==null&&(i.useBitmapCoordinateSpace((s=>{this.pp(s)})),this.Ep&&(this.dm(i,Od),this.fm(i),this.vm(i),this.dm(i,Fn),this.dm(i,Wd)))}this.Gv.applySuggestedBitmapSize();let e=Vt(this.Gv);e!==null&&(e.useBitmapCoordinateSpace((({context:i,bitmapSize:s})=>{i.clearRect(0,0,s.width,s.height)})),this.pm(e),this.dm(e,Ud))}bm(){return this.yp}wm(){return this.Cp}mp(t,e){this.dm(t,e)}Np(){this.Ep!==null&&this.Ep.F_().p(this),this.Ep=null}Qp(t){this.tm(this.Dp,t)}tm(t,e){let i=e.localX,s=e.localY;t.M()&&t.m(this.$i().St().Eu(i),{x:i,y:s},e)}pp({context:t,bitmapSize:e}){let{width:i,height:s}=e,r=this.$i(),o=r.q(),l=r.md();o===l?ns(t,0,0,i,s,l):nc(t,0,0,i,s,o,l)}fm(t){let e=y(this.Ep).W_().Uh().gt();e!==null&&e.X(t,!1)}vm(t){let e=this.$i().qc();this.gm(t,Fn,jo,e),this.gm(t,Fn,zn,e)}pm(t){this.gm(t,Fn,zn,this.$i().Yc())}dm(t,e){let i=y(this.Ep).$o();for(let s of i)this.gm(t,e,jo,s);for(let s of i)this.gm(t,e,zn,s)}gm(t,e,i,s){let r=y(this.Ep),o=r.$t().Fc(),l=o!==null&&o.jc===s,a=o!==null&&l&&o.Av!==void 0?o.Av.gr:void 0;Ko(e,(c=>i(c,t,l,a)),s,r)}Yp(){if(this.Ep===null)return;let t=this.Jd,e=this.Ep.P_().W().visible,i=this.Ep.R_().W().visible;e||this.yp===null||(this.Wp.removeChild(this.yp.hp()),this.yp.S(),this.yp=null),i||this.Cp===null||(this.jp.removeChild(this.Cp.hp()),this.Cp.S(),this.Cp=null);let s=t.$t()._d();e&&this.yp===null&&(this.yp=new ts(this,t.W(),s,"left"),this.Wp.appendChild(this.yp.hp())),i&&this.Cp===null&&(this.Cp=new ts(this,t.W(),s,"right"),this.jp.appendChild(this.Cp.hp()))}Mm(t){return t.Rv&&this.Bp||this.Ap!==null}xm(t){return Math.max(0,Math.min(t,this.Lv.width-1))}Sm(t){return Math.max(0,Math.min(t,this.Lv.height-1))}Kp(t,e,i){this.$i().hd(this.xm(t),this.Sm(e),i,y(this.Ep))}rm(){this.$i().ad()}am(){this.Ip&&(this.Ap=null,this.rm())}sm(t,e,i){this.Ap=t,this.Ip=!1,this.Kp(e.x,e.y,i);let s=this.$i().Yc();this.zp={x:s.Yt(),y:s.Zt()}}$i(){return this.Jd.$t()}nm(t){if(!this.Rp)return;let e=this.$i(),i=this.dp();if(e.I_(i,i.vn()),this.Pp=null,this.Rp=!1,e.sd(),this.Lp!==null){let s=performance.now(),r=e.St();this.Lp.Dr(r.ju(),s),this.Lp.Ju(s)||e.Zn(this.Lp)}}Xp(){this.Ap=null}Gp(){if(this.Ep){if(this.$i().Un(),document.activeElement!==document.body&&document.activeElement!==document.documentElement)y(document.activeElement).blur();else{let t=document.getSelection();t!==null&&t.removeAllRanges()}!this.Ep.vn().Ni()&&this.$i().St().Ni()}}im(t){if(this.Ep===null)return;let e=this.$i(),i=e.St();if(i.Ni())return;let s=this.Jd.W(),r=s.handleScroll,o=s.kineticScroll;if((!r.pressedMouseMove||t.Rv)&&(!r.horzTouchDrag&&!r.vertTouchDrag||!t.Rv))return;let l=this.Ep.vn(),a=performance.now();if(this.Pp!==null||this.Mm(t)||(this.Pp={x:t.clientX,y:t.clientY,Vd:a,km:t.localX,ym:t.localY}),this.Pp!==null&&!this.Rp&&(this.Pp.x!==t.clientX||this.Pp.y!==t.clientY)){if(t.Rv&&o.touch||!t.Rv&&o.mouse){let c=i.he();this.Lp=new Wo(.2/c,7/c,.997,15/c),this.Lp.qd(i.ju(),this.Pp.Vd)}else this.Lp=null;l.Ni()||e.B_(this.Ep,l,t.localY),e.td(t.localX),this.Rp=!0}this.Rp&&(l.Ni()||e.A_(this.Ep,l,t.localY),e.nd(t.localX),this.Lp!==null&&this.Lp.qd(i.ju(),a))}},es=class{constructor(t,e,i,s,r){this.ft=!0,this.Lv=$({width:0,height:0}),this.jv=()=>this.fp(3),this.Uv=t==="left",this.Vc=i._d,this.cn=e,this.Cm=s,this.Tm=r,this.Xv=document.createElement("div"),this.Xv.style.width="25px",this.Xv.style.height="100%",this.Xv.style.overflow="hidden",this.Kv=ye(this.Xv,$({width:16,height:16})),this.Kv.subscribeSuggestedBitmapSizeChanged(this.jv)}S(){this.Kv.unsubscribeSuggestedBitmapSizeChanged(this.jv),Se(this.Kv.canvasElement),this.Kv.dispose()}hp(){return this.Xv}_m(){return this.Lv}up(t){kt(this.Lv,t)||(this.Lv=t,this.Kv.resizeCanvasElement(t),this.Xv.style.width=`${t.width}px`,this.Xv.style.height=`${t.height}px`,this.ft=!0)}fp(t){if(t<3&&!this.ft||this.Lv.width===0||this.Lv.height===0)return;this.ft=!1,this.Kv.applySuggestedBitmapSize();let e=Vt(this.Kv);e!==null&&e.useBitmapCoordinateSpace((i=>{this.pp(i),this.Ae(i)}))}Mp(){return this.Kv.bitmapSize}xp(t,e,i){let s=this.Mp();s.width>0&&s.height>0&&t.drawImage(this.Kv.canvasElement,e,i)}Ae({context:t,bitmapSize:e,horizontalPixelRatio:i,verticalPixelRatio:s}){if(!this.Cm())return;t.fillStyle=this.cn.timeScale.borderColor;let r=Math.floor(this.Vc.W().C*i),o=Math.floor(this.Vc.W().C*s),l=this.Uv?e.width-r:0;t.fillRect(l,0,r,o)}pp({context:t,bitmapSize:e}){ns(t,0,0,e.width,e.height,this.Tm())}};function rl(n){return t=>{var e,i;return(i=(e=t.da)===null||e===void 0?void 0:e.call(t,n))!==null&&i!==void 0?i:[]}}var jd=rl("normal"),Kd=rl("top"),qd=rl("bottom"),Go=class{constructor(t,e){this.Pm=null,this.Rm=null,this.k=null,this.Dm=!1,this.Lv=$({width:0,height:0}),this.Vm=new O,this.Nv=new be(5),this.Wv=!1,this.jv=()=>{this.Wv||this.Jd.$t().$h()},this.$v=()=>{this.Wv||this.Jd.$t().$h()},this.Jd=t,this.U_=e,this.cn=t.W().layout,this.Zd=document.createElement("tr"),this.Om=document.createElement("td"),this.Om.style.padding="0",this.Bm=document.createElement("td"),this.Bm.style.padding="0",this.Xv=document.createElement("td"),this.Xv.style.height="25px",this.Xv.style.padding="0",this.Am=document.createElement("div"),this.Am.style.width="100%",this.Am.style.height="100%",this.Am.style.position="relative",this.Am.style.overflow="hidden",this.Xv.appendChild(this.Am),this.Kv=ye(this.Am,$({width:16,height:16})),this.Kv.subscribeSuggestedBitmapSizeChanged(this.jv);let i=this.Kv.canvasElement;i.style.position="absolute",i.style.zIndex="1",i.style.left="0",i.style.top="0",this.Gv=ye(this.Am,$({width:16,height:16})),this.Gv.subscribeSuggestedBitmapSizeChanged(this.$v);let s=this.Gv.canvasElement;s.style.position="absolute",s.style.zIndex="2",s.style.left="0",s.style.top="0",this.Zd.appendChild(this.Om),this.Zd.appendChild(this.Xv),this.Zd.appendChild(this.Bm),this.Im(),this.Jd.$t().w_().l(this.Im.bind(this),this),this.rp=new Ki(this.Gv.canvasElement,this,{sv:()=>!0,ev:()=>!this.Jd.W().handleScroll.horzTouchDrag})}S(){this.rp.S(),this.Pm!==null&&this.Pm.S(),this.Rm!==null&&this.Rm.S(),this.Gv.unsubscribeSuggestedBitmapSizeChanged(this.$v),Se(this.Gv.canvasElement),this.Gv.dispose(),this.Kv.unsubscribeSuggestedBitmapSizeChanged(this.jv),Se(this.Kv.canvasElement),this.Kv.dispose()}hp(){return this.Zd}zm(){return this.Pm}Lm(){return this.Rm}mv(t){if(this.Dm)return;this.Dm=!0;let e=this.Jd.$t();!e.St().Ni()&&this.Jd.W().handleScale.axisPressedMouseMove.time&&e.Gc(t.localX)}vv(t){this.mv(t)}bv(){let t=this.Jd.$t();!t.St().Ni()&&this.Dm&&(this.Dm=!1,this.Jd.W().handleScale.axisPressedMouseMove.time&&t.rd())}lv(t){let e=this.Jd.$t();!e.St().Ni()&&this.Jd.W().handleScale.axisPressedMouseMove.time&&e.ed(t.localX)}rv(t){this.lv(t)}uv(){this.Dm=!1;let t=this.Jd.$t();t.St().Ni()&&!this.Jd.W().handleScale.axisPressedMouseMove.time||t.rd()}ov(){this.uv()}Uf(){this.Jd.W().handleScale.axisDoubleClickReset.time&&this.Jd.$t().Kn()}Wf(){this.Uf()}Jf(){this.Jd.$t().W().handleScale.axisPressedMouseMove.time&&this.Sp(1)}Tv(){this.Sp(0)}_m(){return this.Lv}Em(){return this.Vm}Nm(t,e,i){kt(this.Lv,t)||(this.Lv=t,this.Wv=!0,this.Kv.resizeCanvasElement(t),this.Gv.resizeCanvasElement(t),this.Wv=!1,this.Xv.style.width=`${t.width}px`,this.Xv.style.height=`${t.height}px`,this.Vm.m(t)),this.Pm!==null&&this.Pm.up($({width:e,height:t.height})),this.Rm!==null&&this.Rm.up($({width:i,height:t.height}))}Fm(){let t=this.Wm();return Math.ceil(t.C+t.T+t.P+t.L+t.B+t.jm)}bt(){this.Jd.$t().St().ja()}Mp(){return this.Kv.bitmapSize}xp(t,e,i){let s=this.Mp();s.width>0&&s.height>0&&t.drawImage(this.Kv.canvasElement,e,i)}fp(t){if(t===0)return;if(t!==1){this.Kv.applySuggestedBitmapSize();let i=Vt(this.Kv);i!==null&&(i.useBitmapCoordinateSpace((s=>{this.pp(s),this.Ae(s),this.Hm(i,qd)})),this.bp(i),this.Hm(i,jd)),this.Pm!==null&&this.Pm.fp(t),this.Rm!==null&&this.Rm.fp(t)}this.Gv.applySuggestedBitmapSize();let e=Vt(this.Gv);e!==null&&(e.useBitmapCoordinateSpace((({context:i,bitmapSize:s})=>{i.clearRect(0,0,s.width,s.height)})),this.$m([...this.Jd.$t().wt(),this.Jd.$t().Yc()],e),this.Hm(e,Kd))}Hm(t,e){let i=this.Jd.$t().wt();for(let s of i)Ko(e,(r=>jo(r,t,!1,void 0)),s,void 0);for(let s of i)Ko(e,(r=>zn(r,t,!1,void 0)),s,void 0)}pp({context:t,bitmapSize:e}){ns(t,0,0,e.width,e.height,this.Jd.$t().md())}Ae({context:t,bitmapSize:e,verticalPixelRatio:i}){if(this.Jd.W().timeScale.borderVisible){t.fillStyle=this.Um();let s=Math.max(1,Math.floor(this.Wm().C*i));t.fillRect(0,0,e.width,s)}}bp(t){let e=this.Jd.$t().St(),i=e.ja();if(!i||i.length===0)return;let s=this.U_.maxTickMarkWeight(i),r=this.Wm(),o=e.W();o.borderVisible&&o.ticksVisible&&t.useBitmapCoordinateSpace((({context:l,horizontalPixelRatio:a,verticalPixelRatio:c})=>{l.strokeStyle=this.Um(),l.fillStyle=this.Um();let u=Math.max(1,Math.floor(a)),h=Math.floor(.5*a);l.beginPath();let d=Math.round(r.T*c);for(let f=i.length;f--;){let p=Math.round(i[f].coord*a);l.rect(p-h,0,u,d)}l.fill()})),t.useMediaCoordinateSpace((({context:l})=>{let a=r.C+r.T+r.L+r.P/2;l.textAlign="center",l.textBaseline="middle",l.fillStyle=this.$(),l.font=this.op();for(let c of i)if(c.weight<s){let u=c.needAlignCoordinate?this.qm(l,c.coord,c.label):c.coord;l.fillText(c.label,u,a)}this.Jd.W().timeScale.allowBoldLabels&&(l.font=this.Ym());for(let c of i)if(c.weight>=s){let u=c.needAlignCoordinate?this.qm(l,c.coord,c.label):c.coord;l.fillText(c.label,u,a)}}))}qm(t,e,i){let s=this.Nv.xi(t,i),r=s/2,o=Math.floor(e-r)+.5;return o<0?e+=Math.abs(0-o):o+s>this.Lv.width&&(e-=Math.abs(this.Lv.width-(o+s))),e}$m(t,e){let i=this.Wm();for(let s of t)for(let r of s.Qi())r.gt().X(e,i)}Um(){return this.Jd.W().timeScale.borderColor}$(){return this.cn.textColor}j(){return this.cn.fontSize}op(){return We(this.j(),this.cn.fontFamily)}Ym(){return We(this.j(),this.cn.fontFamily,"bold")}Wm(){this.k===null&&(this.k={C:1,N:NaN,L:NaN,B:NaN,ji:NaN,T:5,P:NaN,R:"",Wi:new be,jm:0});let t=this.k,e=this.op();if(t.R!==e){let i=this.j();t.P=i,t.R=e,t.L=3*i/12,t.B=3*i/12,t.ji=9*i/12,t.N=0,t.jm=4*i/12,t.Wi.ir()}return this.k}Sp(t){this.Xv.style.cursor=t===1?"ew-resize":"default"}Im(){let t=this.Jd.$t(),e=t.W();e.leftPriceScale.visible||this.Pm===null||(this.Om.removeChild(this.Pm.hp()),this.Pm.S(),this.Pm=null),e.rightPriceScale.visible||this.Rm===null||(this.Bm.removeChild(this.Rm.hp()),this.Rm.S(),this.Rm=null);let i={_d:this.Jd.$t()._d()},s=()=>e.leftPriceScale.borderVisible&&t.St().W().borderVisible,r=()=>t.md();e.leftPriceScale.visible&&this.Pm===null&&(this.Pm=new es("left",e,i,s,r),this.Om.appendChild(this.Pm.hp())),e.rightPriceScale.visible&&this.Rm===null&&(this.Rm=new es("right",e,i,s,r),this.Bm.appendChild(this.Rm.hp()))}},Gd=!!qe&&!!navigator.userAgentData&&navigator.userAgentData.brands.some((n=>n.brand.includes("Chromium")))&&!!qe&&(!((Pr=navigator?.userAgentData)===null||Pr===void 0)&&Pr.platform?navigator.userAgentData.platform==="Windows":navigator.userAgent.toLowerCase().indexOf("win")>=0),Pr,Zo=class{constructor(t,e,i){var s;this.Zm=[],this.Xm=0,this.ro=0,this.o_=0,this.Km=0,this.Gm=0,this.Jm=null,this.Qm=!1,this.Dp=new O,this.Vp=new O,this.Pc=new O,this.tb=null,this.ib=null,this.Gd=t,this.cn=e,this.U_=i,this.Zd=document.createElement("div"),this.Zd.classList.add("tv-lightweight-charts"),this.Zd.style.overflow="hidden",this.Zd.style.direction="ltr",this.Zd.style.width="100%",this.Zd.style.height="100%",(s=this.Zd).style.userSelect="none",s.style.webkitUserSelect="none",s.style.msUserSelect="none",s.style.MozUserSelect="none",s.style.webkitTapHighlightColor="transparent",this.nb=document.createElement("table"),this.nb.setAttribute("cellspacing","0"),this.Zd.appendChild(this.nb),this.sb=this.eb.bind(this),Ir(this.cn)&&this.rb(!0),this.$i=new Fo(this.Dc.bind(this),this.cn,i),this.$t().Zc().l(this.hb.bind(this),this),this.lb=new Go(this,this.U_),this.nb.appendChild(this.lb.hp());let r=e.autoSize&&this.ab(),o=this.cn.width,l=this.cn.height;if(r||o===0||l===0){let a=t.getBoundingClientRect();o=o||a.width,l=l||a.height}this.ob(o,l),this._b(),t.appendChild(this.Zd),this.ub(),this.$i.St().sc().l(this.$i.Xl.bind(this.$i),this),this.$i.w_().l(this.$i.Xl.bind(this.$i),this)}$t(){return this.$i}W(){return this.cn}qp(){return this.Zm}cb(){return this.lb}S(){this.rb(!1),this.Xm!==0&&window.cancelAnimationFrame(this.Xm),this.$i.Zc().p(this),this.$i.St().sc().p(this),this.$i.w_().p(this),this.$i.S();for(let t of this.Zm)this.nb.removeChild(t.hp()),t.hm().p(this),t.lm().p(this),t.S();this.Zm=[],y(this.lb).S(),this.Zd.parentElement!==null&&this.Zd.parentElement.removeChild(this.Zd),this.Pc.S(),this.Dp.S(),this.Vp.S(),this.fb()}ob(t,e,i=!1){if(this.ro===e&&this.o_===t)return;let s=(function(l){let a=Math.floor(l.width),c=Math.floor(l.height);return $({width:a-a%2,height:c-c%2})})($({width:t,height:e}));this.ro=s.height,this.o_=s.width;let r=this.ro+"px",o=this.o_+"px";y(this.Zd).style.height=r,y(this.Zd).style.width=o,this.nb.style.height=r,this.nb.style.width=o,i?this.pb(J.es(),performance.now()):this.$i.Xl()}fp(t){t===void 0&&(t=J.es());for(let e=0;e<this.Zm.length;e++)this.Zm[e].fp(t.Hn(e).Fn);this.cn.timeScale.visible&&this.lb.fp(t.jn())}Hh(t){let e=Ir(this.cn);this.$i.Hh(t);let i=Ir(this.cn);i!==e&&this.rb(i),this.ub(),this.mb(t)}hm(){return this.Dp}lm(){return this.Vp}Zc(){return this.Pc}bb(){this.Jm!==null&&(this.pb(this.Jm,performance.now()),this.Jm=null);let t=this.wb(null),e=document.createElement("canvas");e.width=t.width,e.height=t.height;let i=y(e.getContext("2d"));return this.wb(i),e}gb(t){return t==="left"&&!this.Mb()||t==="right"&&!this.xb()||this.Zm.length===0?0:y(t==="left"?this.Zm[0].bm():this.Zm[0].wm()).cp()}Sb(){return this.cn.autoSize&&this.tb!==null}kb(){return this.Zd}Jp(t){this.ib=t,this.ib?this.kb().style.setProperty("cursor",t):this.kb().style.removeProperty("cursor")}yb(){return this.ib}Cb(){return it(this.Zm[0])._m()}mb(t){(t.autoSize!==void 0||!this.tb||t.width===void 0&&t.height===void 0)&&(t.autoSize&&!this.tb&&this.ab(),t.autoSize===!1&&this.tb!==null&&this.fb(),t.autoSize||t.width===void 0&&t.height===void 0||this.ob(t.width||this.o_,t.height||this.ro))}wb(t){let e=0,i=0,s=this.Zm[0],r=(l,a)=>{let c=0;for(let u=0;u<this.Zm.length;u++){let h=this.Zm[u],d=y(l==="left"?h.bm():h.wm()),f=d.Mp();t!==null&&d.xp(t,a,c),c+=f.height}};this.Mb()&&(r("left",0),e+=y(s.bm()).Mp().width);for(let l=0;l<this.Zm.length;l++){let a=this.Zm[l],c=a.Mp();t!==null&&a.xp(t,e,i),i+=c.height}e+=s.Mp().width,this.xb()&&(r("right",e),e+=y(s.wm()).Mp().width);let o=(l,a,c)=>{y(l==="left"?this.lb.zm():this.lb.Lm()).xp(y(t),a,c)};if(this.cn.timeScale.visible){let l=this.lb.Mp();if(t!==null){let a=0;this.Mb()&&(o("left",a,i),a=y(s.bm()).Mp().width),this.lb.xp(t,a,i),a+=l.width,this.xb()&&o("right",a,i)}i+=l.height}return $({width:e,height:i})}Tb(){let t=0,e=0,i=0;for(let p of this.Zm)this.Mb()&&(e=Math.max(e,y(p.bm()).ap(),this.cn.leftPriceScale.minimumWidth)),this.xb()&&(i=Math.max(i,y(p.wm()).ap(),this.cn.rightPriceScale.minimumWidth)),t+=p.g_();e=Oo(e),i=Oo(i);let s=this.o_,r=this.ro,o=Math.max(s-e-i,0),l=this.cn.timeScale.visible,a=l?Math.max(this.lb.Fm(),this.cn.timeScale.minimumHeight):0;var c;a=(c=a)+c%2;let u=0+a,h=r<u?0:r-u,d=h/t,f=0;for(let p=0;p<this.Zm.length;++p){let m=this.Zm[p];m.Up(this.$i.Uc()[p]);let g=0,v=0;v=p===this.Zm.length-1?h-f:Math.round(m.g_()*d),g=Math.max(v,2),f+=g,m.up($({width:o,height:g})),this.Mb()&&m.om(e,"left"),this.xb()&&m.om(i,"right"),m.dp()&&this.$i.Xc(m.dp(),g)}this.lb.Nm($({width:l?o:0,height:a}),l?e:0,l?i:0),this.$i.x_(o),this.Km!==e&&(this.Km=e),this.Gm!==i&&(this.Gm=i)}rb(t){t?this.Zd.addEventListener("wheel",this.sb,{passive:!1}):this.Zd.removeEventListener("wheel",this.sb)}Pb(t){switch(t.deltaMode){case t.DOM_DELTA_PAGE:return 120;case t.DOM_DELTA_LINE:return 32}return Gd?1/window.devicePixelRatio:1}eb(t){if(!(t.deltaX!==0&&this.cn.handleScroll.mouseWheel||t.deltaY!==0&&this.cn.handleScale.mouseWheel))return;let e=this.Pb(t),i=e*t.deltaX/100,s=-e*t.deltaY/100;if(t.cancelable&&t.preventDefault(),s!==0&&this.cn.handleScale.mouseWheel){let r=Math.sign(s)*Math.min(1,Math.abs(s)),o=t.clientX-this.Zd.getBoundingClientRect().left;this.$t().Jc(o,r)}i!==0&&this.cn.handleScroll.mouseWheel&&this.$t().Qc(-80*i)}pb(t,e){var i;let s=t.jn();s===3&&this.Rb(),s!==3&&s!==2||(this.Db(t),this.Vb(t,e),this.lb.bt(),this.Zm.forEach((r=>{r.Zp()})),((i=this.Jm)===null||i===void 0?void 0:i.jn())===3&&(this.Jm.ts(t),this.Rb(),this.Db(this.Jm),this.Vb(this.Jm,e),t=this.Jm,this.Jm=null)),this.fp(t)}Vb(t,e){for(let i of t.Qn())this.ns(i,e)}Db(t){let e=this.$i.Uc();for(let i=0;i<e.length;i++)t.Hn(i).Wn&&e[i].E_()}ns(t,e){let i=this.$i.St();switch(t.qn){case 0:i.rc();break;case 1:i.hc(t.Vt);break;case 2:i.Gn(t.Vt);break;case 3:i.Jn(t.Vt);break;case 4:i.Uu();break;case 5:t.Vt.Ju(e)||i.Jn(t.Vt.Qu(e))}}Dc(t){this.Jm!==null?this.Jm.ts(t):this.Jm=t,this.Qm||(this.Qm=!0,this.Xm=window.requestAnimationFrame((e=>{if(this.Qm=!1,this.Xm=0,this.Jm!==null){let i=this.Jm;this.Jm=null,this.pb(i,e);for(let s of i.Qn())if(s.qn===5&&!s.Vt.Ju(e)){this.$t().Zn(s.Vt);break}}})))}Rb(){this._b()}_b(){let t=this.$i.Uc(),e=t.length,i=this.Zm.length;for(let s=e;s<i;s++){let r=it(this.Zm.pop());this.nb.removeChild(r.hp()),r.hm().p(this),r.lm().p(this),r.S()}for(let s=i;s<e;s++){let r=new qo(this,t[s]);r.hm().l(this.Ob.bind(this),this),r.lm().l(this.Bb.bind(this),this),this.Zm.push(r),this.nb.insertBefore(r.hp(),this.lb.hp())}for(let s=0;s<e;s++){let r=t[s],o=this.Zm[s];o.dp()!==r?o.Up(r):o.$p()}this.ub(),this.Tb()}Ab(t,e,i){var s;let r=new Map;t!==null&&this.$i.wt().forEach((u=>{let h=u.In().hl(t);h!==null&&r.set(u,h)}));let o;if(t!==null){let u=(s=this.$i.St().Ui(t))===null||s===void 0?void 0:s.originalTime;u!==void 0&&(o=u)}let l=this.$t().Fc(),a=l!==null&&l.jc instanceof ji?l.jc:void 0,c=l!==null&&l.Av!==void 0?l.Av.wr:void 0;return{Ib:o,se:t??void 0,zb:e??void 0,Lb:a,Eb:r,Nb:c,Fb:i??void 0}}Ob(t,e,i){this.Dp.m((()=>this.Ab(t,e,i)))}Bb(t,e,i){this.Vp.m((()=>this.Ab(t,e,i)))}hb(t,e,i){this.Pc.m((()=>this.Ab(t,e,i)))}ub(){let t=this.cn.timeScale.visible?"":"none";this.lb.hp().style.display=t}Mb(){return this.Zm[0].dp().P_().W().visible}xb(){return this.Zm[0].dp().R_().W().visible}ab(){return"ResizeObserver"in window&&(this.tb=new ResizeObserver((t=>{let e=t.find((i=>i.target===this.Gd));e&&this.ob(e.contentRect.width,e.contentRect.height)})),this.tb.observe(this.Gd,{box:"border-box"}),!0)}fb(){this.tb!==null&&this.tb.disconnect(),this.tb=null}};function Ir(n){return!!(n.handleScroll.mouseWheel||n.handleScale.mouseWheel)}function Zd(n){return(function(t){return t.open!==void 0})(n)||(function(t){return t.value!==void 0})(n)}function mc(n,t){var e={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(e[i]=n[i]);if(n!=null&&typeof Object.getOwnPropertySymbols=="function"){var s=0;for(i=Object.getOwnPropertySymbols(n);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(n,i[s])&&(e[i[s]]=n[i[s]])}return e}function Oa(n,t,e,i){let s=e.value,r={se:t,ot:n,Vt:[s,s,s,s],Ib:i};return e.color!==void 0&&(r.V=e.color),r}function Xd(n,t,e,i){let s=e.value,r={se:t,ot:n,Vt:[s,s,s,s],Ib:i};return e.lineColor!==void 0&&(r.lt=e.lineColor),e.topColor!==void 0&&(r.Ts=e.topColor),e.bottomColor!==void 0&&(r.Ps=e.bottomColor),r}function Jd(n,t,e,i){let s=e.value,r={se:t,ot:n,Vt:[s,s,s,s],Ib:i};return e.topLineColor!==void 0&&(r.Pe=e.topLineColor),e.bottomLineColor!==void 0&&(r.Re=e.bottomLineColor),e.topFillColor1!==void 0&&(r.Se=e.topFillColor1),e.topFillColor2!==void 0&&(r.ke=e.topFillColor2),e.bottomFillColor1!==void 0&&(r.ye=e.bottomFillColor1),e.bottomFillColor2!==void 0&&(r.Ce=e.bottomFillColor2),r}function Yd(n,t,e,i){let s={se:t,ot:n,Vt:[e.open,e.high,e.low,e.close],Ib:i};return e.color!==void 0&&(s.V=e.color),s}function Qd(n,t,e,i){let s={se:t,ot:n,Vt:[e.open,e.high,e.low,e.close],Ib:i};return e.color!==void 0&&(s.V=e.color),e.borderColor!==void 0&&(s.Ot=e.borderColor),e.wickColor!==void 0&&(s.Zh=e.wickColor),s}function tf(n,t,e,i,s){let r=it(s)(e),o=Math.max(...r),l=Math.min(...r),a=r[r.length-1],c=[a,o,l,a],u=e,{time:h,color:d}=u;return{se:t,ot:n,Vt:c,Ib:i,He:mc(u,["time","color"]),V:d}}function Bn(n){return n.Vt!==void 0}function Wa(n,t){return t.customValues!==void 0&&(n.Wb=t.customValues),n}function pe(n){return(t,e,i,s,r,o)=>(function(l,a){return a?a(l):(c=l).open===void 0&&c.value===void 0;var c})(i,o)?Wa({ot:t,se:e,Ib:s},i):Wa(n(t,e,i,s,r),i)}function Ua(n){return{Candlestick:pe(Qd),Bar:pe(Yd),Area:pe(Xd),Baseline:pe(Jd),Histogram:pe(Oa),Line:pe(Oa),Custom:pe(tf)}[n]}function ja(n){return{se:0,jb:new Map,ha:n}}function Ka(n,t){if(n!==void 0&&n.length!==0)return{Hb:t.key(n[0].ot),$b:t.key(n[n.length-1].ot)}}function qa(n){let t;return n.forEach((e=>{t===void 0&&(t=e.Ib)})),it(t)}var Xo=class{constructor(t){this.Ub=new Map,this.qb=new Map,this.Yb=new Map,this.Zb=[],this.U_=t}S(){this.Ub.clear(),this.qb.clear(),this.Yb.clear(),this.Zb=[]}Xb(t,e){let i=this.Ub.size!==0,s=!1,r=this.qb.get(t);if(r!==void 0)if(this.qb.size===1)i=!1,s=!0,this.Ub.clear();else for(let a of this.Zb)a.pointData.jb.delete(t)&&(s=!0);let o=[];if(e.length!==0){let a=e.map((f=>f.time)),c=this.U_.createConverterToInternalObj(e),u=Ua(t.Jh()),h=t.ya(),d=t.Ca();o=e.map(((f,p)=>{let m=c(f.time),g=this.U_.key(m),v=this.Ub.get(g);v===void 0&&(v=ja(m),this.Ub.set(g,v),s=!0);let b=u(m,v.se,f,a[p],h,d);return v.jb.set(t,b),b}))}i&&this.Kb(),this.Gb(t,o);let l=-1;if(s){let a=[];this.Ub.forEach((c=>{a.push({timeWeight:0,time:c.ha,pointData:c,originalTime:qa(c.jb)})})),a.sort(((c,u)=>this.U_.key(c.time)-this.U_.key(u.time))),l=this.Jb(a)}return this.Qb(t,l,(function(a,c,u){let h=Ka(a,u),d=Ka(c,u);if(h!==void 0&&d!==void 0)return{Ql:h.$b>=d.$b&&h.Hb>=d.Hb}})(this.qb.get(t),r,this.U_))}fd(t){return this.Xb(t,[])}tw(t,e){let i=e;(function(m){m.Ib===void 0&&(m.Ib=m.time)})(i),this.U_.preprocessData(e);let s=this.U_.createConverterToInternalObj([e])(e.time),r=this.Yb.get(t);if(r!==void 0&&this.U_.key(s)<this.U_.key(r))throw new Error(`Cannot update oldest data, last time=${r}, new time=${s}`);let o=this.Ub.get(this.U_.key(s)),l=o===void 0;o===void 0&&(o=ja(s),this.Ub.set(this.U_.key(s),o));let a=Ua(t.Jh()),c=t.ya(),u=t.Ca(),h=a(s,o.se,e,i.Ib,c,u);o.jb.set(t,h),this.iw(t,h);let d={Ql:Bn(h)};if(!l)return this.Qb(t,-1,d);let f={timeWeight:0,time:o.ha,pointData:o,originalTime:qa(o.jb)},p=Gi(this.Zb,this.U_.key(f.time),((m,g)=>this.U_.key(m.time)<g));this.Zb.splice(p,0,f);for(let m=p;m<this.Zb.length;++m)Ar(this.Zb[m].pointData,m);return this.U_.fillWeightsForPoints(this.Zb,p),this.Qb(t,p,d)}iw(t,e){let i=this.qb.get(t);i===void 0&&(i=[],this.qb.set(t,i));let s=i.length!==0?i[i.length-1]:null;s===null||this.U_.key(e.ot)>this.U_.key(s.ot)?Bn(e)&&i.push(e):Bn(e)?i[i.length-1]=e:i.splice(-1,1),this.Yb.set(t,e.ot)}Gb(t,e){e.length!==0?(this.qb.set(t,e.filter(Bn)),this.Yb.set(t,e[e.length-1].ot)):(this.qb.delete(t),this.Yb.delete(t))}Kb(){for(let t of this.Zb)t.pointData.jb.size===0&&this.Ub.delete(this.U_.key(t.time))}Jb(t){let e=-1;for(let i=0;i<this.Zb.length&&i<t.length;++i){let s=this.Zb[i],r=t[i];if(this.U_.key(s.time)!==this.U_.key(r.time)){e=i;break}r.timeWeight=s.timeWeight,Ar(r.pointData,i)}if(e===-1&&this.Zb.length!==t.length&&(e=Math.min(this.Zb.length,t.length)),e===-1)return-1;for(let i=e;i<t.length;++i)Ar(t[i].pointData,i);return this.U_.fillWeightsForPoints(t,e),this.Zb=t,e}nw(){if(this.qb.size===0)return null;let t=0;return this.qb.forEach((e=>{e.length!==0&&(t=Math.max(t,e[e.length-1].se))})),t}Qb(t,e,i){let s={sw:new Map,St:{Lu:this.nw()}};if(e!==-1)this.qb.forEach(((r,o)=>{s.sw.set(o,{He:r,ew:o===t?i:void 0})})),this.qb.has(t)||s.sw.set(t,{He:[],ew:i}),s.St.rw=this.Zb,s.St.hw=e;else{let r=this.qb.get(t);s.sw.set(t,{He:r||[],ew:i})}return s}};function Ar(n,t){n.se=t,n.jb.forEach((e=>{e.se=t}))}function ol(n){let t={value:n.Vt[3],time:n.Ib};return n.Wb!==void 0&&(t.customValues=n.Wb),t}function Ga(n){let t=ol(n);return n.V!==void 0&&(t.color=n.V),t}function ef(n){let t=ol(n);return n.lt!==void 0&&(t.lineColor=n.lt),n.Ts!==void 0&&(t.topColor=n.Ts),n.Ps!==void 0&&(t.bottomColor=n.Ps),t}function nf(n){let t=ol(n);return n.Pe!==void 0&&(t.topLineColor=n.Pe),n.Re!==void 0&&(t.bottomLineColor=n.Re),n.Se!==void 0&&(t.topFillColor1=n.Se),n.ke!==void 0&&(t.topFillColor2=n.ke),n.ye!==void 0&&(t.bottomFillColor1=n.ye),n.Ce!==void 0&&(t.bottomFillColor2=n.Ce),t}function pc(n){let t={open:n.Vt[0],high:n.Vt[1],low:n.Vt[2],close:n.Vt[3],time:n.Ib};return n.Wb!==void 0&&(t.customValues=n.Wb),t}function sf(n){let t=pc(n);return n.V!==void 0&&(t.color=n.V),t}function rf(n){let t=pc(n),{V:e,Ot:i,Zh:s}=n;return e!==void 0&&(t.color=e),i!==void 0&&(t.borderColor=i),s!==void 0&&(t.wickColor=s),t}function Jo(n){return{Area:ef,Line:Ga,Baseline:nf,Histogram:Ga,Bar:sf,Candlestick:rf,Custom:of}[n]}function of(n){let t=n.Ib;return Object.assign(Object.assign({},n.He),{time:t})}var lf={vertLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},horzLine:{color:"#9598A1",width:1,style:3,visible:!0,labelVisible:!0,labelBackgroundColor:"#131722"},mode:1},af={vertLines:{color:"#D6DCDE",style:0,visible:!0},horzLines:{color:"#D6DCDE",style:0,visible:!0}},cf={background:{type:"solid",color:"#FFFFFF"},textColor:"#191919",fontSize:12,fontFamily:nl,attributionLogo:!0},Nr={autoScale:!0,mode:0,invertScale:!1,alignLabels:!0,borderVisible:!0,borderColor:"#2B2B43",entireTextOnly:!1,visible:!1,ticksVisible:!1,scaleMargins:{bottom:.1,top:.2},minimumWidth:0},uf={rightOffset:0,barSpacing:6,minBarSpacing:.5,fixLeftEdge:!1,fixRightEdge:!1,lockVisibleTimeRangeOnResize:!1,rightBarStaysOnScroll:!1,borderVisible:!0,borderColor:"#2B2B43",visible:!0,timeVisible:!1,secondsVisible:!0,shiftVisibleRangeOnNewBar:!0,allowShiftVisibleRangeOnWhitespaceReplacement:!1,ticksVisible:!1,uniformDistribution:!1,minimumHeight:0,allowBoldLabels:!0},hf={color:"rgba(0, 0, 0, 0)",visible:!1,fontSize:48,fontFamily:nl,fontStyle:"",text:"",horzAlign:"center",vertAlign:"center"};function Za(){return{width:0,height:0,autoSize:!1,layout:cf,crosshair:lf,grid:af,overlayPriceScales:Object.assign({},Nr),leftPriceScale:Object.assign(Object.assign({},Nr),{visible:!1}),rightPriceScale:Object.assign(Object.assign({},Nr),{visible:!0}),timeScale:uf,watermark:hf,localization:{locale:qe?navigator.language:"",dateFormat:"dd MMM 'yy"},handleScroll:{mouseWheel:!0,pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:!0},handleScale:{axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0},mouseWheel:!0,pinch:!0},kineticScroll:{mouse:!1,touch:!0},trackingMode:{exitMode:1}}}var Yo=class{constructor(t,e){this.lw=t,this.aw=e}applyOptions(t){this.lw.$t().Hc(this.aw,t)}options(){return this.Li().W()}width(){return ss(this.aw)?this.lw.gb(this.aw):0}Li(){return y(this.lw.$t().$c(this.aw)).Dt}};function Xa(n,t,e){let i=mc(n,["time","originalTime"]),s=Object.assign({time:t},i);return e!==void 0&&(s.originalTime=e),s}var df={color:"#FF0000",price:0,lineStyle:2,lineWidth:1,lineVisible:!0,axisLabelVisible:!0,title:"",axisLabelColor:"",axisLabelTextColor:""},Qo=class{constructor(t){this.Eh=t}applyOptions(t){this.Eh.Hh(t)}options(){return this.Eh.W()}ow(){return this.Eh}},tl=class{constructor(t,e,i,s,r){this._w=new O,this.Ls=t,this.uw=e,this.cw=i,this.U_=r,this.dw=s}S(){this._w.S()}priceFormatter(){return this.Ls.ma()}priceToCoordinate(t){let e=this.Ls.Ct();return e===null?null:this.Ls.Dt().Rt(t,e.Vt)}coordinateToPrice(t){let e=this.Ls.Ct();return e===null?null:this.Ls.Dt().pn(t,e.Vt)}barsInLogicalRange(t){if(t===null)return null;let e=new Oe(new ge(t.from,t.to)).hu(),i=this.Ls.In();if(i.Ni())return null;let s=i.hl(e.Vs(),1),r=i.hl(e.ui(),-1),o=y(i.sl()),l=y(i.An());if(s!==null&&r!==null&&s.se>r.se)return{barsBefore:t.from-o,barsAfter:l-t.to};let a={barsBefore:s===null||s.se===o?t.from-o:s.se-o,barsAfter:r===null||r.se===l?l-t.to:l-r.se};return s!==null&&r!==null&&(a.from=s.Ib,a.to=r.Ib),a}setData(t){this.U_,this.Ls.Jh(),this.uw.fw(this.Ls,t),this.pw("full")}update(t){this.Ls.Jh(),this.uw.mw(this.Ls,t),this.pw("update")}dataByIndex(t,e){let i=this.Ls.In().hl(t,e);return i===null?null:Jo(this.seriesType())(i)}data(){let t=Jo(this.seriesType());return this.Ls.In().ie().map((e=>t(e)))}subscribeDataChanged(t){this._w.l(t)}unsubscribeDataChanged(t){this._w.v(t)}setMarkers(t){this.U_;let e=t.map((i=>Xa(i,this.U_.convertHorzItemToInternal(i.time),i.time)));this.Ls.ia(e)}markers(){return this.Ls.na().map((t=>Xa(t,t.originalTime,void 0)))}applyOptions(t){this.Ls.Hh(t)}options(){return Ft(this.Ls.W())}priceScale(){return this.cw.priceScale(this.Ls.Dt().Ta())}createPriceLine(t){let e=Ct(Ft(df),t),i=this.Ls.sa(e);return new Qo(i)}removePriceLine(t){this.Ls.ea(t.ow())}seriesType(){return this.Ls.Jh()}attachPrimitive(t){this.Ls.Sa(t),t.attached&&t.attached({chart:this.dw,series:this,requestUpdate:()=>this.Ls.$t().Xl()})}detachPrimitive(t){this.Ls.ka(t),t.detached&&t.detached()}pw(t){this._w.M()&&this._w.m(t)}},el=class{constructor(t,e,i){this.bw=new O,this.pu=new O,this.Vm=new O,this.$i=t,this.kl=t.St(),this.lb=e,this.kl.tc().l(this.ww.bind(this)),this.kl.nc().l(this.gw.bind(this)),this.lb.Em().l(this.Mw.bind(this)),this.U_=i}S(){this.kl.tc().p(this),this.kl.nc().p(this),this.lb.Em().p(this),this.bw.S(),this.pu.S(),this.Vm.S()}scrollPosition(){return this.kl.ju()}scrollToPosition(t,e){e?this.kl.Gu(t,1e3):this.$i.Jn(t)}scrollToRealTime(){this.kl.Ku()}getVisibleRange(){let t=this.kl.Du();return t===null?null:{from:t.from.originalTime,to:t.to.originalTime}}setVisibleRange(t){let e={from:this.U_.convertHorzItemToInternal(t.from),to:this.U_.convertHorzItemToInternal(t.to)},i=this.kl.Au(e);this.$i.vd(i)}getVisibleLogicalRange(){let t=this.kl.Ru();return t===null?null:{from:t.Vs(),to:t.ui()}}setVisibleLogicalRange(t){te(t.from<=t.to,"The from index cannot be after the to index."),this.$i.vd(t)}resetTimeScale(){this.$i.Kn()}fitContent(){this.$i.rc()}logicalToCoordinate(t){let e=this.$i.St();return e.Ni()?null:e.It(t)}coordinateToLogical(t){return this.kl.Ni()?null:this.kl.Eu(t)}timeToCoordinate(t){let e=this.U_.convertHorzItemToInternal(t),i=this.kl.Da(e,!1);return i===null?null:this.kl.It(i)}coordinateToTime(t){let e=this.$i.St(),i=e.Eu(t),s=e.Ui(i);return s===null?null:s.originalTime}width(){return this.lb._m().width}height(){return this.lb._m().height}subscribeVisibleTimeRangeChange(t){this.bw.l(t)}unsubscribeVisibleTimeRangeChange(t){this.bw.v(t)}subscribeVisibleLogicalRangeChange(t){this.pu.l(t)}unsubscribeVisibleLogicalRangeChange(t){this.pu.v(t)}subscribeSizeChange(t){this.Vm.l(t)}unsubscribeSizeChange(t){this.Vm.v(t)}applyOptions(t){this.kl.Hh(t)}options(){return Object.assign(Object.assign({},Ft(this.kl.W())),{barSpacing:this.kl.he()})}ww(){this.bw.M()&&this.bw.m(this.getVisibleRange())}gw(){this.pu.M()&&this.pu.m(this.getVisibleLogicalRange())}Mw(t){this.Vm.m(t.width,t.height)}};function ff(n){if(n===void 0||n.type==="custom")return;let t=n;t.minMove!==void 0&&t.precision===void 0&&(t.precision=(function(e){if(e>=1)return 0;let i=0;for(;i<8;i++){let s=Math.round(e);if(Math.abs(s-e)<1e-8)return i;e*=10}return i})(t.minMove))}function Ja(n){return(function(t){if(_n(t.handleScale)){let i=t.handleScale;t.handleScale={axisDoubleClickReset:{time:i,price:i},axisPressedMouseMove:{time:i,price:i},mouseWheel:i,pinch:i}}else if(t.handleScale!==void 0){let{axisPressedMouseMove:i,axisDoubleClickReset:s}=t.handleScale;_n(i)&&(t.handleScale.axisPressedMouseMove={time:i,price:i}),_n(s)&&(t.handleScale.axisDoubleClickReset={time:s,price:s})}let e=t.handleScroll;_n(e)&&(t.handleScroll={horzTouchDrag:e,vertTouchDrag:e,mouseWheel:e,pressedMouseMove:e})})(n),n}var il=class{constructor(t,e,i){this.xw=new Map,this.Sw=new Map,this.kw=new O,this.yw=new O,this.Cw=new O,this.Tw=new Xo(e);let s=i===void 0?Ft(Za()):Ct(Ft(Za()),Ja(i));this.U_=e,this.lw=new Zo(t,s,e),this.lw.hm().l((o=>{this.kw.M()&&this.kw.m(this.Pw(o()))}),this),this.lw.lm().l((o=>{this.yw.M()&&this.yw.m(this.Pw(o()))}),this),this.lw.Zc().l((o=>{this.Cw.M()&&this.Cw.m(this.Pw(o()))}),this);let r=this.lw.$t();this.Rw=new el(r,this.lw.cb(),this.U_)}remove(){this.lw.hm().p(this),this.lw.lm().p(this),this.lw.Zc().p(this),this.Rw.S(),this.lw.S(),this.xw.clear(),this.Sw.clear(),this.kw.S(),this.yw.S(),this.Cw.S(),this.Tw.S()}resize(t,e,i){this.autoSizeActive()||this.lw.ob(t,e,i)}addCustomSeries(t,e){let i=ze(t),s=Object.assign(Object.assign({},Ya),i.defaultOptions());return this.Dw("Custom",s,e,i)}addAreaSeries(t){return this.Dw("Area",ad,t)}addBaselineSeries(t){return this.Dw("Baseline",cd,t)}addBarSeries(t){return this.Dw("Bar",od,t)}addCandlestickSeries(t={}){return(function(e){e.borderColor!==void 0&&(e.borderUpColor=e.borderColor,e.borderDownColor=e.borderColor),e.wickColor!==void 0&&(e.wickUpColor=e.wickColor,e.wickDownColor=e.wickColor)})(t),this.Dw("Candlestick",rd,t)}addHistogramSeries(t){return this.Dw("Histogram",ud,t)}addLineSeries(t){return this.Dw("Line",ld,t)}removeSeries(t){let e=it(this.xw.get(t)),i=this.Tw.fd(e);this.lw.$t().fd(e),this.Vw(i),this.xw.delete(t),this.Sw.delete(e)}fw(t,e){this.Vw(this.Tw.Xb(t,e))}mw(t,e){this.Vw(this.Tw.tw(t,e))}subscribeClick(t){this.kw.l(t)}unsubscribeClick(t){this.kw.v(t)}subscribeCrosshairMove(t){this.Cw.l(t)}unsubscribeCrosshairMove(t){this.Cw.v(t)}subscribeDblClick(t){this.yw.l(t)}unsubscribeDblClick(t){this.yw.v(t)}priceScale(t){return new Yo(this.lw,t)}timeScale(){return this.Rw}applyOptions(t){this.lw.Hh(Ja(t))}options(){return this.lw.W()}takeScreenshot(){return this.lw.bb()}autoSizeActive(){return this.lw.Sb()}chartElement(){return this.lw.kb()}paneSize(){let t=this.lw.Cb();return{height:t.height,width:t.width}}setCrosshairPosition(t,e,i){let s=this.xw.get(i);if(s===void 0)return;let r=this.lw.$t().cr(s);r!==null&&this.lw.$t().ld(t,e,r)}clearCrosshairPosition(){this.lw.$t().ad(!0)}Dw(t,e,i={},s){ff(i.priceFormat);let r=Ct(Ft(Qa),Ft(e),i),o=this.lw.$t().ud(t,r,s),l=new tl(o,this,this,this,this.U_);return this.xw.set(l,o),this.Sw.set(o,l),l}Vw(t){let e=this.lw.$t();e.od(t.St.Lu,t.St.rw,t.St.hw),t.sw.forEach(((i,s)=>s.J(i.He,i.ew))),e.Fu()}Ow(t){return it(this.Sw.get(t))}Pw(t){let e=new Map;t.Eb.forEach(((s,r)=>{let o=r.Jh(),l=Jo(o)(s);if(o!=="Custom")te(Zd(l));else{let a=r.Ca();te(!a||a(l)===!1)}e.set(this.Ow(r),l)}));let i=t.Lb!==void 0&&this.Sw.has(t.Lb)?this.Ow(t.Lb):void 0;return{time:t.Ib,logical:t.se,point:t.zb,hoveredSeries:i,hoveredObjectId:t.Nb,seriesData:e,sourceEvent:t.Fb}}};function mf(n,t,e){let i;if(qi(n)){let r=document.getElementById(n);te(r!==null,`Cannot find element in DOM with id=${n}`),i=r}else i=n;let s=new il(i,t,e);return t.setOptions(s.options()),s}function Ge(n,t){return mf(n,new Qn,Qn.Ad(t))}var zg=Object.assign(Object.assign({},Qa),Ya);function pf(n){if(!n)return n;let t=l=>({time:l[0],open:l[1],high:l[2],low:l[3],close:l[4],volume:l[5]}),e=(l,a="value")=>({time:l[0],[a]:l[1]}),i=Array.isArray(n.bars)&&n.bars.length>0&&Array.isArray(n.bars[0])?n.bars.map(t):n.bars,s=Array.isArray(n.rsi)&&n.rsi.length>0&&Array.isArray(n.rsi[0])?n.rsi.map(l=>e(l)):n.rsi,r=n.volumeDeltaRsi&&Array.isArray(n.volumeDeltaRsi.rsi)&&n.volumeDeltaRsi.rsi.length>0&&Array.isArray(n.volumeDeltaRsi.rsi[0])?n.volumeDeltaRsi.rsi.map(l=>e(l)):n.volumeDeltaRsi?.rsi||[],o=Array.isArray(n.volumeDelta)&&n.volumeDelta.length>0&&Array.isArray(n.volumeDelta[0])?n.volumeDelta.map(l=>e(l,"delta")):n.volumeDelta;return{...n,bars:i,rsi:s,volumeDeltaRsi:{rsi:r},volumeDelta:o}}function gf(n){if(!n)return n;let t=l=>({time:l[0],open:l[1],high:l[2],low:l[3],close:l[4],volume:l[5]}),e=(l,a="value")=>({time:l[0],[a]:l[1]}),i=Array.isArray(n.latestBar)?t(n.latestBar):n.latestBar,s=Array.isArray(n.latestRsi)?e(n.latestRsi):n.latestRsi,r=Array.isArray(n.latestVolumeDeltaRsi)?e(n.latestVolumeDeltaRsi):n.latestVolumeDeltaRsi,o=Array.isArray(n.latestVolumeDelta)?e(n.latestVolumeDelta,"delta"):n.latestVolumeDelta;return{...n,latestBar:i,latestRsi:s,latestVolumeDeltaRsi:r,latestVolumeDelta:o}}async function rs(n,t,e={}){let i=new URLSearchParams;i.set("format","tuple"),Number.isFinite(e.vdRsiLength)&&i.set("vdRsiLength",String(Math.max(1,Math.floor(Number(e.vdRsiLength))))),typeof e.vdSourceInterval=="string"&&e.vdSourceInterval&&i.set("vdSourceInterval",e.vdSourceInterval),typeof e.vdRsiSourceInterval=="string"&&e.vdRsiSourceInterval&&i.set("vdRsiSourceInterval",e.vdRsiSourceInterval);let s=i.toString(),r=`/api/chart?ticker=${encodeURIComponent(n)}&interval=${t}${s?`&${s}`:""}`,o=await fetch(r,{signal:e.signal});if(typeof e.onResponseMeta=="function"&&e.onResponseMeta({status:o.status,chartCacheHeader:o.headers.get("x-chart-cache")}),!o.ok){let a=await o.json().catch(()=>({error:"Failed to fetch chart data"}));throw new Error(a.error||`HTTP ${o.status}`)}let l=await o.json();return pf(l)}async function gc(n,t,e={}){let i=new URLSearchParams;i.set("format","tuple"),Number.isFinite(e.vdRsiLength)&&i.set("vdRsiLength",String(Math.max(1,Math.floor(Number(e.vdRsiLength))))),typeof e.vdSourceInterval=="string"&&e.vdSourceInterval&&i.set("vdSourceInterval",e.vdSourceInterval),typeof e.vdRsiSourceInterval=="string"&&e.vdRsiSourceInterval&&i.set("vdRsiSourceInterval",e.vdRsiSourceInterval);let s=i.toString(),r=`/api/chart/latest?ticker=${encodeURIComponent(n)}&interval=${t}${s?`&${s}`:""}`,o=await fetch(r,{signal:e.signal});if(typeof e.onResponseMeta=="function"&&e.onResponseMeta({status:o.status,chartCacheHeader:o.headers.get("x-chart-cache")}),!o.ok){let a=await o.json().catch(()=>({error:"Failed to fetch latest chart data"}));throw new Error(a.error||`HTTP ${o.status}`)}let l=await o.json();return gf(l)}var vc="catvue_app_timezone_v1",ll="America/Los_Angeles",bc=[{value:"America/Los_Angeles",label:"Los Angeles (US Pacific time)"},{value:"America/Denver",label:"Denver (US Mountain time)"},{value:"America/Chicago",label:"Chicago (US Central time)"},{value:"America/New_York",label:"New York (US Eastern time)"},{value:"UTC",label:"UTC"}],vf=new Set(bc.map(n=>n.value)),al=new Set,ls=yf(),cl=ls,os=new Map;function bf(n){if(!n)return!1;try{return new Intl.DateTimeFormat("en-US",{timeZone:n}),!0}catch{return!1}}function yc(n){let t=String(n||"").trim();return!t||!vf.has(t)||!bf(t)?ll:t}function yf(){let n="";try{n=typeof window<"u"?String(window.localStorage.getItem(vc)||""):""}catch{n=""}return yc(n)}function Sf(n){try{if(typeof window>"u")return;window.localStorage.setItem(vc,n)}catch{}}function wf(n,t){let e=Array.isArray(n)?n.join("|"):n,i=Object.entries(t).sort(([s],[r])=>s.localeCompare(r)).map(([s,r])=>`${s}:${String(r)}`);return`${e}|${i.join(",")}`}function Sc(){return bc.map(n=>({...n}))}function Y(){return ls}function we(n="en-US",t={}){let e=Y();cl!==e&&(os.clear(),cl=e);let i=wf(n,t),s=os.get(i);if(s)return s;let r=new Intl.DateTimeFormat(n,{...t,timeZone:e});return os.set(i,r),r}function wc(n){let t=yc(n),e=ls;return t===e||(ls=t,Sf(t),os.clear(),cl=t,al.forEach(i=>{try{i(t,e)}catch{}})),t}function Mc(n){return al.add(n),()=>{al.delete(n)}}var z=class z{constructor(t){_(this,"container");_(this,"chart");_(this,"series");_(this,"lineTools");_(this,"displayMode");_(this,"lineColor","#58a6ff");_(this,"midlineColor","#ffffff");_(this,"midlineStyle","dotted");_(this,"data");_(this,"seriesData",[]);_(this,"referenceLines",[]);_(this,"midlinePriceLine",null);_(this,"priceData",[]);_(this,"priceByTime",new Map);_(this,"indexByTime",new Map);_(this,"divergencePointTimeKeys",new Set);_(this,"divergenceToolActive",!1);_(this,"highlightSeries",null);_(this,"firstPoint",null);_(this,"divergencePoints",[]);_(this,"trendLineSeriesList",[]);_(this,"trendlineCrossLabels",[]);_(this,"trendlineDefinitions",[]);_(this,"timelineSeries",null);_(this,"suppressExternalSync",!1);_(this,"onTrendLineDrawn");this.container=t.container,this.displayMode=t.displayMode,this.lineColor=t.lineColor||this.lineColor,this.midlineColor=t.midlineColor||this.midlineColor,this.midlineStyle=t.midlineStyle||this.midlineStyle,this.data=this.normalizeRSIData(t.data),this.priceData=t.priceData||[],this.rebuildLookupMaps(),this.seriesData=this.buildSeriesData(this.data,this.priceData),this.onTrendLineDrawn=t.onTrendLineDrawn,this.chart=LightweightCharts.createChart(t.container,{height:400,layout:{background:{color:"#0d1117"},textColor:"#c9d1d9",fontFamily:"'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",attributionLogo:!1},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},timeScale:{visible:!0,timeVisible:!0,secondsVisible:!1,borderVisible:!0,ticksVisible:!0,fixRightEdge:!1,rightBarStaysOnScroll:!1,rightOffset:10,tickMarkFormatter:(e,i)=>this.formatTickMark(e,i),borderColor:"#21262d"},rightPriceScale:{borderColor:"#21262d",minimumWidth:z.SCALE_MIN_WIDTH_PX,entireTextOnly:!0,scaleMargins:{top:.2,bottom:.2}},crosshair:{mode:1},kineticScroll:{touch:!1,mouse:!1},handleScroll:{pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:Ht,mouseWheel:!0},handleScale:{mouseWheel:!0,pinch:!0,axisPressedMouseMove:{time:!0,price:!1},axisDoubleClickReset:{time:!0,price:!1}}}),this.addReferenceLine(50,"Midline",this.midlineColor,this.midlineStyleToLineStyle(this.midlineStyle)),this.updateSeries(),this.updateTimelineSeriesData(),this.chart.subscribeCrosshairMove(e=>{this.divergenceToolActive&&e&&e.time}),this.chart.subscribeClick(e=>{this.divergenceToolActive&&e&&e.time&&this.detectAndHighlightDivergence(e.time)}),this.chart.timeScale().subscribeVisibleLogicalRangeChange(()=>{this.refreshTrendlineCrossLabels()})}normalizeRSIData(t){return t.filter(e=>e&&(typeof e.time=="string"||typeof e.time=="number")&&Number.isFinite(Number(e.value))).map(e=>({...e,value:Math.max(z.RSI_DATA_MIN,Math.min(z.RSI_DATA_MAX,Number(e.value)))}))}formatRSIScaleLabel(t){if(!Number.isFinite(t))return"";let e=Number(t).toFixed(1);return e.length>=z.SCALE_LABEL_CHARS?e:e.padEnd(z.SCALE_LABEL_CHARS," ")}fixedRSIAutoscaleInfoProvider(){return{priceRange:{minValue:z.RSI_AXIS_MIN,maxValue:z.RSI_AXIS_MAX}}}timeKey(t){return typeof t=="number"?String(t):t}rebuildLookupMaps(){this.priceByTime.clear(),this.indexByTime.clear();for(let t=0;t<this.data.length;t++){let e=this.data[t];this.indexByTime.set(this.timeKey(e.time),t)}for(let t of this.priceData){let e=Number(t.close);Number.isFinite(e)&&this.priceByTime.set(this.timeKey(t.time),e)}}toDateFromScaleTime(t){if(typeof t=="number"&&Number.isFinite(t))return new Date(t*1e3);if(typeof t=="string"&&t.trim()){let e=t.includes("T")?t:`${t.replace(" ","T")}Z`,i=new Date(e);return Number.isFinite(i.getTime())?i:null}return t&&typeof t=="object"&&Number.isFinite(t.year)&&Number.isFinite(t.month)&&Number.isFinite(t.day)?new Date(Date.UTC(Number(t.year),Number(t.month)-1,Number(t.day),0,0,0)):null}toUnixSeconds(t){if(typeof t=="number"&&Number.isFinite(t))return t;if(typeof t!="string"||!t.trim())return null;let e=t.includes("T")?t:`${t.replace(" ","T")}Z`,s=new Date(e).getTime();return Number.isFinite(s)?Math.floor(s/1e3):null}formatTickMark(t,e){let i=this.toDateFromScaleTime(t);return i?e===0?i.toLocaleDateString("en-US",{year:"numeric",timeZone:Y()}):e===1?i.toLocaleDateString("en-US",{month:"short",timeZone:Y()}):i.toLocaleDateString("en-US",{day:"numeric",timeZone:Y()}):""}midlineStyleToLineStyle(t){return t==="solid"?0:1}isSyncSuppressed(){return this.suppressExternalSync}inferBarStepSeconds(){if(this.data.length<2)return 1800;let t=[];for(let e=1;e<this.data.length;e++){let i=this.data[e-1]?.time,s=this.data[e]?.time;if(typeof i!="number"||typeof s!="number")continue;let r=s-i;Number.isFinite(r)&&r>0&&r<=8*3600&&t.push(r)}return t.length===0?1800:(t.sort((e,i)=>e-i),t[Math.floor(t.length/2)])}barsPerTradingDayFromStep(t){return t<=300?78:t<=900?26:t<=1800?13:t<=3600?7:2}futureBarsForOneYear(){let t=this.inferBarStepSeconds();return this.barsPerTradingDayFromStep(t)*252}ensureTimelineSeries(){this.timelineSeries||(this.timelineSeries=this.chart.addLineSeries({color:"rgba(0, 0, 0, 0)",lineVisible:!1,pointMarkersVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1}))}updateTimelineSeriesData(){if(this.ensureTimelineSeries(),!this.timelineSeries||this.data.length===0)return;let t=this.toUnixSeconds(this.data[this.data.length-1]?.time);if(t===null)return;let e=[{time:t}],i=t,s=0;for(;s<z.FUTURE_TIMELINE_TRADING_DAYS;){i+=86400;let r=new Date(i*1e3).getUTCDay();r===0||r===6||(e.push({time:i}),s+=1)}this.timelineSeries.setData(e)}buildSeriesData(t,e){if(!e||e.length===0)return t;let i=new Map;for(let s of t)i.set(String(s.time),Number(s.value));return e.map(s=>{let r=i.get(String(s.time));return Number.isFinite(r)?{time:s.time,value:r}:{time:s.time}})}addReferenceLine(t,e,i,s=2){if(this.referenceLines.push({value:t,label:e,color:i,lineStyle:s}),this.series){let r=this.series.createPriceLine({price:t,color:i,lineWidth:1,lineStyle:s,axisLabelVisible:!1,title:e});e==="Midline"&&(this.midlinePriceLine=r)}}updateSeries(){this.series&&this.chart.removeSeries(this.series),this.midlinePriceLine=null,this.displayMode==="line"?this.series=this.chart.addLineSeries({color:this.lineColor,lineWidth:1,priceFormat:{type:"custom",minMove:1,formatter:t=>this.formatRSIScaleLabel(Number(t))},autoscaleInfoProvider:()=>this.fixedRSIAutoscaleInfoProvider(),priceLineVisible:!1,lastValueVisible:!1}):this.series=this.chart.addHistogramSeries({color:this.lineColor,priceFormat:{type:"custom",minMove:1,formatter:t=>this.formatRSIScaleLabel(Number(t))},autoscaleInfoProvider:()=>this.fixedRSIAutoscaleInfoProvider(),priceLineVisible:!1,lastValueVisible:!1}),this.displayMode==="line"?this.series.setData(this.seriesData):this.series.setData(this.seriesData.map(t=>Number.isFinite(Number(t.value))?{time:t.time,value:t.value,color:this.lineColor}:{time:t.time})),this.referenceLines.forEach(t=>{let e=this.series.createPriceLine({price:t.value,color:t.color,lineWidth:1,lineStyle:t.lineStyle,axisLabelVisible:!1,title:t.label});t.label==="Midline"&&(this.midlinePriceLine=e)})}setDisplayMode(t){this.displayMode!==t&&(this.displayMode=t,this.updateSeries(),this.refreshTrendlineCrossLabels())}setLineColor(t){t&&(this.lineColor=t,this.displayMode==="line"&&this.series?this.series.applyOptions({color:t}):this.displayMode!=="line"&&this.series&&(this.series.applyOptions({color:t}),this.series.setData(this.seriesData.map(e=>Number.isFinite(Number(e.value))?{time:e.time,value:e.value,color:this.lineColor}:{time:e.time}))))}setMidlineOptions(t,e){t&&(this.midlineColor=t),e&&(this.midlineStyle=e);let i=this.midlineStyleToLineStyle(this.midlineStyle);this.referenceLines=this.referenceLines.map(s=>s.label!=="Midline"?s:{...s,color:this.midlineColor,lineStyle:i}),this.midlinePriceLine&&this.midlinePriceLine.applyOptions({color:this.midlineColor,lineStyle:i})}setData(t,e){this.clearDivergence(),this.data=this.normalizeRSIData(t),e&&(this.priceData=e),this.rebuildLookupMaps(),this.seriesData=this.buildSeriesData(this.data,this.priceData),this.series&&(this.displayMode==="line"?this.series.setData(this.seriesData):this.series.setData(this.seriesData.map(i=>Number.isFinite(Number(i.value))?{time:i.time,value:i.value,color:this.lineColor}:{time:i.time}))),this.updateTimelineSeriesData(),this.refreshTrendlineCrossLabels()}updateLatestPoint(t,e){if(!t||typeof t.time!="string"&&typeof t.time!="number")return!1;let i=Number(t.value);if(!Number.isFinite(i)||this.data.length===0)return!1;let s=this.data.length-1,r=this.data[s]?.time,o=this.timeKey(r),l=this.timeKey(t.time);if(o!==l)return!1;let a=Math.max(z.RSI_DATA_MIN,Math.min(z.RSI_DATA_MAX,i));if(this.data[s]={...this.data[s],value:a},e&&this.timeKey(e.time)===o){let c=Number(e.close);Number.isFinite(c)&&(this.priceData.length>0&&this.timeKey(this.priceData[this.priceData.length-1].time)===o&&(this.priceData[this.priceData.length-1]={...this.priceData[this.priceData.length-1],close:c}),this.priceByTime.set(o,c))}return this.seriesData.length>0&&this.timeKey(this.seriesData[this.seriesData.length-1].time)===o?this.seriesData[this.seriesData.length-1]={time:r,value:a}:this.seriesData=this.buildSeriesData(this.data,this.priceData),this.series&&(this.displayMode==="line"?this.series.update({time:r,value:a}):this.series.update({time:r,value:a,color:this.lineColor})),this.refreshTrendlineCrossLabels(),!0}getChart(){return this.chart}getSeries(){return this.series}getPersistedTrendlines(){return this.trendlineDefinitions.map(t=>({...t}))}restorePersistedTrendlines(t){if(this.clearDivergence(),!(!Array.isArray(t)||t.length===0))for(let e of t){if(!e)continue;let i=e.time1,s=e.time2,r=Number(e.value1),o=Number(e.value2);typeof i!="string"&&typeof i!="number"||typeof s!="string"&&typeof s!="number"||!Number.isFinite(r)||!Number.isFinite(o)||this.drawTrendLine(i,r,s,o,!0)}}refreshTrendlineLabels(){this.refreshTrendlineCrossLabels()}getLineTools(){return this.lineTools}activateDivergenceTool(){this.divergenceToolActive=!0;let t=this.chart.chartElement();t&&(t.style.cursor="crosshair")}deactivateDivergenceTool(){this.divergenceToolActive=!1;let t=this.chart.chartElement();t&&(t.style.cursor="default"),this.clearHighlights(),this.firstPoint=null,this.divergencePoints=[],this.divergencePointTimeKeys.clear()}detectAndHighlightDivergence(t){let e=this.timeKey(t),i=this.indexByTime.get(e);if(i===void 0){console.log("Clicked point not found in RSI data");return}let s=this.data[i].value,r=this.priceByTime.get(e);if(!Number.isFinite(r)){console.log("Corresponding price data not found");return}let o=Number(r);if(this.firstPoint){if(!this.divergencePointTimeKeys.has(e)){console.log("Second point must be one of the highlighted divergence points");return}console.log(`Drawing trend line from (RSI: ${this.firstPoint.rsi.toFixed(2)}) to (RSI: ${s.toFixed(2)})`),this.drawTrendLine(this.firstPoint.time,this.firstPoint.rsi,t,s),this.clearHighlights(),this.deactivateDivergenceTool(),this.onTrendLineDrawn?.()}else{this.firstPoint={time:t,rsi:s,price:o,index:i},this.divergencePoints=[],this.divergencePointTimeKeys.clear();for(let l=i+1;l<this.data.length;l++){let a=this.data[l].value,c=this.data[l].time,u=this.priceByTime.get(this.timeKey(c));if(Number.isFinite(u)){let h=Number(u),d=a<s&&h>o,f=a>s&&h<o;(d||f)&&(this.divergencePoints.push({time:c,value:a}),this.divergencePointTimeKeys.add(this.timeKey(c)))}}console.log(`Found ${this.divergencePoints.length} divergence points from origin (RSI: ${s.toFixed(2)}, Price: ${o.toFixed(2)})`),this.highlightPoints(this.divergencePoints)}}highlightPoints(t){if(this.clearHighlights(),t.length===0)return;this.highlightSeries=this.chart.addLineSeries({color:"#ff6b6b",lineVisible:!1,pointMarkersVisible:!0,pointMarkersRadius:2,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,autoscaleInfoProvider:()=>this.fixedRSIAutoscaleInfoProvider()});let e=Math.max(1,Math.ceil(t.length/z.MAX_HIGHLIGHT_POINTS)),i=e===1?t:t.filter((s,r)=>r%e===0);this.highlightSeries.setData(i)}clearHighlights(){this.highlightSeries&&(this.chart.removeSeries(this.highlightSeries),this.highlightSeries=null)}formatMmDdYyFromUnixSeconds(t){return Number.isFinite(t)?we("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"}).format(new Date(Math.round(Number(t))*1e3)):"N/A"}createTrendlineCrossLabelElement(t){let e=document.createElement("div");return e.className="trendline-cross-label",e.textContent=t,e.style.position="absolute",e.style.zIndex="29",e.style.minHeight="24px",e.style.display="inline-flex",e.style.alignItems="center",e.style.padding="0 8px",e.style.borderRadius="4px",e.style.border="1px solid #30363d",e.style.background="#161b22",e.style.color="#c9d1d9",e.style.fontSize="12px",e.style.fontFamily="'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",e.style.pointerEvents="none",e.style.whiteSpace="nowrap",e.style.transform="translate(-50%, calc(-100% - 6px))",e}refreshTrendlineCrossLabels(){if(!this.chart||!this.series||!this.container)return;let t=this.container.clientWidth,e=this.container.clientHeight;for(let i of this.trendlineCrossLabels){let s=this.chart.timeScale().timeToCoordinate(i.anchorTime),r=this.series.priceToCoordinate(i.anchorValue);if(!Number.isFinite(s)||!Number.isFinite(r)||s<0||s>t||r<0||r>e){i.element.style.display="none";continue}i.element.style.display="inline-flex",i.element.style.left=`${Math.round(s)}px`,i.element.style.top=`${Math.round(Math.max(8,r))}px`}}clearTrendlineCrossLabels(){for(let t of this.trendlineCrossLabels)t.element.remove();this.trendlineCrossLabels=[]}addTrendlineCrossLabel(t,e,i){let s=this.createTrendlineCrossLabelElement(i);this.container.appendChild(s),this.trendlineCrossLabels.push({element:s,anchorTime:t,anchorValue:e}),this.refreshTrendlineCrossLabels()}indexToUnixSeconds(t,e,i,s,r){if(!Number.isFinite(t))return null;if(t>e)return s===null?null:s+(t-e)*r;if(t<0)return i===null?null:i+t*r;let o=Math.max(0,Math.floor(t)),l=Math.min(e,Math.ceil(t)),a=this.toUnixSeconds(this.data[o]?.time),c=this.toUnixSeconds(this.data[l]?.time);if(o===l)return a;if(Number.isFinite(a)&&Number.isFinite(c)){let u=t-o;return Number(a)+(Number(c)-Number(a))*u}return Number.isFinite(a)?Number(a)+(t-o)*r:i===null?null:i+t*r}computeTrendlineMidlineCrossUnixSeconds(t,e,i,s,r,o,l){if(!Number.isFinite(i)||Math.abs(i)<1e-12)return null;let a=t+(z.MIDLINE_VALUE-e)/i;return Number.isFinite(a)?this.indexToUnixSeconds(a,s,r,o,l):null}drawTrendLine(t,e,i,s,r=!0){let o=this.chart.timeScale().getVisibleLogicalRange?.();this.suppressExternalSync=!0;try{let l=this.indexByTime.get(this.timeKey(t)),a=this.indexByTime.get(this.timeKey(i));if(l===void 0||a===void 0){console.error("Could not find indices for trend line points");return}if(a===l)return;let c=(s-e)/(a-l),u=[],h=this.futureBarsForOneYear(),d=this.data.length-1,f=d+h,p=this.inferBarStepSeconds(),m=this.toUnixSeconds(this.data[0]?.time),g=this.data[d]?.time,v=this.toUnixSeconds(g);for(let S=l;S<=f;S++){let x=e+c*(S-l);if(x<z.RSI_DATA_MIN||x>z.RSI_DATA_MAX)break;let A=null;S<=d?A=this.data[S]?.time??null:v!==null&&(A=v+(S-d)*p),A!=null&&u.push({time:A,value:x})}if(!u.length)return;let b=this.chart.addLineSeries({color:"#ffa500",lineWidth:1,lineStyle:0,autoscaleInfoProvider:()=>this.fixedRSIAutoscaleInfoProvider(),priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1});this.trendLineSeriesList.push(b),b.setData(u);let w=this.computeTrendlineMidlineCrossUnixSeconds(l,e,c,d,m,v,p);this.addTrendlineCrossLabel(t,e,this.formatMmDdYyFromUnixSeconds(w)),r&&this.trendlineDefinitions.push({time1:t,value1:Number(e),time2:i,value2:Number(s)})}finally{if(o)try{this.chart.timeScale().setVisibleLogicalRange(o)}catch{}this.suppressExternalSync=!1}}clearDivergence(t=!1){let e=t?this.chart.timeScale().getVisibleLogicalRange?.():null;t&&(this.suppressExternalSync=!0);try{this.clearHighlights(),this.clearTrendlineCrossLabels();for(let i of this.trendLineSeriesList)try{this.chart.removeSeries(i)}catch{}this.trendLineSeriesList=[],this.trendlineDefinitions=[],this.firstPoint=null,this.divergencePoints=[],this.divergencePointTimeKeys.clear()}finally{if(t&&e)try{this.chart.timeScale().setVisibleLogicalRange(e)}catch{}t&&(this.suppressExternalSync=!1)}}resize(){this.chart&&(this.chart.resize(this.chart.options().width,400),this.refreshTrendlineCrossLabels())}destroy(){this.chart&&(this.clearTrendlineCrossLabels(),this.chart.remove())}};_(z,"SCALE_LABEL_CHARS",4),_(z,"SCALE_MIN_WIDTH_PX",56),_(z,"RSI_DATA_MIN",0),_(z,"RSI_DATA_MAX",100),_(z,"RSI_AXIS_MIN",20),_(z,"RSI_AXIS_MAX",80),_(z,"MIDLINE_VALUE",50),_(z,"MAX_HIGHLIGHT_POINTS",2e3),_(z,"FUTURE_TIMELINE_TRADING_DAYS",252);var as=z;var Ot=[1,3,7,14,28],ul=new Map,cs=new Map,Mf="custom_chart_settings_v1",us="1min",xf=new Set(["1min","5min","15min","30min","1hour","4hour"]);function xc(n){let t=String(n||"").trim().toLowerCase();return t==="bullish"||t==="bearish"?t:"neutral"}function Me(n){return String(n||"").trim().toUpperCase()}function Ze(n){let t=String(n||"").trim();return xf.has(t)?t:us}function Xe(){try{if(typeof window>"u")return us;let n=window.localStorage.getItem(Mf);if(!n)return us;let t=JSON.parse(n);return Ze(t?.volumeDelta?.sourceInterval)}catch{return us}}function Cc(n,t){return`${Me(n)}|${Ze(t)}`}function hl(n,t){let e=Cc(n,t),i=ul.get(e);return i?!Number.isFinite(i.expiresAtMs)||i.expiresAtMs<=Date.now()?(ul.delete(e),null):i:null}function Dc(n,t){let e=Cc(t.ticker,n);ul.set(e,t)}function Tc(){let n={};for(let t of Ot)n[String(t)]="neutral";return n}function Cf(n){let t=Me(n?.ticker);if(!t)return null;let e=Tc(),i=n?.states||{};for(let o of Ot)e[String(o)]=xc(i[String(o)]);let s=Number(n?.expiresAtMs),r=Number.isFinite(s)&&s>Date.now()?s:Date.now()+3600*1e3;return{ticker:t,tradeDate:typeof n?.tradeDate=="string"?n.tradeDate:null,states:e,expiresAtMs:r}}async function Df(n,t,e){let i=Ze(t),s=e?.forceRefresh===!0,r=e?.noCache===!0,o=Array.from(new Set(n.map(c=>Me(c)).filter(Boolean)));if(o.length===0)return new Map;let l=`${i}|${s?"refresh":"cached"}|${r?"nocache":"cache"}|${o.join(",")}`;if(cs.has(l))return await cs.get(l);let a=(async()=>{let c=new Map,u=new URLSearchParams;u.set("tickers",o.join(",")),u.set("vdSourceInterval",i),s&&u.set("refresh","1"),r&&u.set("nocache","1");let h=await fetch(`/api/chart/divergence-summary?${u.toString()}`,{cache:"no-store"});if(!h.ok)throw new Error(`Failed to fetch divergence summary (HTTP ${h.status})`);let d=await h.json(),f=Array.isArray(d?.summaries)?d.summaries:[];for(let p of f){let m=Cf(p);m&&(c.set(m.ticker,m),Dc(i,m))}return c})().catch(()=>new Map).finally(()=>{cs.delete(l)});return cs.set(l,a),await a}async function Zi(n,t,e){let i=Me(n),s=t?Ze(t):Xe(),r=e?.forceRefresh===!0,o=e?.noCache===!0;if(!i)return null;if(!r&&!o){let a=hl(i,s);if(a)return a}return(await Df([i],s,{forceRefresh:r,noCache:o})).get(i)||null}function Tf(n,t){n.querySelectorAll(".divergence-mini-cell").forEach(s=>{let r=String(s.dataset.days||"").trim(),o=t?.states?.[r]||"neutral";s.classList.remove("is-bullish","is-bearish","is-neutral"),o==="bullish"?s.classList.add("is-bullish"):o==="bearish"?s.classList.add("is-bearish"):s.classList.add("is-neutral")});let i=(n instanceof HTMLElement,n);i instanceof HTMLElement&&(t?.tradeDate?(i.dataset.tradeDate=t.tradeDate,i.title=`Daily divergence as of ${t.tradeDate}`):(i.removeAttribute("data-trade-date"),i.title="Daily divergence"))}var Lf={1:3,3:3,7:2,14:2,28:1};function hs(n,t){let e=0;for(let i of Ot){let s=String(i),r=String(n?.[s]||"").trim().toLowerCase(),o=Number(Lf[s]||0);r==="bullish"?e+=o:r==="bearish"&&(e-=o)}return t&&(e+=t.ema8===!0?1:t.ema8===!1?-1:0,e+=t.ema21===!0?1:t.ema21===!1?-1:0,e+=t.sma50===!0?1:t.sma50===!1?-1:0,e+=t.sma200===!0?1:t.sma200===!1?-1:0),e}function dl(n,t){let e=Me(n);if(!e)return 0;let i=t?Ze(t):Xe(),s=hl(e,i);return s?hs(s.states):0}function xe(n){let t=Xe(),e=Array.from(n.querySelectorAll(".divergence-mini[data-ticker]"));for(let i of e){let s=Me(i.dataset.ticker);if(!s)continue;let r=hl(s,t);r&&Tf(i,r)}}function Je(n,t){let e=t?Ze(t):Xe(),s=Date.now()+3600*1e3;for(let r of n||[]){let o=Me(r?.ticker);if(!o)continue;let l=Tc(),a=r?.divergence_states||{};for(let c of Ot)l[String(c)]=xc(a[String(c)]);Dc(e,{ticker:o,tradeDate:typeof r?.divergence_trade_date=="string"?r.divergence_trade_date:null,states:l,expiresAtMs:s})}}var Lc=new Map,Ef=1440*60*1e3;function kf(n){let t=`${n}|date`,e=Lc.get(t);if(e)return e;let i=new Intl.DateTimeFormat("en-CA",{timeZone:n,year:"numeric",month:"2-digit",day:"2-digit"});return Lc.set(t,i),i}function fl(n,t){let e=Number(n.find(i=>i.type===t)?.value);return Number.isFinite(e)?e:0}function _f(n,t){let e=kf(t).formatToParts(n);return{year:fl(e,"year"),month:fl(e,"month"),day:fl(e,"day")}}function Ec(n,t,e){return`${n}-${String(t).padStart(2,"0")}-${String(e).padStart(2,"0")}`}function Rf(n,t){let e=Pf(n);if(!Number.isFinite(e))return"";let i=new Date(e+t*Ef);return Ec(i.getUTCFullYear(),i.getUTCMonth()+1,i.getUTCDate())}function Pf(n){let t=String(n||"").match(/^(\d{4})-(\d{2})-(\d{2})$/);if(!t)return null;let e=Number(t[1]),i=Number(t[2]),s=Number(t[3]);return!Number.isFinite(e)||!Number.isFinite(i)||!Number.isFinite(s)?null:Date.UTC(e,i-1,s)}function If(n=Y()){let e=_f(new Date,n);return Ec(e.year,e.month,e.day)}function kc(n){return n?n<1e3?n.toFixed(0).padEnd(7):(Math.round(n/1e3)+"K").padEnd(7):"0".padEnd(7)}function _c(n,t="",e="",i=Y()){let s=If(i);if(!s)return{startDate:"",endDate:""};if(n==="1"||n==="2"||n==="5"){let r=Rf(s,-29);return r?{startDate:r,endDate:s}:{startDate:"",endDate:""}}if(n==="custom"){let r=String(t||"").trim(),o=String(e||"").trim();return/^\d{4}-\d{2}-\d{2}$/.test(r)&&/^\d{4}-\d{2}-\d{2}$/.test(o)?{startDate:r,endDate:o}:{startDate:"",endDate:""}}return{startDate:"",endDate:""}}function lt(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Ce(n,t="desc"){return(e,i)=>{let s=0;if(n==="time")s=(i.timestamp||"").localeCompare(e.timestamp||"");else{if(n==="favorite")return e.is_favorite===i.is_favorite?(i.timestamp||"").localeCompare(e.timestamp||""):(i.is_favorite?1:0)-(e.is_favorite?1:0);if(n==="volume")s=(i.signal_volume||0)-(e.signal_volume||0);else if(n==="score"){let r=i.divergence_states?hs(i.divergence_states,i.ma_states):dl(i.ticker),o=e.divergence_states?hs(e.divergence_states,e.ma_states):dl(e.ticker);if(i.vdf_score?r+=Math.round(i.vdf_score/10):i.vdf_detected&&(r+=10),e.vdf_score?o+=Math.round(e.vdf_score/10):e.vdf_detected&&(o+=10),r!==o)s=r-o;else{let l=(i.signal_volume||0)-(e.signal_volume||0);l!==0?s=l:s=(i.timestamp||"").localeCompare(e.timestamp||"")}}else s=(i.timestamp||"").localeCompare(e.timestamp||"")}return n!=="favorite"&&t==="asc"?-s:s}}function ee(n,t,e){let i=document.querySelector(n);i&&i.querySelectorAll(".tf-btn").forEach(s=>{let r=s,o=r.dataset.sort;o===t?(r.classList.add("active"),o!=="favorite"&&r.setAttribute("data-sort-dir",e==="asc"?"\u2191":"\u2193")):(r.classList.remove("active"),r.removeAttribute("data-sort-dir"))})}var Af=[];function Rc(){return Af}var ds=[];function Ye(){return ds}function Pc(n){ds=n}function Ic(n,t){ds=[...ds.filter(i=>(i.timeframe||"").trim()!==n),...t]}function Nf(n){let t=String(n||"").trim();if(!t)return"";let e=t.match(/^(\d{4})-(\d{2})-(\d{2})/);if(e){let s=Number(e[2]),r=Number(e[3]);if(Number.isFinite(s)&&s>0&&Number.isFinite(r)&&r>0)return`${s}/${r}`}let i=new Date(t);return Number.isNaN(i.getTime())?"":`${i.getMonth()+1}/${i.getDate()}`}function De(n){let t=Nf(n.signal_trade_date||n.divergence_trade_date||n.timestamp)||"--",e="DataAPI",i=n.ma_states||{},s=!1,r=!1;if(n.signal_direction!==void 0&&n.signal_direction!==null){let g=Number(n.signal_direction);s=g===1,r=g===-1}else s=!!(n.signal_type&&n.signal_type.toLowerCase().includes("bull")),r=!s;let o=s?"bullish-card":r?"bearish-card":"",l=kc(n.signal_volume||0),a=n.is_favorite===!0||String(n.is_favorite).toLowerCase()==="true",c=a?"filled":"",u=a?"visible":"hidden",h=a?"1":"0",d=`
        <svg class="fav-icon ${c}" data-id="${n.id}" data-source="${e}" viewBox="0 0 24 24" width="15" height="15" stroke="currentColor" stroke-width="2.25" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <polyline class="check-mark" points="7.5 12.5 10.5 15.5 16.5 9.5" style="visibility: ${u}; opacity: ${h};"></polyline>
        </svg>
    `,f=Ot.map(g=>{let v=String(g),b=String(n.divergence_states?.[v]||"neutral").toLowerCase();return`<span class="divergence-mini-cell ${b==="bullish"?"is-bullish":b==="bearish"?"is-bearish":"is-neutral"}" data-days="${g}">${g}</span>`}).join(""),p=n.divergence_trade_date?`Daily divergence as of ${lt(n.divergence_trade_date)}`:"Daily divergence",m=`
        <span class="ma-dot-row" title="8 EMA, 21 EMA, 50 SMA, 200 SMA">
            <span class="ma-dot ${i.ema8?"is-up":"is-down"}"></span>
            <span class="ma-dot ${i.ema21?"is-up":"is-down"}"></span>
            <span class="ma-dot ${i.sma50?"is-up":"is-down"}"></span>
            <span class="ma-dot ${i.sma200?"is-up":"is-down"}"></span>
        </span>
    `;return`
        <div class="alert-card ${o}" data-ticker="${lt(n.ticker)}" data-source="${e}">
            ${d}
            <h3>${lt(n.ticker)}</h3>
            
            <div class="metrics-container">
                <div class="metric-item" title="Daily divergence summary">
                    <div class="divergence-mini" data-ticker="${lt(n.ticker)}" title="${p}">
                        ${f}
                    </div>
                </div>
                <div class="metric-item" title="Signal Volume">
                    <span class="volume-text">${l}</span>
                    ${n.vdf_detected&&n.vdf_score?`<span class="vdf-score-badge${n.vdf_proximity==="imminent"?" vdf-imminent":n.vdf_proximity==="high"?" vdf-high":""}" title="VD Accumulation Score: ${n.vdf_score}">${n.vdf_score}</span>`:n.vdf_detected?'<span class="vdf-tag" title="VD Accumulation detected">VDF</span>':""}
                    ${m}
                </div>
            </div>

            <span class="alert-time">${t}</span>
        </div>
    `}function $f(n){return typeof n=="boolean"?n:typeof n=="string"?n.toLowerCase()==="true":typeof n=="number"?n===1:!1}function Ac(n){let t=n,e=Number(t.id);if(!Number.isFinite(e))throw new Error("Invalid divergence payload: missing/invalid id");return{...t,id:e,is_favorite:$f(t.is_favorite),source:"DataAPI"}}async function Nc(n=""){try{let t=new URLSearchParams(String(n||"").replace(/^\?/,""));t.set("vd_source_interval",Xe());let e=await fetch(`/api/divergence/signals?${t.toString()}`);if(!e.ok)throw new Error("Network response was not ok");let i=await e.json();if(!Array.isArray(i))throw new Error("Invalid divergence payload: expected array");return i.map(Ac)}catch(t){throw console.error("Error fetching divergence signals:",t),t}}async function $c(n){let t=await fetch(`/api/divergence/signals/${n}/favorite`,{method:"POST"});if(!t.ok)throw new Error("Network response was not ok");return Ac(await t.json())}async function Vc(){let n=await fetch("/api/divergence/fetch-daily/run",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await n.json().catch(()=>({}));if(!n.ok){if(n.status===409&&String(t?.status||"")==="running")return{status:"running"};let e=typeof t?.error=="string"&&t.error.trim()?t.error.trim():`Failed to start fetch-daily run (HTTP ${n.status})`;throw new Error(e)}return{status:String(t?.status||"started")}}async function Fc(){let n=await fetch("/api/divergence/fetch-daily/stop",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await n.json().catch(()=>({}));if(!n.ok){if(n.status===409&&typeof t?.status=="string")return{status:t.status};let e=typeof t?.error=="string"&&t.error.trim()?t.error.trim():`Failed to stop fetch-daily run (HTTP ${n.status})`;throw new Error(e)}return{status:String(t?.status||"stop-requested")}}async function Bc(){let n=await fetch("/api/divergence/fetch-weekly/run",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await n.json().catch(()=>({}));if(!n.ok){if(n.status===409&&String(t?.status||"")==="running")return{status:"running"};let e=typeof t?.error=="string"&&t.error.trim()?t.error.trim():`Failed to start fetch-weekly run (HTTP ${n.status})`;throw new Error(e)}return{status:String(t?.status||"started")}}async function zc(){let n=await fetch("/api/divergence/fetch-weekly/stop",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await n.json().catch(()=>({}));if(!n.ok){if(n.status===409&&typeof t?.status=="string")return{status:t.status};let e=typeof t?.error=="string"&&t.error.trim()?t.error.trim():`Failed to stop fetch-weekly run (HTTP ${n.status})`;throw new Error(e)}return{status:String(t?.status||"stop-requested")}}async function Hc(){let n=await fetch("/api/divergence/vdf-scan/run",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await n.json().catch(()=>({}));if(!n.ok){if(n.status===409&&String(t?.status||"")==="running")return{status:"running"};let e=typeof t?.error=="string"&&t.error.trim()?t.error.trim():`Failed to start VDF scan (HTTP ${n.status})`;throw new Error(e)}return{status:String(t?.status||"started")}}async function Oc(){let n=await fetch("/api/divergence/vdf-scan/stop",{method:"POST",headers:{"Content-Type":"application/json"}}),t=await n.json().catch(()=>({}));if(!n.ok){if(n.status===409&&typeof t?.status=="string")return{status:t.status};let e=typeof t?.error=="string"&&t.error.trim()?t.error.trim():`Failed to stop VDF scan (HTTP ${n.status})`;throw new Error(e)}return{status:String(t?.status||"stop-requested")}}async function ml(){let n=await fetch("/api/divergence/scan/status"),t=await n.json().catch(()=>null);if(!n.ok||!t){let e=typeof t?.error=="string"&&t.error.trim()?t.error.trim():"Failed to fetch divergence scan status";throw new Error(e)}return{running:!!t.running,lastScanDateEt:t.lastScanDateEt??null,scanControl:t.scanControl??null,tableBuild:t.tableBuild??null,fetchDailyData:t.fetchDailyData??null,fetchWeeklyData:t.fetchWeeklyData??null,vdfScan:t.vdfScan??null,latestJob:t.latestJob??null}}var Es="1",ks="1",qc="",Gc="",Zc="",Xc="",Wt="score",Ut="score",ie="desc",ne="desc",jt=100,tn=jt,en=jt,ms=null,pl=!1,fs=0,Wc=3,Qe=-1,ti=-1,vs=0,Vf=8e3,ei=!1,ii=!1,ni=!1,nt=!1,st=!1,Ji=!1,gl=-1,si=null,ps=null,Te=null,Yi=null,Xi=null,Uc=new Map;function nn(n){return n==="daily"?Es:ks}function Jc(n,t,e){n==="daily"?(qc=t,Gc=e):(Zc=t,Xc=e)}function Ff(n){return n==="daily"?{from:qc,to:Gc}:{from:Zc,to:Xc}}function Le(n,t){let e=new Set;for(let r of n){let o=r.signal_trade_date||(r.timestamp?r.timestamp.slice(0,10):null);o&&e.add(o)}let i=[...e].sort((r,o)=>o.localeCompare(r)),s=new Set(i.slice(0,t));return n.filter(r=>{let o=r.signal_trade_date||(r.timestamp?r.timestamp.slice(0,10):null);return o?s.has(o):!1})}function vl(n,t){return t==="1"?Le(n,1):t==="2"?Le(n,2):t==="5"?Le(n,5):n}function Yc(){return{button:document.getElementById("divergence-run-btn"),status:document.getElementById("divergence-run-status")}}function Qc(){return{button:document.getElementById("divergence-run-table-btn"),status:document.getElementById("divergence-table-run-status")}}function tu(){return{button:document.getElementById("divergence-fetch-daily-btn"),status:document.getElementById("divergence-fetch-daily-status")}}function eu(){return{button:document.getElementById("divergence-fetch-weekly-btn"),status:document.getElementById("divergence-fetch-weekly-status")}}function Bf(){return{pauseResumeButton:document.getElementById("divergence-run-pause-resume-btn"),stopButton:document.getElementById("divergence-run-stop-btn")}}function zf(){return{pauseResumeButton:document.getElementById("divergence-table-pause-resume-btn"),stopButton:document.getElementById("divergence-table-stop-btn"),manualUpdateButton:document.getElementById("divergence-manual-update-btn")}}function Hf(){return{stopButton:document.getElementById("divergence-fetch-daily-stop-btn")}}function Of(){return{stopButton:document.getElementById("divergence-fetch-weekly-stop-btn")}}function bs(n,t=!1){let{button:e}=Yc();e&&(e.disabled=n||t,e.classList.toggle("active",n),e.textContent=n?"Running":"Run Fetch")}function ys(n){let{status:t}=Yc();t&&(t.textContent=n)}function Ss(n,t=!1){let{button:e}=Qc();e&&(e.disabled=n||t,e.classList.toggle("active",n),e.textContent=n?"Running":"Run Table")}function ws(n){let{status:t}=Qc();t&&(t.textContent=n)}function ri(n,t=!1){let{button:e}=tu();e&&(e.disabled=n,e.classList.toggle("active",n),t&&!n?e.textContent="Resume Fetch":e.textContent="Fetch Daily")}function Pt(n){let{status:t}=tu();t&&(t.textContent=n)}function oi(n,t=!1){let{button:e}=eu();e&&(e.disabled=n,e.classList.toggle("active",n),t&&!n?e.textContent="Resume Fetch":e.textContent="Fetch Weekly")}function It(n){let{status:t}=eu();t&&(t.textContent=n)}function iu(){return{button:document.getElementById("divergence-vdf-scan-btn"),status:document.getElementById("divergence-vdf-scan-status")}}function Wf(){return{stopButton:document.getElementById("divergence-vdf-scan-stop-btn")}}function li(n){let{button:t}=iu();t&&(t.disabled=n,t.classList.toggle("active",n),t.textContent="VDF Scan")}function Ee(n){let{status:t}=iu();t&&(t.textContent=n)}function Ms(n){let{stopButton:t}=Wf(),e=n?.vdfScan||null,i=!!e?.running,s=!!e?.stop_requested;t&&(t.textContent="\u23F9",t.disabled=!i||s,t.classList.toggle("active",i),t.setAttribute("aria-label","Stop VDF Scan"),t.title="Stop VDF Scan")}function xs(n){let{pauseResumeButton:t,stopButton:e}=Bf(),i=n?.scanControl||null,s=!!(i?.running||n?.running),r=!!i?.pause_requested,o=!!i?.can_resume,l=!!i?.stop_requested;t&&(t.textContent=o&&!s?"\u25B6":"\u23F8",t.disabled=s?r:!o,t.classList.toggle("active",s||o),t.setAttribute("aria-label",o&&!s?"Resume Run Fetch":"Pause Run Fetch"),t.title=o&&!s?"Resume Run Fetch":"Pause Run Fetch"),e&&(e.textContent="\u23F9",e.disabled=!s||l,e.classList.toggle("active",s),e.setAttribute("aria-label","Stop Run Fetch"),e.title="Stop Run Fetch")}function Cs(n){let{pauseResumeButton:t,stopButton:e,manualUpdateButton:i}=zf(),s=n?.tableBuild||null,r=!!s?.running,o=!!s?.pause_requested,l=!!s?.stop_requested,a=!!s?.can_resume;t&&(t.textContent=a&&!r?"\u25B6":"\u23F8",t.disabled=r?o:!a,t.classList.toggle("active",r||a),t.setAttribute("aria-label",a&&!r?"Resume Run Table":"Pause Run Table"),t.title=a&&!r?"Resume Run Table":"Pause Run Table"),e&&(e.textContent="\u23F9",e.disabled=!r||l,e.classList.toggle("active",r),e.setAttribute("aria-label","Stop Run Table"),e.title="Stop Run Table"),i&&(i.disabled=!1)}function Ds(n){let{stopButton:t}=Hf(),e=n?.fetchDailyData||null,i=!!e?.running,s=!!e?.stop_requested;t&&(t.textContent="\u23F9",t.disabled=!i||s,t.classList.toggle("active",i),t.setAttribute("aria-label","Stop Fetch Daily"),t.title="Stop Fetch Daily")}function Ts(n){let{stopButton:t}=Of(),e=n?.fetchWeeklyData||null,i=!!e?.running,s=!!e?.stop_requested;t&&(t.textContent="\u23F9",t.disabled=!i||s,t.classList.toggle("active",i),t.setAttribute("aria-label","Stop Fetch Weekly"),t.title="Stop Fetch Weekly")}function at(n){let t=String(n?.message||n||"").trim();return t?/not configured/i.test(t)?"DB not configured":/unauthorized/i.test(t)?"Unauthorized":/already running|running/i.test(t)?"Already running":t.length>56?`${t.slice(0,56)}...`:t:"Run failed"}function U(n){let t=String(n||"").trim();if(!t)return null;let e=t.match(/^(\d{4})-(\d{2})-(\d{2})/);return e?`${e[1]}-${e[2]}-${e[3]}`:null}function ai(n){let t=n.split("-");if(t.length!==3)return"";let e=Number(t[1]),i=Number(t[2]);return!Number.isFinite(e)||e<=0||!Number.isFinite(i)||i<=0?"":`${e}/${i}`}function jc(n){let t=n.latestJob,e=U(n.lastScanDateEt)||U(t?.scanned_trade_date)||U(t?.run_for_date)||U(t?.finished_at)||U(t?.started_at);if(!e)return"Fetched";let i=ai(e);return i?`Fetched ${i}`:"Fetched"}function nu(n){let t=n.latestJob,e=n.scanControl||null;if(n.running){let i=Number(t?.processed_symbols||0),s=Number(t?.total_symbols||0);return e?.stop_requested?s>0?`Stopping ${i}/${s}`:"Stopping":e?.pause_requested?s>0?`Pausing ${i}/${s}`:"Pausing":s>0?`Running ${i}/${s}`:"Running"}if(t?.status==="paused"){let i=Number(t?.processed_symbols||0),s=Number(t?.total_symbols||0);return s>0?`Paused ${i}/${s}`:"Paused"}return t?.status==="stopped"?"Stopped":t?.status==="completed"?jc(n):t?.status==="failed"?"Last run failed":n.lastScanDateEt||t?.run_for_date||t?.finished_at||t?.started_at?jc(n):"Idle"}function su(n){let t=n.tableBuild;if(!t)return"Table idle";let e=String(t.status||"").toLowerCase(),i=Number(t.error_tickers||0);if(e==="stopped")return"Table stopped";if(e==="paused"){let s=Number(t.processed_tickers||0),r=Number(t.total_tickers||0);return r>0?`Paused ${s}/${r}`:"Table paused"}if(t.running){let s=Number(t.processed_tickers||0),r=Number(t.total_tickers||0);return t.stop_requested?r>0?`Stopping ${s}/${r}`:"Stopping":t.pause_requested?r>0?`Pausing ${s}/${r}`:"Pausing":r>0?`Table ${s}/${r}`:"Table running"}if(e==="completed"){let s=U(t.last_published_trade_date||null),r=s?ai(s):"";return r?`Table ${r}`:"Table fetched"}if(e==="completed-with-errors"){let s=U(t.last_published_trade_date||null),r=s?ai(s):"";return r&&i>0?`Table ${r} (${i} errors)`:i>0?`Table done (${i} errors)`:r?`Table ${r}`:"Table fetched"}return e==="failed"?"Table failed":"Table idle"}function ru(n){let t=n.fetchDailyData,e=n.latestJob,i=U(t?.last_published_trade_date||null)||U(n.lastScanDateEt)||U(e?.scanned_trade_date)||U(e?.run_for_date)||U(e?.finished_at)||U(e?.started_at),s=i?ai(i):"",r=s?`Ran ${s}`:"Ran --";if(!t)return r;let o=String(t.status||"").toLowerCase();if(o==="stopping")return"Stopping";if(o==="stopped"){if(t.can_resume){let l=Number(t.processed_tickers||0),a=Number(t.total_tickers||0);return a>0?`Stopped ${l}/${a} (resumable)`:"Stopped (resumable)"}return"Stopped"}if(t.running){let l=Number(t.processed_tickers||0),a=Number(t.total_tickers||0),c=Number(t.error_tickers||0);return t.stop_requested?"Stopping":o==="running-retry"?`Retrying ${c} failed (${l}/${a})`:o==="running-ma"?`MA ${l}/${a}`:o==="running-ma-retry"?`Retrying failed MA (${l}/${a})`:`${l} / ${a}`}return r}function ou(n){let t=n.fetchWeeklyData,e=n.latestJob,i=U(t?.last_published_trade_date||null)||U(n.lastScanDateEt)||U(e?.scanned_trade_date)||U(e?.run_for_date)||U(e?.finished_at)||U(e?.started_at),s=i?ai(i):"",r=s?`Ran ${s}`:"Ran --";if(!t)return r;let o=String(t.status||"").toLowerCase();if(o==="stopping")return"Stopping";if(o==="stopped"){if(t.can_resume){let l=Number(t.processed_tickers||0),a=Number(t.total_tickers||0);return a>0?`Stopped ${l}/${a} (resumable)`:"Stopped (resumable)"}return"Stopped"}if(t.running){let l=Number(t.processed_tickers||0),a=Number(t.total_tickers||0),c=Number(t.error_tickers||0);return t.stop_requested?"Stopping":o==="running-retry"?`Retrying ${c} failed (${l}/${a})`:o==="running-ma"?`MA ${l}/${a}`:o==="running-ma-retry"?`Retrying failed MA (${l}/${a})`:`${l} / ${a}`}return r}function lu(n){let t=n.vdfScan;if(!t)return"Ran --";let e=String(t.status||"").toLowerCase(),i=U(t.finished_at||t.started_at||null),s=i?ai(i):"",r=s?`Ran ${s}`:"Ran --";if(e==="stopping")return"Stopping";if(e==="stopped")return"Stopped";if(t.running){let o=Number(t.processed_tickers||0),l=Number(t.total_tickers||0),a=Number(t.detected_tickers||0);return t.stop_requested?"Stopping":e==="running-retry"?`Retrying (${o}/${l})`:`${o}/${l} (${a} VDF)`}if(e==="completed"||e==="completed-with-errors"){let o=Number(t.detected_tickers||0);return o>0?`${r} (${o} VDF)`:r}return r}function Ls(){ms!==null&&(window.clearInterval(ms),ms=null)}function Qi(n=!1,t){if(gu())return;let e=Date.now();!n&&e-vs<Vf||(vs=e,t?ci(t).then(()=>se(t)).catch(()=>{}):sn().then(rn).catch(()=>{}))}async function _s(n){if(!pl){pl=!0;try{let t=await ml();fs=0,ei=!!t.tableBuild?.running,ii=!!t.fetchDailyData?.running,ni=!!t.fetchWeeklyData?.running,bs(t.running,!!t.scanControl?.can_resume),ys(nu(t)),xs(t);let e=ei;Ss(e,!!t.tableBuild?.can_resume),ws(su(t)),Cs(t);let i=ii,s=!!t.fetchDailyData?.can_resume;ri(i,s),Pt(ru(t)),Ds(t);let r=ni,o=!!t.fetchWeeklyData?.can_resume;oi(r,o),It(ou(t)),Ts(t);let l=!!t.vdfScan?.running;if(li(l),Ee(lu(t)),Ms(t),i?(nt=!0,st=!1):r&&(st=!0,nt=!1),i&&nt){let a=Number(t.fetchDailyData?.processed_tickers||0),c=a!==Qe;Qe=a,Qi(c,"1d")}else Qe=-1;if(r&&st){let a=Number(t.fetchWeeklyData?.processed_tickers||0),c=a!==ti;ti=a,Qi(c,"1w")}else ti=-1;if(l&&Ji){let a=Number(t.vdfScan?.processed_tickers||0),c=a!==gl;gl=a,c&&Qi(!0)}else gl=-1;!i&&!r&&!l&&(vs=0),!t.running&&!e&&!i&&!r&&!l&&(Ls(),n&&(nt&&(await ci("1d"),se("1d")),st&&(await ci("1w"),se("1w")),Ji&&(await sn(),rn())),nt=!1,st=!1,Ji=!1)}catch(t){fs+=1,fs<Wc?console.warn(`Scan status poll failed (${fs}/${Wc}), retrying next cycle`):(console.error("Failed to poll divergence scan status:",t),ei=!1,ii=!1,ni=!1,ys(at(t)),ws(at(t)),Pt(at(t)),It(at(t)),Ls(),bs(!1,!1),xs(null),Ss(!1,!1),Cs(null),ri(!1,!1),Ds(null),oi(!1,!1),Ts(null),li(!1),Ms(null),nt=!1,st=!1)}finally{pl=!1}}}function Rs(n){Ls(),ms=window.setInterval(()=>{_s(n)},2500)}async function ke(){try{let n=await ml();ei=!!n.tableBuild?.running,ii=!!n.fetchDailyData?.running,ni=!!n.fetchWeeklyData?.running,bs(n.running,!!n.scanControl?.can_resume),ys(nu(n)),xs(n);let t=ei;Ss(t,!!n.tableBuild?.can_resume),ws(su(n)),Cs(n);let e=ii,i=!!n.fetchDailyData?.can_resume;ri(e,i),Pt(ru(n)),Ds(n);let s=ni,r=!!n.fetchWeeklyData?.can_resume;oi(s,r),It(ou(n)),Ts(n);let o=!!n.vdfScan?.running;if(li(o),Ee(lu(n)),Ms(n),e?(nt=!0,st=!1):s&&(st=!0,nt=!1),e&&nt){let l=Number(n.fetchDailyData?.processed_tickers||0),a=l!==Qe;Qe=l,Qi(a,"1d")}else Qe=-1;if(s&&st){let l=Number(n.fetchWeeklyData?.processed_tickers||0),a=l!==ti;ti=l,Qi(a,"1w")}else ti=-1;!e&&!s&&(vs=0),n.running||t||e||s||o?Rs(!0):(Ls(),nt=!1,st=!1)}catch(n){console.error("Failed to sync divergence scan UI state:",n),ei=!1,ii=!1,ni=!1,bs(!1,!1),xs(null),ys(at(n)),Ss(!1,!1),ws(at(n)),Cs(null),ri(!1,!1),Pt(at(n)),Ds(null),oi(!1,!1),It(at(n)),Ts(null),li(!1),Ms(null),nt=!1,st=!1}}async function au(){ri(!0),Pt("Starting..."),nt=!0,st=!1;try{let n=await Vc();n.status==="running"?Pt("Already running"):n.status==="resumed"&&Pt("Resuming..."),Rs(!0),await _s(!1)}catch(n){console.error("Failed to start fetch-daily run:",n),ri(!1),Pt(at(n))}}async function cu(){oi(!0),It("Starting..."),st=!0,nt=!1;try{let n=await Bc();n.status==="running"?It("Already running"):n.status==="resumed"&&It("Resuming..."),Rs(!0),await _s(!1)}catch(n){console.error("Failed to start fetch-weekly run:",n),oi(!1),It(at(n))}}async function uu(){try{(await Fc()).status==="stop-requested"&&Pt("Stopping"),nt=!1,await ke()}catch(n){console.error("Failed to stop fetch-daily run:",n),Pt(at(n))}}async function hu(){try{(await zc()).status==="stop-requested"&&It("Stopping"),st=!1,await ke()}catch(n){console.error("Failed to stop fetch-weekly run:",n),It(at(n))}}async function du(){li(!0),Ee("Starting..."),Ji=!0,nt=!1,st=!1;try{(await Hc()).status==="running"&&Ee("Already running"),Rs(!0),await _s(!1)}catch(n){console.error("Failed to start VDF scan:",n),li(!1),Ee(at(n))}}async function fu(){try{(await Oc()).status==="stop-requested"&&Ee("Stopping"),Ji=!1,await ke()}catch(n){console.error("Failed to stop VDF scan:",n),Ee(at(n))}}async function sn(n){try{let[t,e]=await Promise.all([ci("1d"),ci("1w")]),i=[...t,...e];return Je(i),i}catch(t){return console.error("Error fetching divergence signals:",t),[]}}function bl(n,t,e){if(n>=t)return"";let i=t-n,s=Math.min(i,jt);return`<button class="tf-btn show-more-btn" data-timeframe="${e}">\u25BC Show ${s} more (${n}/${t})</button>`}function rn(){let n=Ye();Je(n),tn=jt,en=jt;let t=document.getElementById("divergence-daily-container"),e=document.getElementById("divergence-weekly-container");if(!t||!e)return;let i=n.filter(l=>(l.timeframe||"").trim()==="1d"),s=n.filter(l=>(l.timeframe||"").trim()==="1w");i=vl(i,Es),s=vl(s,ks),Wt==="favorite"&&(i=i.filter(l=>l.is_favorite)),Ut==="favorite"&&(s=s.filter(l=>l.is_favorite)),i.sort(Ce(Wt==="favorite"?"time":Wt,ie)),s.sort(Ce(Ut==="favorite"?"time":Ut,ne));let r=i.slice(0,tn),o=s.slice(0,en);t.innerHTML=r.map(De).join("")+bl(r.length,i.length,"1d"),e.innerHTML=o.map(De).join("")+bl(o.length,s.length,"1w"),xe(t),xe(e)}async function ci(n){try{let t=n==="1d"?"daily":"weekly",e=nn(t),i=Ff(t),{startDate:s,endDate:r}=_c(e,i.from,i.to);if(!s||!r)return[];let o=`?start_date=${s}&end_date=${r}&timeframe=${n}`,l=await Nc(o);return Je(l),Ic(n,l),l}catch(t){return console.error(`Error fetching divergence signals for ${n}:`,t),[]}}function se(n){let t=Ye(),e=n==="1d"?"divergence-daily-container":"divergence-weekly-container",i=document.getElementById(e);if(!i)return;let r=nn(n==="1d"?"daily":"weekly"),o=n==="1d"?Wt:Ut,l=n==="1d"?ie:ne,a=t.filter(h=>(h.timeframe||"").trim()===n);a=vl(a,r),o==="favorite"&&(a=a.filter(h=>h.is_favorite)),a.sort(Ce(o==="favorite"?"time":o,l));let c=n==="1d"?tn:en,u=a.slice(0,c);i.innerHTML=u.map(De).join("")+bl(u.length,a.length,n),xe(i)}function gs(){if(Te!==null&&(window.clearTimeout(Te),Te=null),Yi){try{Yi.abort()}catch{}Yi=null}if(ps){try{ps.remove()}catch{}ps=null}si&&(si.remove(),si=null),Xi=null}async function Uf(n,t){if(Xi===n&&si)return;gs(),Xi=n;let e=document.createElement("div");e.className="mini-chart-overlay",e.style.cssText=`
        position: fixed;
        width: 500px;
        height: 300px;
        background: #0d1117;
        border: 1px solid #30363d;
        border-radius: 6px;
        z-index: 1000;
        pointer-events: none;
        overflow: hidden;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.4);
    `;let i=500,s=300,r=8,o=t.right+r,l=t.top;o+i>window.innerWidth&&(o=t.left-i-r),o<0&&(o=r),l+s>window.innerHeight&&(l=window.innerHeight-s-r),l<0&&(l=r),e.style.left=`${o}px`,e.style.top=`${l}px`,document.body.appendChild(e),si=e;let a,c=Uc.get(n);if(c)a=c;else{let d=new AbortController;Yi=d;try{let f=await fetch(`/api/chart/mini-bars?ticker=${encodeURIComponent(n)}`,{signal:d.signal});if(!f.ok)throw new Error(`HTTP ${f.status}`);let p=await f.json();a=Array.isArray(p?.bars)?p.bars:[],a.length>0&&Uc.set(n,a)}catch{Xi===n&&gs();return}Yi=null}if(Xi!==n||!si)return;if(a.length===0){gs();return}let u=Ge(e,{width:500,height:300,layout:{background:{color:"#0d1117"},textColor:"#d1d4dc",fontFamily:"'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",attributionLogo:!1},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},rightPriceScale:{visible:!1},timeScale:{visible:!1},handleScroll:!1,handleScale:!1,crosshair:{vertLine:{visible:!1},horzLine:{visible:!1}}});ps=u,u.addCandlestickSeries({upColor:"#26a69a",downColor:"#ef5350",borderVisible:!1,wickUpColor:"#26a69a",wickDownColor:"#ef5350",priceLineVisible:!1,lastValueVisible:!1}).setData(a),u.timeScale().fitContent()}function Kc(n){let e=n.target.closest(".fav-icon");if(!e)return;n.stopPropagation();let i=e.dataset.id,s="DataAPI";if(!i)return;let r=document.querySelectorAll(`.fav-icon[data-id="${i}"][data-source="${s}"]`),o=e.classList.contains("filled");r.forEach(l=>{let a=l.querySelector(".check-mark");o?(l.classList.remove("filled"),a&&(a.style.visibility="hidden",a.style.opacity="0")):(l.classList.add("filled"),a&&(a.style.visibility="visible",a.style.opacity="1"))}),$c(Number(i)).then(l=>{let a=Ye(),c=a.findIndex(u=>u.id===l.id);c!==-1&&(a[c].is_favorite=l.is_favorite,Pc(a)),r.forEach(u=>{let h=u.querySelector(".check-mark");l.is_favorite?(u.classList.add("filled"),h&&(h.style.visibility="visible",h.style.opacity="1")):(u.classList.remove("filled"),h&&(h.style.visibility="hidden",h.style.opacity="0"))})}).catch(()=>{r.forEach(l=>{let a=l.querySelector(".check-mark");o?(l.classList.add("filled"),a&&(a.style.visibility="visible",a.style.opacity="1")):(l.classList.remove("filled"),a&&(a.style.visibility="hidden",a.style.opacity="0"))})})}function mu(){let n=document.getElementById("view-divergence");if(!n)return;n.addEventListener("click",Kc);let t=document.getElementById("ticker-view");t&&t.addEventListener("click",Kc),n.addEventListener("click",e=>{let i=e.target;if(i.closest(".fav-icon"))return;let s=i.closest(".alert-card");if(s){let r=s.dataset.ticker;if(r&&window.showTickerView){let o=null;s.closest("#divergence-daily-container")?o="daily":s.closest("#divergence-weekly-container")&&(o="weekly"),window.showTickerView(r,"divergence",o)}}}),document.querySelectorAll("#view-divergence .divergence-daily-sort .tf-btn").forEach(e=>{e.addEventListener("click",()=>{let i=e.dataset.sort;jf(i)})}),document.querySelectorAll("#view-divergence .divergence-weekly-sort .tf-btn").forEach(e=>{e.addEventListener("click",()=>{let i=e.dataset.sort;Kf(i)})}),n.addEventListener("mouseenter",e=>{let s=e.target.closest(".alert-card");if(!s)return;let r=s.dataset.ticker;r&&(Te!==null&&window.clearTimeout(Te),Te=window.setTimeout(()=>{Te=null;let o=s.getBoundingClientRect();Uf(r,o)},2e3))},!0),n.addEventListener("mouseleave",e=>{e.target.closest(".alert-card")&&gs()},!0),n.addEventListener("click",e=>{let i=e.target.closest(".show-more-btn");if(!i)return;let s=i.dataset.timeframe;s&&(s==="1d"?(tn+=jt,se("1d")):(en+=jt,se("1w")))})}function jf(n){n===Wt&&n!=="favorite"?ie=ie==="desc"?"asc":"desc":(Wt=n,ie="desc"),tn=jt,ee("#view-divergence .divergence-daily-sort",Wt,ie),se("1d")}function Kf(n){n===Ut&&n!=="favorite"?ne=ne==="desc"?"asc":"desc":(Ut=n,ne="desc"),en=jt,ee("#view-divergence .divergence-weekly-sort",Ut,ne),se("1w")}function pu(){Wt="score",ie="desc",Ut="score",ne="desc",Es="1",ks="1",ee("#view-divergence .divergence-daily-sort",Wt,ie),ee("#view-divergence .divergence-weekly-sort",Ut,ne)}function Ps(n,t,e=!0){if(n==="daily"?Es=t:ks=t,document.querySelectorAll(`.column-tf-controls[data-column="${n}"]`).forEach(i=>{i.querySelectorAll(".tf-btn[data-tf]").forEach(s=>{let r=s;r.classList.toggle("active",r.dataset.tf===t)})}),e){let i=n==="daily"?"1d":"1w";ci(i).then(()=>se(i))}}var ui="score",hi="score",on="desc",ln="desc";function yl(n){n===ui&&n!=="favorite"?on=on==="desc"?"asc":"desc":(ui=n,on="desc"),ee(".ticker-daily-sort",ui,on);let t=document.getElementById("ticker-view");if(!t)return;let e=t.dataset.ticker;e&&Is(e,{refreshCharts:!1})}function Sl(n){n===hi&&n!=="favorite"?ln=ln==="desc"?"asc":"desc":(hi=n,ln="desc"),ee(".ticker-weekly-sort",hi,ln);let t=document.getElementById("ticker-view");if(!t)return;let e=t.dataset.ticker;e&&Is(e,{refreshCharts:!1})}function Is(n,t={}){let e=t.refreshCharts!==!1,i=[...Rc(),...Ye()];Je(i);let s=i.filter(u=>u.ticker===n),r=s.filter(u=>(u.timeframe||"").trim()==="1d"),o=s.filter(u=>(u.timeframe||"").trim()==="1w"),l=(u,h)=>h==="1"?Le(u,1):h==="2"?Le(u,2):h==="5"?Le(u,5):u;r=l(r,nn("daily")),o=l(o,nn("weekly")),ui==="favorite"&&(r=r.filter(u=>u.is_favorite)),hi==="favorite"&&(o=o.filter(u=>u.is_favorite)),r.sort(Ce(ui==="favorite"?"time":ui,on)),o.sort(Ce(hi==="favorite"?"time":hi,ln));let a=document.getElementById("ticker-daily-container");a&&(a.innerHTML=r.map(De).join(""),r.length>0&&xe(a));let c=document.getElementById("ticker-weekly-container");c&&(c.innerHTML=o.map(De).join(""),o.length>0&&xe(c)),e&&At(n)}var As=null,bu=5,wl="SVIX";async function Gf(n,t){let e=await fetch(`/api/breadth?ticker=${n}&days=${t}`);if(!e.ok)throw new Error("Failed to fetch breadth data");return e.json()}function vu(n){if(n.length===0)return[];let t=n[0];return t===0?n.map(()=>100):n.map(e=>e/t*100)}function Zf(n,t,e){let i=document.getElementById("breadth-chart");if(!i)return;let s=Y();As&&(As.destroy(),As=null);let r=e?new Set(n.map(h=>new Date(h.date).toLocaleDateString("en-US",{timeZone:s}))).size:0,o=n.map(h=>{if(e){let f=new Date(h.date);return r>1?f.toLocaleDateString("en-US",{month:"numeric",day:"numeric",timeZone:s}):f.toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZone:s})}return new Date(h.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric",timeZone:s})}),l=n.map(h=>h.spy),a=n.map(h=>h.comparison),c=vu(l),u=vu(a);As=new Chart(i,{type:"line",data:{labels:o,datasets:[{label:"SPY",data:c,borderColor:"#58a6ff",backgroundColor:"transparent",borderWidth:2.5,pointRadius:c.length>15?0:3,pointHoverRadius:5,tension:.3,order:1,fill:!1},{label:t,data:u,borderColor:"#d2a8ff",backgroundColor:"transparent",borderWidth:2.5,pointRadius:u.length>15?0:3,pointHoverRadius:5,tension:.3,order:2,fill:{target:0,above:"rgba(63, 185, 80, 0.18)",below:"rgba(248, 81, 73, 0.18)"}}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{labels:{color:"#c9d1d9",font:{size:12},usePointStyle:!0,pointStyle:"line"}},tooltip:{backgroundColor:"rgba(22, 27, 34, 0.95)",borderColor:"#30363d",borderWidth:1,titleColor:"#c9d1d9",bodyColor:"#8b949e",padding:12,callbacks:{label:function(h){let d=h.parsed.y.toFixed(2);return`${h.dataset.label}: ${d}`}}},filler:{propagate:!0}},scales:{x:{ticks:{color:"#8b949e",maxRotation:0,autoSkip:!0,maxTicksLimit:10,font:{size:11}},grid:{color:"rgba(48, 54, 61, 0.3)"}},y:{ticks:{color:"#8b949e",font:{size:11},callback:function(h){return h.toFixed(1)}},grid:{color:"rgba(48, 54, 61, 0.3)"}}}}})}async function Ml(){let n=document.getElementById("breadth-error");n&&(n.style.display="none");try{let t=await Gf(wl,bu);if(t.points.length===0){n&&(n.textContent="No data available for this timeframe",n.style.display="block");return}Zf(t.points,wl,t.intraday)}catch(t){console.error("Breadth load error:",t),n&&(n.textContent="Failed to load breadth data",n.style.display="block")}}function yu(n){bu=n,document.querySelectorAll("#breadth-tf-btns .tf-btn").forEach(t=>{t.classList.toggle("active",Number(t.dataset.days)===n)}),Ml()}function Su(n){wl=n,document.querySelectorAll("#breadth-metric-btns .tf-btn").forEach(t=>{t.classList.toggle("active",t.dataset.metric===n)}),Ml()}function xl(){Ml()}var an=null,Cl=!1;function wt(n){return String(n??"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function Q(n,t=0){let e=Number(n);return Number.isFinite(e)?e.toFixed(Math.max(0,t)):"--"}function wu(n){let t=String(n||"").trim();return t||"idle"}function Xf(n){let t=String(n||"").trim();if(!t)return"--";let e=new Date(t);return Number.isNaN(e.getTime())?"--":e.toLocaleString()}function Dl(n,t,e){let i=wu(t?.status||e?.status||(e?.running?"running":"idle")),s=Number(t?.tickers?.processed??e?.processed_tickers??0),r=Number(t?.tickers?.total??e?.total_tickers??0),o=Number(t?.tickers?.errors??0),l=Q(t?.api?.p95LatencyMs,1),a=Q(t?.api?.avgLatencyMs,1),c=Q(t?.api?.calls,0),u=Q(t?.api?.failures,0),h=Q(t?.api?.rateLimited,0),d=Q(t?.db?.flushCount,0),f=Q(t?.db?.summaryRows,0),p=Q(t?.db?.signalRows,0),m=Q(t?.durationSeconds,1),g=wt(t?.phase||"--"),v=Array.isArray(t?.failedTickers)?t.failedTickers:[],b=Array.isArray(t?.retryRecovered)?t.retryRecovered:[],w=v.length,S=b.length,x="";if(w>0||S>0){let A=v.map(B=>`<span class="log-failed-ticker">${wt(B)}</span>`).join(""),N=b.map(B=>`<span class="log-recovered-ticker">${wt(B)}</span>`).join("");x=`
          <details class="log-failed-details">
            <summary class="log-failed-summary">
              ${w>0?`${w} failed`:""}${w>0&&S>0?", ":""}${S>0?`${S} recovered via retry`:""}
            </summary>
            <div class="log-failed-body">
              ${w>0?`<div class="log-failed-label">Failed:</div><div class="log-failed-list">${A}</div>`:""}
              ${S>0?`<div class="log-recovered-label">Recovered:</div><div class="log-failed-list">${N}</div>`:""}
            </div>
          </details>
        `}return`
      <article class="log-run-card">
        <div class="log-run-card-title">
          <span>${wt(n)}</span>
          <span class="log-run-card-status">${wt(i)}</span>
        </div>
        <div class="log-run-metrics">
          <span class="log-metric-key">Tickers</span><span class="log-metric-val">${s}/${r||0}</span>
          <span class="log-metric-key">Errors</span><span class="log-metric-val">${o}</span>
          <span class="log-metric-key">API calls</span><span class="log-metric-val">${c}</span>
          <span class="log-metric-key">API fail</span><span class="log-metric-val">${u}</span>
          <span class="log-metric-key">429 count</span><span class="log-metric-val">${h}</span>
          <span class="log-metric-key">API p95 ms</span><span class="log-metric-val">${l}</span>
          <span class="log-metric-key">API avg ms</span><span class="log-metric-val">${a}</span>
          <span class="log-metric-key">DB flushes</span><span class="log-metric-val">${d}</span>
          <span class="log-metric-key">Summary rows</span><span class="log-metric-val">${f}</span>
          <span class="log-metric-key">Signal rows</span><span class="log-metric-val">${p}</span>
          <span class="log-metric-key">Duration s</span><span class="log-metric-val">${m}</span>
          <span class="log-metric-key">Phase</span><span class="log-metric-val">${g}</span>
        </div>
        ${x}
      </article>
    `}function Jf(n){let t=n.config||{},e=wt(t.divergenceSourceInterval||"--"),i=Q(t.divergenceLookbackDays,0),s=Q(t.divergenceConcurrencyConfigured,0),r=Q(t.divergenceFlushSize,0),o=Q(t.dataApiMaxRequestsPerSecond,0),l=Q(t.dataApiRateBucketCapacity,0),a=Q(t.dataApiTimeoutMs,0),c=n.schedulerEnabled?"on":"off";return`
      <article class="log-run-card">
        <div class="log-run-card-title">
          <span>Runtime Config</span>
          <span class="log-run-card-status">${wt(c)}</span>
        </div>
        <div class="log-run-metrics">
          <span class="log-metric-key">Source</span><span class="log-metric-val">${e}</span>
          <span class="log-metric-key">Lookback d</span><span class="log-metric-val">${i}</span>
          <span class="log-metric-key">Concurrency</span><span class="log-metric-val">${s}</span>
          <span class="log-metric-key">Flush size</span><span class="log-metric-val">${r}</span>
          <span class="log-metric-key">API max rps</span><span class="log-metric-val">${o}</span>
          <span class="log-metric-key">Bucket cap</span><span class="log-metric-val">${l}</span>
          <span class="log-metric-key">Timeout ms</span><span class="log-metric-val">${a}</span>
        </div>
      </article>
    `}function Yf(n){let t=document.getElementById("logs-run-cards");if(!t)return;let e=[Dl("Fetch Daily",n.runs?.fetchDaily,n.statuses?.fetchDaily),Dl("Fetch Weekly",n.runs?.fetchWeekly,n.statuses?.fetchWeekly),Dl("VDF Scan",n.runs?.vdfScan,n.statuses?.vdfScan),Jf(n)];t.innerHTML=e.join("")}function Qf(n){let t=document.getElementById("logs-history-container");if(!t)return;let e=Array.isArray(n.history)?n.history:[];if(e.length===0){t.innerHTML='<div class="loading">No run history yet</div>';return}t.innerHTML=e.slice(0,15).map(i=>{let s=Number(i?.tickers?.processed||0),r=Number(i?.tickers?.total||0),o=Number(i?.tickers?.errors||0),l=Number(i?.api?.calls||0),a=Q(i?.api?.p95LatencyMs,1),c=Array.isArray(i?.failedTickers)?i.failedTickers:[],u=Array.isArray(i?.retryRecovered)?i.retryRecovered:[],h=c.length,d=u.length,f="";if(h>0||d>0){let p=c.map(g=>`<span class="log-failed-ticker">${wt(g)}</span>`).join(""),m=u.map(g=>`<span class="log-recovered-ticker">${wt(g)}</span>`).join("");f=`
              <details class="log-failed-details">
                <summary class="log-failed-summary">
                  ${h>0?`${h} failed`:""}${h>0&&d>0?", ":""}${d>0?`${d} recovered`:""}
                </summary>
                <div class="log-failed-body">
                  ${h>0?`<div class="log-failed-label">Failed:</div><div class="log-failed-list">${p}</div>`:""}
                  ${d>0?`<div class="log-recovered-label">Recovered:</div><div class="log-failed-list">${m}</div>`:""}
                </div>
              </details>
            `}return`
          <article class="log-history-entry">
            <div class="log-history-header">
              <span>${wt(String(i?.runType||"run"))}</span>
              <span>${wt(wu(i?.status))}</span>
            </div>
            <div class="log-history-sub">
              ${wt(Xf(i?.startedAt))} |
              tickers ${s}/${r}${o>0?` (${o} err)`:""} |
              api ${l} |
              p95 ${a}ms
            </div>
            ${f}
          </article>
        `}).join("")}async function tm(){let n=await fetch("/api/logs/run-metrics",{cache:"no-store"});if(!n.ok)throw new Error(`Failed to fetch run metrics (HTTP ${n.status})`);return n.json()}async function cn(){if(!Cl){Cl=!0;try{let n=await tm();Yf(n),Qf(n)}catch(n){let t=document.getElementById("logs-history-container");t&&(t.innerHTML='<div class="loading">Failed to load logs</div>'),console.error("Failed to refresh logs view:",n)}finally{Cl=!1}}}function Mu(){an===null&&(an=window.setInterval(()=>{cn().catch(()=>{})},5e3))}function xu(){an!==null&&(window.clearInterval(an),an=null)}function Cu(){document.getElementById("logs-refresh-btn")?.addEventListener("click",()=>{cn().catch(()=>{})})}var hn="divergence",Lu=0,Eu="divergence",ku=null,Du=!1,Tu=8;window.setTickerDailySort=yl;window.setTickerWeeklySort=Sl;function Tl(){return ku}function Ll(){return Eu}window.showTickerView=function(n,t="divergence",e=null){Eu=t,ku=e,Lu=window.scrollY,hn!=="divergence"&&Ns("divergence"),Ru("divergence");let i=document.getElementById("ticker-view");i&&($s(),i.dataset.ticker=n,document.getElementById("dashboard-view")?.classList.add("hidden"),document.getElementById("view-divergence")?.classList.add("hidden"),i.classList.remove("hidden"),Is(n),window.scrollTo(0,0))};window.showOverview=function(){$s();let n=document.getElementById("ticker-view");n&&delete n.dataset.ticker,Ns("divergence"),window.scrollTo(0,Lu)};function Ns(n){hn=n,Ru(n),document.getElementById("view-logs")?.classList.add("hidden"),document.getElementById("view-divergence")?.classList.add("hidden"),document.getElementById("view-breadth")?.classList.add("hidden"),document.getElementById("ticker-view")?.classList.add("hidden"),$s(),xu(),_u(),n==="logs"?(document.getElementById("view-logs")?.classList.remove("hidden"),cn().catch(()=>{}),Mu()):n==="divergence"?(document.getElementById("view-divergence")?.classList.remove("hidden"),sn(!0).then(rn),ke()):n==="breadth"&&(document.getElementById("view-breadth")?.classList.remove("hidden"),xl())}function _u(){document.getElementById("header-nav-dropdown")?.classList.add("hidden"),document.getElementById("header-nav-dropdown")?.classList.remove("open")}function Ru(n){document.querySelectorAll(".header-nav-item").forEach(t=>t.classList.remove("active")),document.querySelector(`.header-nav-item[data-view="${n}"]`)?.classList.add("active")}function em(){let n=document.getElementById("search-toggle"),t=document.getElementById("search-input"),e=document.getElementById("search-container");!n||!t||!e||(n.addEventListener("click",i=>{i.stopPropagation(),t.classList.contains("active")?(t.classList.remove("active"),t.blur()):(t.classList.add("active"),t.focus())}),e.addEventListener("click",()=>{t.classList.contains("active")||(t.classList.add("active"),t.focus())}),t.addEventListener("keydown",i=>{if(i.key==="Enter"){let s=t.value.trim().toUpperCase();s&&(window.showTickerView(s),t.value="",t.blur(),t.classList.remove("active"))}}),document.addEventListener("keydown",i=>{document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement.isContentEditable||i.ctrlKey||i.altKey||i.metaKey||i.key.length>1||/^[a-zA-Z0-9]$/.test(i.key)&&(t.classList.contains("active")||t.classList.add("active"),t.focus())}))}async function im(){if(hn==="divergence"){await sn(!0),rn();return}if(hn==="breadth"){xl();return}hn==="logs"&&await cn()}function nm(){let n=document.getElementById("global-settings-container"),t=document.getElementById("global-settings-toggle"),e=document.getElementById("global-settings-panel"),i=document.getElementById("global-timezone-select");if(!n||!t||!e)return;let s=()=>{e.querySelectorAll(".global-settings-toggle-row").forEach(d=>d.remove());let u=e.querySelector("#global-enable-v3-fetch, #enable-v3-fetch");u&&(u.closest(".global-settings-row")||u).remove(),e.querySelectorAll("label, span, div").forEach(d=>{String(d.textContent||"").trim().toLowerCase()==="enable v3 fetch"&&(d.closest(".global-settings-row")||d).remove()})},r=()=>{if(i)return i;let u=document.createElement("div");u.className="global-settings-row global-settings-timezone-row";let h=document.createElement("label");h.className="global-settings-label",h.htmlFor="global-timezone-select",h.textContent="Timezone";let d=document.createElement("select");return d.id="global-timezone-select",d.className="glass-input global-settings-select",d.setAttribute("aria-label","Timezone"),u.append(h,d),e.append(u),i=d,d};s(),i=r();let o=i,l=()=>{e.classList.add("hidden"),t.classList.remove("active")},a=()=>{e.classList.remove("hidden"),t.classList.add("active"),o.value=Y()},c=Sc();o.innerHTML=c.map(u=>`<option value="${u.value}">${u.label}</option>`).join(""),o.value=Y(),o.addEventListener("change",()=>{wc(o.value)}),Mc(u=>{o.value=u,im().catch(h=>{console.error("Failed to refresh UI after timezone change:",h)})}),t.addEventListener("click",u=>{u.stopPropagation(),e.classList.contains("hidden")?(a(),ke().catch(()=>{})):l()}),e.addEventListener("click",u=>{u.stopPropagation()}),document.addEventListener("click",u=>{let h=u.target;h&&(h.closest("#global-settings-container")||l())})}async function sm(){try{return(await fetch("/api/auth/check")).ok}catch{return!1}}async function rm(n){try{return(await fetch("/api/auth/verify",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({passcode:n})})).ok}catch{return!1}}async function om(n){let t=document.getElementById("site-lock-overlay");if(!t){n();return}t.dataset.doubleTapBound||(t.addEventListener("dblclick",b=>{b.preventDefault()}),t.dataset.doubleTapBound="1");let e=t.querySelector(".site-lock-panel"),i=document.getElementById("site-lock-status"),s=Array.from(t.querySelectorAll(".site-lock-dot")),r=Array.from(t.querySelectorAll("[data-lock-digit]")),o=Array.from(t.querySelectorAll("[data-lock-action]"));if(await sm()){t.classList.add("hidden"),document.body.classList.remove("site-locked"),n();return}document.body.classList.add("site-locked"),t.classList.remove("hidden");let l="",a=!1,c=()=>{for(let b=0;b<s.length;b++)s[b].classList.toggle("filled",b<l.length)},u=b=>{i&&(i.textContent=b)},h=()=>{l="",c()},d=()=>{t.classList.add("hidden"),document.body.classList.remove("site-locked"),window.removeEventListener("keydown",v,!0),n()},f=()=>{u(""),h(),e&&(e.classList.remove("shake"),e.offsetWidth,e.classList.add("shake")),window.setTimeout(()=>{e&&e.classList.remove("shake")},320)},p=async()=>{if(l.length<Tu||a)return;a=!0;let w=await rm(l);a=!1,w?d():f()},m=b=>{/^[0-9]$/.test(b)&&(l.length>=Tu||(l+=b,u(""),c(),p()))},g=()=>{l.length&&(l=l.slice(0,-1),u(""),c())};r.forEach(b=>{b.addEventListener("click",()=>{m(String(b.dataset.lockDigit||""))})}),o.forEach(b=>{b.addEventListener("click",()=>{let w=String(b.dataset.lockAction||"");if(w==="clear"){h(),u("");return}w==="back"&&g()})});let v=b=>{if(t.classList.contains("hidden"))return;let w=b.key;if(/^[0-9]$/.test(w)){b.preventDefault(),m(w);return}if(w==="Backspace"){b.preventDefault(),g();return}w==="Escape"&&(b.preventDefault(),h(),u(""))};window.addEventListener("keydown",v,!0),c()}function lm(){let n=document.getElementById("header-nav-toggle"),t=document.getElementById("header-nav-dropdown");!n||!t||(n.addEventListener("click",e=>{e.stopPropagation(),un(),t.classList.contains("open")?(t.classList.remove("open"),setTimeout(()=>t.classList.add("hidden"),150)):(t.classList.remove("hidden"),requestAnimationFrame(()=>t.classList.add("open")))}),t.addEventListener("click",e=>{let i=e.target.closest(".header-nav-item");if(!i)return;let s=i.dataset.view;s&&(Ns(s),t.classList.remove("open"),setTimeout(()=>t.classList.add("hidden"),150))}))}function am(){document.addEventListener("click",n=>{let t=n.target,e=t.closest(".column-tf-controls .tf-btn[data-tf]");if(e){let s=e.closest(".column-tf-controls");if(!s)return;let r=s.dataset.column,o=e.dataset.tf;if(!r||!o)return;if(o==="custom"){let l=s.querySelector(".column-tf-custom-panel");if(l){let a=!l.classList.contains("hidden");un(),a||(l.classList.remove("hidden"),requestAnimationFrame(()=>l.classList.add("open")))}Ps(r,o,!1);return}un(),Ps(r,o);return}let i=t.closest(".column-tf-apply");if(i){let s=i.closest(".column-tf-controls");if(!s)return;let r=s.dataset.column,o=s.querySelector(".column-tf-from"),l=s.querySelector(".column-tf-to");r&&o?.value&&l?.value&&(Jc(r,o.value,l.value),Ps(r,"custom")),un();return}t.closest(".column-tf-custom-panel")||t.closest(".column-tf-controls")||un()})}function un(){document.querySelectorAll(".column-tf-custom-panel").forEach(n=>{n.classList.remove("open"),n.classList.add("hidden")})}function cm(){Du||(Du=!0,document.getElementById("ticker-back-btn")?.addEventListener("click",window.showOverview),document.getElementById("divergence-fetch-daily-btn")?.addEventListener("click",()=>{au()}),document.getElementById("divergence-fetch-daily-stop-btn")?.addEventListener("click",()=>{uu()}),document.getElementById("divergence-fetch-weekly-btn")?.addEventListener("click",()=>{cu()}),document.getElementById("divergence-fetch-weekly-stop-btn")?.addEventListener("click",()=>{hu()}),document.getElementById("divergence-vdf-scan-btn")?.addEventListener("click",()=>{du()}),document.getElementById("divergence-vdf-scan-stop-btn")?.addEventListener("click",()=>{fu()}),document.querySelectorAll(".ticker-daily-sort .tf-btn").forEach(n=>{n.addEventListener("click",()=>{let t=n.dataset.sort;yl(t)})}),document.querySelectorAll(".ticker-weekly-sort .tf-btn").forEach(n=>{n.addEventListener("click",()=>{let t=n.dataset.sort;Sl(t)})}),document.querySelectorAll("#breadth-tf-btns .tf-btn").forEach(n=>{n.addEventListener("click",()=>{let t=Number(n.dataset.days);yu(t)})}),document.querySelectorAll("#breadth-metric-btns .tf-btn").forEach(n=>{n.addEventListener("click",()=>{let t=n.dataset.metric;Su(t);let e=document.getElementById("breadth-subtitle");e&&(e.textContent=`SPY vs ${t} \u2014 Normalized`)})}),lm(),am(),document.addEventListener("click",n=>{let t=n.target;t&&(t.closest("#header-nav-container")||_u())}),pu(),ke().catch(()=>{}),Ns("divergence"),nm(),em(),Cu(),mu(),um(),Pu())}document.addEventListener("DOMContentLoaded",()=>{om(()=>{cm()})});function um(){((t,e)=>{t&&t.addEventListener("click",i=>{if(window.innerWidth>768)return;let s=i.target;if(!s)return;let r=s.closest("h2");if(!r||!(r.closest(".column-header")||r.closest(".header-title-group")))return;let l=r.closest(".column");l&&l.closest(e)&&l.classList.toggle("collapsed")})})(document.getElementById("view-divergence"),"#divergence-dashboard-view")}var R=null,gt="1day",E=null,ct=null,Pl=null,T=null,P=null,ht=null,Il=null,Al=null,X=null,he=null,Nl=null,V=[],yi=new Map,bn=null,pn=[],Js=[],Ys=[],Ks=new Set,gn=null,Xt=!1,Tt=!1,bi=!1,di=null,$l=!1,qs=0,j=null,Pe=null,wn=new Map,Ie=new Map,Li=new Map,Ae=new Map,Tn=new Map,Mn=new Map,M=[],Qs=[],tr=null,er=null,ir=null,nr=null,K=null,G=null,Z=null,tt=null,q=null,Lt=!1,Et=!1,Si=!1,wi=!1,Mi=null,xi=null,Vl=null,Fl=null,Ju=null,Yu=null,Iu=!1,Kt=null,Gs=null,sr=!1,dn=null,yn=null,Zs=!1,ut=new Map,Au=!1,El=null,kl=null,_e=new Map,W=null,Vs=null,le=new Map,H=null,Gt=null,hm=200,Qu="\u270E",dm="\u232B",th="D",fm=120,mm=900*1e3,pm=900*1e3,gm=16,eh="custom_chart_session_cache_v1",vm=6,bm=9e5,Ln=10,ym=252,Mt=4,Ci=56,Sm="Invalid symbol",ih="#21262d",wm="\u2699",nh="custom_chart_settings_v1",Ht=typeof window<"u"&&(window.matchMedia("(max-width: 768px)").matches||"ontouchstart"in window||navigator.maxTouchPoints>0),sh="custom_chart_trendlines_v1",_l="top-pane-ticker-label",Ol="top-pane-badge",Nu=38,rh=6,Wl=8,ur=8,rt=24,rr=6,Mm="#2962FF",xm=50,Cm=50,Dm=20,Tm=80,oh=0,lh=100,Lm=2e3,Em="#ff6b6b",km="#ffa500",ah="#089981",ch="#f23645",uh=[{value:"1min",label:"1 min"},{value:"5min",label:"5 min"},{value:"15min",label:"15 min"},{value:"30min",label:"30 min"},{value:"1hour",label:"1 hour"},{value:"4hour",label:"4 hour"}],hh=180,_m={"5min":[],"15min":[],"30min":[],"1hour":[],"4hour":["1day"],"1day":["4hour","1week"],"1week":["1day"]},vn={length:14,lineColor:"#58a6ff",midlineColor:"#ffffff",midlineStyle:"dotted"},mi={length:14,lineColor:Mm,midlineColor:"#ffffff",midlineStyle:"dotted",sourceInterval:"1min"},Dt={sourceInterval:"1min",divergenceTable:!0,divergentPriceBars:!0,bullishDivergentColor:"#26a69a",bearishDivergentColor:"#ef5350",neutralDivergentColor:"#8b949e"},ae={maSourceMode:"daily",verticalGridlines:!1,horizontalGridlines:!1,ma:[{enabled:!0,type:"EMA",length:8,color:"#ffa500"},{enabled:!0,type:"EMA",length:21,color:"#8a2be2"},{enabled:!0,type:"SMA",length:50,color:"#00bcd4"},{enabled:!1,type:"SMA",length:200,color:"#90ee90"}]},Nt=["vd-chart-container","price-chart-container","rsi-chart-container","vd-rsi-chart-container"],vt=[...Nt],fn=null,Ul=120,jl=600,Rm={"vd-chart-container":240,"price-chart-container":400,"rsi-chart-container":400,"vd-rsi-chart-container":400},xn={},$u=!1,qt=!1,k={...vn},D={...mi},C={...Dt},L={maSourceMode:ae.maSourceMode,verticalGridlines:ae.verticalGridlines,horizontalGridlines:ae.horizontalGridlines,ma:ae.ma.map(n=>({...n,series:null,values:[]}))};function Fs(n,t){let e=t==="price"?tr:t==="volumeDeltaRsi"?er:t==="volumeDelta"?ir:nr;if(e&&e.parentElement===n)return e;let i=document.createElement("div"),s=t==="price"?"month-grid-overlay-price":t==="volumeDeltaRsi"?"month-grid-overlay-volume-delta-rsi":t==="volumeDelta"?"month-grid-overlay-volume-delta":"month-grid-overlay-rsi";return i.className=`month-grid-overlay ${s}`,i.style.position="absolute",i.style.top="0",i.style.right="0",i.style.bottom="0",i.style.left="0",i.style.pointerEvents="none",i.style.zIndex="6",n.appendChild(i),t==="price"?tr=i:t==="volumeDeltaRsi"?er=i:t==="volumeDelta"?ir=i:nr=i,i}function Zt(n){if(typeof n=="number"&&Number.isFinite(n))return n;if(typeof n=="string"&&n.trim()){let t=Date.parse(n.includes("T")?n:`${n.replace(" ","T")}Z`);if(Number.isFinite(t))return Math.floor(t/1e3)}return null}function Pm(n){if(typeof n=="number"&&Number.isFinite(n))return new Date(n*1e3);if(typeof n=="string"&&n.trim()){let t=new Date(n.includes("T")?n:`${n.replace(" ","T")}Z`);return Number.isFinite(t.getTime())?t:null}return n&&typeof n=="object"&&Number.isFinite(n.year)&&Number.isFinite(n.month)&&Number.isFinite(n.day)?new Date(Date.UTC(Number(n.year),Number(n.month)-1,Number(n.day),0,0,0)):null}function Kl(n,t){let e=Pm(n);if(!e)return"";let i=Y();return t===0?e.toLocaleDateString("en-US",{year:"numeric",timeZone:i}):t===1?e.toLocaleDateString("en-US",{month:"short",timeZone:i}):e.toLocaleDateString("en-US",{day:"numeric",timeZone:i})}function Im(n){let t=we("en-US",{year:"numeric",month:"2-digit"}).formatToParts(new Date(n*1e3)),e=t.find(s=>s.type==="year")?.value||"",i=t.find(s=>s.type==="month")?.value||"";return`${e}-${i}`}function Am(n){let t=[],e="";for(let i of n){let s=Zt(i?.time);if(s===null)continue;let r=Im(s);r!==e&&(t.push(s),e=r)}return t}function Vu(n){return we("en-CA",{year:"numeric",month:"2-digit",day:"2-digit"}).format(new Date(n*1e3))}function Nm(n){if(!Array.isArray(n)||n.length===0)return[];let t=Zt(n[n.length-1]?.time);if(!Number.isFinite(t))return[];let e=[{time:Number(t)}],i=Number(t),s=0;for(;s<ym;){i+=86400;let r=new Date(i*1e3).getUTCDay();r===0||r===6||(e.push({time:i}),s+=1)}return e}function dh(n){let t=Nm(n);Pl&&Pl.setData(t),Il&&Il.setData(t),Nl&&Nl.setData(t)}function $m(n,t){if(!Array.isArray(n)||n.length===0)return[];if(n.length===1)return[50];let e=Math.max(1,Math.floor(t||14)),i=new Array(n.length).fill(50),s=[],r=[],o=0,l=0;for(let a=1;a<n.length;a++){let c=n[a]-n[a-1],u=c>0?c:0,h=c<0?Math.abs(c):0;if(s.push(u),r.push(h),a<e){let p=a,m=0,g=0;for(let v=0;v<p;v++)m+=s[v],g+=r[v];o=m/p,l=g/p}else if(a===e){let p=0,m=0;for(let g=a-e;g<a;g++)p+=s[g],m+=r[g];o=p/e,l=m/e}else o=(o*(e-1)+u)/e,l=(l*(e-1)+h)/e;let f=100-100/(1+(l===0?100:o/l));i[a]=Number.isFinite(f)?f:i[a-1]}return i[0]=i[1]??50,i}function fh(n,t){if(!n||n.length===0)return[];let e=n.map(r=>Number(r.close)),i=$m(e,t),s=[];for(let r=0;r<n.length;r++){let o=i[r];Number.isFinite(o)&&s.push({time:n[r].time,value:Math.round(o*100)/100})}return s}function mh(n){return Array.isArray(n)?n.filter(t=>t&&(typeof t.time=="string"||typeof t.time=="number")&&Number.isFinite(Number(t.value))).map(t=>({time:t.time,value:Number(t.value)})):[]}function ql(n,t){return[String(n||"").trim().toUpperCase(),t,String(D.length),C.sourceInterval,D.sourceInterval].join("|")}function Vm(n){if(!n||typeof n!="object")return!1;let t=n;return!(!Array.isArray(t.bars)||t.bars.length===0)}function Gl(){for(;ut.size>gm;){let n=ut.keys().next().value;if(!n)break;ut.delete(n)}}function ph(){if(!Au&&(Au=!0,!(typeof window>"u")))try{let n=window.sessionStorage.getItem(eh);if(!n)return;let t=JSON.parse(n);if(!t||t.version!==1||!Array.isArray(t.entries))return;let e=[...t.entries].filter(i=>i&&typeof i.key=="string"&&Number.isFinite(i.updatedAt)&&Vm(i.data)).sort((i,s)=>Number(i.updatedAt)-Number(s.updatedAt));for(let i of e)ut.set(i.key,{data:i.data,updatedAt:Number(i.updatedAt)});Gl()}catch{}}function gh(){typeof window>"u"||El===null&&(El=window.setTimeout(()=>{El=null;try{let n=Array.from(ut.entries()).reverse(),t=[],e=0;for(let[s,r]of n){if(!r||!r.data||!Number.isFinite(r.updatedAt))continue;let o={key:s,updatedAt:r.updatedAt,data:r.data},l=JSON.stringify(o);if(l&&!(e+l.length>bm)&&(t.push(o),e+=l.length,t.length>=vm))break}let i=JSON.stringify({version:1,entries:t});window.sessionStorage.setItem(eh,i)}catch{}},180))}function Fm(){ph();let n=Date.now(),t=!1;for(let[i,s]of ut.entries())(!s||!s.updatedAt||n-s.updatedAt>pm)&&(ut.delete(i),t=!0);let e=ut.size;Gl(),ut.size!==e&&(t=!0),t&&gh()}function Zl(n){Fm();let t=ut.get(n);return t&&(ut.delete(n),ut.set(n,t)),t?t.data:null}function Xl(n,t){ph(),ut.delete(n),ut.set(n,{data:t,updatedAt:Date.now()}),Gl(),gh()}function Fu(n){let t=Array.isArray(n?.bars)?n.bars:[];if(!t.length)return"none";let e=t[t.length-1];return[t.length,I(e.time),Number(e.open),Number(e.high),Number(e.low),Number(e.close),Number(e.volume)].join("|")}var vh={"5min":{fetchMs:[],renderMs:[]},"15min":{fetchMs:[],renderMs:[]},"30min":{fetchMs:[],renderMs:[]},"1hour":{fetchMs:[],renderMs:[]},"4hour":{fetchMs:[],renderMs:[]},"1day":{fetchMs:[],renderMs:[]},"1week":{fetchMs:[],renderMs:[]}},Jl={"5min":{fetchCount:0,renderCount:0,fetchP95Ms:0,renderP95Ms:0,responseCacheHit:0,responseCacheMiss:0,responseCacheUnknown:0},"15min":{fetchCount:0,renderCount:0,fetchP95Ms:0,renderP95Ms:0,responseCacheHit:0,responseCacheMiss:0,responseCacheUnknown:0},"30min":{fetchCount:0,renderCount:0,fetchP95Ms:0,renderP95Ms:0,responseCacheHit:0,responseCacheMiss:0,responseCacheUnknown:0},"1hour":{fetchCount:0,renderCount:0,fetchP95Ms:0,renderP95Ms:0,responseCacheHit:0,responseCacheMiss:0,responseCacheUnknown:0},"4hour":{fetchCount:0,renderCount:0,fetchP95Ms:0,renderP95Ms:0,responseCacheHit:0,responseCacheMiss:0,responseCacheUnknown:0},"1day":{fetchCount:0,renderCount:0,fetchP95Ms:0,renderP95Ms:0,responseCacheHit:0,responseCacheMiss:0,responseCacheUnknown:0},"1week":{fetchCount:0,renderCount:0,fetchP95Ms:0,renderP95Ms:0,responseCacheHit:0,responseCacheMiss:0,responseCacheUnknown:0}};function bh(n){if(!n.length)return 0;let t=[...n].sort((i,s)=>i-s),e=Math.min(t.length-1,Math.max(0,Math.ceil(t.length*.95)-1));return Math.round(t[e]*100)/100}function yh(n,t){!Number.isFinite(t)||t<0||(n.push(Math.round(t*100)/100),n.length>hh&&n.shift())}function Sh(n,t,e){let i=vh[n],s=Jl[n];yh(i.fetchMs,t),s.fetchCount+=1,s.fetchP95Ms=bh(i.fetchMs),e==="hit"?s.responseCacheHit+=1:e==="miss"?s.responseCacheMiss+=1:s.responseCacheUnknown+=1}function Bu(n,t){let e=vh[n],i=Jl[n];yh(e.renderMs,t),i.renderCount+=1,i.renderP95Ms=bh(e.renderMs)}function Bm(){typeof window>"u"||(window.__chartPerfMetrics={getSnapshot:()=>({byInterval:Jl,sampleMax:hh})})}async function zu(n,t){let e=String(n||"").trim().toUpperCase();if(!e)return;let i=_m[t]||[];oa();let s=new AbortController;Gs=s;let r=[];for(let o of i){if(s.signal.aborted)break;let l=ql(e,o);if(Zl(l))continue;if(_e.has(l)){r.push(_e.get(l));continue}let a=rs(e,o,{vdRsiLength:D.length,vdSourceInterval:C.sourceInterval,vdRsiSourceInterval:D.sourceInterval,signal:s.signal}).then(c=>{Xl(l,c)}).catch(()=>{}).finally(()=>{_e.delete(l)});_e.set(l,a),r.push(a)}await Promise.allSettled(r),s.signal.aborted||Tg(t,s.signal).catch(()=>{})}Bm();function Ei(n){if(!Array.isArray(n))return[...Nt];let t=new Set(Nt),e=[];for(let i of n){if(typeof i!="string"||!t.has(i))continue;let s=i;e.includes(s)||e.push(s)}for(let i of Nt)e.includes(i)||e.push(i);return e}function zm(n){if(!Number.isFinite(n))return"";let t=Math.max(0,Math.min(100,Number(n))),e="";return Math.abs(t)>=100?e=String(Math.round(t)):e=t.toFixed(1),e.length>=Mt?e:e.padEnd(Mt," ")}function Hm(n){return Array.isArray(n)?n.filter(t=>t&&(typeof t.time=="string"||typeof t.time=="number")&&Number.isFinite(Number(t.delta))).map(t=>({time:t.time,delta:Number(t.delta)})):[]}function Om(n){if(!Number.isFinite(n))return"";let t=n<0?"-":"",e=Math.abs(n),i=Mt-t.length;if(i<=0)return t.slice(0,Mt);let s=(c,u)=>{if(u<=0)return Math.trunc(c);let h=10**u;return Math.trunc(c*h)/h},r=c=>c.replace(/\.0+$/,"").replace(/(\.\d*?)0+$/,"$1"),o=(c,u)=>{let h=e/c;if(c!==1&&h<1)return null;let d=i-u.length;if(d<=0)return null;let f=0;for(u?h<10&&(f=1):h>=10&&h<100?f=1:h<10&&(f=2);f>=0;){let p=r(s(h,f).toFixed(f));if(p.length<=d)return`${t}${p}${u}`;f-=1}return null},l=[{divisor:1e9,suffix:"B"},{divisor:1e6,suffix:"M"},{divisor:1e3,suffix:"K"},{divisor:1,suffix:""}];for(let c of l){let u=o(c.divisor,c.suffix);if(u)return u.length>=Mt?u:u.padEnd(Mt," ")}let a=[{divisor:1e3,suffix:"K"},{divisor:1e6,suffix:"M"},{divisor:1e9,suffix:"B"}];for(let c of a){let u=i-c.suffix.length;if(u<=0)continue;let h=e/c.divisor,d=String(Math.max(1,Math.trunc(h)));if(d.length>u)continue;let f=`${t}${d}${c.suffix}`;return f.length>=Mt?f:f.padEnd(Mt," ")}return t?`${t}0`.padEnd(Mt," "):"0".padEnd(Mt," ")}function or(n){if(!Array.isArray(n))return[];let t=[];for(let e of n){if(!e||typeof e!="object")continue;let i=e,s=i.time1,r=i.time2,o=Number(i.value1),l=Number(i.value2);typeof s!="string"&&typeof s!="number"||typeof r!="string"&&typeof r!="number"||!Number.isFinite(o)||!Number.isFinite(l)||t.push({time1:s,value1:o,time2:r,value2:l})}return t}function wh(n,t){return`${n.toUpperCase()}|${t}`}function Mh(){if(typeof window>"u")return{};try{let n=window.localStorage.getItem(sh);if(!n)return{};let t=JSON.parse(n),e={};for(let[i,s]of Object.entries(t||{}))e[i]={rsi:or(s?.rsi),volumeDeltaRsi:or(s?.volumeDeltaRsi)};return e}catch{return{}}}function Wm(n){if(!(typeof window>"u"))try{window.localStorage.setItem(sh,JSON.stringify(n))}catch{}}function Um(n,t){let i=Mh()[wh(n,t)];return{rsi:or(i?.rsi),volumeDeltaRsi:or(i?.volumeDeltaRsi)}}function hr(){if(!R)return;let n=Mh(),t=wh(R,gt);n[t]={rsi:T?.getPersistedTrendlines()??[],volumeDeltaRsi:Ys.map(e=>({...e}))},Wm(n)}function F(){if(!(typeof window>"u"))try{let n={price:{maSourceMode:L.maSourceMode,verticalGridlines:L.verticalGridlines,horizontalGridlines:L.horizontalGridlines,ma:L.ma.map(t=>({enabled:t.enabled,type:t.type,length:t.length,color:t.color}))},rsi:{length:k.length,lineColor:k.lineColor,midlineColor:k.midlineColor,midlineStyle:k.midlineStyle},volumeDelta:{sourceInterval:C.sourceInterval,divergenceTable:C.divergenceTable,divergentPriceBars:C.divergentPriceBars,bullishDivergentColor:C.bullishDivergentColor,bearishDivergentColor:C.bearishDivergentColor,neutralDivergentColor:C.neutralDivergentColor},volumeDeltaRsi:{length:D.length,lineColor:D.lineColor,midlineColor:D.midlineColor,midlineStyle:D.midlineStyle,sourceInterval:D.sourceInterval},paneOrder:[...vt],paneHeights:{...xn}};window.localStorage.setItem(nh,JSON.stringify(n))}catch{}}function jm(){if(!(Iu||typeof window>"u")){Iu=!0;try{let n=window.localStorage.getItem(nh);if(!n)return;let t=JSON.parse(n),e=t?.price;if(e&&(L.maSourceMode=e.maSourceMode==="timeframe"?"timeframe":"daily",typeof e.verticalGridlines=="boolean"&&(L.verticalGridlines=e.verticalGridlines),typeof e.horizontalGridlines=="boolean"&&(L.horizontalGridlines=e.horizontalGridlines),Array.isArray(e.ma)))for(let o=0;o<L.ma.length;o++){let l=e.ma[o];l&&(L.ma[o].enabled=!!l.enabled,L.ma[o].type=l.type==="EMA"?"EMA":"SMA",L.ma[o].length=Math.max(1,Math.floor(Number(l.length)||L.ma[o].length)),typeof l.color=="string"&&l.color.trim()&&(L.ma[o].color=l.color))}let i=t?.rsi;i&&(k.length=Math.max(1,Math.floor(Number(i.length)||k.length)),typeof i.lineColor=="string"&&i.lineColor.trim()&&(k.lineColor=i.lineColor),typeof i.midlineColor=="string"&&i.midlineColor.trim()&&(k.midlineColor=i.midlineColor),k.midlineStyle=i.midlineStyle==="solid"?"solid":"dotted");let s=t?.volumeDelta;if(s){let o=String(s.sourceInterval||"");(o==="1min"||o==="5min"||o==="15min"||o==="30min"||o==="1hour"||o==="4hour")&&(C.sourceInterval=o),typeof s.divergenceTable=="boolean"&&(C.divergenceTable=s.divergenceTable),typeof s.divergentPriceBars=="boolean"&&(C.divergentPriceBars=s.divergentPriceBars),typeof s.bullishDivergentColor=="string"&&s.bullishDivergentColor.trim()&&(C.bullishDivergentColor=s.bullishDivergentColor),typeof s.bearishDivergentColor=="string"&&s.bearishDivergentColor.trim()&&(C.bearishDivergentColor=s.bearishDivergentColor),typeof s.neutralDivergentColor=="string"&&s.neutralDivergentColor.trim()&&(C.neutralDivergentColor=s.neutralDivergentColor)}let r=t?.volumeDeltaRsi;if(r){D.length=Math.max(1,Math.floor(Number(r.length)||D.length)),typeof r.lineColor=="string"&&r.lineColor.trim()&&(D.lineColor=r.lineColor),typeof r.midlineColor=="string"&&r.midlineColor.trim()&&(D.midlineColor=r.midlineColor),D.midlineStyle=r.midlineStyle==="solid"?"solid":"dotted";let o=String(r.sourceInterval||"");(o==="1min"||o==="5min"||o==="15min"||o==="30min"||o==="1hour"||o==="4hour")&&(D.sourceInterval=o)}if(vt=Ei(t?.paneOrder),t?.paneHeights&&typeof t.paneHeights=="object")for(let[o,l]of Object.entries(t.paneHeights))typeof l=="number"&&l>=Ul&&l<=jl&&(xn[o]=l)}catch{}}}function xh(n,t){let e=Math.max(1,Math.floor(t)),i=new Array(n.length).fill(null),s=n.slice(),r=null;for(let l=0;l<s.length;l++)Number.isFinite(s[l])?r=s[l]:r!==null&&(s[l]=r);let o=0;for(let l=0;l<s.length;l++){let a=s[l];Number.isFinite(a)&&(o+=a,l>=e&&(o-=s[l-e]),l>=e-1&&(i[l]=o/e))}return i}function Km(n,t,e){let i=[],s=new Map,r=new Set;for(let c of n){let u=Zt(c?.time),h=Number(c?.close);if(u===null||!Number.isFinite(h))continue;let d=Vu(u);r.has(d)||(r.add(d),i.push(d)),s.set(d,h)}let o=i.map(c=>Number(s.get(c))),l=t==="EMA"?Ch(o,e):xh(o,e),a=new Map;for(let c=0;c<i.length;c++)a.set(i[c],l[c]??null);return n.map(c=>{let u=Zt(c?.time);return u===null?null:a.get(Vu(u))??null})}function Ch(n,t){let e=Math.max(1,Math.floor(t)),i=new Array(n.length).fill(null);if(n.length===0)return i;let s=n.slice(),r=null;for(let a=0;a<s.length;a++)Number.isFinite(s[a])?r=s[a]:r!==null&&(s[a]=r);let o=2/(e+1),l=null;for(let a=0;a<s.length;a++){let c=s[a];if(Number.isFinite(c)){if(l===null){let u=0,h=0;for(let d=a;d<s.length&&h<e;d++)Number.isFinite(s[d])&&(u+=s[d],h++);l=h>0?u/h:c}else l=c*o+l*(1-o);i[a]=l}}return i}function Bl(n){let t=typeof n=="number"?n:Number.NaN;return Number.isFinite(t)&&t>0}function Yl(){for(let n of L.ma)n.series&&E&&(E.removeSeries(n.series),n.series=null),E||(n.series=null),n.values=[]}function ce(){if(!E||!M.length){Yl();return}for(let n of L.ma){let t=Math.max(1,Math.floor(Number(n.length)||1));if(n.length=t,!n.enabled){n.series&&(E.removeSeries(n.series),n.series=null),n.values=[];continue}n.series?n.series.applyOptions({color:n.color}):n.series=E.addLineSeries({color:n.color,lineWidth:1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1});let e=L.maSourceMode==="daily"?Km(M,n.type,t):n.type==="EMA"?Ch(M.map(s=>Number(s.close)),t):xh(M.map(s=>Number(s.close)),t);n.values=e;let i=M.map((s,r)=>{let o=e[r];return Bl(o)?{time:s.time,value:o}:{time:s.time}});n.series.setData(i)}}function qm(){if(!E||!Array.isArray(M)||M.length===0)return;if(L.maSourceMode==="daily"){ce();return}let n=M.length-1,t=M[n],e=Number(t?.close);if(!Number.isFinite(e)){ce();return}for(let i of L.ma){if(!i.enabled||!i.series)continue;let s=Math.max(1,Math.floor(Number(i.length)||1)),r=null;if(i.type==="EMA")if(n===0)r=e;else{let o=Number(i.values[n-1]);if(!Number.isFinite(o)){ce();return}let l=2/(s+1);r=e*l+o*(1-l)}else if(n<s-1)r=null;else{let o=0;for(let l=n-s+1;l<=n;l++){let a=Number(M[l]?.close);if(!Number.isFinite(a)){ce();return}o+=a}r=o/s}i.values.length!==M.length&&(i.values=new Array(M.length).fill(null)),i.values[n]=Bl(r)?r:null,Bl(r)?i.series.update({time:t.time,value:r}):i.series.update({time:t.time})}}function Bs(n){n&&(n.innerHTML="")}function zs(n,t){if(!n||!t||(t.innerHTML="",!L.verticalGridlines)||!Qs.length)return;let e=t.clientWidth||t.offsetWidth;if(!(!Number.isFinite(e)||e<=0))for(let i of Qs){let s=n.timeScale().timeToCoordinate(i);if(!Number.isFinite(s)||s<0||s>e)continue;let r=document.createElement("div");r.style.position="absolute",r.style.top="0",r.style.bottom="0",r.style.left=`${Math.round(s)}px`,r.style.width="1px",r.style.background=ih,t.appendChild(r)}}function Gm(){zs(E,tr),zs(P,er),zs(X,ir),zs(T?.getChart(),nr),Bh()}function fe(){kl===null&&(kl=requestAnimationFrame(()=>{kl=null,Gm(),Qp()}))}function Ql(){E&&(E.applyOptions({grid:{vertLines:{visible:!1},horzLines:{visible:L.horizontalGridlines,color:ih}}}),fe())}function Dh(){if(!K)return;let n=K.querySelector('[data-price-setting="ma-source"]'),t=K.querySelector('[data-price-setting="v-grid"]'),e=K.querySelector('[data-price-setting="h-grid"]');n&&(n.value=L.maSourceMode),t&&(t.checked=L.verticalGridlines),e&&(e.checked=L.horizontalGridlines);for(let i=0;i<L.ma.length;i++){let s=L.ma[i],r=K.querySelector(`[data-price-setting="ma-enabled-${i}"]`),o=K.querySelector(`[data-price-setting="ma-type-${i}"]`),l=K.querySelector(`[data-price-setting="ma-length-${i}"]`),a=K.querySelector(`[data-price-setting="ma-color-${i}"]`);r&&(r.checked=s.enabled),o&&(o.value=s.type),l&&(l.value=String(s.length)),a&&(a.value=s.color)}}function Th(){if(!tt)return;let n=tt.querySelector('[data-rsi-setting="length"]'),t=tt.querySelector('[data-rsi-setting="line-color"]'),e=tt.querySelector('[data-rsi-setting="midline-color"]'),i=tt.querySelector('[data-rsi-setting="midline-style"]');n&&(n.value=String(k.length)),t&&(t.value=k.lineColor),e&&(e.value=k.midlineColor),i&&(i.value=k.midlineStyle)}function Lh(){if(!G)return;let n=G.querySelector('[data-vd-setting="source-interval"]'),t=G.querySelector('[data-vd-setting="divergence-table"]'),e=G.querySelector('[data-vd-setting="divergent-price-bars"]'),i=G.querySelector('[data-vd-setting="divergent-bullish-color"]'),s=G.querySelector('[data-vd-setting="divergent-bearish-color"]'),r=G.querySelector('[data-vd-setting="divergent-neutral-color"]');n&&(n.value=C.sourceInterval),t&&(t.checked=C.divergenceTable),e&&(e.checked=C.divergentPriceBars),i&&(i.value=C.bullishDivergentColor),s&&(s.value=C.bearishDivergentColor),r&&(r.value=C.neutralDivergentColor)}function Eh(){if(!Z)return;let n=Z.querySelector('[data-vd-rsi-setting="length"]'),t=Z.querySelector('[data-vd-rsi-setting="line-color"]'),e=Z.querySelector('[data-vd-rsi-setting="midline-color"]'),i=Z.querySelector('[data-vd-rsi-setting="midline-style"]'),s=Z.querySelector('[data-vd-rsi-setting="source-interval"]');n&&(n.value=String(D.length)),t&&(t.value=D.lineColor),e&&(e.value=D.midlineColor),i&&(i.value=D.midlineStyle),s&&(s.value=D.sourceInterval)}function mn(){K&&(K.style.display="none"),G&&(G.style.display="none"),Z&&(Z.style.display="none"),tt&&(tt.style.display="none")}function Zm(){return Ei(vt)[0]}function Xm(n){let t=String(n.dataset.topPaneBadgeRole||"");return t==="ticker"?0:t==="price-change"?1:100}function ta(n){let t=Array.from(n.querySelectorAll(".pane-settings-btn, .pane-trendline-btn"));if(!t.length)return Nu;let i=t.reduce((s,r)=>{let o=r.offsetLeft+r.offsetWidth;return o>s?o:s},0)+rh;return Math.max(Nu,i)}function Sn(n){let t=Array.from(n.querySelectorAll(`.${Ol}`)).filter(s=>s.style.display!=="none");if(!t.length)return;let e=t.map((s,r)=>({badge:s,index:r,priority:Xm(s)})).sort((s,r)=>s.priority-r.priority||s.index-r.index).map(s=>s.badge),i=ta(n);for(let s of e){s.style.left=`${i}px`,s.style.top="8px",s.style.maxWidth=`calc(100% - ${i+30}px)`;let r=Math.ceil(s.getBoundingClientRect().width||s.offsetWidth||0);i+=Math.max(0,r)+rh}}function Hu(n){let t=String(n||"").trim().toUpperCase();if(!t)return;let e=`https://www.tradingview.com/symbols/${encodeURIComponent(t)}/`;window.open(e,"_blank","noopener,noreferrer")}function ea(){let n=Zm();for(let s of Nt){let r=document.getElementById(s);if(!r||!(r instanceof HTMLElement))continue;let o=r.querySelector(`.${_l}`);o&&s!==n&&o.remove()}if(!n)return;let t=document.getElementById(n);if(!t||!(t instanceof HTMLElement))return;let e=String(R||"").trim().toUpperCase(),i=t.querySelector(`.${_l}`);if(!e){i&&i.remove();for(let s of Nt){let r=document.getElementById(s);!r||!(r instanceof HTMLElement)||Sn(r)}return}if(!i){let s=ta(t);i=document.createElement("div"),i.className=`${_l} ${Ol}`,i.dataset.topPaneBadgeRole="ticker",i.style.position="absolute",i.style.left=`${s}px`,i.style.top="8px",i.style.zIndex="32",i.style.minHeight="24px",i.style.maxWidth=`calc(100% - ${s+30}px)`,i.style.display="inline-flex",i.style.alignItems="center",i.style.padding="0 8px",i.style.borderRadius="4px",i.style.border="1px solid #30363d",i.style.background="#161b22",i.style.color="#c9d1d9",i.style.fontSize="12px",i.style.fontWeight="600",i.style.fontFamily="'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",i.style.whiteSpace="nowrap",i.style.overflow="hidden",i.style.textOverflow="ellipsis",i.style.pointerEvents="auto",i.style.cursor="pointer",i.title="Open on TradingView",i.setAttribute("role","link"),i.tabIndex=0,i.dataset.clickBound||(i.addEventListener("click",r=>{r.stopPropagation();let o=r.currentTarget;Hu(String(o.dataset.tickerSymbol||""))}),i.addEventListener("keydown",r=>{if(r.key!=="Enter"&&r.key!==" ")return;r.preventDefault();let o=r.currentTarget;Hu(String(o.dataset.tickerSymbol||""))}),i.dataset.clickBound="1"),t.appendChild(i)}i.dataset.tickerSymbol=e,i.textContent=e;for(let s of Nt){let r=document.getElementById(s);!r||!(r instanceof HTMLElement)||Sn(r)}}function kh(n){for(let t of vt){let e=document.getElementById(t);!e||e.parentElement!==n||n.appendChild(e)}}function Jm(n,t,e){if(n===t)return;let i=vt.filter(o=>o!==n),s=i.indexOf(t);if(s<0)return;let r=e?s+1:s;i.splice(r,0,n),vt=Ei(i)}function Ou(){for(let n of Nt){let t=document.getElementById(n);t&&t.classList.remove("pane-drag-over")}}function _h(n){kh(n);let t=document.getElementById("price-chart-container"),e=document.getElementById("vd-rsi-chart-container"),i=document.getElementById("rsi-chart-container"),s=document.getElementById("vd-chart-container");t&&e&&i&&s&&gr(t,e,i,s),dr(),ea()}function Ym(){return document.getElementById("custom-chart-container")?.classList.contains("chart-fullscreen")===!0}function Hs(n){let e=Ei(vt).indexOf(n);return e===3&&Ym()?!1:e===1||e===3}function Os(n,t){n&&n.applyOptions({rightPriceScale:{visible:!0},timeScale:{visible:t,borderVisible:t,ticksVisible:t}})}function dr(){Os(E,Hs("price-chart-container")),Os(P,Hs("vd-rsi-chart-container")),Os(T?.getChart(),Hs("rsi-chart-container")),Os(X,Hs("vd-chart-container"))}function Qm(n,t,e){n.dataset.paneId||(n.dataset.paneId=t);let i=n.querySelector(".pane-order-handle");i||(i=document.createElement("button"),i.type="button",i.className="pane-order-handle",i.title="Drag to reorder panes",i.textContent="",i.setAttribute("aria-label","Reorder pane"),n.appendChild(i)),i.dataset.bound||(i.setAttribute("draggable","true"),i.addEventListener("dragstart",s=>{fn=t,s.dataTransfer&&(s.dataTransfer.effectAllowed="move",s.dataTransfer.setData("text/plain",t)),Ou()}),i.addEventListener("dragend",()=>{fn=null,Ou()}),i.dataset.bound="1"),n.dataset.dropBound||(n.addEventListener("dragover",s=>{fn&&(s.preventDefault(),n.classList.add("pane-drag-over"),s.dataTransfer&&(s.dataTransfer.dropEffect="move"))}),n.addEventListener("dragleave",()=>{n.classList.remove("pane-drag-over")}),n.addEventListener("drop",s=>{s.preventDefault(),n.classList.remove("pane-drag-over");let r=fn;if(fn=null,!r||r===t)return;let o=vt.indexOf(r),l=vt.indexOf(t),a=o>=0&&l>=0?o<l:!0;Jm(r,t,a),_h(e),F()}),n.dataset.dropBound="1")}function tp(n){vt=Ei(vt),kh(n);for(let t of Nt){let e=document.getElementById(t);!e||!(e instanceof HTMLElement)||e.parentElement!==n||Qm(e,t,n)}ea()}function ia(){if(!T)return;let n=fh(M,k.length);Li=new Map(n.filter(t=>Number.isFinite(Number(t.value))).map(t=>[I(t.time),Number(t.value)])),T.setData(n,M.map(t=>({time:t.time,close:t.close}))),T.setLineColor(k.lineColor),T.setMidlineOptions(k.midlineColor,k.midlineStyle),fr()}function Rh(n){return n==="solid"?0:1}function na(){ht&&ht.applyOptions({color:D.lineColor,lineWidth:1}),Al&&Al.applyOptions({color:D.midlineColor,lineStyle:Rh(D.midlineStyle)}),fr()}function pi(n){na(),n&&R&&At(R,gt)}function ep(){Yl(),L.maSourceMode=ae.maSourceMode,L.verticalGridlines=ae.verticalGridlines,L.horizontalGridlines=ae.horizontalGridlines;for(let t=0;t<L.ma.length;t++){let e=ae.ma[t];e&&(L.ma[t].enabled=e.enabled,L.ma[t].type=e.type,L.ma[t].length=e.length,L.ma[t].color=e.color,L.ma[t].series=null,L.ma[t].values=[])}vt=[...Nt];let n=document.getElementById("chart-content");n&&n instanceof HTMLElement&&_h(n),Ql(),ce(),Dh(),F()}function ip(){k.length=vn.length,k.lineColor=vn.lineColor,k.midlineColor=vn.midlineColor,k.midlineStyle=vn.midlineStyle,ia(),Th(),F()}function np(){C.sourceInterval=Dt.sourceInterval,C.divergenceTable=Dt.divergenceTable,C.divergentPriceBars=Dt.divergentPriceBars,C.bullishDivergentColor=Dt.bullishDivergentColor,C.bearishDivergentColor=Dt.bearishDivergentColor,C.neutralDivergentColor=Dt.neutralDivergentColor,R&&At(R,gt),Re(),Lh(),F()}function sp(){D.length=mi.length,D.lineColor=mi.lineColor,D.midlineColor=mi.midlineColor,D.midlineStyle=mi.midlineStyle,D.sourceInterval=mi.sourceInterval,pi(!0),Eh(),F()}function Ws(n,t){let e=n.querySelector(`.pane-settings-btn[data-pane="${t}"]`);if(e)return e;let i=document.createElement("button");return i.className="pane-settings-btn settings-icon-btn",i.dataset.pane=t,i.type="button",i.title=t==="price"?"Price settings":t==="volumeDelta"?"Volume Delta settings":t==="volumeDeltaRsi"?"Volume Delta RSI settings":"RSI settings",i.textContent=wm,i.style.position="absolute",i.style.left=`${Wl}px`,i.style.top=`${ur}px`,i.style.zIndex="30",i.style.width=`${rt}px`,i.style.height=`${rt}px`,i.style.borderRadius="4px",n.appendChild(i),i}function rp(n){return n==="volumeDelta"?"VD":n==="volumeDeltaRsi"?"VD-RSI":n==="rsi"?"RSI":"Price"}function Us(n,t){let e=n.querySelector(`.pane-name-badge[data-pane="${t}"]`);if(e)return e;let i=document.createElement("div");return i.className="pane-name-badge",i.dataset.pane=t,i.textContent=rp(t),i.style.position="absolute",i.style.left=`${Wl}px`,i.style.top=`${ur+rt+rr}px`,i.style.zIndex="30",i.style.minWidth=`${rt}px`,i.style.height=`${rt}px`,i.style.padding="0 8px",i.style.borderRadius="4px",i.style.border="1px solid #30363d",i.style.background="#161b22",i.style.color="#c9d1d9",i.style.display="inline-flex",i.style.alignItems="center",i.style.justifyContent="center",i.style.fontSize="12px",i.style.fontWeight="600",i.style.fontFamily="'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",i.style.pointerEvents="none",i.style.userSelect="none",n.appendChild(i),i}function fi(n,t,e,i){let s=n.querySelector(`.pane-trendline-btn[data-pane="${t}"][data-action="${e}"]`);if(s)return s;let r=document.createElement("button");return r.className="pane-trendline-btn",r.dataset.pane=t,r.dataset.action=e,r.type="button",r.title=e==="trend"?"Draw Trendline":e==="erase"?"Erase Trendline":"Divergence",r.textContent=e==="trend"?Qu:e==="erase"?dm:th,r.style.position="absolute",r.style.left=`${Wl+(i+1)*(rt+rr)}px`,r.style.top=`${ur}px`,r.style.zIndex="30",r.style.width=`${rt}px`,r.style.height=`${rt}px`,r.style.borderRadius="4px",r.style.border="1px solid #30363d",r.style.background="#161b22",r.style.color="#c9d1d9",r.style.cursor="pointer",r.style.padding="0",n.appendChild(r),r}function op(n,t){return document.querySelector(`.pane-trendline-btn[data-pane="${n}"][data-action="${t}"]`)}function Ne(n,t,e){let i=op(n,t);i&&(i.classList.toggle("active",e),i.style.background=e?"#1f6feb":"#161b22",i.style.color="#ffffff",i.textContent=t==="trend"?Qu:th)}function dt(n,t){Ne(n,"trend",t)}function Ph(){if(!Array.isArray(M)||M.length===0)return null;let n=M[M.length-1]?.time;if(typeof n!="string"&&typeof n!="number")return null;if(!E)return n;try{let t=E.timeScale().getVisibleLogicalRange?.(),e=Number(t?.from),i=Number(t?.to);if(!Number.isFinite(e)||!Number.isFinite(i))return n;let s=Math.round((e+i)/2),r=Math.max(0,Math.min(M.length-1,s)),o=M[r]?.time;if(typeof o=="string"||typeof o=="number")return o}catch{}return n}function lp(){if(!T)return;let n=Ph();if(n===null)return;let t=gi(n,Li),e=T.getChart?.(),i=T.getSeries?.();if(!(!e||!i||!Number.isFinite(t)))try{e.setCrosshairPosition(Number(t),n,i)}catch{}}function ap(){if(!P||!ht)return;let n=Ph();if(n===null)return;let t=gi(n,Ae);if(Number.isFinite(t))try{P.setCrosshairPosition(Number(t),n,ht)}catch{}}function cp(){if(T){if(Tt){T.deactivateDivergenceTool(),Tt=!1,dt("rsi",!1);return}Lt&&Cn(),T.activateDivergenceTool(),Tt=!0,dt("rsi",!0),lp()}}function up(){T?.clearDivergence(!0),T?.deactivateDivergenceTool(),Tt=!1,dt("rsi",!1),hr()}function hp(){if(P){if(Xt){En(),dt("volumeDeltaRsi",!1);return}Et&&Dn(),$p(),dt("volumeDeltaRsi",!0),ap()}}function dp(){ra(!0),En(),dt("volumeDeltaRsi",!1),hr()}function fp(n){let t=Zt(n);if(t===null)return"";let e=new Date(t*1e3);return gt==="1day"||gt==="1week"?we("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"}).format(e):e.toLocaleString("en-US",{timeZone:Y(),month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",hour12:!1})}function mp(n,t){let e=t==="rsi"?Vl:Fl;if(e&&e.parentElement===n)return e.style.top="0",e.style.right="0",e.style.maxWidth="100%",e;let i=document.createElement("div");i.className=`divergence-plot-overlay divergence-plot-overlay-${t}`,i.style.position="absolute",i.style.top="0",i.style.right="0",i.style.width="468px",i.style.maxWidth="100%",i.style.height="286px",i.style.border="1px solid #30363d",i.style.borderRadius="6px",i.style.background="rgba(13, 17, 23, 0.95)",i.style.backdropFilter="blur(4px)",i.style.zIndex="35",i.style.pointerEvents="none",i.style.display="none",i.style.padding="8px",i.style.boxSizing="border-box";let s=document.createElement("div");s.style.position="relative",s.style.width="100%",s.style.height="100%";let r=document.createElement("canvas");return r.className="divergence-plot-overlay-canvas",s.appendChild(r),i.appendChild(s),n.appendChild(i),t==="rsi"?Vl=i:Fl=i,i}function Ih(n){return n==="rsi"?Ju:Yu}function Ah(n,t){n==="rsi"?Ju=t:Yu=t}function Di(n){let t=n==="rsi"?Vl:Fl;t&&(t.style.display="none");let e=Ih(n);if(e){try{e.destroy()}catch{}Ah(n,null)}}function Nh(n){if(!Array.isArray(M)||M.length===0)return null;let t=Mn.get(I(n));if(t!==void 0)return t;let e=Zt(n);if(e===null)return null;let i=0,s=Number.POSITIVE_INFINITY;for(let r=0;r<M.length;r++){let o=Zt(M[r]?.time);if(o===null)continue;let l=Math.abs(o-e);l<s&&(s=l,i=r)}return Number.isFinite(s)?i:null}function pp(n){let t=[],e=[],i=[];for(let s=n;s<M.length;s++){let r=M[s],o=I(r.time),l=Number(Li.get(o)),a=Number(Ae.get(o));!Number.isFinite(l)||!Number.isFinite(a)||(t.push(fp(r.time)),e.push(l),i.push(a))}return{labels:t,rsiValues:e,volumeDeltaRsiValues:i}}function lr(n,t){let e=n==="rsi"?document.getElementById("rsi-chart-container"):document.getElementById("vd-rsi-chart-container");if(!e||!(e instanceof HTMLElement))return;let i=mp(e,n),s=i.querySelector(".divergence-plot-overlay-canvas");if(!s)return;if(!M.length||t<0||t>=M.length){Di(n);return}let r=pp(t);if(r.rsiValues.length<2){Di(n);return}i.style.display="block";let o=Ih(n);if(o){o.data.labels=r.labels,o.data.datasets[0].data=r.rsiValues,o.data.datasets[0].borderColor=k.lineColor,o.data.datasets[1].data=r.volumeDeltaRsiValues,o.data.datasets[1].borderColor=D.lineColor,o.update("none");return}let l=new Chart(s,{type:"line",data:{labels:r.labels,datasets:[{label:"RSI",data:r.rsiValues,borderColor:k.lineColor,backgroundColor:"transparent",borderWidth:1,pointRadius:r.rsiValues.length>24?0:2,tension:.2},{label:"VD RSI",data:r.volumeDeltaRsiValues,borderColor:D.lineColor,backgroundColor:"transparent",borderWidth:1,pointRadius:r.volumeDeltaRsiValues.length>24?0:2,tension:.2}]},options:{responsive:!0,maintainAspectRatio:!1,animation:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{display:!1},tooltip:{backgroundColor:"rgba(22, 27, 34, 0.95)",borderColor:"#30363d",borderWidth:1,titleColor:"#c9d1d9",bodyColor:"#8b949e"}},scales:{x:{display:!1,ticks:{color:"#8b949e",maxRotation:0,autoSkip:!0,maxTicksLimit:6,font:{size:10}},grid:{color:"rgba(48, 54, 61, 0.22)"}},y:{display:!1,min:0,max:100,ticks:{color:"#8b949e",font:{size:10}},grid:{color:"rgba(48, 54, 61, 0.22)"}}}}});Ah(n,l)}function Cn(){Lt=!1,Si=!1,Mi=null,Ne("rsi","divergence",!1),Di("rsi")}function Dn(){Et=!1,wi=!1,xi=null,Ne("volumeDeltaRsi","divergence",!1),Di("volumeDeltaRsi")}function Wu(n,t){if(!Lt||t&&!Si)return;let e=Nh(n);e!==null&&(Si=!0,Mi=e,lr("rsi",e))}function $h(n,t){if(!Et||t&&!wi)return;let e=Nh(n);e!==null&&(wi=!0,xi=e,lr("volumeDeltaRsi",e))}function gp(){if(Lt){Cn();return}Tt&&(T?.deactivateDivergenceTool(),Tt=!1,dt("rsi",!1)),Lt=!0,Si=!1,Mi=null,Ne("rsi","divergence",!0)}function vp(){if(Et){Dn();return}Xt&&(En(),dt("volumeDeltaRsi",!1)),Et=!0,wi=!1,xi=null,Ne("volumeDeltaRsi","divergence",!0)}function fr(){Lt&&Si&&Mi!==null&&lr("rsi",Mi),Et&&wi&&xi!==null&&lr("volumeDeltaRsi",xi)}function bp(){Tt&&(T?.deactivateDivergenceTool(),Tt=!1,dt("rsi",!1)),Xt&&(En(),dt("volumeDeltaRsi",!1)),Lt&&Cn(),Et&&Dn()}function mr(n){n.style.fontFamily='-apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif',n.style.fontSize="12px",n.style.fontWeight="500",n.style.lineHeight="1.2",n.querySelectorAll("div, span, label, input, select, button").forEach(t=>{t.style.fontFamily="inherit",t.style.fontSize="inherit",t.style.fontWeight="inherit",t.style.fontStyle="normal",t.style.letterSpacing="normal"}),n.querySelectorAll("label").forEach(t=>{t.style.display="flex",t.style.justifyContent="space-between",t.style.alignItems="center",t.style.gap="8px",t.style.minHeight="26px"}),n.querySelectorAll('input[type="checkbox"]').forEach(t=>{t.style.width="14px",t.style.height="14px",t.style.margin="0"}),n.querySelectorAll("input, select, button").forEach(t=>{t.style.boxSizing="border-box",t.style.lineHeight="1.2"})}function yp(n){let t=document.createElement("div");return t.className="pane-settings-panel price-settings-panel",t.style.position="absolute",t.style.left="8px",t.style.top="38px",t.style.zIndex="31",t.style.width="280px",t.style.maxWidth="calc(100% - 16px)",t.style.background="rgba(22, 27, 34, 0.95)",t.style.border="1px solid #30363d",t.style.borderRadius="6px",t.style.padding="10px",t.style.display="none",t.style.color="#c9d1d9",t.style.backdropFilter="blur(6px)",t.innerHTML=`
    <div style="display:flex; justify-content:space-between; align-items:center; min-height:26px; margin-bottom:8px;">
      <div style="font-weight:600;">Chart</div>
      <button type="button" data-price-setting="reset" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:4px 8px; font-size:12px; cursor:pointer;">Reset</button>
    </div>
    <label style="margin-bottom:6px;">
      <span>Vertical gridlines</span>
      <input type="checkbox" data-price-setting="v-grid" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Horizontal gridlines</span>
      <input type="checkbox" data-price-setting="h-grid" />
    </label>
    <label style="margin-bottom:4px;">
      <span>MA source</span>
      <select data-price-setting="ma-source" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;">
        <option value="daily">Daily</option>
        <option value="timeframe">Chart</option>
      </select>
    </label>
    ${L.ma.map((e,i)=>`
      <div style="display:grid; grid-template-columns: 20px 64px 58px 1fr; gap:6px; align-items:center; min-height:26px; margin-bottom:6px;">
        <input type="checkbox" data-price-setting="ma-enabled-${i}" title="Enable MA ${i+1}" />
        <select data-price-setting="ma-type-${i}" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;">
          <option value="SMA">SMA</option>
          <option value="EMA">EMA</option>
        </select>
        <input data-price-setting="ma-length-${i}" type="number" min="1" max="500" step="1" style="width:58px; background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;" />
        <input data-price-setting="ma-color-${i}" type="color" style="width:100%; height:24px; border:none; background:transparent; padding:0;" />
      </div>
    `).join("")}
  `,mr(t),t.addEventListener("input",e=>{let i=e.target;if(!i)return;let s=i.dataset.priceSetting||"";if(s==="ma-source"){L.maSourceMode=i.value==="timeframe"?"timeframe":"daily",ce(),F();return}if(s==="v-grid"){L.verticalGridlines=i.checked,fe(),F();return}if(s==="h-grid"){L.horizontalGridlines=i.checked,Ql(),F();return}let r=s.match(/^ma-(enabled|type|length|color)-(\d)$/);if(!r)return;let o=r[1],l=Number(r[2]),a=L.ma[l];a&&(o==="enabled"?a.enabled=i.checked:o==="type"?a.type=i.value==="EMA"?"EMA":"SMA":o==="length"?a.length=Math.max(1,Math.floor(Number(i.value)||14)):o==="color"&&(a.color=i.value||a.color),ce(),F())}),t.addEventListener("click",e=>{let i=e.target;i&&i.dataset.priceSetting==="reset"&&(e.preventDefault(),ep())}),n.appendChild(t),t}function Sp(n){let t=document.createElement("div");return t.className="pane-settings-panel rsi-settings-panel",t.style.position="absolute",t.style.left="8px",t.style.top="38px",t.style.zIndex="31",t.style.width="230px",t.style.maxWidth="calc(100% - 16px)",t.style.background="rgba(22, 27, 34, 0.95)",t.style.border="1px solid #30363d",t.style.borderRadius="6px",t.style.padding="10px",t.style.display="none",t.style.color="#c9d1d9",t.style.backdropFilter="blur(6px)",t.innerHTML=`
    <div style="display:flex; justify-content:space-between; align-items:center; min-height:26px; margin-bottom:8px;">
      <div style="font-weight:600;">RSI</div>
      <button type="button" data-rsi-setting="reset" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:4px 8px; font-size:12px; cursor:pointer;">Reset</button>
    </div>
    <label style="margin-bottom:6px;">
      <span>Length</span>
      <input data-rsi-setting="length" type="number" min="1" max="200" step="1" style="width:64px; background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Line color</span>
      <input data-rsi-setting="line-color" type="color" style="width:64px; height:24px; border:none; background:transparent; padding:0;" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Midline color</span>
      <input data-rsi-setting="midline-color" type="color" style="width:64px; height:24px; border:none; background:transparent; padding:0;" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Midline style</span>
      <select data-rsi-setting="midline-style" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;">
        <option value="dotted">Dotted</option>
        <option value="solid">Solid</option>
      </select>
    </label>
  `,mr(t),t.addEventListener("input",e=>{let i=e.target;if(!i)return;let s=i.dataset.rsiSetting||"";if(s==="length"){k.length=Math.max(1,Math.floor(Number(i.value)||14)),ia(),F();return}if(s==="line-color"){k.lineColor=i.value||k.lineColor,T?.setLineColor(k.lineColor),F();return}if(s==="midline-color"){k.midlineColor=i.value||k.midlineColor,T?.setMidlineOptions(k.midlineColor,k.midlineStyle),F();return}if(s==="midline-style"){k.midlineStyle=i.value==="solid"?"solid":"dotted",T?.setMidlineOptions(k.midlineColor,k.midlineStyle),F();return}}),t.addEventListener("click",e=>{let i=e.target;i&&i.dataset.rsiSetting==="reset"&&(e.preventDefault(),ip())}),n.appendChild(t),t}function wp(n){let t=document.createElement("div");return t.className="pane-settings-panel volume-delta-settings-panel",t.style.position="absolute",t.style.left="8px",t.style.top="38px",t.style.zIndex="31",t.style.width="230px",t.style.maxWidth="calc(100% - 16px)",t.style.background="rgba(22, 27, 34, 0.95)",t.style.border="1px solid #30363d",t.style.borderRadius="6px",t.style.padding="10px",t.style.display="none",t.style.color="#c9d1d9",t.style.backdropFilter="blur(6px)",t.innerHTML=`
    <div style="display:flex; justify-content:space-between; align-items:center; min-height:26px; margin-bottom:8px;">
      <div style="font-weight:600;">Volume Delta</div>
      <button type="button" data-vd-setting="reset" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:4px 8px; font-size:12px; cursor:pointer;">Reset</button>
    </div>
    <label style="margin-bottom:6px;">
      <span>Source</span>
      <select data-vd-setting="source-interval" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;">
        ${uh.map(e=>`<option value="${e.value}">${e.label}</option>`).join("")}
      </select>
    </label>
    <label style="margin-bottom:6px;">
      <span>Divergence table</span>
      <input type="checkbox" data-vd-setting="divergence-table" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Divergent price bars</span>
      <input type="checkbox" data-vd-setting="divergent-price-bars" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Bullish</span>
      <input type="color" data-vd-setting="divergent-bullish-color" style="width:64px; height:24px; border:none; background:transparent; padding:0;" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Bearish</span>
      <input type="color" data-vd-setting="divergent-bearish-color" style="width:64px; height:24px; border:none; background:transparent; padding:0;" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Neutral</span>
      <input type="color" data-vd-setting="divergent-neutral-color" style="width:64px; height:24px; border:none; background:transparent; padding:0;" />
    </label>
  `,mr(t),t.addEventListener("input",e=>{let i=e.target;if(!i)return;let s=i.dataset.vdSetting||"";if(s==="source-interval"){let r=String(i.value||"");if(r!=="1min"&&r!=="5min"&&r!=="15min"&&r!=="30min"&&r!=="1hour"&&r!=="4hour")return;C.sourceInterval=r,R&&At(R,gt),F();return}if(s==="divergence-table"){C.divergenceTable=i.checked,Pe&&pr(Pe,M),F();return}if(s==="divergent-price-bars"){C.divergentPriceBars=i.checked,Re(),F();return}if(s==="divergent-bullish-color"){C.bullishDivergentColor=i.value||C.bullishDivergentColor,Re(),F();return}if(s==="divergent-bearish-color"){C.bearishDivergentColor=i.value||C.bearishDivergentColor,Re(),F();return}if(s==="divergent-neutral-color"){C.neutralDivergentColor=i.value||C.neutralDivergentColor,Re(),F();return}}),t.addEventListener("click",e=>{let i=e.target;i&&i.dataset.vdSetting==="reset"&&(e.preventDefault(),np())}),n.appendChild(t),t}function Mp(n){let t=document.createElement("div");return t.className="pane-settings-panel volume-delta-rsi-settings-panel",t.style.position="absolute",t.style.left="8px",t.style.top="38px",t.style.zIndex="31",t.style.width="230px",t.style.maxWidth="calc(100% - 16px)",t.style.background="rgba(22, 27, 34, 0.95)",t.style.border="1px solid #30363d",t.style.borderRadius="6px",t.style.padding="10px",t.style.display="none",t.style.color="#c9d1d9",t.style.backdropFilter="blur(6px)",t.innerHTML=`
    <div style="display:flex; justify-content:space-between; align-items:center; min-height:26px; margin-bottom:8px;">
      <div style="font-weight:600;">Volume Delta RSI</div>
      <button type="button" data-vd-rsi-setting="reset" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:4px 8px; font-size:12px; cursor:pointer;">Reset</button>
    </div>
    <label style="margin-bottom:6px;">
      <span>Length</span>
      <input data-vd-rsi-setting="length" type="number" min="1" max="200" step="1" style="width:64px; background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Source</span>
      <select data-vd-rsi-setting="source-interval" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;">
        ${uh.map(e=>`<option value="${e.value}">${e.label}</option>`).join("")}
      </select>
    </label>
    <label style="margin-bottom:6px;">
      <span>Line color</span>
      <input data-vd-rsi-setting="line-color" type="color" style="width:64px; height:24px; border:none; background:transparent; padding:0;" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Midline color</span>
      <input data-vd-rsi-setting="midline-color" type="color" style="width:64px; height:24px; border:none; background:transparent; padding:0;" />
    </label>
    <label style="margin-bottom:6px;">
      <span>Midline style</span>
      <select data-vd-rsi-setting="midline-style" style="background:#0d1117; color:#c9d1d9; border:1px solid #30363d; border-radius:4px; padding:2px 4px;">
        <option value="dotted">Dotted</option>
        <option value="solid">Solid</option>
      </select>
    </label>
  `,mr(t),t.addEventListener("input",e=>{let i=e.target;if(!i)return;let s=i.dataset.vdRsiSetting||"";if(s==="length"){D.length=Math.max(1,Math.floor(Number(i.value)||14)),pi(!0),F();return}if(s==="source-interval"){let r=String(i.value||"");if(r!=="1min"&&r!=="5min"&&r!=="15min"&&r!=="30min"&&r!=="1hour"&&r!=="4hour")return;D.sourceInterval=r,pi(!0),F();return}if(s==="line-color"){D.lineColor=i.value||D.lineColor,pi(!1),F();return}if(s==="midline-color"){D.midlineColor=i.value||D.midlineColor,pi(!1),F();return}if(s==="midline-style"){D.midlineStyle=i.value==="solid"?"solid":"dotted",pi(!1),F();return}}),t.addEventListener("click",e=>{let i=e.target;i&&i.dataset.vdRsiSetting==="reset"&&(e.preventDefault(),sp())}),n.appendChild(t),t}function xp(n,t,e,i){let s=Ws(n,"price"),r=Xp(n),o=Ws(t,"volumeDeltaRsi"),l=Ws(e,"rsi"),a=Ws(i,"volumeDelta");Us(n,"price"),Us(t,"volumeDeltaRsi"),Us(e,"rsi"),Us(i,"volumeDelta");let c=fi(t,"volumeDeltaRsi","trend",0),u=fi(t,"volumeDeltaRsi","erase",1),h=fi(t,"volumeDeltaRsi","divergence",2),d=fi(e,"rsi","trend",0),f=fi(e,"rsi","erase",1),p=fi(e,"rsi","divergence",2);(!K||K.parentElement!==n)&&(K?.parentElement&&K.parentElement.removeChild(K),K=yp(n)),(!tt||tt.parentElement!==e)&&(tt?.parentElement&&tt.parentElement.removeChild(tt),tt=Sp(e)),(!Z||Z.parentElement!==t)&&(Z?.parentElement&&Z.parentElement.removeChild(Z),Z=Mp(t)),(!G||G.parentElement!==i)&&(G?.parentElement&&G.parentElement.removeChild(G),G=wp(i)),Dh(),Lh(),Eh(),Th(),s.dataset.bound||(s.addEventListener("click",m=>{m.stopPropagation();let g=K?.style.display==="block"?"none":"block";mn(),K&&(K.style.display=g)}),s.dataset.bound="1"),o.dataset.bound||(o.addEventListener("click",m=>{m.stopPropagation();let g=Z?.style.display==="block"?"none":"block";mn(),Z&&(Z.style.display=g)}),o.dataset.bound="1"),a.dataset.bound||(a.addEventListener("click",m=>{m.stopPropagation();let g=G?.style.display==="block"?"none":"block";mn(),G&&(G.style.display=g)}),a.dataset.bound="1"),l.dataset.bound||(l.addEventListener("click",m=>{m.stopPropagation();let g=tt?.style.display==="block"?"none":"block";mn(),tt&&(tt.style.display=g)}),l.dataset.bound="1"),c.dataset.bound||(c.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),hp()}),c.dataset.bound="1"),u.dataset.bound||(u.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),dp()}),u.dataset.bound="1"),h.dataset.bound||(h.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),vp()}),h.dataset.bound="1"),d.dataset.bound||(d.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),cp()}),d.dataset.bound="1"),f.dataset.bound||(f.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),up()}),f.dataset.bound="1"),p.dataset.bound||(p.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),gp()}),p.dataset.bound="1"),r.dataset.bound||(r.addEventListener("click",m=>{m.preventDefault(),m.stopPropagation(),R&&Kh(R,!0)}),r.dataset.bound="1"),dt("rsi",Tt),dt("volumeDeltaRsi",Xt),Ne("rsi","divergence",Lt),Ne("volumeDeltaRsi","divergence",Et),document.body.dataset.chartSettingsBound||(document.addEventListener("click",m=>{let g=m.target;g&&(g.closest(".pane-settings-panel")||g.closest(".pane-settings-btn")||mn())}),document.addEventListener("keydown",m=>{m.key==="Escape"&&bp()}),document.body.dataset.chartSettingsBound="1")}function Cp(n){let t=n.querySelector(".price-pane-change");if(t)return t;let e=ta(n);return t=document.createElement("div"),t.className=`price-pane-change ${Ol}`,t.dataset.topPaneBadgeRole="price-change",t.style.position="absolute",t.style.left=`${e}px`,t.style.top="8px",t.style.zIndex="30",t.style.minHeight="24px",t.style.display="inline-flex",t.style.alignItems="center",t.style.padding="0 8px",t.style.borderRadius="4px",t.style.border="1px solid #30363d",t.style.background="#161b22",t.style.color="#c9d1d9",t.style.fontSize="12px",t.style.fontFamily="'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",t.style.pointerEvents="none",t.style.display="none",n.appendChild(t),t}function Dp(n){if(Ie=new Map,!(!Array.isArray(n)||n.length<2))for(let t=1;t<n.length;t++){let e=Number(n[t]?.close),i=Number(n[t-1]?.close);if(!Number.isFinite(e)||!Number.isFinite(i)||i===0)continue;let s=(e-i)/i*100;Ie.set(I(n[t].time),s)}}function xt(n,t){let e=Cp(n);if(!M.length||Ie.size===0){e.style.display="none",e.textContent="",Sn(n);return}let i=M[M.length-1]?.time,s=t!=null?I(t):I(i),r=Number(Ie.get(s));if(!Number.isFinite(r)){e.style.display="none",e.textContent="",Sn(n);return}let o=r>0?"+":"";e.textContent=`${o}${r.toFixed(2)}%`,e.style.color=r>0?"#26a69a":r<0?"#ef5350":"#c9d1d9",e.style.display="inline-flex",Sn(n)}function Tp(n){let t=n.querySelector(".price-pane-message");return t||(t=document.createElement("div"),t.className="price-pane-message",t.style.position="absolute",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",t.style.color="#8b949e",t.style.fontSize="1rem",t.style.fontWeight="600",t.style.pointerEvents="none",t.style.zIndex="20",t.style.display="none",n.appendChild(t),t)}function Uu(n,t){let e=Tp(n);if(!t){e.style.display="none",e.textContent="";return}e.textContent=t,e.style.display="block"}function Lp(n){let t=String(n?.message||n||"");return/No .*data available for this ticker|No valid chart bars/i.test(t)}function Ep(n){if(!Number.isFinite(n))return"";let t=Math.abs(n),e="";if(t>=100)e=String(Math.round(n));else if(t>=10){let i=Math.round(n*10)/10;Math.abs(i)>=100?e=String(Math.round(i)):e=i.toFixed(1)}else e=(Math.round(n*100)/100).toFixed(2);return e.length>=Mt?e:e.padEnd(Mt," ")}function I(n){return typeof n=="number"?String(n):n}function sa(){return{priceRange:{minValue:Dm,maxValue:Tm}}}function Vh(n){return Math.max(oh,Math.min(lh,Number(n)))}function Fh(n){let t=document.getElementById("vd-rsi-chart-container");t&&(t.style.cursor=n?"crosshair":"default")}function de(n){return Zt(n)}function kp(n){return Number.isFinite(n)?we("en-US",{month:"2-digit",day:"2-digit",year:"2-digit"}).format(new Date(Math.round(Number(n))*1e3)):"N/A"}function _p(n){let t=document.createElement("div");return t.className="trendline-cross-label",t.textContent=n,t.style.position="absolute",t.style.zIndex="29",t.style.minHeight="24px",t.style.display="inline-flex",t.style.alignItems="center",t.style.padding="0 8px",t.style.borderRadius="4px",t.style.border="1px solid #30363d",t.style.background="#161b22",t.style.color="#c9d1d9",t.style.fontSize="12px",t.style.fontFamily="'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",t.style.pointerEvents="none",t.style.whiteSpace="nowrap",t.style.transform="translate(-50%, calc(-100% - 6px))",t}function Bh(){let n=document.getElementById("vd-rsi-chart-container");if(!n||!P||!ht)return;let t=n.clientWidth,e=n.clientHeight;for(let i of Js){let s=P.timeScale().timeToCoordinate(i.anchorTime),r=ht.priceToCoordinate(i.anchorValue);if(!Number.isFinite(s)||!Number.isFinite(r)||s<0||s>t||r<0||r>e){i.element.style.display="none";continue}i.element.style.display="inline-flex",i.element.style.left=`${Math.round(s)}px`,i.element.style.top=`${Math.round(Math.max(8,r))}px`}}function ju(){for(let n of Js)n.element.remove();Js=[]}function Rp(n,t,e){let i=document.getElementById("vd-rsi-chart-container");if(!i)return;let s=_p(e);i.appendChild(s),Js.push({element:s,anchorTime:n,anchorValue:t}),Bh()}function Pp(n,t,e,i,s){if(!Number.isFinite(n))return null;if(n>t)return i===null?null:i+(n-t)*s;if(n<0)return e===null?null:e+n*s;let r=Math.max(0,Math.floor(n)),o=Math.min(t,Math.ceil(n)),l=de(V[r]?.time),a=de(V[o]?.time);if(r===o)return l;if(Number.isFinite(l)&&Number.isFinite(a)){let c=n-r;return Number(l)+(Number(a)-Number(l))*c}return Number.isFinite(l)?Number(l)+(n-r)*s:e===null?null:e+n*s}function Ip(n,t,e,i,s,r,o){if(!Number.isFinite(e)||Math.abs(e)<1e-12)return null;let l=n+(Cm-t)/e;return Number.isFinite(l)?Pp(l,i,s,r,o):null}function zh(){if(V.length<2)return 1800;let n=[];for(let t=1;t<V.length;t++){let e=de(V[t-1].time),i=de(V[t].time);if(e===null||i===null)continue;let s=i-e;Number.isFinite(s)&&s>0&&s<=8*3600&&n.push(s)}return n.length===0?1800:(n.sort((t,e)=>t-e),n[Math.floor(n.length/2)])}function Ap(n){return n<=300?78:n<=900?26:n<=1800?13:n<=3600?7:2}function Np(){let n=zh();return Ap(n)*252}function Hh(){if(!(!bn||!P)){try{P.removeSeries(bn)}catch{}bn=null}}function Oh(n=!1){let t=n&&P?P.timeScale().getVisibleLogicalRange?.():null;if(n&&(bi=!0),!P||pn.length===0){pn=[],Ys=[],ju(),n&&(bi=!1);return}try{for(let e of pn)try{P.removeSeries(e)}catch{}pn=[],Ys=[],ju()}finally{if(n&&t)try{P.timeScale().setVisibleLogicalRange(t)}catch{}n&&(bi=!1)}}function Wh(){Hh(),gn=null,Ks.clear()}function En(){Xt=!1,Wh(),Fh(!1)}function $p(){Xt=!0,Fh(!0)}function ra(n=!1){Wh(),Oh(n)}function Vp(n){if(Hh(),!P||n.length===0)return;bn=P.addLineSeries({color:Em,lineVisible:!1,pointMarkersVisible:!0,pointMarkersRadius:2,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,autoscaleInfoProvider:()=>sa()});let t=Math.max(1,Math.ceil(n.length/Lm)),e=t===1?n:n.filter((i,s)=>s%t===0);bn.setData(e)}function Uh(n,t,e,i,s=!0){if(!P||!V.length)return;let r=yi.get(I(n)),o=yi.get(I(e));if(r===void 0||o===void 0||r===o)return;let l=(i-t)/(o-r),a=V.length-1,c=Np(),u=a+c,h=zh(),d=de(V[0]?.time),f=de(V[a]?.time),p=P.timeScale().getVisibleLogicalRange?.(),m=[];bi=!0;try{for(let b=r;b<=u;b++){let w=t+l*(b-r);if(!Number.isFinite(w)||w<oh||w>lh)break;let S=null;b<=a?S=V[b]?.time??null:f!==null&&(S=f+(b-a)*h),S!=null&&m.push({time:S,value:w})}if(!m.length)return;let g=P.addLineSeries({color:km,lineWidth:1,lineStyle:0,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,autoscaleInfoProvider:()=>sa()});g.setData(m),pn.push(g);let v=Ip(r,t,l,a,d,f,h);Rp(n,t,kp(v)),s&&Ys.push({time1:n,value1:Number(t),time2:e,value2:Number(i)})}finally{if(p)try{P.timeScale().setVisibleLogicalRange(p)}catch{}bi=!1}}function Fp(n){if(!Xt)return;let t=I(n),e=yi.get(t);if(e===void 0)return;let i=V[e];if(!i)return;let s=Number(i.value),r=wn.get(t);if(!Number.isFinite(s)||!Number.isFinite(r))return;let o=Number(r);if(!gn){gn={time:n,rsi:s,price:o,index:e};let l=[];Ks.clear();for(let a=e+1;a<V.length;a++){let c=V[a],u=Number(c?.value);if(!Number.isFinite(u))continue;let h=wn.get(I(c.time));if(!Number.isFinite(h))continue;let d=Number(h),f=u<s&&d>o,p=u>s&&d<o;!f&&!p||(l.push({time:c.time,value:u}),Ks.add(I(c.time)))}Vp(l);return}Ks.has(t)&&(Uh(gn.time,gn.rsi,n,s),En(),dt("volumeDeltaRsi",!1),hr())}function Bp(n,t){return!n||!t?!1:Math.abs(Number(n.from)-Number(t.from))<1e-6&&Math.abs(Number(n.to)-Number(t.to))<1e-6}function zp(n){let t=Ge(n,{layout:{background:{color:"#0d1117"},textColor:"#d1d4dc",fontFamily:"'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",attributionLogo:!1},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},crosshair:{mode:Ht?zt.Magnet:zt.Normal},kineticScroll:{touch:!1,mouse:!1},handleScroll:{pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:Ht,mouseWheel:!0},handleScale:{mouseWheel:!0,pinch:!0,axisPressedMouseMove:!0,axisDoubleClickReset:!0},rightPriceScale:{borderColor:"#2b2b43",minimumWidth:Ci,entireTextOnly:!0},timeScale:{visible:!1,timeVisible:!0,secondsVisible:!1,borderVisible:!1,fixRightEdge:!1,rightBarStaysOnScroll:!1,rightOffset:Ln,tickMarkFormatter:Kl}}),e=t.addCandlestickSeries({upColor:"#26a69a",downColor:"#ef5350",borderVisible:!1,wickUpColor:"#26a69a",wickDownColor:"#ef5350",priceFormat:{type:"custom",minMove:.01,formatter:s=>Ep(Number(s))}}),i=t.addLineSeries({color:"rgba(0, 0, 0, 0)",lineVisible:!1,pointMarkersVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1});return{chart:t,series:e,timelineSeries:i}}function Hp(n){let t=Ge(n,{layout:{background:{color:"#0d1117"},textColor:"#c9d1d9",fontFamily:"'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",attributionLogo:!1},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},crosshair:{mode:Ht?zt.Magnet:zt.Normal},kineticScroll:{touch:!1,mouse:!1},handleScroll:{pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:Ht,mouseWheel:!0},handleScale:{mouseWheel:!0,pinch:!0,axisPressedMouseMove:{time:!0,price:!1},axisDoubleClickReset:{time:!0,price:!1}},rightPriceScale:{borderColor:"#21262d",minimumWidth:Ci,entireTextOnly:!0,scaleMargins:{top:.2,bottom:.2}},timeScale:{visible:!1,timeVisible:!0,secondsVisible:!1,borderVisible:!1,fixRightEdge:!1,rightBarStaysOnScroll:!1,rightOffset:Ln,tickMarkFormatter:Kl}}),e=t.addLineSeries({color:D.lineColor,lineWidth:1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1,priceFormat:{type:"custom",minMove:.1,formatter:s=>zm(Number(s))},autoscaleInfoProvider:()=>sa()}),i=t.addLineSeries({color:"rgba(0, 0, 0, 0)",lineVisible:!1,pointMarkersVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1});return Al=e.createPriceLine({price:xm,color:D.midlineColor,lineWidth:1,lineStyle:Rh(D.midlineStyle),axisLabelVisible:!1,title:"Midline"}),t.subscribeClick(s=>{if(!(!s||!s.time)){if(Et){$h(s.time,!1);return}Xt&&Fp(s.time)}}),{chart:t,rsiSeries:e,timelineSeries:i}}function Op(n){let t=Ge(n,{layout:{background:{color:"#0d1117"},textColor:"#c9d1d9",fontFamily:"'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",attributionLogo:!1},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},crosshair:{mode:Ht?zt.Magnet:zt.Normal},kineticScroll:{touch:!1,mouse:!1},handleScroll:{pressedMouseMove:!0,horzTouchDrag:!0,vertTouchDrag:Ht,mouseWheel:!0},handleScale:{mouseWheel:!0,pinch:!0,axisPressedMouseMove:{time:!0,price:!0},axisDoubleClickReset:{time:!0,price:!0}},rightPriceScale:{borderColor:"#21262d",minimumWidth:Ci,entireTextOnly:!0},timeScale:{visible:!1,timeVisible:!0,secondsVisible:!1,borderVisible:!1,fixRightEdge:!1,rightBarStaysOnScroll:!1,rightOffset:Ln,tickMarkFormatter:Kl}}),e=t.addHistogramSeries({base:0,priceLineVisible:!1,lastValueVisible:!1,priceFormat:{type:"custom",minMove:1,formatter:s=>Om(Number(s))}}),i=t.addLineSeries({color:"rgba(0, 0, 0, 0)",lineVisible:!1,pointMarkersVisible:!1,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1});return e.createPriceLine({price:0,color:"#8b949e",lineWidth:1,lineStyle:2,axisLabelVisible:!1,title:""}),X=t,{chart:t,histogramSeries:e,timelineSeries:i}}function Wp(n,t){if(!ht)return;ra(),V=mh(t?.rsi||[]).map(r=>({time:r.time,value:Vh(Number(r.value))})),yi=new Map;for(let r=0;r<V.length;r++)yi.set(I(V[r].time),r);let i=new Map;for(let r of V)i.set(I(r.time),Number(r.value));let s=n.map(r=>{let o=i.get(I(r.time));return Number.isFinite(o)?{time:r.time,value:Number(o)}:{time:r.time}});ht.setData(s),Ae=new Map;for(let r of n){let o=I(r.time),l=i.get(o);Number.isFinite(l)&&Ae.set(o,Number(l))}fr()}function Up(n){if(Oh(),!(!Array.isArray(n)||n.length===0))for(let t of n){let e=t?.time1,i=t?.time2,s=Number(t?.value1),r=Number(t?.value2);typeof e!="string"&&typeof e!="number"||typeof i!="string"&&typeof i!="number"||!Number.isFinite(s)||!Number.isFinite(r)||Uh(e,s,i,r,!0)}}function jp(){if(!R)return;let n=Um(R,gt);T?.restorePersistedTrendlines(n.rsi),Up(n.volumeDeltaRsi)}function Kp(n,t){if(!he)return;let e=new Map;for(let s of t){let r=Number(s.delta);Number.isFinite(r)&&e.set(I(s.time),r)}let i=n.map(s=>{let r=e.get(I(s.time))??0,o=Number.isFinite(Number(r))?Number(r):0;return{time:s.time,value:o,color:o>=0?ah:ch}});he.setData(i),Tn=new Map(i.map(s=>[I(s.time),Number(s.value)||0])),Re()}function qp(n){if(q&&q.parentElement===n)return q.style.top="8px",q.style.transform="none",q.style.right=`${Ci+8}px`,q.style.display="flex",q.style.flexDirection="row",q.style.alignItems="center",q.style.gap=`${rr}px`,q.style.background="transparent",q.style.border="none",q.style.borderRadius="0",q.style.overflow="visible",q;let t=document.createElement("div");return t.className="volume-delta-divergence-summary",t.style.position="absolute",t.style.top="8px",t.style.transform="none",t.style.right=`${Ci+8}px`,t.style.zIndex="34",t.style.display="flex",t.style.flexDirection="row",t.style.alignItems="center",t.style.gap=`${rr}px`,t.style.background="transparent",t.style.border="none",t.style.borderRadius="0",t.style.overflow="visible",t.style.pointerEvents="auto",n.appendChild(t),q=t,t}function zl(){q&&(q.style.display="none",q.innerHTML="")}function pr(n,t,e){if(!C.divergenceTable){zl();return}let i=qp(n);i.innerHTML="",i.style.display="flex",i.style.flexDirection="row",i.style.alignItems="center";let s=String(R||"").trim().toUpperCase(),r=C.sourceInterval,o=e?.noCache===!0,l=`${s}|${r}|${Date.now()}`;i.dataset.requestToken=l;let a=!1,c=null,u=(f,p,m)=>{let g=document.createElement("div");return g.textContent=f,g.title=m,g.style.display="inline-flex",g.style.alignItems="center",g.style.justifyContent="center",g.style.width=`${rt}px`,g.style.height=`${rt}px`,g.style.padding="0",g.style.borderRadius="4px",g.style.border="1px solid #30363d",g.style.background="#161b22",g.style.fontSize="12px",g.style.fontWeight="600",g.style.lineHeight="1",g.style.fontFamily="'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",g.style.color=p,g.style.pointerEvents="none",g},h=()=>{a||(a=!0,d(c,!0),Zi(s,r,{forceRefresh:!0,noCache:!0}).then(f=>{i.dataset.requestToken===l&&String(R||"").trim().toUpperCase()===s&&(c=f||null,d(c,!1))}).catch(()=>{i.dataset.requestToken===l&&String(R||"").trim().toUpperCase()===s&&d(c,!1)}).finally(()=>{a=!1}))},d=(f,p=!1)=>{if(i.dataset.requestToken!==l||String(R||"").trim().toUpperCase()!==s)return;i.innerHTML="";let m=document.createElement("button");m.type="button",m.title=p?"Refreshing divergence table...":"Refresh divergence table",m.style.display="inline-flex",m.style.alignItems="center",m.style.justifyContent="center",m.style.width=`${rt}px`,m.style.height=`${rt}px`,m.style.padding="0",m.style.borderRadius="4px",m.style.border="none",m.style.background="transparent",m.style.color="#c9d1d9",m.style.cursor=p?"wait":"pointer",m.style.pointerEvents=p?"none":"auto",m.style.userSelect="none",m.style.flex="0 0 auto",m.style.verticalAlign="middle",m.setAttribute("aria-disabled",p?"true":"false"),m.disabled=!1;let g="http://www.w3.org/2000/svg",v=document.createElementNS(g,"svg");v.setAttribute("width","14"),v.setAttribute("height","14"),v.setAttribute("viewBox","0 0 24 24"),v.setAttribute("fill","none"),v.setAttribute("stroke","currentColor"),v.setAttribute("stroke-width","2.5"),v.setAttribute("stroke-linecap","round"),v.setAttribute("stroke-linejoin","round"),v.style.display="block";let b=document.createElementNS(g,"path");b.setAttribute("d","M21.5 2v6h-6");let w=document.createElementNS(g,"path");w.setAttribute("d","M21.5 8A10 10 0 0 0 5.6 5.6");let S=document.createElementNS(g,"path");S.setAttribute("d","M2.5 22v-6h6");let x=document.createElementNS(g,"path");x.setAttribute("d","M2.5 16A10 10 0 0 0 18.4 18.4"),v.appendChild(b),v.appendChild(w),v.appendChild(S),v.appendChild(x),p&&v.animate([{transform:"rotate(0deg)"},{transform:"rotate(360deg)"}],{duration:800,iterations:1/0,easing:"linear"}),m.appendChild(v),m.addEventListener("click",A=>{A.preventDefault(),A.stopPropagation(),h()}),i.appendChild(m);for(let A=0;A<Ot.length;A++){let N=Ot[A],B=f?.states?.[String(N)]||"neutral",bt=B==="bullish"?"#26a69a":B==="bearish"?"#ef5350":"#ffffff",et=u(String(N),bt,`Last ${N} day${N===1?"":"s"}${f?.tradeDate?` (as of ${f.tradeDate})`:""}`);i.appendChild(et)}};d(null,!1),!(!s||!Array.isArray(t)||t.length<2)&&Zi(s,r).then(f=>{if(i.dataset.requestToken!==l)return;c=f||null,d(c,!1),(o||!f||!Number.isFinite(f.expiresAtMs)||f.expiresAtMs<=Date.now())&&Zi(s,r,{forceRefresh:!0,noCache:!0}).then(m=>{i.dataset.requestToken===l&&(c=m||null,d(c,!1))}).catch(()=>{})}).catch(()=>{Zi(s,r,{forceRefresh:!0,noCache:!0}).then(f=>{i.dataset.requestToken===l&&(c=f||null,d(c,!1))}).catch(()=>{d(c,!1)})})}var jh="#c9d1d9",Gp="#484f58",Zp="#ef5350";function Xp(n){if(W&&W.parentElement===n)return W;W&&W.parentElement&&W.parentElement.removeChild(W);let t=document.createElement("button");return t.className="vdf-indicator-btn",t.type="button",t.title="Volume Divergence Flag Detector",t.textContent="VDF",t.style.position="absolute",t.style.top=`${ur}px`,t.style.right=`${Ci+8}px`,t.style.zIndex="34",t.style.width="auto",t.style.minWidth=`${rt}px`,t.style.height=`${rt}px`,t.style.padding="0 5px",t.style.borderRadius="4px",t.style.border="1px solid #30363d",t.style.background="#161b22",t.style.color=jh,t.style.cursor="pointer",t.style.fontSize="9px",t.style.fontWeight="700",t.style.fontFamily="'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",t.style.letterSpacing="0.5px",t.style.lineHeight=`${rt}px`,t.style.textAlign="center",t.style.userSelect="none",n.appendChild(t),W=t,t}function Ku(n,t){W&&(W.style.color=n,t!==void 0&&(W.title=t))}function Jp(n){if(!n.is_detected)return"VD Accumulation: Not detected";let e=`VD Accumulation Score: ${Math.round(n.composite_score*100)}`,i=n.zones?.[0];if(i){let r=i.startDate.split("-"),o=i.endDate.split("-"),l=r.length>=3?`${Number(r[1])}/${Number(r[2])}`:i.startDate,a=o.length>=3?`${Number(o[1])}/${Number(o[2])}`:i.endDate;e+=`
Zone: ${l}\u2192${a} (${i.windowDays}d)`,i.absorptionPct!=null&&(e+=`
Absorption: ${(i.absorptionPct*100).toFixed(1)}%`)}n.zones?.length>1&&(e+=`
+${n.zones.length-1} more zone(s)`),n.distribution?.length>0&&(e+=`
Distribution: ${n.distribution.length} cluster(s)`);let s=n.proximity;if(s&&s.level!=="none"){e+=`
Proximity: ${s.level.charAt(0).toUpperCase()+s.level.slice(1)} (${s.compositeScore} pts)`;for(let r of s.signals)e+=`
  \u2713 ${r.detail} +${r.points}`}return e}function Hl(n){if(W){if(n.is_detected){let t=Math.round(n.composite_score*100);W.textContent=String(t),W.style.color=t>=80?"#26a69a":t>=60?"#8bc34a":"#c9d1d9";let e=n.proximity?.level||"none";e==="imminent"||e==="high"?W.style.borderColor="#ff9800":e==="elevated"?W.style.borderColor="#ffc107":W.style.borderColor="#30363d"}else W.textContent="VDF",W.style.color=Gp,W.style.borderColor="#30363d";W.title=Jp(n)}}function Yp(n){if(H&&H.parentElement===n)return H;H?.parentElement&&H.parentElement.removeChild(H);let t=document.createElement("div");return t.className="vd-zone-overlay",t.style.position="absolute",t.style.top="0",t.style.right="0",t.style.bottom="0",t.style.left="0",t.style.pointerEvents="none",t.style.zIndex="5",n.appendChild(t),H=t,t}function Ti(n){if(!H||(H.innerHTML="",!E||!n))return;let t=H.clientWidth||H.offsetWidth,e=H.clientHeight||H.offsetHeight;if(!Number.isFinite(t)||t<=0)return;let i=new Map;for(let h of M){let d=Zt(h?.time);if(d===null)continue;let f=new Date(d*1e3).toLocaleDateString("en-CA",{timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit"});i.has(f)||i.set(f,d)}let s=h=>{let d=i.get(h);if(d===void 0)return null;let f=E.timeScale().timeToCoordinate(d);return Number.isFinite(f)?f:null};if(n.zones)for(let h of n.zones){let d=s(h.startDate),f=s(h.endDate);if(d==null||f==null)continue;let p=Math.min(d,f),m=Math.abs(f-d);if(p>t||p+m<0)continue;let g=.04+h.score*.08,v=document.createElement("div");v.style.cssText=`position:absolute;left:${Math.round(p)}px;top:0;width:${Math.max(Math.round(m),2)}px;height:100%;background:rgba(38,166,154,${g.toFixed(3)});border-left:1px solid rgba(38,166,154,0.3);border-right:1px solid rgba(38,166,154,0.3);`;let b=document.createElement("div");b.style.cssText="position:absolute;top:2px;right:2px;font-size:9px;color:rgba(38,166,154,0.8);font-family:monospace;",b.textContent=(h.score*100).toFixed(0),v.appendChild(b),H.appendChild(v)}if(n.distribution)for(let h of n.distribution){let d=s(h.startDate),f=s(h.endDate);if(d==null||f==null)continue;let p=Math.min(d,f),m=Math.abs(f-d);if(p>t||p+m<0)continue;let g=document.createElement("div");g.style.cssText=`position:absolute;left:${Math.round(p)}px;top:0;width:${Math.max(Math.round(m),2)}px;height:100%;background:rgba(239,83,80,0.06);border-left:1px solid rgba(239,83,80,0.3);border-right:1px solid rgba(239,83,80,0.3);`,H.appendChild(g)}let r=5,o=1,l=2,a=n.zones&&n.zones.length>0,c=n.distribution&&n.distribution.length>0;if(e>60&&(a||c)){let h=e-l-r,d=h-o-r,f=d-o-r;if(n.zones)for(let p of n.zones){let m=s(p.startDate),g=s(p.endDate);if(m==null||g==null)continue;let v=Math.min(m,g),b=Math.abs(g-m);if(v>t||v+b<0)continue;let w=(.4+p.score*.5).toFixed(2),S=document.createElement("div");S.style.cssText=`position:absolute;left:${Math.round(v)}px;top:${f}px;width:${Math.max(Math.round(b),2)}px;height:${r}px;background:rgba(38,166,154,${w});border-radius:1px;`,H.appendChild(S)}if(n.distribution)for(let p of n.distribution){let m=s(p.startDate),g=s(p.endDate);if(m==null||g==null)continue;let v=Math.min(m,g),b=Math.abs(g-m);if(v>t||v+b<0)continue;let w=document.createElement("div");w.style.cssText=`position:absolute;left:${Math.round(v)}px;top:${d}px;width:${Math.max(Math.round(b),2)}px;height:${r}px;background:rgba(239,83,80,0.65);border-radius:1px;`,H.appendChild(w)}if(n.zones)for(let p of n.zones){let m=p.absorptionPct||0;if(m<5)continue;let g=s(p.startDate),v=s(p.endDate);if(g==null||v==null)continue;let b=Math.min(g,v),w=Math.abs(v-g);if(b>t||b+w<0)continue;let S=Math.min(.3+m/100*.6,.9).toFixed(2),x=document.createElement("div");x.style.cssText=`position:absolute;left:${Math.round(b)}px;top:${h}px;width:${Math.max(Math.round(w),2)}px;height:${r}px;background:rgba(255,167,38,${S});border-radius:1px;`,H.appendChild(x)}}if(n.zones)for(let h of n.zones){let d=s(h.startDate),f=s(h.endDate);if(d!=null&&d>=0&&d<=t){let p=document.createElement("div");p.style.cssText=`position:absolute;left:${Math.round(d)}px;top:0;width:0;height:100%;border-left:1px dashed rgba(38,166,154,0.25);`,H.appendChild(p)}if(f!=null&&f>=0&&f<=t){let p=document.createElement("div");p.style.cssText=`position:absolute;left:${Math.round(f)}px;top:0;width:0;height:100%;border-left:1px dashed rgba(38,166,154,0.25);`,H.appendChild(p)}}if(n.distribution)for(let h of n.distribution){let d=s(h.startDate),f=s(h.endDate);if(d!=null&&d>=0&&d<=t){let p=document.createElement("div");p.style.cssText=`position:absolute;left:${Math.round(d)}px;top:0;width:0;height:100%;border-left:1px dashed rgba(239,83,80,0.2);`,H.appendChild(p)}if(f!=null&&f>=0&&f<=t){let p=document.createElement("div");p.style.cssText=`position:absolute;left:${Math.round(f)}px;top:0;width:0;height:100%;border-left:1px dashed rgba(239,83,80,0.2);`,H.appendChild(p)}}let u=n.proximity;if(u&&u.level!=="none"&&u.compositeScore>0){let h=u.level==="imminent"?"244,67,54":u.level==="high"?"255,152,0":"255,193,7",d=u.level==="imminent"?.4:u.level==="high"?.3:.2,f=document.createElement("div");f.style.cssText=`position:absolute;right:0;top:0;width:3px;height:100%;background:rgba(${h},${d});box-shadow:0 0 8px rgba(${h},${(d*1.5).toFixed(2)}),0 0 16px rgba(${h},${d});`,u.level==="imminent"&&(f.className="vdf-prox-pulse"),H.appendChild(f)}}function Qp(){if(!H||!R)return;let n=new Date().toLocaleDateString("en-CA",{timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit"}),t=le.get(`${R}|${n}`);Ti(t||null)}async function Kh(n,t=!1){if(!n||Vs===n&&!t)return;let e=new Date().toLocaleDateString("en-CA",{timeZone:"America/New_York",year:"numeric",month:"2-digit",day:"2-digit"}),i=`${n}|${e}`;if(!t&&le.has(i)){let s=le.get(i);Hl(s),Ti(s),cr(s);return}Vs=n,Ku(jh,"VDF: Loading...");try{let s=new URLSearchParams({ticker:n});t&&s.set("force","1");let r=await fetch(`/api/chart/vdf-status?${s}`);if(!r.ok)throw new Error(`HTTP ${r.status}`);let o=await r.json();if(R!==n)return;let l={is_detected:o.is_detected||!1,composite_score:Number(o.composite_score)||0,status:o.status||"",weeks:Number(o.weeks)||0,zones:Array.isArray(o.zones)?o.zones:[],distribution:Array.isArray(o.distribution)?o.distribution:[],proximity:o.proximity||{compositeScore:0,level:"none",signals:[]},details:o.details||void 0};if(le.set(i,l),le.size>hm){let a=le.keys().next().value;a!==void 0&&le.delete(a)}Hl(l),Ti(l),cr(l)}catch{R===n&&Ku(Zp,"VDF: Failed to load")}finally{Vs===n&&(Vs=null)}}var $t=[{key:"s1",label:"Net Delta",defaultWeight:20,tooltip:"Total net buying as % of total volume. Higher = more buying pressure. Measures raw institutional flow."},{key:"s2",label:"Delta Slope",defaultWeight:15,tooltip:"Trend of cumulative weekly delta. Rising slope = buying is building over time, not a one-off spike."},{key:"s3",label:"Delta Shift",defaultWeight:10,tooltip:"Is buying stronger now than before? Compares avg daily delta in the zone to the pre-context period."},{key:"s4",label:"Accum Ratio",defaultWeight:10,tooltip:"Fraction of weeks with positive delta. High ratio = persistent buying across multiple weeks, not sporadic."},{key:"s5",label:"Buy vs Sell",defaultWeight:5,tooltip:"Ratio of large buy days to large sell days. Detects if big-volume days lean bullish or bearish."},{key:"s6",label:"Absorption",defaultWeight:18,tooltip:"Percentage of days where price fell but delta was positive. Core divergence signal: institutions buying the dip."},{key:"s7",label:"Vol Decline",defaultWeight:5,tooltip:"Volume declining from first-third to last-third of the zone. Supply drying up = fewer sellers remain."},{key:"s8",label:"Divergence",defaultWeight:17,tooltip:"Rewards price-down + delta-up divergence. Score = 0 when price is rising or delta is negative. The thesis signal."}],qh={};$t.forEach(n=>{qh[n.key]=n.defaultWeight});var pt={...qh},Xs=null;function tg(){try{let n=localStorage.getItem("chart_vdf_weights");if(n){let t=JSON.parse(n);if(t&&typeof t=="object")for(let e of $t)typeof t[e.key]=="number"&&(pt[e.key]=t[e.key])}}catch{}}function Rl(){try{localStorage.setItem("chart_vdf_weights",JSON.stringify(pt))}catch{}}function ar(){return $t.reduce((n,t)=>n+(pt[t.key]||0),0)}function Gh(n){if(!n.components)return n.score;let t=ar();if(t<=0)return 0;let e=0;for(let r of $t){let o=n.components[r.key]||0;e+=o*((pt[r.key]||0)/t)}let i=n.concordancePenalty??1,s=n.durationMultiplier??1;return e*i*s}function eg(){let n=ar();return $t.map(t=>{let e=pt[t.key]||0,i=n>0?Math.round(e/n*100):0;return[t.key,t.label,`${i}%`]})}function ig(){let n=document.createElement("div");n.className="vdf-settings-panel",n.style.cssText="background:#161b22;border:1px solid #30363d;border-radius:6px;padding:12px 14px;margin:0 14px 12px;display:none;";function t(){let e=ar(),i=e===100,s=i?"#26a69a":e>100?"#f44336":"#ffc107",r=$t.map(l=>{let a=pt[l.key]||0;return`<div style="display:grid;grid-template-columns:110px 48px;gap:8px;align-items:center;margin:3px 0;" title="${lt(l.tooltip)}">
        <label style="color:#8b949e;font-size:11px;white-space:nowrap;cursor:help;border-bottom:1px dotted #484f58;" title="${lt(l.tooltip)}">${lt(l.label)}</label>
        <input type="text" inputmode="numeric" value="${a}" data-vdf-weight="${l.key}"
          style="width:42px;height:22px;background:#0d1117;color:#c9d1d9;border:1px solid #30363d;border-radius:3px;font-size:11px;font-family:'SF Mono',Menlo,Monaco,Consolas,monospace;text-align:center;padding:0 2px;outline:none;" />
      </div>`}).join(""),o=$t.every(l=>pt[l.key]===l.defaultWeight);n.innerHTML=`
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px;">
        <span style="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:#8b949e;">Scoring Weights</span>
        <div style="display:flex;gap:6px;align-items:center;">
          <span class="vdf-weight-total" style="font-size:10px;color:${s};font-family:'SF Mono',Menlo,Monaco,Consolas,monospace;font-weight:600;">${e}%</span>
          <button type="button" data-vdf-weight-action="reset" style="background:#0d1117;color:${o?"#484f58":"#c9d1d9"};border:1px solid #30363d;border-radius:4px;padding:2px 8px;font-size:10px;cursor:pointer;${o?"opacity:0.5;":""}" title="Reset to default weights">Reset</button>
          <button type="button" data-vdf-weight-action="run" style="background:${i?"#26a69a":"#21262d"};color:${i?"#fff":"#484f58"};border:1px solid ${i?"#26a69a":"#30363d"};border-radius:4px;padding:2px 8px;font-size:10px;font-weight:600;cursor:${i?"pointer":"default"};${i?"":"opacity:0.5;"}" title="${i?"Re-run VDF with these weights":"Weights must total 100% to run"}">Run</button>
        </div>
      </div>
      ${r}
      <div style="margin-top:8px;font-size:10px;color:#484f58;line-height:1.4;">${i?"Weights total 100%. Click Run to re-score, or edit values.":`Weights must total 100% to run (currently ${e}%).`}</div>
    `}return t(),n.addEventListener("change",e=>{let i=e.target,s=i?.dataset?.vdfWeight;if(!s)return;let r=Math.max(0,Math.min(100,Math.round(Number(i.value)||0)));pt[s]=r,Rl(),t()}),n.addEventListener("blur",e=>{let i=e.target,s=i?.dataset?.vdfWeight;if(!s)return;let r=Math.max(0,Math.min(100,Math.round(Number(i.value)||0)));pt[s]!==r&&(pt[s]=r,Rl(),t())},!0),n.addEventListener("click",e=>{let i=e.target;if(i?.dataset?.vdfWeightAction==="reset"&&($t.forEach(s=>{pt[s.key]=s.defaultWeight}),Rl(),t(),qu()),i?.dataset?.vdfWeightAction==="run"){if(ar()!==100)return;qu()}}),Xs=n,n}function ng(){if(!Xs)return;let n=Xs.style.display==="none";Xs.style.display=n?"block":"none"}function qu(){let n=R||"",t=new Date().toISOString().split("T")[0],e=`${n}|${t}`,i=le.get(e);i&&(cr(i),Hl(i),Ti(i))}function ue(n){let t=n.split("-");return t.length<3?n:`${Number(t[1])}/${Number(t[2])}`}function sg(n){return n>=80?"Strong":n>=60?"Moderate":n>=40?"Weak":"Marginal"}function Zh(n){return n>=80?"#26a69a":n>=60?"#8bc34a":"#c9d1d9"}function Xh(n){return n==="imminent"?"#f44336":n==="high"?"#ff9800":n==="elevated"?"#ffc107":"#8b949e"}function Jh(){if(Gt)return Gt;let n=document.getElementById("chart-content");if(!n)return document.createElement("div");let t=document.createElement("div");return t.id="vdf-analysis-panel",t.style.cssText='width:100%;border-radius:6px;border:1px solid #30363d;background:#0d1117;color:#c9d1d9;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",sans-serif;font-size:13px;line-height:1.5;overflow:hidden;display:none;',n.appendChild(t),Gt=t,t}function rg(){if(!Gt)return;let n=Gt.querySelector(".vdf-ap-body");if(!n)return;let t=n.style.display==="none";n.style.display=t?"block":"none";let e=Gt.querySelector(".vdf-ap-chevron");e&&(e.textContent=t?"\u25BE":"\u25B8");try{localStorage.setItem("chart_vdf_panel_collapsed",t?"0":"1")}catch{}}function og(n){return eg().map(([t,e,i])=>{let s=Number(n[t])||0,r=Math.max(0,Math.min(100,Math.round(s*100))),o=s>=.7?"#26a69a":s>=.4?"#8bc34a":"#484f58";return`<div style="display:grid;grid-template-columns:130px 1fr 36px;gap:6px;align-items:center;margin:2px 0;">
      <span style="color:#8b949e;font-size:11px;white-space:nowrap;">${lt(e)} (${i})</span>
      <div style="height:4px;background:#21262d;border-radius:2px;overflow:hidden;">
        <div style="height:100%;width:${r}%;background:${o};border-radius:2px;"></div>
      </div>
      <span style="color:#c9d1d9;font-size:11px;font-family:'SF Mono',Menlo,Monaco,Consolas,monospace;text-align:right;">${s.toFixed(2)}</span>
    </div>`}).join("")}function lg(n,t,e){let i=Gh(n),s=Math.round(i*100),r=Math.round(n.score*100),o=!$t.every(m=>pt[m.key]===m.defaultWeight),l=e?`Zone ${t+1} (Primary)`:`Zone ${t+1}`,a=Zh(s),c="",u=[];n.overallPriceChange!=null&&u.push(`Price: ${n.overallPriceChange>=0?"+":""}${n.overallPriceChange.toFixed(1)}%`),n.netDeltaPct!=null&&u.push(`Net Delta: ${n.netDeltaPct>=0?"+":""}${n.netDeltaPct.toFixed(1)}%`),n.absorptionPct!=null&&u.push(`Absorption: ${n.absorptionPct.toFixed(1)}%`),u.length&&(c=`<div style="margin:4px 0;color:#8b949e;font-size:12px;">${u.join(" &nbsp;|&nbsp; ")}</div>`);let h="",d=[];n.accumWeeks!=null&&n.weeks&&d.push(`Accum weeks: ${n.accumWeeks}/${n.weeks} (${Math.round(n.accumWeeks/n.weeks*100)}%)`),n.durationMultiplier!=null&&d.push(`Duration: ${n.durationMultiplier.toFixed(3)}x`),n.concordancePenalty!=null&&n.concordancePenalty<1&&d.push(`Concordance: ${n.concordancePenalty.toFixed(3)}x`),d.length&&(h=`<div style="margin:2px 0;color:#8b949e;font-size:12px;">${d.join(" &nbsp;|&nbsp; ")}</div>`);let f="";n.components&&(f=`<div style="margin-top:8px;"><div style="color:#8b949e;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.5px;margin-bottom:4px;">Components</div>${og(n.components)}</div>`);let p=o&&r!==s?`<span style="font-size:10px;color:#484f58;margin-left:4px;" title="Server score with default weights">(was ${r})</span>`:"";return`<div style="background:#161b22;border:1px solid #21262d;border-radius:4px;padding:12px;margin-bottom:8px;">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:4px;">
      <span style="font-weight:600;font-size:13px;color:#c9d1d9;">${lt(l)}</span>
      <span><span style="font-family:'SF Mono',Menlo,Monaco,Consolas,monospace;font-size:13px;font-weight:700;color:${a};">${s}</span>${p}</span>
    </div>
    <div style="color:#c9d1d9;font-size:12px;">${ue(n.startDate)} \u2192 ${ue(n.endDate)} (${n.windowDays} trading days${n.weeks?`, ${n.weeks} wk`:""})</div>
    ${c}
    ${h}
    ${f}
  </div>`}function ag(n,t){let e="",i=[];return n.priceChangePct!=null&&i.push(`Price ${n.priceChangePct>=0?"+":""}${n.priceChangePct.toFixed(1)}%`),n.netDeltaPct!=null&&i.push(`Delta ${n.netDeltaPct>=0?"+":""}${n.netDeltaPct.toFixed(1)}%`),i.length&&(e=i.join(" while ")+" \u2014 selling into strength."),`<div style="background:rgba(239,83,80,0.06);border:1px solid rgba(239,83,80,0.2);border-radius:4px;padding:10px 12px;margin-bottom:8px;">
    <div style="font-weight:600;font-size:12px;color:#ef5350;margin-bottom:2px;">Cluster ${t+1}: ${ue(n.startDate)} \u2192 ${ue(n.endDate)} (${n.spanDays} days)</div>
    ${e?`<div style="color:#8b949e;font-size:12px;">${lt(e)}</div>`:""}
  </div>`}function cg(n){if(n.level==="none"&&n.compositeScore===0)return"";let t=n.level.charAt(0).toUpperCase()+n.level.slice(1),e=Xh(n.level),i=n.signals.map(s=>`<div style="display:flex;justify-content:space-between;align-items:center;padding:2px 0;font-size:12px;">
      <span style="color:#c9d1d9;">\u2713 ${lt(s.detail)}</span>
      <span style="color:${e};font-family:'SF Mono',Menlo,Monaco,Consolas,monospace;font-weight:600;white-space:nowrap;margin-left:12px;">+${s.points}</span>
    </div>`).join("");return`<div style="margin-top:4px;">
    <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;">
      <span style="font-family:'SF Mono',Menlo,Monaco,Consolas,monospace;font-size:13px;font-weight:700;color:${e};">${n.compositeScore} pts</span>
      <span style="font-size:11px;font-weight:600;color:${e};border:1px solid ${e};border-radius:3px;padding:0 5px;line-height:16px;">${t}</span>
    </div>
    ${i}
  </div>`}function cr(n){tg();let t=Jh();if(!n){t.style.display="none",t.innerHTML="";return}let e=R||"",i=n.zones[0],s=i?Math.round(Gh(i)*100):0,r=n.is_detected?s:Math.round(n.composite_score*100),o=sg(r),l=Zh(r),a=n.details?.metrics,c=!$t.every(S=>pt[S.key]===S.defaultWeight),u=!0;try{u=localStorage.getItem("chart_vdf_panel_collapsed")!=="0"}catch{}n.is_detected&&!localStorage.getItem("chart_vdf_panel_collapsed")&&(u=!1);let h=u?"\u25B8":"\u25BE",d=u?"none":"block",p=`<span class="vdf-ap-gear" style="font-size:14px;color:${c?"#26a69a":"#484f58"};cursor:pointer;margin-right:8px;padding:2px 4px;" title="VDF scoring weights">\u2699</span>`,m=`<div class="vdf-ap-header" style="display:flex;justify-content:space-between;align-items:center;padding:10px 14px;cursor:pointer;user-select:none;border-bottom:1px solid #21262d;">
    <div style="display:flex;align-items:center;gap:8px;">
      <span class="vdf-ap-chevron" style="font-size:12px;color:#8b949e;width:12px;">${h}</span>
      <span style="font-weight:600;color:#c9d1d9;">VD Analysis</span>
      <span style="color:#8b949e;font-family:'SF Mono',Menlo,Monaco,Consolas,monospace;font-size:12px;">${lt(e)}</span>
    </div>
    <div style="display:flex;align-items:center;">
      ${p}
      ${n.is_detected?`<span style="font-family:'SF Mono',Menlo,Monaco,Consolas,monospace;font-size:13px;font-weight:700;color:${l};">${r}</span>`:'<span style="font-size:11px;color:#484f58;">Not detected</span>'}
    </div>
  </div>`,g="";if(n.is_detected){let S=n.zones.length,x=`Volume-delta accumulation <span style="color:${l};font-weight:600;">${o}</span> (score: ${r}).`;x+=` ${S} accumulation zone${S!==1?"s":""} detected`,n.weeks&&(x+=` spanning up to ${n.weeks} weeks`),x+=".",a?.scanStart&&a?.scanEnd&&(x+=` Scan: ${ue(a.scanStart)} \u2192 ${ue(a.scanEnd)}`,a.totalDays&&(x+=` (${a.totalDays} trading days)`),x+="."),n.distribution.length>0&&(x+=` <span style="color:#ef5350;">${n.distribution.length} distribution cluster${n.distribution.length!==1?"s":""}</span> also found.`);let A=`<div style="margin-bottom:16px;font-size:13px;color:#c9d1d9;">${x}</div>`,N="display:inline-block;width:14px;height:5px;border-radius:1px;vertical-align:middle;margin-right:5px;",B="display:inline-block;width:14px;height:0;border-top:1px dashed;vertical-align:middle;margin-right:5px;",bt="display:inline-block;width:3px;height:12px;border-radius:1px;vertical-align:middle;margin-right:5px;",et=[];et.push(`<span style="white-space:nowrap;"><span style="${N}background:rgba(38,166,154,0.7);"></span>Accumulation</span>`),n.distribution.length>0&&et.push(`<span style="white-space:nowrap;"><span style="${N}background:rgba(239,83,80,0.65);"></span>Distribution</span>`),n.zones.some(ot=>(ot.absorptionPct||0)>=5)&&et.push(`<span style="white-space:nowrap;"><span style="${N}background:rgba(255,167,38,0.7);"></span>Absorption</span>`),et.push(`<span style="white-space:nowrap;"><span style="${B}border-color:rgba(38,166,154,0.4);"></span>Zone bounds</span>`);let $e=n.proximity;if($e&&$e.level!=="none"&&$e.compositeScore>0){let ot=Xh($e.level);et.push(`<span style="white-space:nowrap;"><span style="${bt}background:${ot};box-shadow:0 0 4px ${ot};"></span>Proximity</span>`)}let kn=`<div style="display:flex;flex-wrap:wrap;gap:12px 16px;padding:8px 12px;background:#161b22;border:1px solid #21262d;border-radius:4px;margin-bottom:16px;font-size:11px;color:#8b949e;">${et.join("")}</div>`,me="font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:#8b949e;margin:16px 0 8px;border-bottom:1px solid #21262d;padding-bottom:4px;",Ve="";n.zones.length>0&&(Ve=`<div style="${me}">Accumulation Zones</div>`,Ve+=n.zones.map((ot,Yt)=>lg(ot,Yt,Yt===0)).join(""));let Jt="";n.distribution.length>0&&(Jt=`<div style="${me}">Distribution Clusters</div>`,Jt+=n.distribution.map((ot,Yt)=>ag(ot,Yt)).join(""));let Fe="",ft=n.proximity;if(ft&&(ft.level!=="none"||ft.compositeScore>0)){let ot=ft.level.charAt(0).toUpperCase()+ft.level.slice(1);Fe=`<div style="${me}">Proximity Signals (${ft.compositeScore} pts \u2014 ${ot})</div>`,Fe+=cg(ft)}g=`<div style="padding:14px;">${A}${kn}${Ve}${Jt}${Fe}</div>`}else{let S="";a?.scanStart&&a?.scanEnd&&(S=` Scan: ${ue(a.scanStart)} \u2192 ${ue(a.scanEnd)}`,a.totalDays&&(S+=` (${a.totalDays} trading days)`),S+="."),g=`<div style="padding:14px;color:#8b949e;font-size:13px;">No accumulation patterns detected in the scan period.${S}</div>`}t.innerHTML=`${m}<div class="vdf-ap-body" style="display:${d};">${g}</div>`,t.style.display="block";let v=t.querySelector(".vdf-ap-body");if(v){let S=ig();v.insertBefore(S,v.firstChild)}let b=t.querySelector(".vdf-ap-header");b&&b.addEventListener("click",S=>{S.target.closest(".vdf-ap-gear")||rg()});let w=t.querySelector(".vdf-ap-gear");w&&w.addEventListener("click",S=>{S.stopPropagation(),ng()})}function Re(){if(!ct)return;if(!Array.isArray(M)||M.length===0){ct.setData([]);return}if(!C.divergentPriceBars){ct.setData(M);return}let n=C.bullishDivergentColor||Dt.bullishDivergentColor,t=C.bearishDivergentColor||Dt.bearishDivergentColor,i=String(C.neutralDivergentColor||"").trim().toLowerCase()==="#c9d1d9"?Dt.neutralDivergentColor:C.neutralDivergentColor||Dt.neutralDivergentColor,s=M.map((r,o)=>{let l=Number(r?.close),a=Number(M[o-1]?.close),c=Number(Tn.get(I(r.time))),u=o>0&&Number.isFinite(l)&&Number.isFinite(a),h=Number.isFinite(c),d=i;if(u&&h){let f=c>0&&l<a,p=c<0&&l>a;f?d=n:p&&(d=t)}return{...r,color:d}});ct.setData(s)}function ug(n){return n.filter(t=>t&&(typeof t.time=="string"||typeof t.time=="number")&&Number.isFinite(Number(t.open))&&Number.isFinite(Number(t.high))&&Number.isFinite(Number(t.low))&&Number.isFinite(Number(t.close)))}function gr(n,t,e,i){if(!E)return;let s=n.getBoundingClientRect(),r=t.getBoundingClientRect(),o=e.getBoundingClientRect(),l=i.getBoundingClientRect(),a=Math.max(1,Math.floor(s.width)),c=Math.max(1,Math.floor(s.height)),u=Math.max(1,Math.floor(r.width)),h=Math.max(1,Math.floor(r.height)),d=Math.max(1,Math.floor(o.width)),f=Math.max(1,Math.floor(o.height)),p=Math.max(1,Math.floor(l.width)),m=Math.max(1,Math.floor(l.height));E.applyOptions({width:a,height:c}),P&&P.applyOptions({width:u,height:h}),T&&(T.getChart().applyOptions({width:d,height:f}),T.refreshTrendlineLabels()),X&&X.applyOptions({width:p,height:m}),fe()}function hg(n,t,e,i){di||(di=new ResizeObserver(()=>{gr(n,t,e,i)}),di.observe(n),di.observe(t),di.observe(e),di.observe(i))}function dg(n,t,e,i){let s=[n,t,e,i];for(let r of s){let o=xn[r.id];o&&o>=Ul&&o<=jl&&(r.style.height=`${o}px`)}}function fg(n,t,e,i){if($u)return;$u=!0;let s=[n,t,e,i];for(let r of s){let o=document.createElement("div");o.className="pane-resize-handle",r.appendChild(o);let l=0,a=0,c=h=>{let d=h.clientY-l,f=Math.min(jl,Math.max(Ul,a+d));r.style.height=`${f}px`},u=h=>{o.classList.remove("active"),o.releasePointerCapture(h.pointerId),o.removeEventListener("pointermove",c),o.removeEventListener("pointerup",u);let d=r.getBoundingClientRect().height;xn[r.id]=Math.round(d),F()};o.addEventListener("pointerdown",h=>{h.preventDefault(),h.stopPropagation(),l=h.clientY,a=r.getBoundingClientRect().height,o.classList.add("active"),o.setPointerCapture(h.pointerId),o.addEventListener("pointermove",c),o.addEventListener("pointerup",u)}),o.addEventListener("dblclick",h=>{h.preventDefault(),h.stopPropagation();let d=Rm[r.id];d&&(r.style.height=`${d}px`,delete xn[r.id],F())})}}function re(n){let t=n.querySelector(".chart-loading-overlay");t&&t.remove();let e=document.createElement("div");e.className="chart-loading-overlay",e.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(13, 17, 23, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    pointer-events: none;
  `;let i=document.createElement("div");i.innerHTML=`
    <svg width="40" height="40" viewBox="0 0 40 40" style="animation: spin 1s linear infinite;">
      <circle cx="20" cy="20" r="16" fill="none" stroke="#58a6ff" stroke-width="3"
              stroke-dasharray="80" stroke-dashoffset="60" stroke-linecap="round" opacity="0.8"/>
    </svg>
    <style>
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
    </style>
  `,e.appendChild(i),n.appendChild(e)}function js(n,t){let e=n.querySelector(".chart-loading-overlay");e&&e.remove();let i=document.createElement("div");i.className="chart-loading-overlay",i.style.cssText=`
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(13, 17, 23, 0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    pointer-events: auto;
  `;let s=document.createElement("button");s.type="button",s.textContent="Try Refreshing",s.style.background="#161b22",s.style.color="#c9d1d9",s.style.border="1px solid #30363d",s.style.borderRadius="6px",s.style.padding="8px 12px",s.style.fontSize="12px",s.style.fontWeight="600",s.style.cursor="pointer",s.style.fontFamily="'SF Mono', 'Menlo', 'Monaco', 'Consolas', monospace",s.addEventListener("click",r=>{r.preventDefault(),t()}),i.appendChild(s),n.appendChild(i)}function oe(n){let t=n.querySelector(".chart-loading-overlay");t&&t.remove()}function mg(n){let t=R;t&&(dn!==null&&(window.clearTimeout(dn),dn=null),dn=window.setTimeout(()=>{dn=null,!(!R||R!==t)&&At(t,n)},fm))}function pg(){return!(document.visibilityState!=="visible"||document.getElementById("view-live")?.classList.contains("hidden")||document.getElementById("ticker-view")?.classList.contains("hidden"))}function gg(n){if(!ct||!T||!ht||!he||!Array.isArray(M)||M.length===0)return!1;let t=M.length-1,e=M[t],i=n.latestBar;if(!i||I(e?.time)!==I(i.time))return!1;let s=e.time,r=I(s);M[t]={...e,...i};let o=Number(M[t].close);if(Number.isFinite(o)&&wn.set(r,o),Mn.set(r,t),t>0){let u=Number(M[t-1]?.close);if(Number.isFinite(u)&&u!==0&&Number.isFinite(o)){let h=(o-u)/u*100;Ie.set(r,h)}}let l=Number(n.latestRsi?.value);if(Number.isFinite(l)&&(Li.set(r,Number(l)),!T.updateLatestPoint({time:s,value:Number(l)},Number.isFinite(o)?{time:s,close:o}:void 0)))return!1;let a=Number(n.latestVolumeDeltaRsi?.value);if(Number.isFinite(a)){let u=Vh(Number(a));Ae.set(r,u),V.length>0&&I(V[V.length-1].time)===r&&(V[V.length-1]={...V[V.length-1],value:u}),ht.update({time:s,value:u})}let c=Number(n.latestVolumeDelta?.delta);if(Number.isFinite(c)){let u=Number(c);Tn.set(r,u),he.update({time:s,value:u,color:u>=0?ah:ch})}return C.divergentPriceBars?Re():ct.update(M[t]),qm(),j&&xt(j,null),Pe&&pr(Pe,M),fr(),!0}async function vg(n,t){let e=performance.now(),i=null,s=await gc(n,t,{vdRsiLength:D.length,vdSourceInterval:C.sourceInterval,vdRsiSourceInterval:D.sourceInterval,onResponseMeta:u=>{i=u.chartCacheHeader}});if(Sh(t,performance.now()-e,i),!R||R!==n||gt!==t||!Array.isArray(M)||M.length===0)return;let r=M[M.length-1]?.time,o=s.latestBar;if(r==null||!o){await At(n,t,{silent:!0});return}let l=I(r),a=I(o.time);if(l!==a){await At(n,t,{silent:!0});return}gg(s)||await At(n,t,{silent:!0})}function Gu(n,t,e,i,s){let r=ug(n.bars||[]);if(r.length===0)throw new Error("No valid chart bars returned for this ticker/interval");Qs=Am(r),dh(r);let o=fh(r,k.length),l={rsi:mh(n.volumeDeltaRsi?.rsi||[])},a=Hm(n.volumeDelta||[]);M=r,Mn=new Map;for(let c=0;c<r.length;c++)Mn.set(I(r[c].time),c);Dp(r),wn=new Map(r.map(c=>[I(c.time),Number(c.close)])),Li=new Map(o.filter(c=>Number.isFinite(Number(c.value))).map(c=>[I(c.time),Number(c.value)])),ct&&ct.setData(r),xt(t,null),Wp(r,l),Kp(r,a),pr(s,r),na(),!T&&i?(T=new as({container:i,data:o,displayMode:"line",lineColor:k.lineColor,midlineColor:k.midlineColor,midlineStyle:k.midlineStyle,priceData:r.map(c=>({time:c.time,close:c.close})),onTrendLineDrawn:()=>{T?.deactivateDivergenceTool(),Tt=!1,dt("rsi",!1),hr()}}),gr(t,e,i,s),dr()):T&&T.setData(o,r.map(c=>({time:c.time,close:c.close}))),ia(),jp(),wg(),ce(),yg(),Yh(),fe(),R&&Kh(R)}function bg(){yn===null&&(yn=window.setInterval(()=>{if(Zs||Kt||!R||!pg())return;let n=R,t=gt;Zs=!0,vg(n,t).catch(()=>{}).finally(()=>{Zs=!1})},mm))}function gu(){return sr}function oa(){if(Gs){try{Gs.abort()}catch{}Gs=null}}function $s(){if(Kt){try{Kt.abort()}catch{}Kt=null}oa(),yn!==null&&(window.clearInterval(yn),yn=null),Zs=!1,sr=!1,qs++}async function At(n,t=gt,e={}){let i=e.silent===!0;jm();let s=R,r=gt,o=++qs,l=typeof s=="string"&&(s!==n||r!==t),a=t==="1week"&&(typeof s!="string"||l);gt=t,R=n;let c=ql(n,t);l&&(Si=!1,wi=!1,Mi=null,xi=null,Lt=!1,Et=!1,Xt=!1,Tt=!1,Di("rsi"),Di("volumeDeltaRsi"),$l=!1,qt=!1,Gt&&(Gt.style.display="none",Gt.innerHTML=""));let u=document.getElementById("chart-content");if(!u||!(u instanceof HTMLElement)){console.error("Chart content container not found");return}tp(u);let h=document.getElementById("price-chart-container"),d=document.getElementById("vd-rsi-chart-container"),f=document.getElementById("rsi-chart-container"),p=document.getElementById("vd-chart-container"),m=document.getElementById("chart-error");if(!h||!d||!f||!p||!m){console.error("Chart containers not found");return}if(j=h,Pe=p,m.style.display="none",m.textContent="",Uu(h,null),Fs(h,"price"),Fs(d,"volumeDeltaRsi"),Fs(f,"rsi"),Fs(p,"volumeDelta"),Yp(h),Jh(),xp(h,d,f,p),ea(),!E){let{chart:w,series:S,timelineSeries:x}=zp(h);E=w,ct=S,Pl=x,Ql()}if(!P){let{chart:w,rsiSeries:S,timelineSeries:x}=Hp(d);P=w,ht=S,Il=x,na()}if(!X){let{chart:w,histogramSeries:S,timelineSeries:x}=Op(p);X=w,he=S,Nl=x}dg(h,d,f,p),hg(h,d,f,p),fg(h,d,f,p),gr(h,d,f,p),dr();let g=i?null:Zl(c),v=!!g;if(g){let w=performance.now();Gu(g,h,d,f,p),Bu(t,performance.now()-w),a&&Zu(),zu(n,t)}else i||(re(h),re(d),re(f),re(p));if(oa(),Kt)try{Kt.abort()}catch{}let b=new AbortController;Kt=b,i||(sr=!0);try{let w=performance.now(),S=null,x=await rs(n,t,{vdRsiLength:D.length,vdSourceInterval:C.sourceInterval,vdRsiSourceInterval:D.sourceInterval,signal:b.signal,onResponseMeta:N=>{S=N.chartCacheHeader}});if(Sh(t,performance.now()-w,S),o!==qs)return;if(!v||Fu(g)!==Fu(x)){let N=performance.now();Gu(x,h,d,f,p),Bu(t,performance.now()-N),a&&Zu()}Xl(c,x),zu(n,t),i||(oe(h),oe(d),oe(f),oe(p))}catch(w){if(o!==qs||w?.name==="AbortError"||(console.error("Failed to load chart:",w),i)||v)return;if(Lp(w)){oe(h),oe(d),oe(f),oe(p),ct&&ct.setData([]),Ie=new Map,xt(h,null),T&&T.setData([],[]),P&&ht?.setData([]),X&&he?.setData([]),dh([]),ra(),V=[],yi=new Map,Ae=new Map,Tn=new Map,zl(),M=[],Mn=new Map,Yl(),Qs=[],Bs(tr),Bs(er),Bs(ir),Bs(nr),Ti(null),cr(null),Uu(h,Sm),Cn(),Dn(),m.style.display="none",m.textContent="";return}Ie=new Map,xt(h,null),zl(),Cn(),Dn(),m.style.display="none",m.textContent="";let S=()=>{re(h),re(d),re(f),re(p),At(n,t)};js(h,S),js(d,S),js(f,S),js(p,S)}finally{i||(sr=!1),Kt===b&&(Kt=null)}}function Yh(){if(!E)return;let n=E.timeScale().getVisibleLogicalRange();if(n)try{P&&P.timeScale().setVisibleLogicalRange(n),T&&T.getChart().timeScale().setVisibleLogicalRange(n),X&&X.timeScale().setVisibleLogicalRange(n),fe()}catch{}}function yg(){if(!E)return;let n=Ln;E.timeScale().applyOptions({rightOffset:n}),P&&P.timeScale().applyOptions({rightOffset:n}),T&&T.getChart().timeScale().applyOptions({rightOffset:n}),X&&X.timeScale().applyOptions({rightOffset:n}),fe()}function Zu(){if(!E||gt!=="1week"||!Array.isArray(M)||M.length===0)return;let n=M.length-1,t=Math.min(M.length,78),e=Math.max(0,n-t+1),i=n+Ln;try{E.timeScale().setVisibleLogicalRange({from:e,to:i}),Yh(),fe()}catch{}}function gi(n,t){let e=Number(t.get(I(n)));if(Number.isFinite(e))return e;if(!Array.isArray(M)||M.length===0)return null;let i=de(n);for(let s=M.length-1;s>=0;s--){let r=M[s];if(!r)continue;let o=r.time;if(i!==null){let a=de(o);if(a!==null&&a>i)continue}let l=Number(t.get(I(o)));if(Number.isFinite(l))return l}return null}function Sg(){qt=!qt;let n={visible:!qt},t={crosshair:{vertLine:n,horzLine:n}};E&&E.applyOptions(t),P&&P.applyOptions(t),X&&X.applyOptions(t),T&&T.getChart()?.applyOptions(t),qt&&(E?.clearCrosshairPosition(),P?.clearCrosshairPosition(),X?.clearCrosshairPosition(),T?.getChart()?.clearCrosshairPosition())}function wg(){if($l||!E||!P||!T||!X||!ct||!ht||!he)return;$l=!0;let n=P,t=T.getChart(),e=X,i=null,s=u=>{requestAnimationFrame(()=>{i===u&&(i=null)})},r=(u,h)=>{if(!h)return;let d=[{owner:"price",chart:E},{owner:"volumeDeltaRsi",chart:n},{owner:"rsi",chart:t},{owner:"volumeDelta",chart:e}];for(let f of d){if(f.owner===u)continue;let p=f.chart.timeScale().getVisibleLogicalRange();Bp(p,h)||f.chart.timeScale().setVisibleLogicalRange(h)}fe()};E.timeScale().subscribeVisibleLogicalRangeChange(u=>{if(!(!u||i==="volumeDeltaRsi"||i==="rsi"||i==="volumeDelta")){i="price";try{r("price",u)}finally{s("price")}}}),n.timeScale().subscribeVisibleLogicalRangeChange(u=>{if(!bi&&!(!u||i==="price"||i==="rsi"||i==="volumeDelta")){i="volumeDeltaRsi";try{r("volumeDeltaRsi",u)}finally{s("volumeDeltaRsi")}}}),t.timeScale().subscribeVisibleLogicalRangeChange(u=>{if(!T?.isSyncSuppressed?.()&&!(!u||i==="price"||i==="volumeDeltaRsi"||i==="volumeDelta")){i="rsi";try{r("rsi",u)}finally{s("rsi")}}}),e.timeScale().subscribeVisibleLogicalRangeChange(u=>{if(!(!u||i==="price"||i==="volumeDeltaRsi"||i==="rsi")){i="volumeDelta";try{r("volumeDelta",u)}finally{s("volumeDelta")}}});let o=u=>{let h=gi(u,wn);if(Number.isFinite(h)&&ct)try{E.setCrosshairPosition(Number(h),u,ct)}catch{E.clearCrosshairPosition()}else E.clearCrosshairPosition()},l=u=>{let h=gi(u,Ae);if(Number.isFinite(h))try{n.setCrosshairPosition(Number(h),u,ht)}catch{n.clearCrosshairPosition()}else n.clearCrosshairPosition()},a=u=>{let h=gi(u,Li),d=T?.getSeries();if(Number.isFinite(h)&&d)try{t.setCrosshairPosition(Number(h),u,d)}catch{t.clearCrosshairPosition()}else t.clearCrosshairPosition()},c=u=>{let h=gi(u,Tn);if(Number.isFinite(h))try{e.setCrosshairPosition(Number(h),u,he)}catch{e.clearCrosshairPosition()}else e.clearCrosshairPosition()};if(E.subscribeCrosshairMove(u=>{if(!u||!u.time){n.clearCrosshairPosition(),t.clearCrosshairPosition(),e.clearCrosshairPosition(),j&&xt(j,null);return}qt||(j&&xt(j,u.time),l(u.time),a(u.time),c(u.time))}),n.subscribeCrosshairMove(u=>{if(!u||!u.time){E.clearCrosshairPosition(),t.clearCrosshairPosition(),e.clearCrosshairPosition(),j&&xt(j,null);return}qt||(Et&&$h(u.time,!0),j&&xt(j,u.time),o(u.time),a(u.time),c(u.time))}),t.subscribeCrosshairMove(u=>{if(!u||!u.time){E.clearCrosshairPosition(),n.clearCrosshairPosition(),e.clearCrosshairPosition(),j&&xt(j,null);return}qt||(Lt&&Wu(u.time,!0),j&&xt(j,u.time),o(u.time),l(u.time),c(u.time))}),e.subscribeCrosshairMove(u=>{if(!u||!u.time){E.clearCrosshairPosition(),n.clearCrosshairPosition(),t.clearCrosshairPosition(),j&&xt(j,null);return}qt||(j&&xt(j,u.time),o(u.time),l(u.time),a(u.time))}),t.subscribeClick(u=>{!u||!u.time||Lt&&Wu(u.time,!1)}),Ht){let u=0,h=()=>{let d=Date.now();d-u<300?(Sg(),u=0):u=d};E.subscribeClick(h),n.subscribeClick(h),t.subscribeClick(h),e.subscribeClick(h)}}function Pu(){let n=document.getElementById("chart-controls");n&&(bg(),n.querySelectorAll("button[data-interval]").forEach(t=>{t.addEventListener("click",e=>{let i=e.currentTarget,s=i.getAttribute("data-interval");s&&(n.querySelectorAll("button[data-interval]").forEach(r=>r.classList.remove("active")),i.classList.add("active"),R&&mg(s))})}),n.querySelectorAll("button[data-mode]").forEach(t=>{t.addEventListener("click",e=>{let i=e.currentTarget,s=i.getAttribute("data-mode");s&&(n.querySelectorAll("button[data-mode]").forEach(r=>r.classList.remove("active")),i.classList.add("active"),T&&T.setDisplayMode(s))})}),Cg())}var Mg=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
  <polyline points="5.5 1 1 1 1 5.5"/>
  <polyline points="10.5 1 15 1 15 5.5"/>
  <polyline points="10.5 15 15 15 15 10.5"/>
  <polyline points="5.5 15 1 15 1 10.5"/>
</svg>`,xg=`<svg width="16" height="16" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
  <polyline points="1 5.5 5.5 5.5 5.5 1"/>
  <polyline points="15 5.5 10.5 5.5 10.5 1"/>
  <polyline points="15 10.5 10.5 10.5 10.5 15"/>
  <polyline points="1 10.5 5.5 10.5 5.5 15"/>
</svg>`;function Cg(){let n=document.getElementById("chart-fullscreen-btn"),t=document.getElementById("custom-chart-container"),e=document.getElementById("chart-nav-prev"),i=document.getElementById("chart-nav-next");if(!n||!t)return;e&&e.addEventListener("click",()=>vi(-1)),i&&i.addEventListener("click",()=>vi(1)),Dg();let s=()=>{let o=t.classList.contains("chart-fullscreen");n.innerHTML=o?xg:Mg,n.title=o?"Exit fullscreen (Space)":"Fullscreen (Space)",dr()},r=()=>{t.classList.toggle("chart-fullscreen"),s()};n.addEventListener("click",r),document.addEventListener("keydown",o=>{let l=document.getElementById("ticker-view");!l||l.classList.contains("hidden")||(o.key==="Escape"&&t.classList.contains("chart-fullscreen")&&(t.classList.remove("chart-fullscreen"),s()),o.code==="Space"&&document.activeElement?.tagName!=="INPUT"&&(o.preventDefault(),r()),o.key==="ArrowLeft"?vi(-1):o.key==="ArrowRight"&&vi(1))})}function vi(n){let t=Tl(),e=Ll(),i=document.getElementById("ticker-view")?.dataset.ticker;if(!t||!i)return;let s="";e==="divergence"?s=t==="daily"?"divergence-daily-container":"divergence-weekly-container":s=t==="daily"?"daily-container":"weekly-container";let r=document.getElementById(s);if(!r)return;let o=Array.from(r.querySelectorAll(".alert-card")),l=o.findIndex(c=>c.dataset.ticker===i);if(l===-1)return;let a=l+n;if(a>=0&&a<o.length){let u=o[a].dataset.ticker;u&&window.showTickerView&&window.showTickerView(u,e,t)}}function Dg(){let n=document.getElementById("custom-chart-container");n&&n.addEventListener("dblclick",t=>{let e=n.getBoundingClientRect();if(!(t.clientX-e.left>e.width-60))return;let r=Ei(vt),o=r[2],l=r[3],a=h=>{let d=document.getElementById(h);return!d||d.style.display==="none"?null:d.getBoundingClientRect()},c=a(o);if(c&&t.clientY>=c.top&&t.clientY<=c.bottom){vi(1);return}let u=a(l);if(u&&t.clientY>=u.top&&t.clientY<=u.bottom){vi(-1);return}})}function Xu(n){let t=Tl(),e=Ll(),i=document.getElementById("ticker-view")?.dataset.ticker;if(!t||!i)return null;let s="";e==="divergence"?s=t==="daily"?"divergence-daily-container":"divergence-weekly-container":s=t==="daily"?"daily-container":"weekly-container";let r=document.getElementById(s);if(!r)return null;let o=Array.from(r.querySelectorAll(".alert-card")),l=o.findIndex(c=>c.dataset.ticker===i);if(l===-1)return null;let a=l+n;return a>=0&&a<o.length&&o[a].dataset.ticker||null}async function Tg(n,t){let e=Xu(1),i=Xu(-1),s=async r=>{if(t?.aborted)return;let o=ql(r,n);if(Zl(o)||_e.has(o))return;let l=rs(r,n,{vdRsiLength:D.length,vdSourceInterval:C.sourceInterval,vdRsiSourceInterval:D.sourceInterval,signal:t}).then(a=>Xl(o,a)).catch(()=>{}).finally(()=>_e.delete(o));return _e.set(o,l),l};e&&await s(e),i&&await s(i)}function qf(n){Pe&&(!Array.isArray(M)||M.length<2||pr(Pe,M,n))}})();
/*! Bundled license information:

lightweight-charts/dist/lightweight-charts.production.mjs:
  (*!
   * @license
   * TradingView Lightweight Charts v4.2.1
   * Copyright (c) 2024 TradingView, Inc.
   * Licensed under Apache License 2.0 https://www.apache.org/licenses/LICENSE-2.0
   *)
*/
