(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();function j(){const e=new Date;e.setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));const t=new Date(e.getFullYear(),0,1),i=Math.ceil(((e.getTime()-t.getTime())/864e5+1)/7);return`${e.getFullYear()}-W${i.toString().padStart(2,"0")}`}function Y(){const e=new Date,t=(e.getMonth()+1).toString().padStart(2,"0");return`${e.getFullYear()}-${t}`}function de(e){if(!e)return"";const t=new Date(e),i=new Date,r=new Date(t);r.setHours(0,0,0,0);const n=new Date(i);n.setHours(0,0,0,0);const o=n.getTime()-r.getTime(),s=Math.floor(o/(1e3*60*60*24));return s===0?"Today":s===1?"1d ago":`${s}d ago`}function ue(e){if(!e)return"0".padEnd(7);let t;return e>=1e3?t=(e/1e3).toFixed(1)+"K":t=e.toString(),t.padEnd(7)}function fe(e,t,i){let r="",n="";if(e==="30"||e==="7"||e==="1"){const o=parseInt(e),s=new Date,c=new Date;c.setDate(s.getDate()-o),n=s.toISOString(),r=c.toISOString()}else if(e==="week"){if(!t)return{startDate:"",endDate:""};const o=t.split("-W"),s=o[0],c=o[1],l=parseInt(s),a=parseInt(c),d=new Date(l,0,4),m=d.getDay()===0?6:d.getDay()-1,h=new Date(d.setDate(d.getDate()-m)),g=new Date(h.setDate(h.getDate()+(a-1)*7));g.setHours(0,0,0,0);const k=new Date(g);k.setDate(g.getDate()+6),k.setHours(23,59,59,999),r=g.toISOString(),n=k.toISOString()}else{if(!i)return{startDate:"",endDate:""};const o=i.split("-"),s=Number(o[0]),c=Number(o[1]),l=new Date(s,c-1,1),a=new Date(s,c,0);a.setHours(23,59,59,999),r=l.toISOString(),n=a.toISOString()}return{startDate:r,endDate:n}}function A(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function $(e){return(t,i)=>e==="time"?(i.timestamp||"").localeCompare(t.timestamp||""):e==="favorite"?t.is_favorite===i.is_favorite?(i.timestamp||"").localeCompare(t.timestamp||""):(i.is_favorite?1:0)-(t.is_favorite?1:0):e==="volume"?(i.signal_volume||0)-(t.signal_volume||0):e==="intensity"?(i.intensity_score||0)-(t.intensity_score||0):e==="combo"?(i.combo_score||0)-(t.combo_score||0):(i.timestamp||"").localeCompare(t.timestamp||"")}function he(e){return typeof e=="boolean"?e:typeof e=="string"?e.toLowerCase()==="true":typeof e=="number"?e===1:!1}function U(e){const t=e,i=Number(t.id);if(!Number.isFinite(i))throw new Error("Invalid alert payload: missing/invalid id");return{...t,id:i,is_favorite:he(t.is_favorite)}}async function K(e=""){try{const t=await fetch(`/api/alerts${e}`);if(!t.ok)throw new Error("Network response was not ok");const i=await t.json();if(!Array.isArray(i))throw new Error("Invalid alert payload: expected array");return i.map(U)}catch(t){throw console.error("Error fetching alerts:",t),t}}async function me(e){const t=await fetch(`/api/alerts/${e}/favorite`,{method:"POST"});if(!t.ok)throw new Error("Network response was not ok");return U(await t.json())}let Z=[];function q(){return Z}function X(e){Z=e}function V(e){const t=de(e.timestamp);let i=!1,r=!1;if(e.signal_direction!==void 0&&e.signal_direction!==null){const O=Number(e.signal_direction);i=O===1,r=O===-1}else i=!!(e.signal_type&&e.signal_type.toLowerCase().includes("bull")),r=!i;const n=i?"bullish-card":r?"bearish-card":"",o=ue(e.signal_volume||0),s=e.intensity_score||0,c=e.combo_score||0,l=i?"#3fb950":"#f85149",a="#0d1117",d=`background: conic-gradient(${l} ${s}%, ${a} 0%);`,m=`background: conic-gradient(${l} ${c}%, ${a} 0%);`,h=e.is_favorite===!0||String(e.is_favorite).toLowerCase()==="true",g=h?"filled":"",k=h?"visible":"hidden",ce=h?"1":"0",le=`
        <svg class="fav-icon ${g}" data-id="${e.id}" viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <polyline class="check-mark" points="9 12 11 14 15 10" style="visibility: ${k}; opacity: ${ce};"></polyline>
        </svg>
    `;return`
        <div class="alert-card ${n}" data-ticker="${A(e.ticker)}">
            ${le}
            <h3>${A(e.ticker)}</h3>
            
            <div class="metrics-container">
                <div class="metric-item" title="Intensity: ${s}">
                    <div class="score-circle" style="${d}"></div>
                </div>
                <div class="metric-item" title="Combo: ${c}">
                    <div class="score-circle" style="${m}"></div>
                </div>
                <div class="metric-item" title="Signal Volume">
                    <span class="volume-text">${o}</span>
                </div>
            </div>

            <span class="alert-time">${t}</span>
        </div>
    `}let b="1",G="time",J="time";function ge(e){b=e}function ye(){return b==="30"||b==="7"||b==="1"?!0:b==="week"?document.getElementById("history-week").value===j():document.getElementById("history-month").value===Y()}async function D(e){try{const t=document.getElementById("history-week")?.value||"",i=document.getElementById("history-month")?.value||"",{startDate:r,endDate:n}=fe(b,t,i);if(!r||!n)return[];const o=`?start_date=${r}&end_date=${n}`,s=await K(o);return X(s),s}catch(t){return console.error("Error fetching live alerts:",t),[]}}function y(){const e=q();document.getElementById("ticker-view").classList.add("hidden"),document.getElementById("dashboard-view").classList.remove("hidden"),document.getElementById("reset-filter").classList.add("hidden");const t=document.getElementById("daily-container"),i=document.getElementById("weekly-container"),r=e.filter(o=>(o.timeframe||"").trim()==="1d"),n=e.filter(o=>(o.timeframe||"").trim()==="1w");r.sort($(G)),n.sort($(J)),t.innerHTML=r.map(V).join(""),i.innerHTML=n.map(V).join("")}function ve(){const e=document.getElementById("view-live");e&&e.addEventListener("click",t=>{const i=t.target,r=i.closest(".fav-icon");if(r){t.stopPropagation();const o=r.dataset.id;if(o){const s=document.querySelectorAll(`.fav-icon[data-id="${o}"]`),c=r.classList.contains("filled");s.forEach(l=>{const a=l.querySelector(".check-mark");c?(l.classList.remove("filled"),a&&(a.style.visibility="hidden",a.style.opacity="0")):(l.classList.add("filled"),a&&(a.style.visibility="visible",a.style.opacity="1"))}),me(Number(o)).then(l=>{const a=q(),d=a.findIndex(m=>m.id===l.id);d!==-1&&(a[d].is_favorite=l.is_favorite,X(a),s.forEach(m=>{const h=m.querySelector(".check-mark");l.is_favorite?(m.classList.add("filled"),h&&(h.style.visibility="visible",h.style.opacity="1")):(m.classList.remove("filled"),h&&(h.style.visibility="hidden",h.style.opacity="0"))}))}).catch(()=>{s.forEach(l=>{const a=l.querySelector(".check-mark");c?(l.classList.add("filled"),a&&(a.style.visibility="visible",a.style.opacity="1")):(l.classList.remove("filled"),a&&(a.style.visibility="hidden",a.style.opacity="0"))})})}return}const n=i.closest(".alert-card");if(n){const o=n.dataset.ticker;o&&window.showTickerView&&window.showTickerView(o)}})}function we(e){G=e;const t=document.querySelector("#dashboard-view .column:first-child .header-sort-controls");t&&t.querySelectorAll(".tf-btn").forEach(i=>{const r=i;r.dataset.sort===e?r.classList.add("active"):r.classList.remove("active")}),y()}function be(e){J=e;const t=document.querySelector("#dashboard-view .column:last-child .header-sort-controls");t&&t.querySelectorAll(".tf-btn").forEach(i=>{const r=i;r.dataset.sort===e?r.classList.add("active"):r.classList.remove("active")}),y()}async function Q(){const e=document.querySelector("#leaderboard-controls .tf-btn.active"),t=e?e.dataset.days:"30";try{const i=await K(`?days=${t}`);pe(i)}catch(i){console.error("Error fetching leaderboard:",i)}}function pe(e){const t={};e.forEach(n=>{t[n.ticker]||(t[n.ticker]={dailyBullSum:0,dailyBullCount:0,dailyBearSum:0,dailyBearCount:0,weeklyBullSum:0,weeklyBullCount:0,weeklyBearSum:0,weeklyBearCount:0});const o=n.combo_score||0,s=n.signal_type&&n.signal_type.toLowerCase().includes("bull");n.timeframe==="1w"?s?(t[n.ticker].weeklyBullSum+=o,t[n.ticker].weeklyBullCount++):(t[n.ticker].weeklyBearSum+=o,t[n.ticker].weeklyBearCount++):s?(t[n.ticker].dailyBullSum+=o,t[n.ticker].dailyBullCount++):(t[n.ticker].dailyBearSum+=o,t[n.ticker].dailyBearCount++)});const i=Object.keys(t),r=(n,o)=>i.filter(s=>t[s][o]>0).map(s=>({ticker:s,avgScore:Math.round(t[s][n]/t[s][o])})).sort((s,c)=>c.avgScore-s.avgScore).slice(0,10);C("lb-daily-bull",r("dailyBullSum","dailyBullCount")),C("lb-daily-bear",r("dailyBearSum","dailyBearCount")),C("lb-weekly-bull",r("weeklyBullSum","weeklyBullCount")),C("lb-weekly-bear",r("weeklyBearSum","weeklyBearCount"))}function C(e,t){const i=document.getElementById(e);if(i){if(t.length===0){i.innerHTML='<tr><td colspan="2" style="text-align:center; color:#8b949e">No signals found</td></tr>';return}i.innerHTML=`
        <tbody>
            ${t.map(r=>`
                <tr class="clickable-row" data-ticker="${A(r.ticker)}">
                    <td>${A(r.ticker)}</td>
                    <td>${r.avgScore}</td>
                </tr>
            `).join("")}
        </tbody>
    `}}function ke(){const e=document.getElementById("view-leaderboard");e&&e.addEventListener("click",t=>{const r=t.target.closest(".clickable-row");r&&r.dataset.ticker&&window.showTickerView&&window.showTickerView(r.dataset.ticker)})}async function Le(e,t){const i=`/api/chart?ticker=${encodeURIComponent(e)}&interval=${t}`,r=await fetch(i);if(!r.ok){const n=await r.json().catch(()=>({error:"Failed to fetch chart data"}));throw new Error(n.error||`HTTP ${r.status}`)}return r.json()}function Ee(e){const t=[];for(let i=0;i<e.length;i+=2)i+1<e.length?t.push({time:e[i].time,open:e[i].open,high:Math.max(e[i].high,e[i+1].high),low:Math.min(e[i].low,e[i+1].low),close:e[i+1].close,volume:e[i].volume+e[i+1].volume}):t.push(e[i]);return t}function Se(e){const t=[];for(let i=0;i<e.length;i+=2)i+1<e.length?t.push({time:e[i].time,value:e[i+1].value}):t.push(e[i]);return t}class Be{chart;series;lineTools;displayMode;data;referenceLines=[];priceData=[];divergenceToolActive=!1;highlightSeries=null;constructor(t){this.displayMode=t.displayMode,this.data=t.data,this.priceData=t.priceData||[],this.chart=LightweightCharts.createChart(t.container,{height:400,layout:{background:{color:"#0d1117"},textColor:"#c9d1d9"},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},timeScale:{timeVisible:!0,secondsVisible:!1,borderColor:"#21262d"},rightPriceScale:{borderColor:"#21262d",scaleMargins:{top:.1,bottom:.1}},crosshair:{mode:1}}),this.addReferenceLine(70,"Overbought","#f85149"),this.addReferenceLine(30,"Oversold","#3fb950"),this.updateSeries(),this.chart.subscribeCrosshairMove(i=>{this.divergenceToolActive&&i&&i.time}),this.chart.subscribeClick(i=>{this.divergenceToolActive&&i&&i.time&&this.detectAndHighlightDivergence(i.time)})}addReferenceLine(t,i,r){const n=this.chart.addLineSeries({color:r,lineWidth:1,lineStyle:2,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1});this.referenceLines=this.referenceLines||[],this.referenceLines.push({line:n,value:t})}updateSeries(){if(this.series&&this.chart.removeSeries(this.series),this.displayMode==="line"?this.series=this.chart.addLineSeries({color:"#58a6ff",lineWidth:2,priceLineVisible:!0,lastValueVisible:!0}):this.series=this.chart.addHistogramSeries({color:"#58a6ff",priceFormat:{type:"price",precision:2,minMove:.01},priceLineVisible:!0,lastValueVisible:!0}),this.displayMode==="line"?this.series.setData(this.data):this.series.setData(this.data.map(t=>({time:t.time,value:t.value,color:"#58a6ff"}))),this.data.length>0&&this.referenceLines.length>0){const t=this.data[0].time,i=this.data[this.data.length-1].time;this.referenceLines.forEach(({line:r,value:n})=>{r.setData([{time:t,value:n},{time:i,value:n}])})}}setDisplayMode(t){this.displayMode!==t&&(this.displayMode=t,this.updateSeries())}setData(t,i){if(this.data=t,i&&(this.priceData=i),this.series&&(this.displayMode==="line"?this.series.setData(t):this.series.setData(t.map(r=>({time:r.time,value:r.value,color:"#58a6ff"})))),t.length>0&&this.referenceLines.length>0){const r=t[0].time,n=t[t.length-1].time;this.referenceLines.forEach(({line:o,value:s})=>{o.setData([{time:r,value:s},{time:n,value:s}])})}}getChart(){return this.chart}getSeries(){return this.series}getLineTools(){return this.lineTools}activateDivergenceTool(){this.divergenceToolActive=!0;const t=this.chart.chartElement();t&&(t.style.cursor="crosshair")}deactivateDivergenceTool(){this.divergenceToolActive=!1;const t=this.chart.chartElement();t&&(t.style.cursor="default"),this.clearHighlights()}detectAndHighlightDivergence(t){const i=this.data.findIndex(c=>c.time===t);if(i===-1){console.log("Clicked point not found in RSI data");return}const r=this.data[i].value,n=this.priceData.find(c=>c.time===t);if(!n){console.log("Corresponding price data not found");return}const o=n.close,s=[];for(let c=i+1;c<this.data.length;c++){const l=this.data[c].value,a=this.priceData.find(d=>d.time===this.data[c].time);if(a){const d=a.close;l<r&&d>o&&s.push(this.data[c])}}console.log(`Found ${s.length} divergence points from origin (RSI: ${r.toFixed(2)}, Price: ${o.toFixed(2)})`),this.highlightPoints(s)}highlightPoints(t){this.clearHighlights(),t.length!==0&&(this.highlightSeries=this.chart.addLineSeries({color:"#ff6b6b",lineWidth:0,pointMarkersVisible:!0,pointMarkersRadius:5}),this.highlightSeries.setData(t))}clearHighlights(){this.highlightSeries&&(this.chart.removeSeries(this.highlightSeries),this.highlightSeries=null)}clearDivergence(){this.clearHighlights()}resize(){this.chart&&this.chart.resize(this.chart.options().width,400)}destroy(){this.chart&&this.chart.remove()}}let L=null,_="1day",f=null,H=null,u=null,T=!1,E=null,S=null,x=null,p=null,v=null;function Ce(e){if(!(L===e&&f&&u)){if(L=e,E=document.getElementById("price-chart-container"),S=document.getElementById("rsi-chart-container"),x=document.getElementById("chart-loading"),p=document.getElementById("chart-error"),v=document.getElementById("chart-content"),!E||!S){console.error("Chart containers not found");return}f||(Ie(),De()),ee(e,_)}}function Ie(){!E||!S||f||(f=LightweightCharts.createChart(E,{height:400,layout:{background:{color:"#0d1117"},textColor:"#c9d1d9"},grid:{vertLines:{visible:!1},horzLines:{visible:!1}},timeScale:{visible:!1},rightPriceScale:{borderColor:"#21262d"},crosshair:{mode:1}}),H=f.addCandlestickSeries({upColor:"#3fb950",downColor:"#f85149",borderVisible:!1,wickUpColor:"#3fb950",wickDownColor:"#f85149"}))}function De(){document.querySelectorAll("#chart-controls .feed-controls-group:first-child .tf-btn").forEach(r=>{r.addEventListener("click",n=>{const s=n.target.dataset.interval;s&&L&&Te(s)})}),document.querySelectorAll("#drawing-tools .tf-btn").forEach(r=>{r.addEventListener("click",n=>{const s=n.target.dataset.tool;s&&$e(s)})}),document.querySelectorAll("#chart-controls .feed-controls-group:last-child .tf-btn").forEach(r=>{r.addEventListener("click",n=>{const s=n.target.dataset.mode;s&&u&&Me(s)})})}function Te(e){if(T||!L||e===_)return;_=e,document.querySelectorAll("#chart-controls .feed-controls-group:first-child .tf-btn").forEach(i=>{i.classList.toggle("active",i.dataset.interval===e)}),ee(L,e)}function Me(e){if(!u)return;document.querySelectorAll("#chart-controls .feed-controls-group:last-child .tf-btn").forEach(i=>{i.classList.toggle("active",i.dataset.mode===e)}),u.setDisplayMode(e)}async function ee(e,t){if(!T){T=!0,Ve();try{const i=await Le(e,t);let r=i.bars,n=i.rsi;t==="2hour"&&(r=Ee(r),n=Se(i.rsi)),H&&H.setData(r),!u&&S?(u=new Be({container:S,data:n,displayMode:"line",priceData:r.map(o=>({time:o.time,close:o.close}))}),Ae()):u&&u.setData(n,r.map(o=>({time:o.time,close:o.close}))),f&&u&&(f.timeScale().fitContent(),setTimeout(()=>{f.timeScale().scrollToRealTime()},50)),_e()}catch(i){console.error("Failed to load chart data:",i),He(i instanceof Error?i.message:"Failed to load chart data")}finally{T=!1}}}function Ae(){if(!f||!u)return;const e=u.getChart();let t=!1,i=!1;f.timeScale().subscribeVisibleLogicalRangeChange(r=>{r&&!i&&(t=!0,e.timeScale().setVisibleLogicalRange(r),t=!1)}),e.timeScale().subscribeVisibleLogicalRangeChange(r=>{r&&!t&&(i=!0,f.timeScale().setVisibleLogicalRange(r),i=!1)}),f.subscribeCrosshairMove(r=>{if(!r||!r.time){e.clearCrosshairPosition();return}e.setCrosshairPosition(r.logical,r.time)}),e.subscribeCrosshairMove(r=>{if(!r||!r.time){f.clearCrosshairPosition();return}f.setCrosshairPosition(r.logical,r.time)})}function $e(e){if(!u){console.warn("RSI chart not available");return}try{if(e==="clear"){u.clearDivergence(),u.deactivateDivergenceTool(),document.querySelectorAll("#drawing-tools .tf-btn").forEach(n=>n.classList.remove("active"));return}const t=document.querySelectorAll("#drawing-tools .tf-btn"),i=Array.from(t).find(r=>r.dataset.tool==="trend");e==="trend"&&(i.classList.contains("active")?(i.classList.remove("active"),u.deactivateDivergenceTool()):(t.forEach(n=>n.classList.remove("active")),i.classList.add("active"),u.activateDivergenceTool()))}catch(t){console.error("Error activating divergence tool:",t)}}function Ve(){p&&(p.style.display="none"),v&&(v.style.opacity="0.8")}function _e(){v&&(v.style.opacity="1")}function He(e){p&&(p.textContent=e,p.style.display="block"),x&&(x.style.display="none"),v&&(v.style.opacity="0.5")}window.addEventListener("resize",()=>{f&&f.resize(E?.clientWidth||0,400),u&&u.resize()});let te="time",ie="time",N=null;function re(e){te=e,oe(".ticker-daily-sort",e);const t=document.getElementById("ticker-view");if(!t)return;const i=t.dataset.ticker;i&&B(i)}function ne(e){ie=e,oe(".ticker-weekly-sort",e);const t=document.getElementById("ticker-view");if(!t)return;const i=t.dataset.ticker;i&&B(i)}function oe(e,t){document.querySelectorAll(`${e} .tf-btn`).forEach(i=>{const r=i;r.classList.toggle("active",r.dataset.sort===t)})}function B(e){const i=q().filter(c=>c.ticker===e),r=i.filter(c=>(c.timeframe||"").trim()==="1d"),n=i.filter(c=>(c.timeframe||"").trim()==="1w");r.sort($(te)),n.sort($(ie)),W("ticker-daily-avg",r),W("ticker-weekly-avg",n);const o=document.getElementById("ticker-daily-container");o&&(r.length===0?o.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No daily alerts</div>':o.innerHTML=r.map(V).join(""));const s=document.getElementById("ticker-weekly-container");s&&(n.length===0?s.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No weekly alerts</div>':s.innerHTML=n.map(V).join("")),xe(e),Ce(e)}function W(e,t){const i=document.getElementById(e);if(!i)return;if(t.length===0){i.innerHTML="";return}let r=0;t.forEach(d=>{const m=d.combo_score||0,g=(d.signal_type||"").toLowerCase().includes("bull");r+=g?m:-m});const n=Math.round(r/t.length),o=Math.abs(n),a=`background: conic-gradient(${n>=0?"#3fb950":"#f85149"} ${o}%, #0d1117 0%);`;i.innerHTML=`
        <div class="metric-item" title="Average Score: ${n}">
            <div class="score-circle" style="${a}"></div>
        </div>
    `}function xe(e){typeof TradingView>"u"||N!==e&&(N=e,new TradingView.widget({width:"100%",height:600,symbol:e,interval:"D",timezone:"Etc/UTC",theme:"dark",style:"1",locale:"en",toolbar_bg:"#f1f3f6",enable_publishing:!1,allow_symbol_change:!1,container_id:"tradingview_chart",studies:[{id:"MASimple@tv-basicstudies",inputs:{length:50}}]}))}let I=null,se=5,P="SVIX";async function Pe(e,t){const i=await fetch(`/api/breadth?ticker=${e}&days=${t}`);if(!i.ok)throw new Error("Failed to fetch breadth data");return i.json()}function z(e){if(e.length===0)return[];const t=e[0];return t===0?e.map(()=>100):e.map(i=>i/t*100)}function qe(e,t,i){const r=document.getElementById("breadth-chart");if(!r)return;I&&(I.destroy(),I=null);const n=e.map(a=>i?new Date(a.date).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZone:"America/Los_Angeles"}):new Date(a.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})),o=e.map(a=>a.spy),s=e.map(a=>a.comparison),c=z(o),l=z(s);I=new Chart(r,{type:"line",data:{labels:n,datasets:[{label:"SPY",data:c,borderColor:"#58a6ff",backgroundColor:"transparent",borderWidth:2.5,pointRadius:c.length>15?0:3,pointHoverRadius:5,tension:.3,order:1,fill:!1},{label:t,data:l,borderColor:"#d2a8ff",backgroundColor:"transparent",borderWidth:2.5,pointRadius:l.length>15?0:3,pointHoverRadius:5,tension:.3,order:2,fill:{target:0,above:"rgba(63, 185, 80, 0.18)",below:"rgba(248, 81, 73, 0.18)"}}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{labels:{color:"#c9d1d9",font:{size:12},usePointStyle:!0,pointStyle:"line"}},tooltip:{backgroundColor:"rgba(22, 27, 34, 0.95)",borderColor:"#30363d",borderWidth:1,titleColor:"#c9d1d9",bodyColor:"#8b949e",padding:12,callbacks:{label:function(a){const d=a.parsed.y.toFixed(2);return`${a.dataset.label}: ${d}`}}},filler:{propagate:!0}},scales:{x:{ticks:{color:"#8b949e",maxRotation:0,autoSkip:!0,maxTicksLimit:10,font:{size:11}},grid:{color:"rgba(48, 54, 61, 0.3)"}},y:{ticks:{color:"#8b949e",font:{size:11},callback:function(a){return a.toFixed(1)}},grid:{color:"rgba(48, 54, 61, 0.3)"}}}}})}async function F(){const e=document.getElementById("breadth-error");e&&(e.style.display="none");try{const t=await Pe(P,se);if(t.points.length===0){e&&(e.textContent="No data available for this timeframe",e.style.display="block");return}qe(t.points,P,t.intraday)}catch(t){console.error("Breadth load error:",t),e&&(e.textContent="Failed to load breadth data",e.style.display="block")}}function Fe(e){se=e,document.querySelectorAll("#breadth-tf-btns .tf-btn").forEach(t=>{t.classList.toggle("active",Number(t.dataset.days)===e)}),F()}function Re(e){P=e,document.querySelectorAll("#breadth-metric-btns .tf-btn").forEach(t=>{t.classList.toggle("active",t.dataset.metric===e)}),F()}function Oe(){F()}let R="live",ae=0;window.setDailySort=we;window.setWeeklySort=be;window.setTickerDailySort=re;window.setTickerWeeklySort=ne;window.showTickerView=function(e){R!=="live"&&M("live"),ae=window.scrollY;const t=document.getElementById("ticker-view");t&&(t.dataset.ticker=e,document.getElementById("reset-filter")?.classList.remove("hidden"),document.getElementById("dashboard-view")?.classList.add("hidden"),t.classList.remove("hidden"),B(e),window.scrollTo(0,0))};window.showOverview=function(){const e=document.getElementById("ticker-view");e&&delete e.dataset.ticker,y(),window.scrollTo(0,ae)};function M(e){R=e,document.querySelectorAll(".nav-btn").forEach(t=>t.classList.remove("active")),document.getElementById(`nav-${e}`)?.classList.add("active"),document.getElementById("view-live")?.classList.add("hidden"),document.getElementById("view-leaderboard")?.classList.add("hidden"),document.getElementById("view-breadth")?.classList.add("hidden"),document.getElementById("live-controls")?.classList.add("hidden"),document.getElementById("leaderboard-controls")?.classList.add("hidden"),document.getElementById("breadth-controls")?.classList.add("hidden"),e==="live"?(document.getElementById("view-live")?.classList.remove("hidden"),document.getElementById("live-controls")?.classList.remove("hidden")):e==="leaderboard"?(document.getElementById("view-leaderboard")?.classList.remove("hidden"),document.getElementById("leaderboard-controls")?.classList.remove("hidden"),Q()):e==="breadth"&&(document.getElementById("view-breadth")?.classList.remove("hidden"),document.getElementById("breadth-controls")?.classList.remove("hidden"),Oe())}function w(e){ge(e);const t=document.getElementById("btn-30"),i=document.getElementById("btn-7"),r=document.getElementById("btn-1"),n=document.getElementById("btn-week"),o=document.getElementById("btn-month"),s=document.getElementById("history-week"),c=document.getElementById("history-month");[t,i,r,n,o].forEach(l=>l?.classList.remove("active")),s?.classList.add("hidden"),c?.classList.add("hidden"),e==="30"?t?.classList.add("active"):e==="7"?i?.classList.add("active"):e==="1"?r?.classList.add("active"):e==="week"?(n?.classList.add("active"),s?.classList.remove("hidden")):e==="month"&&(o?.classList.add("active"),c?.classList.remove("hidden")),D().then(()=>{const l=document.getElementById("ticker-view"),a=l?.dataset.ticker;a&&!l?.classList.contains("hidden")?B(a):y()})}function Ne(){const e=document.getElementById("search-toggle"),t=document.getElementById("search-input"),i=document.getElementById("search-container");!e||!t||!i||(e.addEventListener("click",r=>{r.stopPropagation(),t.classList.contains("active")?(t.classList.remove("active"),t.blur()):(t.classList.add("active"),t.focus())}),i.addEventListener("click",()=>{t.classList.contains("active")||(t.classList.add("active"),t.focus())}),t.addEventListener("keydown",r=>{if(r.key==="Enter"){const n=t.value.trim().toUpperCase();n&&(window.showTickerView(n),t.value="",t.blur(),t.classList.remove("active"))}}),document.addEventListener("keydown",r=>{document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement.isContentEditable||r.ctrlKey||r.altKey||r.metaKey||r.key.length>1||/^[a-zA-Z0-9]$/.test(r.key)&&(t.classList.contains("active")||t.classList.add("active"),t.focus())}))}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("nav-live")?.addEventListener("click",()=>M("live")),document.getElementById("nav-leaderboard")?.addEventListener("click",()=>{M("leaderboard")}),document.getElementById("nav-breadth")?.addEventListener("click",()=>M("breadth")),document.getElementById("reset-filter")?.addEventListener("click",window.showOverview),document.getElementById("btn-30")?.addEventListener("click",()=>w("30")),document.getElementById("btn-7")?.addEventListener("click",()=>w("7")),document.getElementById("btn-1")?.addEventListener("click",()=>w("1")),document.getElementById("btn-week")?.addEventListener("click",()=>w("week")),document.getElementById("btn-month")?.addEventListener("click",()=>w("month"));const e=document.getElementById("history-week"),t=document.getElementById("history-month");document.querySelectorAll(".ticker-daily-sort .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const r=i.dataset.sort;re(r)})}),document.querySelectorAll(".ticker-weekly-sort .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const r=i.dataset.sort;ne(r)})}),e&&(e.value=j()),t&&(t.value=Y()),e?.addEventListener("change",()=>D().then(y)),t?.addEventListener("change",()=>D().then(y)),document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(i=>{i.addEventListener("click",r=>{document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(n=>n.classList.remove("active")),r.target.classList.add("active"),Q()})}),document.querySelectorAll("#breadth-tf-btns .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const r=Number(i.dataset.days);Fe(r)})}),document.querySelectorAll("#breadth-metric-btns .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const r=i.dataset.metric;Re(r);const n=document.getElementById("breadth-subtitle");n&&(n.textContent=`SPY vs ${r} â€” Normalized`)})}),w("1"),setInterval(()=>{R==="live"&&ye()&&D().then(()=>{const i=document.getElementById("ticker-view"),r=i?.dataset.ticker;r&&!i?.classList.contains("hidden")?B(r):y()})},1e4),Ne(),ve(),ke(),We()});function We(){const e=document.getElementById("view-live");e&&e.addEventListener("click",t=>{if(window.innerWidth>768)return;const i=t.target;if(i.tagName!=="H2"||!(i.closest(".column-header")||i.closest(".header-title-group")))return;const n=i.closest(".column");n&&n.classList.toggle("collapsed")})}
