(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))i(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function i(o){if(o.ep)return;o.ep=!0;const r=n(o);fetch(o.href,r)}})();function H(){const e=new Date;e.setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));const t=new Date(e.getFullYear(),0,1),n=Math.ceil(((e.getTime()-t.getTime())/864e5+1)/7);return`${e.getFullYear()}-W${n.toString().padStart(2,"0")}`}function F(){const e=new Date,t=(e.getMonth()+1).toString().padStart(2,"0");return`${e.getFullYear()}-${t}`}function U(e){if(!e)return"";const t=new Date(e),n=new Date,i=new Date(t);i.setHours(0,0,0,0);const o=new Date(n);o.setHours(0,0,0,0);const r=o.getTime()-i.getTime(),s=Math.floor(r/(1e3*60*60*24));return s===0?"Today":s===1?"1d ago":`${s}d ago`}function X(e){if(!e)return"0".padEnd(7);let t;return e>=1e3?t=(e/1e3).toFixed(1)+"K":t=e.toString(),t.padEnd(7)}function Z(e,t,n){let i="",o="";if(e==="30"||e==="7"||e==="1"){const r=parseInt(e),s=new Date,l=new Date;l.setDate(s.getDate()-r),o=s.toISOString(),i=l.toISOString()}else if(e==="week"){if(!t)return{startDate:"",endDate:""};const r=t.split("-W"),s=r[0],l=r[1],c=parseInt(s),a=parseInt(l),m=new Date(c,0,4),f=m.getDay()===0?6:m.getDay()-1,u=new Date(m.setDate(m.getDate()-f)),y=new Date(u.setDate(u.getDate()+(a-1)*7));y.setHours(0,0,0,0);const g=new Date(y);g.setDate(y.getDate()+6),g.setHours(23,59,59,999),i=y.toISOString(),o=g.toISOString()}else{if(!n)return{startDate:"",endDate:""};const r=n.split("-"),s=Number(r[0]),l=Number(r[1]),c=new Date(s,l-1,1),a=new Date(s,l,0);a.setHours(23,59,59,999),i=c.toISOString(),o=a.toISOString()}return{startDate:i,endDate:o}}function B(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function S(e){return(t,n)=>e==="time"?(n.timestamp||"").localeCompare(t.timestamp||""):e==="favorite"?t.is_favorite===n.is_favorite?(n.timestamp||"").localeCompare(t.timestamp||""):(n.is_favorite?1:0)-(t.is_favorite?1:0):e==="volume"?(n.signal_volume||0)-(t.signal_volume||0):e==="intensity"?(n.intensity_score||0)-(t.intensity_score||0):e==="combo"?(n.combo_score||0)-(t.combo_score||0):(n.timestamp||"").localeCompare(t.timestamp||"")}async function O(e=""){try{const t=await fetch(`/api/alerts${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}catch(t){throw console.error("Error fetching alerts:",t),t}}async function J(e){const t=await fetch(`/api/alerts/${e}/favorite`,{method:"POST"});if(!t.ok)throw new Error("Network response was not ok");return await t.json()}let V=[];function D(){return V}function N(e){V=e}function I(e){const t=U(e.timestamp);let n=!1,i=!1;if(e.signal_direction!==void 0&&e.signal_direction!==null){const v=Number(e.signal_direction);n=v===1,i=v===-1}else n=!!(e.signal_type&&e.signal_type.toLowerCase().includes("bull")),i=!n;const o=n?"bullish-card":i?"bearish-card":"",r=X(e.signal_volume||0),s=e.intensity_score||0,l=e.combo_score||0,c=n?"#3fb950":"#f85149",a="#0d1117",m=`background: conic-gradient(${c} ${s}%, ${a} 0%);`,f=`background: conic-gradient(${c} ${l}%, ${a} 0%);`,u=e.is_favorite===!0||String(e.is_favorite).toLowerCase()==="true",y=u?"filled":"",g=u?"visible":"hidden",C=u?"1":"0",d=`
        <svg class="fav-icon ${y}" data-id="${e.id}" viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <polyline class="check-mark" points="9 12 11 14 15 10" style="visibility: ${g}; opacity: ${C};"></polyline>
        </svg>
    `;return`
        <div class="alert-card ${o}" data-ticker="${B(e.ticker)}">
            ${d}
            <h3>${B(e.ticker)}</h3>
            
            <div class="metrics-container">
                <div class="metric-item" title="Intensity: ${s}">
                    <div class="score-circle" style="${m}"></div>
                </div>
                <div class="metric-item" title="Combo: ${l}">
                    <div class="score-circle" style="${f}"></div>
                </div>
                <div class="metric-item" title="Signal Volume">
                    <span class="volume-text">${r}</span>
                </div>
            </div>

            <span class="alert-time">${t}</span>
        </div>
    `}let w="1",q="time",W="time";function Q(e){w=e}function ee(){return w==="30"||w==="7"||w==="1"?!0:w==="week"?document.getElementById("history-week").value===H():document.getElementById("history-month").value===F()}async function L(e){try{const t=document.getElementById("history-week")?.value||"",n=document.getElementById("history-month")?.value||"",{startDate:i,endDate:o}=Z(w,t,n);if(!i||!o)return[];const r=`?start_date=${i}&end_date=${o}`,s=await O(r);return N(s),s}catch(t){return console.error("Error fetching live alerts:",t),[]}}function k(){const e=D();document.getElementById("ticker-view").classList.add("hidden"),document.getElementById("dashboard-view").classList.remove("hidden"),document.getElementById("reset-filter").classList.add("hidden");const t=document.getElementById("daily-container"),n=document.getElementById("weekly-container"),i=e.filter(r=>(r.timeframe||"").trim()==="1d"),o=e.filter(r=>(r.timeframe||"").trim()==="1w");i.sort(S(q)),o.sort(S(W)),t.innerHTML=i.map(I).join(""),n.innerHTML=o.map(I).join("")}function te(){const e=document.getElementById("view-live");e&&e.addEventListener("click",t=>{const n=t.target,i=n.closest(".fav-icon");if(i){t.stopPropagation();const r=i.dataset.id;if(r){const s=document.querySelectorAll(`.fav-icon[data-id="${r}"]`),l=i.classList.contains("filled");s.forEach(c=>{const a=c.querySelector(".check-mark");l?(c.classList.remove("filled"),a&&(a.style.visibility="hidden",a.style.opacity="0")):(c.classList.add("filled"),a&&(a.style.visibility="visible",a.style.opacity="1"))}),J(Number(r)).then(c=>{const a=D(),m=a.findIndex(f=>f.id===c.id);m!==-1&&(a[m].is_favorite=c.is_favorite,N(a),s.forEach(f=>{const u=f.querySelector(".check-mark");c.is_favorite?(f.classList.add("filled"),u&&(u.style.visibility="visible",u.style.opacity="1")):(f.classList.remove("filled"),u&&(u.style.visibility="hidden",u.style.opacity="0"))}))}).catch(()=>{s.forEach(c=>{const a=c.querySelector(".check-mark");l?(c.classList.add("filled"),a&&(a.style.visibility="visible",a.style.opacity="1")):(c.classList.remove("filled"),a&&(a.style.visibility="hidden",a.style.opacity="0"))})})}return}const o=n.closest(".alert-card");if(o){const r=o.dataset.ticker;r&&window.showTickerView&&window.showTickerView(r)}})}function ne(e){q=e;const t=document.querySelector("#dashboard-view .column:first-child .header-sort-controls");t&&t.querySelectorAll(".tf-btn").forEach(n=>{const i=n;i.dataset.sort===e?i.classList.add("active"):i.classList.remove("active")}),k()}function ie(e){W=e;const t=document.querySelector("#dashboard-view .column:last-child .header-sort-controls");t&&t.querySelectorAll(".tf-btn").forEach(n=>{const i=n;i.dataset.sort===e?i.classList.add("active"):i.classList.remove("active")}),k()}async function j(){const e=document.querySelector("#leaderboard-controls .tf-btn.active"),t=e?e.dataset.days:"30";try{const n=await O(`?days=${t}`);oe(n)}catch(n){console.error("Error fetching leaderboard:",n)}}function oe(e){const t={};e.forEach(o=>{t[o.ticker]||(t[o.ticker]={dailyBullSum:0,dailyBullCount:0,dailyBearSum:0,dailyBearCount:0,weeklyBullSum:0,weeklyBullCount:0,weeklyBearSum:0,weeklyBearCount:0});const r=o.combo_score||0,s=o.signal_type&&o.signal_type.toLowerCase().includes("bull");o.timeframe==="1w"?s?(t[o.ticker].weeklyBullSum+=r,t[o.ticker].weeklyBullCount++):(t[o.ticker].weeklyBearSum+=r,t[o.ticker].weeklyBearCount++):s?(t[o.ticker].dailyBullSum+=r,t[o.ticker].dailyBullCount++):(t[o.ticker].dailyBearSum+=r,t[o.ticker].dailyBearCount++)});const n=Object.keys(t),i=(o,r)=>n.filter(s=>t[s][r]>0).map(s=>({ticker:s,avgScore:Math.round(t[s][o]/t[s][r])})).sort((s,l)=>l.avgScore-s.avgScore).slice(0,10);b("lb-daily-bull",i("dailyBullSum","dailyBullCount")),b("lb-daily-bear",i("dailyBearSum","dailyBearCount")),b("lb-weekly-bull",i("weeklyBullSum","weeklyBullCount")),b("lb-weekly-bear",i("weeklyBearSum","weeklyBearCount"))}function b(e,t){const n=document.getElementById(e);if(n){if(t.length===0){n.innerHTML='<tr><td colspan="2" style="text-align:center; color:#8b949e">No signals found</td></tr>';return}n.innerHTML=`
        <tbody>
            ${t.map(i=>`
                <tr class="clickable-row" data-ticker="${B(i.ticker)}">
                    <td>${B(i.ticker)}</td>
                    <td>${i.avgScore}</td>
                </tr>
            `).join("")}
        </tbody>
    `}}function re(){const e=document.getElementById("view-leaderboard");e&&e.addEventListener("click",t=>{const i=t.target.closest(".clickable-row");i&&i.dataset.ticker&&window.showTickerView&&window.showTickerView(i.dataset.ticker)})}let P="time",G="time",M=null,_=null,E=null;function z(e){P=e,R(".ticker-daily-sort",e);const t=document.getElementById("ticker-view");if(!t)return;const n=t.dataset.ticker;n&&p(n)}function K(e){G=e,R(".ticker-weekly-sort",e);const t=document.getElementById("ticker-view");if(!t)return;const n=t.dataset.ticker;n&&p(n)}function R(e,t){document.querySelectorAll(`${e} .tf-btn`).forEach(n=>{const i=n;i.classList.toggle("active",i.dataset.sort===t)})}function p(e){const n=D().filter(l=>l.ticker===e),i=n.filter(l=>(l.timeframe||"").trim()==="1d"),o=n.filter(l=>(l.timeframe||"").trim()==="1w");i.sort(S(P)),o.sort(S(G)),A("ticker-daily-avg",i),A("ticker-weekly-avg",o);const r=document.getElementById("ticker-daily-container");r&&(i.length===0?r.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No daily alerts</div>':r.innerHTML=i.map(I).join(""));const s=document.getElementById("ticker-weekly-container");s&&(o.length===0?s.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No weekly alerts</div>':s.innerHTML=o.map(I).join("")),se(e),ce(e)}function A(e,t){const n=document.getElementById(e);if(!n)return;if(t.length===0){n.innerHTML="";return}let i=0;t.forEach(m=>{const f=m.combo_score||0,y=(m.signal_type||"").toLowerCase().includes("bull");i+=y?f:-f});const o=Math.round(i/t.length),r=Math.abs(o),a=`background: conic-gradient(${o>=0?"#3fb950":"#f85149"} ${r}%, #0d1117 0%);`;n.innerHTML=`
        <div class="metric-item" title="Average Score: ${o}">
            <div class="score-circle" style="${a}"></div>
        </div>
    `}function se(e){typeof TradingView>"u"||M!==e&&(M=e,new TradingView.widget({width:"100%",height:600,symbol:e,interval:"D",timezone:"Etc/UTC",theme:"dark",style:"1",locale:"en",toolbar_bg:"#f1f3f6",enable_publishing:!1,allow_symbol_change:!1,container_id:"tradingview_chart",studies:[{id:"MASimple@tv-basicstudies",inputs:{length:50}}]}))}async function ce(e){if(_===e)return;_=e;const t=document.getElementById("gex-chart-container"),n=document.getElementById("gex-loading"),i=document.getElementById("gex-error"),o=document.getElementById("gex-total"),r=document.getElementById("gex-chart"),s=document.getElementById("gex-external-link");if(s&&(s.href=`https://unusualwhales.com/stock/${e}/greek-exposure`,s.style.display="flex"),!(!t||!r)){t.style.display="block",n&&(n.style.display="block"),i&&(i.style.display="none"),r.style.display="none",E&&(E.destroy(),E=null);try{const l=await fetch(`/api/gex/${e}`);if(!l.ok){const d=await l.json().catch(()=>({error:"Failed to fetch GEX data"}));throw new Error(d.error||"Server error")}const c=await l.json();if(n&&(n.style.display="none"),!c.strikes||c.strikes.length===0){i&&(i.textContent="No options data available for this ticker",i.style.display="block");return}r.style.display="block";const a=Math.max(400,c.strikes.length*22),m=r.parentElement;if(m&&(m.style.height=a+"px"),c.strikes.reverse(),c.gex.reverse(),o){const d=$(c.total_gex),v=c.total_gex>=0?"#00E396":"#FF4560";o.innerHTML=`Net Gamma: <span style="color:${v};font-weight:600">${d}</span>`}const f=c.spot_price;let u=0,y=1/0;for(let d=0;d<c.strikes.length;d++){const v=Math.abs(c.strikes[d]-f);v<y&&(y=v,u=d)}const g=c.gex.map(d=>d>=0?"rgba(235, 87, 130, 0.85)":"rgba(235, 87, 130, 0.55)"),C=r.getContext("2d");E=new Chart(C,{type:"bar",data:{labels:c.strikes.map(d=>d.toFixed(2)),datasets:[{label:"Net Gamma",data:c.gex,backgroundColor:g,borderColor:"rgba(235, 87, 130, 1)",borderWidth:.5,borderRadius:1,borderSkipped:!1}]},options:{indexAxis:"y",responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{callbacks:{title:d=>`Strike: $${d[0].label}`,label:d=>`Net Gamma: ${$(d.raw)}`},backgroundColor:"#21262d",borderColor:"#30363d",borderWidth:1,titleColor:"#e6edf3",bodyColor:"#8b949e"},annotation:{annotations:{spotLine:{type:"line",yMin:u,yMax:u,borderColor:"#f0f6fc",borderWidth:2,borderDash:[5,3],label:{display:!0,content:`Spot: $${f.toFixed(2)}`,position:"end",backgroundColor:"#30363d",color:"#f0f6fc",font:{size:11},padding:4}}}}},scales:{x:{position:"bottom",title:{display:!0,text:"Gamma",color:"#8b949e",font:{size:12}},ticks:{color:"#8b949e",font:{size:10},callback:d=>$(d)},grid:{color:"rgba(48, 54, 61, 0.3)"}},y:{ticks:{color:"#8b949e",font:{size:10}},grid:{display:!1}}}}})}catch(l){n&&(n.style.display="none"),i&&(i.textContent=l.message||"Failed to load GEX data",i.style.display="block")}}}function $(e){const t=Math.abs(e),n=e<0?"-":"";return t>=1e6?n+(t/1e6).toFixed(1)+"M":t>=1e3?n+(t/1e3).toFixed(1)+"K":n+t.toFixed(0)}let T="live",Y=0;window.setDailySort=ne;window.setWeeklySort=ie;window.setTickerDailySort=z;window.setTickerWeeklySort=K;window.showTickerView=function(e){T!=="live"&&x("live"),Y=window.scrollY;const t=document.getElementById("ticker-view");t&&(t.dataset.ticker=e,document.getElementById("reset-filter")?.classList.remove("hidden"),document.getElementById("dashboard-view")?.classList.add("hidden"),t.classList.remove("hidden"),p(e),window.scrollTo(0,0))};window.showOverview=function(){const e=document.getElementById("ticker-view");e&&delete e.dataset.ticker,k(),window.scrollTo(0,Y)};function x(e){T=e,document.querySelectorAll(".nav-btn").forEach(t=>t.classList.remove("active")),document.getElementById(`nav-${e}`)?.classList.add("active"),e==="live"?(document.getElementById("view-live")?.classList.remove("hidden"),document.getElementById("view-leaderboard")?.classList.add("hidden"),document.getElementById("live-controls")?.classList.remove("hidden"),document.getElementById("leaderboard-controls")?.classList.add("hidden")):(document.getElementById("view-live")?.classList.add("hidden"),document.getElementById("view-leaderboard")?.classList.remove("hidden"),document.getElementById("live-controls")?.classList.add("hidden"),document.getElementById("leaderboard-controls")?.classList.remove("hidden"),j())}function h(e){Q(e);const t=document.getElementById("btn-30"),n=document.getElementById("btn-7"),i=document.getElementById("btn-1"),o=document.getElementById("btn-week"),r=document.getElementById("btn-month"),s=document.getElementById("history-week"),l=document.getElementById("history-month");[t,n,i,o,r].forEach(c=>c?.classList.remove("active")),s?.classList.add("hidden"),l?.classList.add("hidden"),e==="30"?t?.classList.add("active"):e==="7"?n?.classList.add("active"):e==="1"?i?.classList.add("active"):e==="week"?(o?.classList.add("active"),s?.classList.remove("hidden")):e==="month"&&(r?.classList.add("active"),l?.classList.remove("hidden")),L().then(()=>{const c=document.getElementById("ticker-view"),a=c?.dataset.ticker;a&&!c?.classList.contains("hidden")?p(a):k()})}function le(){const e=document.getElementById("search-toggle"),t=document.getElementById("search-input"),n=document.getElementById("search-container");!e||!t||!n||(e.addEventListener("click",i=>{i.stopPropagation(),t.classList.contains("active")?(t.classList.remove("active"),t.blur()):(t.classList.add("active"),t.focus())}),n.addEventListener("click",()=>{t.classList.contains("active")||(t.classList.add("active"),t.focus())}),t.addEventListener("keydown",i=>{if(i.key==="Enter"){const o=t.value.trim().toUpperCase();o&&(window.showTickerView(o),t.value="",t.blur(),t.classList.remove("active"))}}),document.addEventListener("keydown",i=>{document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement.isContentEditable||i.ctrlKey||i.altKey||i.metaKey||i.key.length>1||/^[a-zA-Z0-9]$/.test(i.key)&&(t.classList.contains("active")||t.classList.add("active"),t.focus())}))}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("nav-live")?.addEventListener("click",()=>x("live")),document.getElementById("nav-leaderboard")?.addEventListener("click",()=>{x("leaderboard")}),document.getElementById("reset-filter")?.addEventListener("click",window.showOverview),document.getElementById("btn-30")?.addEventListener("click",()=>h("30")),document.getElementById("btn-7")?.addEventListener("click",()=>h("7")),document.getElementById("btn-1")?.addEventListener("click",()=>h("1")),document.getElementById("btn-week")?.addEventListener("click",()=>h("week")),document.getElementById("btn-month")?.addEventListener("click",()=>h("month"));const e=document.getElementById("history-week"),t=document.getElementById("history-month");document.querySelectorAll(".ticker-daily-sort .tf-btn").forEach(n=>{n.addEventListener("click",()=>{const i=n.dataset.sort;z(i)})}),document.querySelectorAll(".ticker-weekly-sort .tf-btn").forEach(n=>{n.addEventListener("click",()=>{const i=n.dataset.sort;K(i)})}),e&&(e.value=H()),t&&(t.value=F()),e?.addEventListener("change",()=>L().then(k)),t?.addEventListener("change",()=>L().then(k)),document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(n=>{n.addEventListener("click",i=>{document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(o=>o.classList.remove("active")),i.target.classList.add("active"),j()})}),h("1"),setInterval(()=>{T==="live"&&ee()&&L().then(()=>{const n=document.getElementById("ticker-view"),i=n?.dataset.ticker;i&&!n?.classList.contains("hidden")?p(i):k()})},1e4),le(),te(),re(),ae()});function ae(){const e=document.getElementById("view-live");e&&e.addEventListener("click",t=>{if(window.innerWidth>768)return;const n=t.target;if(n.tagName!=="H2"||!(n.closest(".column-header")||n.closest(".header-title-group")))return;const o=n.closest(".column");o&&o.classList.toggle("collapsed")})}
