(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const r of n)if(r.type==="childList")for(const s of r.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&o(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const r={};return n.integrity&&(r.integrity=n.integrity),n.referrerPolicy&&(r.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?r.credentials="include":n.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(n){if(n.ep)return;n.ep=!0;const r=i(n);fetch(n.href,r)}})();function T(){const e=new Date;e.setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));const t=new Date(e.getFullYear(),0,1),i=Math.ceil(((e.getTime()-t.getTime())/864e5+1)/7);return`${e.getFullYear()}-W${i.toString().padStart(2,"0")}`}function $(){const e=new Date,t=(e.getMonth()+1).toString().padStart(2,"0");return`${e.getFullYear()}-${t}`}function N(e){if(!e)return"";const t=new Date(e),i=new Date,o=new Date(t);o.setHours(0,0,0,0);const n=new Date(i);n.setHours(0,0,0,0);const r=n.getTime()-o.getTime(),s=Math.floor(r/(1e3*60*60*24));return s===0?"Today":s===1?"1d ago":`${s}d ago`}function x(e){return e?e>=1e3?(e/1e3).toFixed(1)+"K":e.toString():"0"}async function A(e=""){try{const t=await fetch(`/api/alerts${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}catch(t){return console.error("Error fetching alerts:",t),[]}}let M=[];function C(){return M}function F(e){M=e}function b(e){const t=N(e.timestamp);let i=!1,o=!1;if(e.signal_direction!==void 0&&e.signal_direction!==null){const m=Number(e.signal_direction);i=m===1,o=m===-1}else i=!!(e.signal_type&&e.signal_type.toLowerCase().includes("bull")),o=!i;const n=i?"bullish-card":o?"bearish-card":"",r=x(e.signal_volume||0),s=e.intensity_score||0,l=e.combo_score||0,a=i?"#3fb950":"#f85149",c="#0d1117",d=`background: conic-gradient(${a} ${s}%, ${c} 0%);`,u=`background: conic-gradient(${a} ${l}%, ${c} 0%);`,v=`Intensity: ${s}`,g=`Combo: ${l}`;return`
        <div class="alert-card ${n}" data-ticker="${e.ticker}">
            <h3>${e.ticker}</h3>
            
            <div class="metrics-container">
                <div class="metric-item" title="${v}">
                    <div class="score-circle" style="${d}"></div>
                </div>
                <div class="metric-item" title="${g}">
                    <div class="score-circle" style="${u}"></div>
                </div>
                <div class="metric-item" title="Signal Volume">
                    <span class="volume-text">${r}</span>
                </div>
            </div>

            <span class="alert-time">${t}</span>
        </div>
    `}let y="30",_="time",O="time";function W(e){y=e}function j(){return y==="30"||y==="7"?!0:y==="week"?document.getElementById("history-week").value===T():document.getElementById("history-month").value===$()}async function k(e=!1){try{let t="",i="",o="";if(y==="30"){const r=new Date,s=new Date;s.setDate(r.getDate()-30),o=r.toISOString(),i=s.toISOString()}else if(y==="7"){const r=new Date,s=new Date;s.setDate(r.getDate()-7),o=r.toISOString(),i=s.toISOString()}else if(y==="week"){const r=document.getElementById("history-week").value;if(!r)return[];const s=r.split("-W"),l=s[0],a=s[1],c=parseInt(l),d=parseInt(a),u=new Date(c,0,4),v=u.getDay()===0?6:u.getDay()-1,g=new Date(u.setDate(u.getDate()-v)),m=new Date(g.setDate(g.getDate()+(d-1)*7));m.setHours(0,0,0,0);const E=new Date(m);E.setDate(m.getDate()+6),E.setHours(23,59,59,999),i=m.toISOString(),o=E.toISOString()}else{const r=document.getElementById("history-month").value;if(!r)return[];const s=r.split("-"),l=Number(s[0]),a=Number(s[1]),c=new Date(l,a-1,1),d=new Date(l,a,0);d.setHours(23,59,59,999),i=c.toISOString(),o=d.toISOString()}t=`?start_date=${i}&end_date=${o}`;const n=await A(t);return F(n),n}catch(t){return console.error("Error fetching live alerts:",t),[]}}function P(e){_=e,V("daily",e),f()}function Y(e){O=e,V("weekly",e),f()}function V(e,t){const i=e==="daily"?0:1,n=document.querySelectorAll("#dashboard-view .column-header")[i];if(!n)return;const r=n.querySelectorAll(".icon-btn");t==="time"?(r[0].classList.add("active"),r[1].classList.remove("active")):(r[0].classList.remove("active"),r[1].classList.add("active"))}function f(){const e=C();document.getElementById("ticker-view").classList.add("hidden"),document.getElementById("dashboard-view").classList.remove("hidden"),document.getElementById("reset-filter").classList.add("hidden");const t=document.getElementById("daily-container"),i=document.getElementById("weekly-container");let o=e.filter(s=>(s.timeframe||"").trim()==="1d"),n=e.filter(s=>(s.timeframe||"").trim()==="1w");const r=(s,l)=>{s.sort((a,c)=>{if(l==="time"){const d=a.timestamp?new Date(a.timestamp).getTime():0;return(c.timestamp?new Date(c.timestamp).getTime():0)-d}else return(a.ticker||"").localeCompare(c.ticker||"")})};r(o,_),r(n,O),t.innerHTML=o.map(b).join(""),i.innerHTML=n.map(b).join(""),K()}function K(){document.querySelectorAll(".alert-card").forEach(e=>{e.addEventListener("click",()=>{const t=e.dataset.ticker;t&&window.showTickerView&&window.showTickerView(t)})})}async function H(){const e=document.querySelector("#leaderboard-controls .tf-btn.active"),t=e?e.dataset.days:"30";try{const i=await A(`?days=${t}`);R(i)}catch(i){console.error("Error fetching leaderboard:",i)}}function R(e){const t={};e.forEach(n=>{t[n.ticker]||(t[n.ticker]={dailyBull:0,dailyBear:0,weeklyBull:0,weeklyBear:0});const r=n.signal_type&&n.signal_type.toLowerCase().includes("bull");n.timeframe==="1w"?r?t[n.ticker].weeklyBull++:t[n.ticker].weeklyBear++:r?t[n.ticker].dailyBull++:t[n.ticker].dailyBear++});const i=Object.keys(t),o=n=>i.map(r=>({ticker:r,count:t[r][n]})).filter(r=>r.count>0).sort((r,s)=>s.count-r.count).slice(0,10);h("lb-daily-bull",o("dailyBull")),h("lb-daily-bear",o("dailyBear")),h("lb-weekly-bull",o("weeklyBull")),h("lb-weekly-bear",o("weeklyBear"))}function h(e,t){const i=document.getElementById(e);if(i){if(t.length===0){i.innerHTML='<tr><td colspan="2" style="text-align:center; color:#8b949e">No signals found</td></tr>';return}i.innerHTML=`
        <tbody>
            ${t.map(o=>`
                <tr class="clickable-row">
                    <td>${o.ticker}</td>
                    <td>${o.count}</td>
                </tr>
            `).join("")}
        </tbody>
    `,i.querySelectorAll(".clickable-row").forEach((o,n)=>{o.addEventListener("click",()=>{window.showTickerView&&window.showTickerView(t[n].ticker)})})}}let p="time",S=null;function q(e){p=e,document.querySelectorAll(".history-controls .tf-btn").forEach(o=>{const n=o;n.classList.toggle("active",n.dataset.sort===e)});const t=document.getElementById("ticker-view");if(!t)return;const i=t.dataset.ticker;i&&L(i)}function L(e){let i=C().filter(c=>c.ticker===e),o=i.filter(c=>(c.timeframe||"").trim()==="1d"),n=i.filter(c=>(c.timeframe||"").trim()==="1w");const r=(c,d)=>d==="volume"?c.signal_volume||0:d==="intensity"?c.intensity_score||0:d==="combo"?c.combo_score||0:c.timestamp?new Date(c.timestamp).getTime():0,s=(c,d)=>{const u=r(c,p);return r(d,p)-u};o.sort(s),n.sort(s),D("ticker-daily-avg",o),D("ticker-weekly-avg",n);const l=document.getElementById("ticker-daily-container");l&&(o.length===0?l.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No daily alerts</div>':l.innerHTML=o.map(b).join(""));const a=document.getElementById("ticker-weekly-container");a&&(n.length===0?a.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No weekly alerts</div>':a.innerHTML=n.map(b).join("")),U(e)}function D(e,t){const i=document.getElementById(e);if(!i)return;if(t.length===0){i.innerHTML="";return}let o=0;t.forEach(d=>{const u=d.combo_score||0,g=(d.signal_type||"").toLowerCase().includes("bull");o+=g?u:-u});const n=Math.round(o/t.length),r=Math.abs(n),c=`background: conic-gradient(${n>=0?"#3fb950":"#f85149"} ${r}%, #0d1117 0%);`;i.innerHTML=`
        <div class="metric-item" title="Average Score: ${n}">
            <div class="score-circle" style="${c}"></div>
        </div>
    `}function U(e){typeof TradingView>"u"||S!==e&&(S=e,new TradingView.widget({width:"100%",height:600,symbol:e,interval:"D",timezone:"Etc/UTC",theme:"dark",style:"1",locale:"en",toolbar_bg:"#f1f3f6",enable_publishing:!1,allow_symbol_change:!1,container_id:"tradingview_chart",studies:[{id:"MASimple@tv-basicstudies",inputs:{length:50}}]}))}let I="live";window.setDailySort=P;window.setWeeklySort=Y;window.setTickerSort=q;window.showTickerView=function(e){I!=="live"&&B("live");const t=document.getElementById("ticker-view");t&&(t.dataset.ticker=e,document.getElementById("reset-filter")?.classList.remove("hidden"),document.getElementById("dashboard-view")?.classList.add("hidden"),t.classList.remove("hidden"),L(e))};window.showOverview=function(){const e=document.getElementById("ticker-view");e&&delete e.dataset.ticker,f()};function B(e){I=e,document.querySelectorAll(".nav-btn").forEach(t=>t.classList.remove("active")),document.getElementById(`nav-${e}`)?.classList.add("active"),e==="live"?(document.getElementById("view-live")?.classList.remove("hidden"),document.getElementById("view-leaderboard")?.classList.add("hidden"),document.getElementById("live-controls")?.classList.remove("hidden"),document.getElementById("leaderboard-controls")?.classList.add("hidden")):(document.getElementById("view-live")?.classList.add("hidden"),document.getElementById("view-leaderboard")?.classList.remove("hidden"),document.getElementById("live-controls")?.classList.add("hidden"),document.getElementById("leaderboard-controls")?.classList.remove("hidden"),H())}function w(e){W(e);const t=document.getElementById("btn-30"),i=document.getElementById("btn-7"),o=document.getElementById("btn-week"),n=document.getElementById("btn-month"),r=document.getElementById("history-week"),s=document.getElementById("history-month");[t,i,o,n].forEach(l=>l?.classList.remove("active")),r?.classList.add("hidden"),s?.classList.add("hidden"),e==="30"?t?.classList.add("active"):e==="7"?i?.classList.add("active"):e==="week"?(o?.classList.add("active"),r?.classList.remove("hidden")):e==="month"&&(n?.classList.add("active"),s?.classList.remove("hidden")),k(!0).then(()=>{const l=document.getElementById("ticker-view"),a=l?.dataset.ticker;a&&!l?.classList.contains("hidden")?L(a):f()})}function z(){const e=document.getElementById("search-toggle"),t=document.getElementById("search-input");!e||!t||(e.addEventListener("click",()=>{t.classList.contains("active")?(t.classList.remove("active"),t.blur()):(t.classList.add("active"),t.focus())}),t.addEventListener("keydown",i=>{if(i.key==="Enter"){const o=t.value.trim().toUpperCase();o&&(window.showTickerView(o),t.value="",t.blur(),t.classList.remove("active"))}}))}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("nav-live")?.addEventListener("click",()=>B("live")),document.getElementById("nav-leaderboard")?.addEventListener("click",()=>{B("leaderboard")}),document.getElementById("reset-filter")?.addEventListener("click",window.showOverview),document.getElementById("btn-30")?.addEventListener("click",()=>w("30")),document.getElementById("btn-7")?.addEventListener("click",()=>w("7")),document.getElementById("btn-week")?.addEventListener("click",()=>w("week")),document.getElementById("btn-month")?.addEventListener("click",()=>w("month"));const e=document.getElementById("history-week"),t=document.getElementById("history-month");document.querySelectorAll(".history-controls .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const o=i.dataset.sort;q(o)})}),e&&(e.value=T()),t&&(t.value=$()),e?.addEventListener("change",()=>k(!0).then(f)),t?.addEventListener("change",()=>k(!0).then(f)),document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(i=>{i.addEventListener("click",o=>{document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(n=>n.classList.remove("active")),o.target.classList.add("active"),H()})}),w("30"),setInterval(()=>{I==="live"&&j()&&k().then(()=>{const i=document.getElementById("ticker-view"),o=i?.dataset.ticker;o&&!i?.classList.contains("hidden")?L(o):f()})},1e4),z()});
