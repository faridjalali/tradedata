(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function i(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=i(r);fetch(r.href,o)}})();function T(){const e=new Date;e.setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));const t=new Date(e.getFullYear(),0,1),i=Math.ceil(((e.getTime()-t.getTime())/864e5+1)/7);return`${e.getFullYear()}-W${i.toString().padStart(2,"0")}`}function $(){const e=new Date,t=(e.getMonth()+1).toString().padStart(2,"0");return`${e.getFullYear()}-${t}`}function q(e){if(!e)return"";const t=new Date(e),i=new Date,n=new Date(t);n.setHours(0,0,0,0);const r=new Date(i);r.setHours(0,0,0,0);const o=r.getTime()-n.getTime(),s=Math.floor(o/(1e3*60*60*24));return s===0?"Today":s===1?"1d ago":`${s}d ago`}function F(e){return e?e>=1e3?(e/1e3).toFixed(1)+"K":e.toString():"0"}async function A(e=""){try{const t=await fetch(`/api/alerts${e}`);if(!t.ok)throw new Error("Network response was not ok");return await t.json()}catch(t){return console.error("Error fetching alerts:",t),[]}}let M=[];function _(){return M}function N(e){M=e}function b(e){const t=q(e.timestamp);let i=!1,n=!1;if(e.signal_direction!==void 0&&e.signal_direction!==null){const m=Number(e.signal_direction);i=m===1,n=m===-1}else i=!!(e.signal_type&&e.signal_type.toLowerCase().includes("bull")),n=!i;const r=i?"bullish-card":n?"bearish-card":"",o=F(e.signal_volume||0),s=e.intensity_score||0,l=e.combo_score||0,a=i?"#3fb950":"#f85149",c="#0d1117",d=`background: conic-gradient(${a} ${s}%, ${c} 0%);`,u=`background: conic-gradient(${a} ${l}%, ${c} 0%);`,g=`Intensity: ${s}`,v=`Combo: ${l}`;return`
        <div class="alert-card ${r}" data-ticker="${e.ticker}">
            <h3>${e.ticker}</h3>
            
            <div class="metrics-container">
                <div class="metric-item" title="${g}">
                    <div class="score-circle" style="${d}"></div>
                </div>
                <div class="metric-item" title="${v}">
                    <div class="score-circle" style="${u}"></div>
                </div>
                <div class="metric-item" title="Signal Volume">
                    <span class="volume-text">${o}</span>
                </div>
            </div>

            <span class="alert-time">${t}</span>
        </div>
    `}let f="30",C="time",O="time";function x(e){f=e}function W(){return f==="30"||f==="7"?!0:f==="week"?document.getElementById("history-week").value===T():document.getElementById("history-month").value===$()}async function k(e){try{let t="",i="",n="";if(f==="30"){const o=new Date,s=new Date;s.setDate(o.getDate()-30),n=o.toISOString(),i=s.toISOString()}else if(f==="7"){const o=new Date,s=new Date;s.setDate(o.getDate()-7),n=o.toISOString(),i=s.toISOString()}else if(f==="week"){const o=document.getElementById("history-week").value;if(!o)return[];const s=o.split("-W"),l=s[0],a=s[1],c=parseInt(l),d=parseInt(a),u=new Date(c,0,4),g=u.getDay()===0?6:u.getDay()-1,v=new Date(u.setDate(u.getDate()-g)),m=new Date(v.setDate(v.getDate()+(d-1)*7));m.setHours(0,0,0,0);const L=new Date(m);L.setDate(m.getDate()+6),L.setHours(23,59,59,999),i=m.toISOString(),n=L.toISOString()}else{const o=document.getElementById("history-month").value;if(!o)return[];const s=o.split("-"),l=Number(s[0]),a=Number(s[1]),c=new Date(l,a-1,1),d=new Date(l,a,0);d.setHours(23,59,59,999),i=c.toISOString(),n=d.toISOString()}t=`?start_date=${i}&end_date=${n}`;const r=await A(t);return N(r),r}catch(t){return console.error("Error fetching live alerts:",t),[]}}function y(){const e=_();document.getElementById("ticker-view").classList.add("hidden"),document.getElementById("dashboard-view").classList.remove("hidden"),document.getElementById("reset-filter").classList.add("hidden");const t=document.getElementById("daily-container"),i=document.getElementById("weekly-container");let n=e.filter(s=>(s.timeframe||"").trim()==="1d"),r=e.filter(s=>(s.timeframe||"").trim()==="1w");const o=(s,l)=>{s.sort((a,c)=>l==="volume"?(c.signal_volume||0)-(a.signal_volume||0):l==="intensity"?(c.intensity_score||0)-(a.intensity_score||0):l==="combo"?(c.combo_score||0)-(a.combo_score||0):l==="time"?(c.timestamp||"").localeCompare(a.timestamp||""):(a.ticker||"").localeCompare(c.ticker||""))};o(n,C),o(r,O),t.innerHTML=n.map(b).join(""),i.innerHTML=r.map(b).join("")}function j(){const e=document.getElementById("dashboard-view");e&&e.addEventListener("click",t=>{const i=t.target.closest(".alert-card");if(i){const n=i.dataset.ticker;n&&window.showTickerView&&window.showTickerView(n)}})}function P(e){C=e;const t=document.querySelector("#dashboard-view .column:first-child .header-sort-controls");t&&t.querySelectorAll(".tf-btn").forEach(i=>{const n=i;n.dataset.sort===e?n.classList.add("active"):n.classList.remove("active")}),y()}function K(e){O=e;const t=document.querySelector("#dashboard-view .column:last-child .header-sort-controls");t&&t.querySelectorAll(".tf-btn").forEach(i=>{const n=i;n.dataset.sort===e?n.classList.add("active"):n.classList.remove("active")}),y()}async function H(){const e=document.querySelector("#leaderboard-controls .tf-btn.active"),t=e?e.dataset.days:"30";try{const i=await A(`?days=${t}`);Y(i)}catch(i){console.error("Error fetching leaderboard:",i)}}function Y(e){const t={};e.forEach(r=>{t[r.ticker]||(t[r.ticker]={dailyBull:0,dailyBear:0,weeklyBull:0,weeklyBear:0});const o=r.signal_type&&r.signal_type.toLowerCase().includes("bull");r.timeframe==="1w"?o?t[r.ticker].weeklyBull++:t[r.ticker].weeklyBear++:o?t[r.ticker].dailyBull++:t[r.ticker].dailyBear++});const i=Object.keys(t),n=r=>i.map(o=>({ticker:o,count:t[o][r]})).filter(o=>o.count>0).sort((o,s)=>s.count-o.count).slice(0,10);h("lb-daily-bull",n("dailyBull")),h("lb-daily-bear",n("dailyBear")),h("lb-weekly-bull",n("weeklyBull")),h("lb-weekly-bear",n("weeklyBear"))}function h(e,t){const i=document.getElementById(e);if(i){if(t.length===0){i.innerHTML='<tr><td colspan="2" style="text-align:center; color:#8b949e">No signals found</td></tr>';return}i.innerHTML=`
        <tbody>
            ${t.map(n=>`
                <tr class="clickable-row">
                    <td>${n.ticker}</td>
                    <td>${n.count}</td>
                </tr>
            `).join("")}
        </tbody>
    `,i.querySelectorAll(".clickable-row").forEach((n,r)=>{n.addEventListener("click",()=>{window.showTickerView&&window.showTickerView(t[r].ticker)})})}}let p="time",S=null;function V(e){p=e,document.querySelectorAll(".history-controls .tf-btn").forEach(n=>{const r=n;r.classList.toggle("active",r.dataset.sort===e)});const t=document.getElementById("ticker-view");if(!t)return;const i=t.dataset.ticker;i&&E(i)}function E(e){let i=_().filter(c=>c.ticker===e),n=i.filter(c=>(c.timeframe||"").trim()==="1d"),r=i.filter(c=>(c.timeframe||"").trim()==="1w");const o=(c,d)=>d==="volume"?c.signal_volume||0:d==="intensity"?c.intensity_score||0:d==="combo"?c.combo_score||0:c.timestamp?new Date(c.timestamp).getTime():0,s=(c,d)=>{const u=o(c,p);return o(d,p)-u};n.sort(s),r.sort(s),D("ticker-daily-avg",n),D("ticker-weekly-avg",r);const l=document.getElementById("ticker-daily-container");l&&(n.length===0?l.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No daily alerts</div>':l.innerHTML=n.map(b).join(""));const a=document.getElementById("ticker-weekly-container");a&&(r.length===0?a.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No weekly alerts</div>':a.innerHTML=r.map(b).join("")),z(e)}function D(e,t){const i=document.getElementById(e);if(!i)return;if(t.length===0){i.innerHTML="";return}let n=0;t.forEach(d=>{const u=d.combo_score||0,v=(d.signal_type||"").toLowerCase().includes("bull");n+=v?u:-u});const r=Math.round(n/t.length),o=Math.abs(r),c=`background: conic-gradient(${r>=0?"#3fb950":"#f85149"} ${o}%, #0d1117 0%);`;i.innerHTML=`
        <div class="metric-item" title="Average Score: ${r}">
            <div class="score-circle" style="${c}"></div>
        </div>
    `}function z(e){typeof TradingView>"u"||S!==e&&(S=e,new TradingView.widget({width:"100%",height:600,symbol:e,interval:"D",timezone:"Etc/UTC",theme:"dark",style:"1",locale:"en",toolbar_bg:"#f1f3f6",enable_publishing:!1,allow_symbol_change:!1,container_id:"tradingview_chart",studies:[{id:"MASimple@tv-basicstudies",inputs:{length:50}}]}))}let I="live";window.setDailySort=P;window.setWeeklySort=K;window.setTickerSort=V;window.showTickerView=function(e){I!=="live"&&B("live");const t=document.getElementById("ticker-view");t&&(t.dataset.ticker=e,document.getElementById("reset-filter")?.classList.remove("hidden"),document.getElementById("dashboard-view")?.classList.add("hidden"),t.classList.remove("hidden"),E(e))};window.showOverview=function(){const e=document.getElementById("ticker-view");e&&delete e.dataset.ticker,y()};function B(e){I=e,document.querySelectorAll(".nav-btn").forEach(t=>t.classList.remove("active")),document.getElementById(`nav-${e}`)?.classList.add("active"),e==="live"?(document.getElementById("view-live")?.classList.remove("hidden"),document.getElementById("view-leaderboard")?.classList.add("hidden"),document.getElementById("live-controls")?.classList.remove("hidden"),document.getElementById("leaderboard-controls")?.classList.add("hidden")):(document.getElementById("view-live")?.classList.add("hidden"),document.getElementById("view-leaderboard")?.classList.remove("hidden"),document.getElementById("live-controls")?.classList.add("hidden"),document.getElementById("leaderboard-controls")?.classList.remove("hidden"),H())}function w(e){x(e);const t=document.getElementById("btn-30"),i=document.getElementById("btn-7"),n=document.getElementById("btn-week"),r=document.getElementById("btn-month"),o=document.getElementById("history-week"),s=document.getElementById("history-month");[t,i,n,r].forEach(l=>l?.classList.remove("active")),o?.classList.add("hidden"),s?.classList.add("hidden"),e==="30"?t?.classList.add("active"):e==="7"?i?.classList.add("active"):e==="week"?(n?.classList.add("active"),o?.classList.remove("hidden")):e==="month"&&(r?.classList.add("active"),s?.classList.remove("hidden")),k().then(()=>{const l=document.getElementById("ticker-view"),a=l?.dataset.ticker;a&&!l?.classList.contains("hidden")?E(a):y()})}function R(){const e=document.getElementById("search-toggle"),t=document.getElementById("search-input"),i=document.getElementById("search-container");!e||!t||!i||(e.addEventListener("click",n=>{n.stopPropagation(),t.classList.contains("active")?(t.classList.remove("active"),t.blur()):(t.classList.add("active"),t.focus())}),i.addEventListener("click",()=>{t.classList.contains("active")||(t.classList.add("active"),t.focus())}),t.addEventListener("keydown",n=>{if(n.key==="Enter"){const r=t.value.trim().toUpperCase();r&&(window.showTickerView(r),t.value="",t.blur(),t.classList.remove("active"))}}),document.addEventListener("keydown",n=>{document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement.isContentEditable||n.ctrlKey||n.altKey||n.metaKey||n.key.length>1||/^[a-zA-Z0-9]$/.test(n.key)&&(t.classList.contains("active")||t.classList.add("active"),t.focus())}))}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("nav-live")?.addEventListener("click",()=>B("live")),document.getElementById("nav-leaderboard")?.addEventListener("click",()=>{B("leaderboard")}),document.getElementById("reset-filter")?.addEventListener("click",window.showOverview),document.getElementById("btn-30")?.addEventListener("click",()=>w("30")),document.getElementById("btn-7")?.addEventListener("click",()=>w("7")),document.getElementById("btn-week")?.addEventListener("click",()=>w("week")),document.getElementById("btn-month")?.addEventListener("click",()=>w("month"));const e=document.getElementById("history-week"),t=document.getElementById("history-month");document.querySelectorAll(".history-controls .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const n=i.dataset.sort;V(n)})}),e&&(e.value=T()),t&&(t.value=$()),e?.addEventListener("change",()=>k().then(y)),t?.addEventListener("change",()=>k().then(y)),document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(i=>{i.addEventListener("click",n=>{document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(r=>r.classList.remove("active")),n.target.classList.add("active"),H()})}),w("30"),setInterval(()=>{I==="live"&&W()&&k().then(()=>{const i=document.getElementById("ticker-view"),n=i?.dataset.ticker;n&&!i?.classList.contains("hidden")?E(n):y()})},1e4),R(),j()});
