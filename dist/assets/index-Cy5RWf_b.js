(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))r(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function i(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function r(n){if(n.ep)return;n.ep=!0;const o=i(n);fetch(n.href,o)}})();function U(){const e=new Date;e.setHours(0,0,0,0),e.setDate(e.getDate()+4-(e.getDay()||7));const t=new Date(e.getFullYear(),0,1),i=Math.ceil(((e.getTime()-t.getTime())/864e5+1)/7);return`${e.getFullYear()}-W${i.toString().padStart(2,"0")}`}function K(){const e=new Date,t=(e.getMonth()+1).toString().padStart(2,"0");return`${e.getFullYear()}-${t}`}function fe(e){if(!e)return"";const t=new Date(e),i=new Date,r=new Date(t);r.setHours(0,0,0,0);const n=new Date(i);n.setHours(0,0,0,0);const o=n.getTime()-r.getTime(),s=Math.floor(o/(1e3*60*60*24));return s===0?"Today":s===1?"1d ago":`${s}d ago`}function me(e){if(!e)return"0".padEnd(7);let t;return e>=1e3?t=(e/1e3).toFixed(1)+"K":t=e.toString(),t.padEnd(7)}function he(e,t,i){let r="",n="";if(e==="30"||e==="7"||e==="1"){const o=parseInt(e),s=new Date,c=new Date;c.setDate(s.getDate()-o),n=s.toISOString(),r=c.toISOString()}else if(e==="week"){if(!t)return{startDate:"",endDate:""};const o=t.split("-W"),s=o[0],c=o[1],l=parseInt(s),a=parseInt(c),u=new Date(l,0,4),h=u.getDay()===0?6:u.getDay()-1,f=new Date(u.setDate(u.getDate()-h)),v=new Date(f.setDate(f.getDate()+(a-1)*7));v.setHours(0,0,0,0);const B=new Date(v);B.setDate(v.getDate()+6),B.setHours(23,59,59,999),r=v.toISOString(),n=B.toISOString()}else{if(!i)return{startDate:"",endDate:""};const o=i.split("-"),s=Number(o[0]),c=Number(o[1]),l=new Date(s,c-1,1),a=new Date(s,c,0);a.setHours(23,59,59,999),r=l.toISOString(),n=a.toISOString()}return{startDate:r,endDate:n}}function V(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")}function H(e){return(t,i)=>e==="time"?(i.timestamp||"").localeCompare(t.timestamp||""):e==="favorite"?t.is_favorite===i.is_favorite?(i.timestamp||"").localeCompare(t.timestamp||""):(i.is_favorite?1:0)-(t.is_favorite?1:0):e==="volume"?(i.signal_volume||0)-(t.signal_volume||0):e==="intensity"?(i.intensity_score||0)-(t.intensity_score||0):e==="combo"?(i.combo_score||0)-(t.combo_score||0):(i.timestamp||"").localeCompare(t.timestamp||"")}function ge(e){return typeof e=="boolean"?e:typeof e=="string"?e.toLowerCase()==="true":typeof e=="number"?e===1:!1}function Z(e){const t=e,i=Number(t.id);if(!Number.isFinite(i))throw new Error("Invalid alert payload: missing/invalid id");return{...t,id:i,is_favorite:ge(t.is_favorite)}}async function X(e=""){try{const t=await fetch(`/api/alerts${e}`);if(!t.ok)throw new Error("Network response was not ok");const i=await t.json();if(!Array.isArray(i))throw new Error("Invalid alert payload: expected array");return i.map(Z)}catch(t){throw console.error("Error fetching alerts:",t),t}}async function ye(e){const t=await fetch(`/api/alerts/${e}/favorite`,{method:"POST"});if(!t.ok)throw new Error("Network response was not ok");return Z(await t.json())}let G=[];function O(){return G}function J(e){G=e}function x(e){const t=fe(e.timestamp);let i=!1,r=!1;if(e.signal_direction!==void 0&&e.signal_direction!==null){const W=Number(e.signal_direction);i=W===1,r=W===-1}else i=!!(e.signal_type&&e.signal_type.toLowerCase().includes("bull")),r=!i;const n=i?"bullish-card":r?"bearish-card":"",o=me(e.signal_volume||0),s=e.intensity_score||0,c=e.combo_score||0,l=i?"#3fb950":"#f85149",a="#0d1117",u=`background: conic-gradient(${l} ${s}%, ${a} 0%);`,h=`background: conic-gradient(${l} ${c}%, ${a} 0%);`,f=e.is_favorite===!0||String(e.is_favorite).toLowerCase()==="true",v=f?"filled":"",B=f?"visible":"hidden",de=f?"1":"0",ue=`
        <svg class="fav-icon ${v}" data-id="${e.id}" viewBox="0 0 24 24" width="16" height="16" stroke="currentColor" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round">
            <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
            <polyline class="check-mark" points="9 12 11 14 15 10" style="visibility: ${B}; opacity: ${de};"></polyline>
        </svg>
    `;return`
        <div class="alert-card ${n}" data-ticker="${V(e.ticker)}">
            ${ue}
            <h3>${V(e.ticker)}</h3>
            
            <div class="metrics-container">
                <div class="metric-item" title="Intensity: ${s}">
                    <div class="score-circle" style="${u}"></div>
                </div>
                <div class="metric-item" title="Combo: ${c}">
                    <div class="score-circle" style="${h}"></div>
                </div>
                <div class="metric-item" title="Signal Volume">
                    <span class="volume-text">${o}</span>
                </div>
            </div>

            <span class="alert-time">${t}</span>
        </div>
    `}let E="1",Q="time",ee="time";function we(e){E=e}function ve(){return E==="30"||E==="7"||E==="1"?!0:E==="week"?document.getElementById("history-week").value===U():document.getElementById("history-month").value===K()}async function _(e){try{const t=document.getElementById("history-week")?.value||"",i=document.getElementById("history-month")?.value||"",{startDate:r,endDate:n}=he(E,t,i);if(!r||!n)return[];const o=`?start_date=${r}&end_date=${n}`,s=await X(o);return J(s),s}catch(t){return console.error("Error fetching live alerts:",t),[]}}function p(){const e=O();document.getElementById("ticker-view").classList.add("hidden"),document.getElementById("dashboard-view").classList.remove("hidden"),document.getElementById("reset-filter").classList.add("hidden");const t=document.getElementById("daily-container"),i=document.getElementById("weekly-container"),r=e.filter(o=>(o.timeframe||"").trim()==="1d"),n=e.filter(o=>(o.timeframe||"").trim()==="1w");r.sort(H(Q)),n.sort(H(ee)),t.innerHTML=r.map(x).join(""),i.innerHTML=n.map(x).join("")}function pe(){const e=document.getElementById("view-live");e&&e.addEventListener("click",t=>{const i=t.target,r=i.closest(".fav-icon");if(r){t.stopPropagation();const o=r.dataset.id;if(o){const s=document.querySelectorAll(`.fav-icon[data-id="${o}"]`),c=r.classList.contains("filled");s.forEach(l=>{const a=l.querySelector(".check-mark");c?(l.classList.remove("filled"),a&&(a.style.visibility="hidden",a.style.opacity="0")):(l.classList.add("filled"),a&&(a.style.visibility="visible",a.style.opacity="1"))}),ye(Number(o)).then(l=>{const a=O(),u=a.findIndex(h=>h.id===l.id);u!==-1&&(a[u].is_favorite=l.is_favorite,J(a),s.forEach(h=>{const f=h.querySelector(".check-mark");l.is_favorite?(h.classList.add("filled"),f&&(f.style.visibility="visible",f.style.opacity="1")):(h.classList.remove("filled"),f&&(f.style.visibility="hidden",f.style.opacity="0"))}))}).catch(()=>{s.forEach(l=>{const a=l.querySelector(".check-mark");c?(l.classList.add("filled"),a&&(a.style.visibility="visible",a.style.opacity="1")):(l.classList.remove("filled"),a&&(a.style.visibility="hidden",a.style.opacity="0"))})})}return}const n=i.closest(".alert-card");if(n){const o=n.dataset.ticker;o&&window.showTickerView&&window.showTickerView(o)}})}function be(e){Q=e;const t=document.querySelector("#dashboard-view .column:first-child .header-sort-controls");t&&t.querySelectorAll(".tf-btn").forEach(i=>{const r=i;r.dataset.sort===e?r.classList.add("active"):r.classList.remove("active")}),p()}function ke(e){ee=e;const t=document.querySelector("#dashboard-view .column:last-child .header-sort-controls");t&&t.querySelectorAll(".tf-btn").forEach(i=>{const r=i;r.dataset.sort===e?r.classList.add("active"):r.classList.remove("active")}),p()}async function te(){const e=document.querySelector("#leaderboard-controls .tf-btn.active"),t=e?e.dataset.days:"30";try{const i=await X(`?days=${t}`);Le(i)}catch(i){console.error("Error fetching leaderboard:",i)}}function Le(e){const t={};e.forEach(n=>{t[n.ticker]||(t[n.ticker]={dailyBullSum:0,dailyBullCount:0,dailyBearSum:0,dailyBearCount:0,weeklyBullSum:0,weeklyBullCount:0,weeklyBearSum:0,weeklyBearCount:0});const o=n.combo_score||0,s=n.signal_type&&n.signal_type.toLowerCase().includes("bull");n.timeframe==="1w"?s?(t[n.ticker].weeklyBullSum+=o,t[n.ticker].weeklyBullCount++):(t[n.ticker].weeklyBearSum+=o,t[n.ticker].weeklyBearCount++):s?(t[n.ticker].dailyBullSum+=o,t[n.ticker].dailyBullCount++):(t[n.ticker].dailyBearSum+=o,t[n.ticker].dailyBearCount++)});const i=Object.keys(t),r=(n,o)=>i.filter(s=>t[s][o]>0).map(s=>({ticker:s,avgScore:Math.round(t[s][n]/t[s][o])})).sort((s,c)=>c.avgScore-s.avgScore).slice(0,10);T("lb-daily-bull",r("dailyBullSum","dailyBullCount")),T("lb-daily-bear",r("dailyBearSum","dailyBearCount")),T("lb-weekly-bull",r("weeklyBullSum","weeklyBullCount")),T("lb-weekly-bear",r("weeklyBearSum","weeklyBearCount"))}function T(e,t){const i=document.getElementById(e);if(i){if(t.length===0){i.innerHTML='<tr><td colspan="2" style="text-align:center; color:#8b949e">No signals found</td></tr>';return}i.innerHTML=`
        <tbody>
            ${t.map(r=>`
                <tr class="clickable-row" data-ticker="${V(r.ticker)}">
                    <td>${V(r.ticker)}</td>
                    <td>${r.avgScore}</td>
                </tr>
            `).join("")}
        </tbody>
    `}}function Ee(){const e=document.getElementById("view-leaderboard");e&&e.addEventListener("click",t=>{const r=t.target.closest(".clickable-row");r&&r.dataset.ticker&&window.showTickerView&&window.showTickerView(r.dataset.ticker)})}async function Se(e,t){const i=`/api/chart?ticker=${encodeURIComponent(e)}&interval=${t}`,r=await fetch(i);if(!r.ok){const n=await r.json().catch(()=>({error:"Failed to fetch chart data"}));throw new Error(n.error||`HTTP ${r.status}`)}return r.json()}function Be(e){const t=[];for(let i=0;i<e.length;i+=2)i+1<e.length?t.push({time:e[i].time,open:e[i].open,high:Math.max(e[i].high,e[i+1].high),low:Math.min(e[i].low,e[i+1].low),close:e[i+1].close,volume:e[i].volume+e[i+1].volume}):t.push(e[i]);return t}class Ce{chart;series;lineTools;displayMode;data;constructor(t){this.displayMode=t.displayMode,this.data=t.data,this.chart=LightweightCharts.createChart(t.container,{height:150,layout:{background:{color:"#0d1117"},textColor:"#c9d1d9"},grid:{vertLines:{color:"#21262d"},horzLines:{color:"#21262d"}},timeScale:{timeVisible:!0,secondsVisible:!1,borderColor:"#21262d"},rightPriceScale:{borderColor:"#21262d",scaleMargins:{top:.1,bottom:.1}},crosshair:{mode:1}}),this.addReferenceLine(70,"Overbought","#f85149"),this.addReferenceLine(30,"Oversold","#3fb950"),this.updateSeries(),typeof LightweightChartsLineTools<"u"&&(this.lineTools=new LightweightChartsLineTools.LineTools(this.chart))}addReferenceLine(t,i,r){this.chart.addLineSeries({color:r,lineWidth:1,lineStyle:2,priceLineVisible:!1,lastValueVisible:!1,crosshairMarkerVisible:!1}).setData([{time:"2020-01-01",value:t},{time:"2030-01-01",value:t}])}updateSeries(){this.series&&this.chart.removeSeries(this.series),this.displayMode==="line"?this.series=this.chart.addLineSeries({color:"#58a6ff",lineWidth:2,priceLineVisible:!0,lastValueVisible:!0}):this.series=this.chart.addHistogramSeries({color:"#58a6ff",priceFormat:{type:"price",precision:2,minMove:.01},priceLineVisible:!0,lastValueVisible:!0}),this.displayMode==="line"?this.series.setData(this.data):this.series.setData(this.data.map(t=>({time:t.time,value:t.value,color:"#58a6ff"})))}setDisplayMode(t){this.displayMode!==t&&(this.displayMode=t,this.updateSeries())}setData(t){this.data=t,this.series&&(this.displayMode==="line"?this.series.setData(t):this.series.setData(t.map(i=>({time:i.time,value:i.value,color:"#58a6ff"}))))}getChart(){return this.chart}getSeries(){return this.series}getLineTools(){return this.lineTools}resize(){this.chart&&this.chart.resize(this.chart.options().width,150)}destroy(){this.chart&&this.chart.remove()}}let y=null,w="1day",g=null,F=null,d=null,m=null,M=!1,C=null,I=null,b=null,S=null,k=null;function Ie(e){if(y=e,C=document.getElementById("price-chart-container"),I=document.getElementById("rsi-chart-container"),b=document.getElementById("chart-loading"),S=document.getElementById("chart-error"),k=document.getElementById("chart-content"),!C||!I){console.error("Chart containers not found");return}De(),Te(),ie(e,w)}function De(){!C||!I||g||(g=LightweightCharts.createChart(C,{height:400,layout:{background:{color:"#0d1117"},textColor:"#c9d1d9"},grid:{vertLines:{color:"#21262d"},horzLines:{color:"#21262d"}},timeScale:{timeVisible:!0,secondsVisible:!1,borderColor:"#21262d"},rightPriceScale:{borderColor:"#21262d"},crosshair:{mode:1}}),F=g.addCandlestickSeries({upColor:"#3fb950",downColor:"#f85149",borderVisible:!1,wickUpColor:"#3fb950",wickDownColor:"#f85149"}),typeof LightweightChartsLineTools<"u"&&(m=new LightweightChartsLineTools.LineTools(g)))}function Te(){document.querySelectorAll("#chart-controls .feed-controls-group:first-child .tf-btn").forEach(r=>{r.addEventListener("click",n=>{const s=n.target.dataset.interval;s&&y&&$e(s)})}),document.querySelectorAll("#drawing-tools .tf-btn").forEach(r=>{r.addEventListener("click",n=>{const s=n.target.dataset.tool;s&&Ae(s)})}),document.querySelectorAll("#chart-controls .feed-controls-group:last-child .tf-btn").forEach(r=>{r.addEventListener("click",n=>{const s=n.target.dataset.mode;s&&d&&_e(s)})})}function $e(e){if(M||!y||e===w)return;w=e,document.querySelectorAll("#chart-controls .feed-controls-group:first-child .tf-btn").forEach(i=>{i.classList.toggle("active",i.dataset.interval===e)}),ie(y,e)}function _e(e){if(!d)return;document.querySelectorAll("#chart-controls .feed-controls-group:last-child .tf-btn").forEach(i=>{i.classList.toggle("active",i.dataset.mode===e)}),d.setDisplayMode(e)}async function ie(e,t){if(!M){M=!0,xe();try{const i=await Se(e,t);let r=i.bars;t==="2hour"&&(r=Be(r)),F&&(F.setData(r),g.timeScale().fitContent()),!d&&I?(d=new Ce({container:I,data:i.rsi,displayMode:"line"}),Me()):d&&d.setData(i.rsi),qe(),setTimeout(()=>He(),100)}catch(i){console.error("Failed to load chart data:",i),Fe(i instanceof Error?i.message:"Failed to load chart data")}finally{M=!1}}}function Me(){if(!g||!d)return;const e=d.getChart();g.timeScale().subscribeVisibleLogicalRangeChange(t=>{t&&e.timeScale().setVisibleLogicalRange(t)}),e.timeScale().subscribeVisibleLogicalRangeChange(t=>{t&&g.timeScale().setVisibleLogicalRange(t)}),g.subscribeCrosshairMove(t=>{if(!t||!t.time){e.clearCrosshairPosition();return}e.setCrosshairPosition(t.logical,t.time)}),e.subscribeCrosshairMove(t=>{if(!t||!t.time){g.clearCrosshairPosition();return}g.setCrosshairPosition(t.logical,t.time)})}function Ae(e){if(!m)return;if(e==="clear"){if(m.clearDrawings(),d){const r=d.getLineTools();r&&r.clearDrawings()}y&&w&&(localStorage.removeItem(`drawings_price_${y}_${w}`),localStorage.removeItem(`drawings_rsi_${y}_${w}`)),document.querySelectorAll("#drawing-tools .tf-btn").forEach(r=>r.classList.remove("active"));return}switch(document.querySelectorAll("#drawing-tools .tf-btn").forEach(i=>{i.dataset.tool===e?i.classList.toggle("active"):i.dataset.tool!=="clear"&&i.classList.remove("active")}),e){case"trend":m.startDrawing(LightweightChartsLineTools.DrawingType.TREND_LINE);break;case"horizontal":m.startDrawing(LightweightChartsLineTools.DrawingType.HORIZONTAL_LINE);break;case"ray":m.startDrawing(LightweightChartsLineTools.DrawingType.RAY);break}Ve()}function Ve(){m&&(m.onDrawingAdded(()=>q()),m.onDrawingModified(()=>q()),m.onDrawingRemoved(()=>q()))}function q(){if(!(!y||!w||!m))try{const e=m.exportDrawings();if(localStorage.setItem(`drawings_price_${y}_${w}`,e),d){const t=d.getLineTools();if(t){const i=t.exportDrawings();localStorage.setItem(`drawings_rsi_${y}_${w}`,i)}}}catch(e){console.error("Failed to save drawings:",e)}}function He(){if(!(!y||!w||!m))try{const e=localStorage.getItem(`drawings_price_${y}_${w}`);if(e&&m.importDrawings(e),d){const t=d.getLineTools();if(t){const i=localStorage.getItem(`drawings_rsi_${y}_${w}`);i&&t.importDrawings(i)}}}catch(e){console.error("Failed to load drawings:",e)}}function xe(){b&&(b.style.display="block"),S&&(S.style.display="none"),k&&(k.style.opacity="0.5")}function qe(){b&&(b.style.display="none"),k&&(k.style.opacity="1")}function Fe(e){S&&(S.textContent=e,S.style.display="block"),b&&(b.style.display="none"),k&&(k.style.opacity="0.5")}window.addEventListener("resize",()=>{g&&g.resize(C?.clientWidth||0,400),d&&d.resize()});let re="time",ne="time",z=null;function oe(e){re=e,ae(".ticker-daily-sort",e);const t=document.getElementById("ticker-view");if(!t)return;const i=t.dataset.ticker;i&&D(i)}function se(e){ne=e,ae(".ticker-weekly-sort",e);const t=document.getElementById("ticker-view");if(!t)return;const i=t.dataset.ticker;i&&D(i)}function ae(e,t){document.querySelectorAll(`${e} .tf-btn`).forEach(i=>{const r=i;r.classList.toggle("active",r.dataset.sort===t)})}function D(e){const i=O().filter(c=>c.ticker===e),r=i.filter(c=>(c.timeframe||"").trim()==="1d"),n=i.filter(c=>(c.timeframe||"").trim()==="1w");r.sort(H(re)),n.sort(H(ne)),j("ticker-daily-avg",r),j("ticker-weekly-avg",n);const o=document.getElementById("ticker-daily-container");o&&(r.length===0?o.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No daily alerts</div>':o.innerHTML=r.map(x).join(""));const s=document.getElementById("ticker-weekly-container");s&&(n.length===0?s.innerHTML='<div style="text-align:center; padding:20px; color:var(--text-secondary)">No weekly alerts</div>':s.innerHTML=n.map(x).join("")),Ne(e),Ie(e)}function j(e,t){const i=document.getElementById(e);if(!i)return;if(t.length===0){i.innerHTML="";return}let r=0;t.forEach(u=>{const h=u.combo_score||0,v=(u.signal_type||"").toLowerCase().includes("bull");r+=v?h:-h});const n=Math.round(r/t.length),o=Math.abs(n),a=`background: conic-gradient(${n>=0?"#3fb950":"#f85149"} ${o}%, #0d1117 0%);`;i.innerHTML=`
        <div class="metric-item" title="Average Score: ${n}">
            <div class="score-circle" style="${a}"></div>
        </div>
    `}function Ne(e){typeof TradingView>"u"||z!==e&&(z=e,new TradingView.widget({width:"100%",height:600,symbol:e,interval:"D",timezone:"Etc/UTC",theme:"dark",style:"1",locale:"en",toolbar_bg:"#f1f3f6",enable_publishing:!1,allow_symbol_change:!1,container_id:"tradingview_chart",studies:[{id:"MASimple@tv-basicstudies",inputs:{length:50}}]}))}let $=null,ce=5,N="SVIX";async function Oe(e,t){const i=await fetch(`/api/breadth?ticker=${e}&days=${t}`);if(!i.ok)throw new Error("Failed to fetch breadth data");return i.json()}function Y(e){if(e.length===0)return[];const t=e[0];return t===0?e.map(()=>100):e.map(i=>i/t*100)}function Re(e,t,i){const r=document.getElementById("breadth-chart");if(!r)return;$&&($.destroy(),$=null);const n=e.map(a=>i?new Date(a.date).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",timeZone:"America/Los_Angeles"}):new Date(a.date+"T00:00:00").toLocaleDateString("en-US",{month:"short",day:"numeric"})),o=e.map(a=>a.spy),s=e.map(a=>a.comparison),c=Y(o),l=Y(s);$=new Chart(r,{type:"line",data:{labels:n,datasets:[{label:"SPY",data:c,borderColor:"#58a6ff",backgroundColor:"transparent",borderWidth:2.5,pointRadius:c.length>15?0:3,pointHoverRadius:5,tension:.3,order:1,fill:!1},{label:t,data:l,borderColor:"#d2a8ff",backgroundColor:"transparent",borderWidth:2.5,pointRadius:l.length>15?0:3,pointHoverRadius:5,tension:.3,order:2,fill:{target:0,above:"rgba(63, 185, 80, 0.18)",below:"rgba(248, 81, 73, 0.18)"}}]},options:{responsive:!0,maintainAspectRatio:!1,interaction:{mode:"index",intersect:!1},plugins:{legend:{labels:{color:"#c9d1d9",font:{size:12},usePointStyle:!0,pointStyle:"line"}},tooltip:{backgroundColor:"rgba(22, 27, 34, 0.95)",borderColor:"#30363d",borderWidth:1,titleColor:"#c9d1d9",bodyColor:"#8b949e",padding:12,callbacks:{label:function(a){const u=a.parsed.y.toFixed(2);return`${a.dataset.label}: ${u}`}}},filler:{propagate:!0}},scales:{x:{ticks:{color:"#8b949e",maxRotation:0,autoSkip:!0,maxTicksLimit:10,font:{size:11}},grid:{color:"rgba(48, 54, 61, 0.3)"}},y:{ticks:{color:"#8b949e",font:{size:11},callback:function(a){return a.toFixed(1)}},grid:{color:"rgba(48, 54, 61, 0.3)"}}}}})}async function R(){const e=document.getElementById("breadth-error");e&&(e.style.display="none");try{const t=await Oe(N,ce);if(t.points.length===0){e&&(e.textContent="No data available for this timeframe",e.style.display="block");return}Re(t.points,N,t.intraday)}catch(t){console.error("Breadth load error:",t),e&&(e.textContent="Failed to load breadth data",e.style.display="block")}}function Pe(e){ce=e,document.querySelectorAll("#breadth-tf-btns .tf-btn").forEach(t=>{t.classList.toggle("active",Number(t.dataset.days)===e)}),R()}function We(e){N=e,document.querySelectorAll("#breadth-metric-btns .tf-btn").forEach(t=>{t.classList.toggle("active",t.dataset.metric===e)}),R()}function ze(){R()}let P="live",le=0;window.setDailySort=be;window.setWeeklySort=ke;window.setTickerDailySort=oe;window.setTickerWeeklySort=se;window.showTickerView=function(e){P!=="live"&&A("live"),le=window.scrollY;const t=document.getElementById("ticker-view");t&&(t.dataset.ticker=e,document.getElementById("reset-filter")?.classList.remove("hidden"),document.getElementById("dashboard-view")?.classList.add("hidden"),t.classList.remove("hidden"),D(e),window.scrollTo(0,0))};window.showOverview=function(){const e=document.getElementById("ticker-view");e&&delete e.dataset.ticker,p(),window.scrollTo(0,le)};function A(e){P=e,document.querySelectorAll(".nav-btn").forEach(t=>t.classList.remove("active")),document.getElementById(`nav-${e}`)?.classList.add("active"),document.getElementById("view-live")?.classList.add("hidden"),document.getElementById("view-leaderboard")?.classList.add("hidden"),document.getElementById("view-breadth")?.classList.add("hidden"),document.getElementById("live-controls")?.classList.add("hidden"),document.getElementById("leaderboard-controls")?.classList.add("hidden"),document.getElementById("breadth-controls")?.classList.add("hidden"),e==="live"?(document.getElementById("view-live")?.classList.remove("hidden"),document.getElementById("live-controls")?.classList.remove("hidden")):e==="leaderboard"?(document.getElementById("view-leaderboard")?.classList.remove("hidden"),document.getElementById("leaderboard-controls")?.classList.remove("hidden"),te()):e==="breadth"&&(document.getElementById("view-breadth")?.classList.remove("hidden"),document.getElementById("breadth-controls")?.classList.remove("hidden"),ze())}function L(e){we(e);const t=document.getElementById("btn-30"),i=document.getElementById("btn-7"),r=document.getElementById("btn-1"),n=document.getElementById("btn-week"),o=document.getElementById("btn-month"),s=document.getElementById("history-week"),c=document.getElementById("history-month");[t,i,r,n,o].forEach(l=>l?.classList.remove("active")),s?.classList.add("hidden"),c?.classList.add("hidden"),e==="30"?t?.classList.add("active"):e==="7"?i?.classList.add("active"):e==="1"?r?.classList.add("active"):e==="week"?(n?.classList.add("active"),s?.classList.remove("hidden")):e==="month"&&(o?.classList.add("active"),c?.classList.remove("hidden")),_().then(()=>{const l=document.getElementById("ticker-view"),a=l?.dataset.ticker;a&&!l?.classList.contains("hidden")?D(a):p()})}function je(){const e=document.getElementById("search-toggle"),t=document.getElementById("search-input"),i=document.getElementById("search-container");!e||!t||!i||(e.addEventListener("click",r=>{r.stopPropagation(),t.classList.contains("active")?(t.classList.remove("active"),t.blur()):(t.classList.add("active"),t.focus())}),i.addEventListener("click",()=>{t.classList.contains("active")||(t.classList.add("active"),t.focus())}),t.addEventListener("keydown",r=>{if(r.key==="Enter"){const n=t.value.trim().toUpperCase();n&&(window.showTickerView(n),t.value="",t.blur(),t.classList.remove("active"))}}),document.addEventListener("keydown",r=>{document.activeElement instanceof HTMLInputElement||document.activeElement instanceof HTMLTextAreaElement||document.activeElement.isContentEditable||r.ctrlKey||r.altKey||r.metaKey||r.key.length>1||/^[a-zA-Z0-9]$/.test(r.key)&&(t.classList.contains("active")||t.classList.add("active"),t.focus())}))}document.addEventListener("DOMContentLoaded",()=>{document.getElementById("nav-live")?.addEventListener("click",()=>A("live")),document.getElementById("nav-leaderboard")?.addEventListener("click",()=>{A("leaderboard")}),document.getElementById("nav-breadth")?.addEventListener("click",()=>A("breadth")),document.getElementById("reset-filter")?.addEventListener("click",window.showOverview),document.getElementById("btn-30")?.addEventListener("click",()=>L("30")),document.getElementById("btn-7")?.addEventListener("click",()=>L("7")),document.getElementById("btn-1")?.addEventListener("click",()=>L("1")),document.getElementById("btn-week")?.addEventListener("click",()=>L("week")),document.getElementById("btn-month")?.addEventListener("click",()=>L("month"));const e=document.getElementById("history-week"),t=document.getElementById("history-month");document.querySelectorAll(".ticker-daily-sort .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const r=i.dataset.sort;oe(r)})}),document.querySelectorAll(".ticker-weekly-sort .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const r=i.dataset.sort;se(r)})}),e&&(e.value=U()),t&&(t.value=K()),e?.addEventListener("change",()=>_().then(p)),t?.addEventListener("change",()=>_().then(p)),document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(i=>{i.addEventListener("click",r=>{document.querySelectorAll("#leaderboard-controls .tf-btn").forEach(n=>n.classList.remove("active")),r.target.classList.add("active"),te()})}),document.querySelectorAll("#breadth-tf-btns .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const r=Number(i.dataset.days);Pe(r)})}),document.querySelectorAll("#breadth-metric-btns .tf-btn").forEach(i=>{i.addEventListener("click",()=>{const r=i.dataset.metric;We(r);const n=document.getElementById("breadth-subtitle");n&&(n.textContent=`SPY vs ${r} â€” Normalized`)})}),L("1"),setInterval(()=>{P==="live"&&ve()&&_().then(()=>{const i=document.getElementById("ticker-view"),r=i?.dataset.ticker;r&&!i?.classList.contains("hidden")?D(r):p()})},1e4),je(),pe(),Ee(),Ye()});function Ye(){const e=document.getElementById("view-live");e&&e.addEventListener("click",t=>{if(window.innerWidth>768)return;const i=t.target;if(i.tagName!=="H2"||!(i.closest(".column-header")||i.closest(".header-title-group")))return;const n=i.closest(".column");n&&n.classList.toggle("collapsed")})}
